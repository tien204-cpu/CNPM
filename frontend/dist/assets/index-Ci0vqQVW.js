(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const x of document.querySelectorAll('link[rel="modulepreload"]'))_(x);new MutationObserver(x=>{for(const P of x)if(P.type==="childList")for(const b of P.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&_(b)}).observe(document,{childList:!0,subtree:!0});function d(x){const P={};return x.integrity&&(P.integrity=x.integrity),x.referrerPolicy&&(P.referrerPolicy=x.referrerPolicy),x.crossOrigin==="use-credentials"?P.credentials="include":x.crossOrigin==="anonymous"?P.credentials="omit":P.credentials="same-origin",P}function _(x){if(x.ep)return;x.ep=!0;const P=d(x);fetch(x.href,P)}})();var uT=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function hT(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var N0={exports:{}},yf={},V0={exports:{}},cr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Qh=Symbol.for("react.element"),dT=Symbol.for("react.portal"),pT=Symbol.for("react.fragment"),fT=Symbol.for("react.strict_mode"),mT=Symbol.for("react.profiler"),gT=Symbol.for("react.provider"),_T=Symbol.for("react.context"),yT=Symbol.for("react.forward_ref"),vT=Symbol.for("react.suspense"),xT=Symbol.for("react.memo"),bT=Symbol.for("react.lazy"),hx=Symbol.iterator;function wT(r){return r===null||typeof r!="object"?null:(r=hx&&r[hx]||r["@@iterator"],typeof r=="function"?r:null)}var $0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},U0=Object.assign,Z0={};function ru(r,o,d){this.props=r,this.context=o,this.refs=Z0,this.updater=d||$0}ru.prototype.isReactComponent={};ru.prototype.setState=function(r,o){if(typeof r!="object"&&typeof r!="function"&&r!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,r,o,"setState")};ru.prototype.forceUpdate=function(r){this.updater.enqueueForceUpdate(this,r,"forceUpdate")};function G0(){}G0.prototype=ru.prototype;function M_(r,o,d){this.props=r,this.context=o,this.refs=Z0,this.updater=d||$0}var k_=M_.prototype=new G0;k_.constructor=M_;U0(k_,ru.prototype);k_.isPureReactComponent=!0;var dx=Array.isArray,q0=Object.prototype.hasOwnProperty,E_={current:null},H0={key:!0,ref:!0,__self:!0,__source:!0};function W0(r,o,d){var _,x={},P=null,b=null;if(o!=null)for(_ in o.ref!==void 0&&(b=o.ref),o.key!==void 0&&(P=""+o.key),o)q0.call(o,_)&&!H0.hasOwnProperty(_)&&(x[_]=o[_]);var c=arguments.length-2;if(c===1)x.children=d;else if(1<c){for(var U=Array(c),Q=0;Q<c;Q++)U[Q]=arguments[Q+2];x.children=U}if(r&&r.defaultProps)for(_ in c=r.defaultProps,c)x[_]===void 0&&(x[_]=c[_]);return{$$typeof:Qh,type:r,key:P,ref:b,props:x,_owner:E_.current}}function TT(r,o){return{$$typeof:Qh,type:r.type,key:o,ref:r.ref,props:r.props,_owner:r._owner}}function I_(r){return typeof r=="object"&&r!==null&&r.$$typeof===Qh}function ST(r){var o={"=":"=0",":":"=2"};return"$"+r.replace(/[=:]/g,function(d){return o[d]})}var px=/\/+/g;function Jm(r,o){return typeof r=="object"&&r!==null&&r.key!=null?ST(""+r.key):o.toString(36)}function Ap(r,o,d,_,x){var P=typeof r;(P==="undefined"||P==="boolean")&&(r=null);var b=!1;if(r===null)b=!0;else switch(P){case"string":case"number":b=!0;break;case"object":switch(r.$$typeof){case Qh:case dT:b=!0}}if(b)return b=r,x=x(b),r=_===""?"."+Jm(b,0):_,dx(x)?(d="",r!=null&&(d=r.replace(px,"$&/")+"/"),Ap(x,o,d,"",function(Q){return Q})):x!=null&&(I_(x)&&(x=TT(x,d+(!x.key||b&&b.key===x.key?"":(""+x.key).replace(px,"$&/")+"/")+r)),o.push(x)),1;if(b=0,_=_===""?".":_+":",dx(r))for(var c=0;c<r.length;c++){P=r[c];var U=_+Jm(P,c);b+=Ap(P,o,d,U,x)}else if(U=wT(r),typeof U=="function")for(r=U.call(r),c=0;!(P=r.next()).done;)P=P.value,U=_+Jm(P,c++),b+=Ap(P,o,d,U,x);else if(P==="object")throw o=String(r),Error("Objects are not valid as a React child (found: "+(o==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":o)+"). If you meant to render a collection of children, use an array instead.");return b}function pp(r,o,d){if(r==null)return r;var _=[],x=0;return Ap(r,_,"","",function(P){return o.call(d,P,x++)}),_}function PT(r){if(r._status===-1){var o=r._result;o=o(),o.then(function(d){(r._status===0||r._status===-1)&&(r._status=1,r._result=d)},function(d){(r._status===0||r._status===-1)&&(r._status=2,r._result=d)}),r._status===-1&&(r._status=0,r._result=o)}if(r._status===1)return r._result.default;throw r._result}var yi={current:null},zp={transition:null},CT={ReactCurrentDispatcher:yi,ReactCurrentBatchConfig:zp,ReactCurrentOwner:E_};function X0(){throw Error("act(...) is not supported in production builds of React.")}cr.Children={map:pp,forEach:function(r,o,d){pp(r,function(){o.apply(this,arguments)},d)},count:function(r){var o=0;return pp(r,function(){o++}),o},toArray:function(r){return pp(r,function(o){return o})||[]},only:function(r){if(!I_(r))throw Error("React.Children.only expected to receive a single React element child.");return r}};cr.Component=ru;cr.Fragment=pT;cr.Profiler=mT;cr.PureComponent=M_;cr.StrictMode=fT;cr.Suspense=vT;cr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=CT;cr.act=X0;cr.cloneElement=function(r,o,d){if(r==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+r+".");var _=U0({},r.props),x=r.key,P=r.ref,b=r._owner;if(o!=null){if(o.ref!==void 0&&(P=o.ref,b=E_.current),o.key!==void 0&&(x=""+o.key),r.type&&r.type.defaultProps)var c=r.type.defaultProps;for(U in o)q0.call(o,U)&&!H0.hasOwnProperty(U)&&(_[U]=o[U]===void 0&&c!==void 0?c[U]:o[U])}var U=arguments.length-2;if(U===1)_.children=d;else if(1<U){c=Array(U);for(var Q=0;Q<U;Q++)c[Q]=arguments[Q+2];_.children=c}return{$$typeof:Qh,type:r.type,key:x,ref:P,props:_,_owner:b}};cr.createContext=function(r){return r={$$typeof:_T,_currentValue:r,_currentValue2:r,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},r.Provider={$$typeof:gT,_context:r},r.Consumer=r};cr.createElement=W0;cr.createFactory=function(r){var o=W0.bind(null,r);return o.type=r,o};cr.createRef=function(){return{current:null}};cr.forwardRef=function(r){return{$$typeof:yT,render:r}};cr.isValidElement=I_;cr.lazy=function(r){return{$$typeof:bT,_payload:{_status:-1,_result:r},_init:PT}};cr.memo=function(r,o){return{$$typeof:xT,type:r,compare:o===void 0?null:o}};cr.startTransition=function(r){var o=zp.transition;zp.transition={};try{r()}finally{zp.transition=o}};cr.unstable_act=X0;cr.useCallback=function(r,o){return yi.current.useCallback(r,o)};cr.useContext=function(r){return yi.current.useContext(r)};cr.useDebugValue=function(){};cr.useDeferredValue=function(r){return yi.current.useDeferredValue(r)};cr.useEffect=function(r,o){return yi.current.useEffect(r,o)};cr.useId=function(){return yi.current.useId()};cr.useImperativeHandle=function(r,o,d){return yi.current.useImperativeHandle(r,o,d)};cr.useInsertionEffect=function(r,o){return yi.current.useInsertionEffect(r,o)};cr.useLayoutEffect=function(r,o){return yi.current.useLayoutEffect(r,o)};cr.useMemo=function(r,o){return yi.current.useMemo(r,o)};cr.useReducer=function(r,o,d){return yi.current.useReducer(r,o,d)};cr.useRef=function(r){return yi.current.useRef(r)};cr.useState=function(r){return yi.current.useState(r)};cr.useSyncExternalStore=function(r,o,d){return yi.current.useSyncExternalStore(r,o,d)};cr.useTransition=function(){return yi.current.useTransition()};cr.version="18.3.1";V0.exports=cr;var Re=V0.exports;/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var MT=Re,kT=Symbol.for("react.element"),ET=Symbol.for("react.fragment"),IT=Object.prototype.hasOwnProperty,AT=MT.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,zT={key:!0,ref:!0,__self:!0,__source:!0};function K0(r,o,d){var _,x={},P=null,b=null;d!==void 0&&(P=""+d),o.key!==void 0&&(P=""+o.key),o.ref!==void 0&&(b=o.ref);for(_ in o)IT.call(o,_)&&!zT.hasOwnProperty(_)&&(x[_]=o[_]);if(r&&r.defaultProps)for(_ in o=r.defaultProps,o)x[_]===void 0&&(x[_]=o[_]);return{$$typeof:kT,type:r,key:P,ref:b,props:x,_owner:AT.current}}yf.Fragment=ET;yf.jsx=K0;yf.jsxs=K0;N0.exports=yf;var R=N0.exports,Y0={exports:{}},Ki={},Q0={exports:{}},J0={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(r){function o(qe,ft){var bt=qe.length;qe.push(ft);e:for(;0<bt;){var Gt=bt-1>>>1,Xt=qe[Gt];if(0<x(Xt,ft))qe[Gt]=ft,qe[bt]=Xt,bt=Gt;else break e}}function d(qe){return qe.length===0?null:qe[0]}function _(qe){if(qe.length===0)return null;var ft=qe[0],bt=qe.pop();if(bt!==ft){qe[0]=bt;e:for(var Gt=0,Xt=qe.length,yn=Xt>>>1;Gt<yn;){var br=2*(Gt+1)-1,Tr=qe[br],cn=br+1,Xr=qe[cn];if(0>x(Tr,bt))cn<Xt&&0>x(Xr,Tr)?(qe[Gt]=Xr,qe[cn]=bt,Gt=cn):(qe[Gt]=Tr,qe[br]=bt,Gt=br);else if(cn<Xt&&0>x(Xr,bt))qe[Gt]=Xr,qe[cn]=bt,Gt=cn;else break e}}return ft}function x(qe,ft){var bt=qe.sortIndex-ft.sortIndex;return bt!==0?bt:qe.id-ft.id}if(typeof performance=="object"&&typeof performance.now=="function"){var P=performance;r.unstable_now=function(){return P.now()}}else{var b=Date,c=b.now();r.unstable_now=function(){return b.now()-c}}var U=[],Q=[],ne=1,ye=null,me=3,re=!1,ce=!1,Le=!1,Qe=typeof setTimeout=="function"?setTimeout:null,pe=typeof clearTimeout=="function"?clearTimeout:null,le=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ve(qe){for(var ft=d(Q);ft!==null;){if(ft.callback===null)_(Q);else if(ft.startTime<=qe)_(Q),ft.sortIndex=ft.expirationTime,o(U,ft);else break;ft=d(Q)}}function Be(qe){if(Le=!1,ve(qe),!ce)if(d(U)!==null)ce=!0,dr(We);else{var ft=d(Q);ft!==null&&Gr(Be,ft.startTime-qe)}}function We(qe,ft){ce=!1,Le&&(Le=!1,pe(rt),rt=-1),re=!0;var bt=me;try{for(ve(ft),ye=d(U);ye!==null&&(!(ye.expirationTime>ft)||qe&&!ur());){var Gt=ye.callback;if(typeof Gt=="function"){ye.callback=null,me=ye.priorityLevel;var Xt=Gt(ye.expirationTime<=ft);ft=r.unstable_now(),typeof Xt=="function"?ye.callback=Xt:ye===d(U)&&_(U),ve(ft)}else _(U);ye=d(U)}if(ye!==null)var yn=!0;else{var br=d(Q);br!==null&&Gr(Be,br.startTime-ft),yn=!1}return yn}finally{ye=null,me=bt,re=!1}}var Je=!1,st=null,rt=-1,Zt=5,zt=-1;function ur(){return!(r.unstable_now()-zt<Zt)}function hr(){if(st!==null){var qe=r.unstable_now();zt=qe;var ft=!0;try{ft=st(!0,qe)}finally{ft?_r():(Je=!1,st=null)}}else Je=!1}var _r;if(typeof le=="function")_r=function(){le(hr)};else if(typeof MessageChannel<"u"){var Wt=new MessageChannel,tn=Wt.port2;Wt.port1.onmessage=hr,_r=function(){tn.postMessage(null)}}else _r=function(){Qe(hr,0)};function dr(qe){st=qe,Je||(Je=!0,_r())}function Gr(qe,ft){rt=Qe(function(){qe(r.unstable_now())},ft)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(qe){qe.callback=null},r.unstable_continueExecution=function(){ce||re||(ce=!0,dr(We))},r.unstable_forceFrameRate=function(qe){0>qe||125<qe?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Zt=0<qe?Math.floor(1e3/qe):5},r.unstable_getCurrentPriorityLevel=function(){return me},r.unstable_getFirstCallbackNode=function(){return d(U)},r.unstable_next=function(qe){switch(me){case 1:case 2:case 3:var ft=3;break;default:ft=me}var bt=me;me=ft;try{return qe()}finally{me=bt}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(qe,ft){switch(qe){case 1:case 2:case 3:case 4:case 5:break;default:qe=3}var bt=me;me=qe;try{return ft()}finally{me=bt}},r.unstable_scheduleCallback=function(qe,ft,bt){var Gt=r.unstable_now();switch(typeof bt=="object"&&bt!==null?(bt=bt.delay,bt=typeof bt=="number"&&0<bt?Gt+bt:Gt):bt=Gt,qe){case 1:var Xt=-1;break;case 2:Xt=250;break;case 5:Xt=1073741823;break;case 4:Xt=1e4;break;default:Xt=5e3}return Xt=bt+Xt,qe={id:ne++,callback:ft,priorityLevel:qe,startTime:bt,expirationTime:Xt,sortIndex:-1},bt>Gt?(qe.sortIndex=bt,o(Q,qe),d(U)===null&&qe===d(Q)&&(Le?(pe(rt),rt=-1):Le=!0,Gr(Be,bt-Gt))):(qe.sortIndex=Xt,o(U,qe),ce||re||(ce=!0,dr(We))),qe},r.unstable_shouldYield=ur,r.unstable_wrapCallback=function(qe){var ft=me;return function(){var bt=me;me=ft;try{return qe.apply(this,arguments)}finally{me=bt}}}})(J0);Q0.exports=J0;var RT=Q0.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var DT=Re,Xi=RT;function it(r){for(var o="https://reactjs.org/docs/error-decoder.html?invariant="+r,d=1;d<arguments.length;d++)o+="&args[]="+encodeURIComponent(arguments[d]);return"Minified React error #"+r+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var e1=new Set,Lh={};function Pl(r,o){Wc(r,o),Wc(r+"Capture",o)}function Wc(r,o){for(Lh[r]=o,r=0;r<o.length;r++)e1.add(o[r])}var Mo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ig=Object.prototype.hasOwnProperty,LT=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,fx={},mx={};function jT(r){return Ig.call(mx,r)?!0:Ig.call(fx,r)?!1:LT.test(r)?mx[r]=!0:(fx[r]=!0,!1)}function FT(r,o,d,_){if(d!==null&&d.type===0)return!1;switch(typeof o){case"function":case"symbol":return!0;case"boolean":return _?!1:d!==null?!d.acceptsBooleans:(r=r.toLowerCase().slice(0,5),r!=="data-"&&r!=="aria-");default:return!1}}function BT(r,o,d,_){if(o===null||typeof o>"u"||FT(r,o,d,_))return!0;if(_)return!1;if(d!==null)switch(d.type){case 3:return!o;case 4:return o===!1;case 5:return isNaN(o);case 6:return isNaN(o)||1>o}return!1}function vi(r,o,d,_,x,P,b){this.acceptsBooleans=o===2||o===3||o===4,this.attributeName=_,this.attributeNamespace=x,this.mustUseProperty=d,this.propertyName=r,this.type=o,this.sanitizeURL=P,this.removeEmptyString=b}var ei={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(r){ei[r]=new vi(r,0,!1,r,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(r){var o=r[0];ei[o]=new vi(o,1,!1,r[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(r){ei[r]=new vi(r,2,!1,r.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(r){ei[r]=new vi(r,2,!1,r,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(r){ei[r]=new vi(r,3,!1,r.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(r){ei[r]=new vi(r,3,!0,r,null,!1,!1)});["capture","download"].forEach(function(r){ei[r]=new vi(r,4,!1,r,null,!1,!1)});["cols","rows","size","span"].forEach(function(r){ei[r]=new vi(r,6,!1,r,null,!1,!1)});["rowSpan","start"].forEach(function(r){ei[r]=new vi(r,5,!1,r.toLowerCase(),null,!1,!1)});var A_=/[\-:]([a-z])/g;function z_(r){return r[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(r){var o=r.replace(A_,z_);ei[o]=new vi(o,1,!1,r,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(r){var o=r.replace(A_,z_);ei[o]=new vi(o,1,!1,r,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(r){var o=r.replace(A_,z_);ei[o]=new vi(o,1,!1,r,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(r){ei[r]=new vi(r,1,!1,r.toLowerCase(),null,!1,!1)});ei.xlinkHref=new vi("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(r){ei[r]=new vi(r,1,!1,r.toLowerCase(),null,!0,!0)});function R_(r,o,d,_){var x=ei.hasOwnProperty(o)?ei[o]:null;(x!==null?x.type!==0:_||!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(BT(o,d,x,_)&&(d=null),_||x===null?jT(o)&&(d===null?r.removeAttribute(o):r.setAttribute(o,""+d)):x.mustUseProperty?r[x.propertyName]=d===null?x.type===3?!1:"":d:(o=x.attributeName,_=x.attributeNamespace,d===null?r.removeAttribute(o):(x=x.type,d=x===3||x===4&&d===!0?"":""+d,_?r.setAttributeNS(_,o,d):r.setAttribute(o,d))))}var Ao=DT.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,fp=Symbol.for("react.element"),Ic=Symbol.for("react.portal"),Ac=Symbol.for("react.fragment"),D_=Symbol.for("react.strict_mode"),Ag=Symbol.for("react.profiler"),t1=Symbol.for("react.provider"),r1=Symbol.for("react.context"),L_=Symbol.for("react.forward_ref"),zg=Symbol.for("react.suspense"),Rg=Symbol.for("react.suspense_list"),j_=Symbol.for("react.memo"),ia=Symbol.for("react.lazy"),n1=Symbol.for("react.offscreen"),gx=Symbol.iterator;function hh(r){return r===null||typeof r!="object"?null:(r=gx&&r[gx]||r["@@iterator"],typeof r=="function"?r:null)}var en=Object.assign,eg;function bh(r){if(eg===void 0)try{throw Error()}catch(d){var o=d.stack.trim().match(/\n( *(at )?)/);eg=o&&o[1]||""}return`
`+eg+r}var tg=!1;function rg(r,o){if(!r||tg)return"";tg=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(o)if(o=function(){throw Error()},Object.defineProperty(o.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(o,[])}catch(Q){var _=Q}Reflect.construct(r,[],o)}else{try{o.call()}catch(Q){_=Q}r.call(o.prototype)}else{try{throw Error()}catch(Q){_=Q}r()}}catch(Q){if(Q&&_&&typeof Q.stack=="string"){for(var x=Q.stack.split(`
`),P=_.stack.split(`
`),b=x.length-1,c=P.length-1;1<=b&&0<=c&&x[b]!==P[c];)c--;for(;1<=b&&0<=c;b--,c--)if(x[b]!==P[c]){if(b!==1||c!==1)do if(b--,c--,0>c||x[b]!==P[c]){var U=`
`+x[b].replace(" at new "," at ");return r.displayName&&U.includes("<anonymous>")&&(U=U.replace("<anonymous>",r.displayName)),U}while(1<=b&&0<=c);break}}}finally{tg=!1,Error.prepareStackTrace=d}return(r=r?r.displayName||r.name:"")?bh(r):""}function OT(r){switch(r.tag){case 5:return bh(r.type);case 16:return bh("Lazy");case 13:return bh("Suspense");case 19:return bh("SuspenseList");case 0:case 2:case 15:return r=rg(r.type,!1),r;case 11:return r=rg(r.type.render,!1),r;case 1:return r=rg(r.type,!0),r;default:return""}}function Dg(r){if(r==null)return null;if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case Ac:return"Fragment";case Ic:return"Portal";case Ag:return"Profiler";case D_:return"StrictMode";case zg:return"Suspense";case Rg:return"SuspenseList"}if(typeof r=="object")switch(r.$$typeof){case r1:return(r.displayName||"Context")+".Consumer";case t1:return(r._context.displayName||"Context")+".Provider";case L_:var o=r.render;return r=r.displayName,r||(r=o.displayName||o.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case j_:return o=r.displayName||null,o!==null?o:Dg(r.type)||"Memo";case ia:o=r._payload,r=r._init;try{return Dg(r(o))}catch{}}return null}function NT(r){var o=r.type;switch(r.tag){case 24:return"Cache";case 9:return(o.displayName||"Context")+".Consumer";case 10:return(o._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return r=o.render,r=r.displayName||r.name||"",o.displayName||(r!==""?"ForwardRef("+r+")":"ForwardRef");case 7:return"Fragment";case 5:return o;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Dg(o);case 8:return o===D_?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o}return null}function ya(r){switch(typeof r){case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function i1(r){var o=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function VT(r){var o=i1(r)?"checked":"value",d=Object.getOwnPropertyDescriptor(r.constructor.prototype,o),_=""+r[o];if(!r.hasOwnProperty(o)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var x=d.get,P=d.set;return Object.defineProperty(r,o,{configurable:!0,get:function(){return x.call(this)},set:function(b){_=""+b,P.call(this,b)}}),Object.defineProperty(r,o,{enumerable:d.enumerable}),{getValue:function(){return _},setValue:function(b){_=""+b},stopTracking:function(){r._valueTracker=null,delete r[o]}}}}function mp(r){r._valueTracker||(r._valueTracker=VT(r))}function s1(r){if(!r)return!1;var o=r._valueTracker;if(!o)return!0;var d=o.getValue(),_="";return r&&(_=i1(r)?r.checked?"true":"false":r.value),r=_,r!==d?(o.setValue(r),!0):!1}function qp(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}function Lg(r,o){var d=o.checked;return en({},o,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:d??r._wrapperState.initialChecked})}function _x(r,o){var d=o.defaultValue==null?"":o.defaultValue,_=o.checked!=null?o.checked:o.defaultChecked;d=ya(o.value!=null?o.value:d),r._wrapperState={initialChecked:_,initialValue:d,controlled:o.type==="checkbox"||o.type==="radio"?o.checked!=null:o.value!=null}}function o1(r,o){o=o.checked,o!=null&&R_(r,"checked",o,!1)}function jg(r,o){o1(r,o);var d=ya(o.value),_=o.type;if(d!=null)_==="number"?(d===0&&r.value===""||r.value!=d)&&(r.value=""+d):r.value!==""+d&&(r.value=""+d);else if(_==="submit"||_==="reset"){r.removeAttribute("value");return}o.hasOwnProperty("value")?Fg(r,o.type,d):o.hasOwnProperty("defaultValue")&&Fg(r,o.type,ya(o.defaultValue)),o.checked==null&&o.defaultChecked!=null&&(r.defaultChecked=!!o.defaultChecked)}function yx(r,o,d){if(o.hasOwnProperty("value")||o.hasOwnProperty("defaultValue")){var _=o.type;if(!(_!=="submit"&&_!=="reset"||o.value!==void 0&&o.value!==null))return;o=""+r._wrapperState.initialValue,d||o===r.value||(r.value=o),r.defaultValue=o}d=r.name,d!==""&&(r.name=""),r.defaultChecked=!!r._wrapperState.initialChecked,d!==""&&(r.name=d)}function Fg(r,o,d){(o!=="number"||qp(r.ownerDocument)!==r)&&(d==null?r.defaultValue=""+r._wrapperState.initialValue:r.defaultValue!==""+d&&(r.defaultValue=""+d))}var wh=Array.isArray;function $c(r,o,d,_){if(r=r.options,o){o={};for(var x=0;x<d.length;x++)o["$"+d[x]]=!0;for(d=0;d<r.length;d++)x=o.hasOwnProperty("$"+r[d].value),r[d].selected!==x&&(r[d].selected=x),x&&_&&(r[d].defaultSelected=!0)}else{for(d=""+ya(d),o=null,x=0;x<r.length;x++){if(r[x].value===d){r[x].selected=!0,_&&(r[x].defaultSelected=!0);return}o!==null||r[x].disabled||(o=r[x])}o!==null&&(o.selected=!0)}}function Bg(r,o){if(o.dangerouslySetInnerHTML!=null)throw Error(it(91));return en({},o,{value:void 0,defaultValue:void 0,children:""+r._wrapperState.initialValue})}function vx(r,o){var d=o.value;if(d==null){if(d=o.children,o=o.defaultValue,d!=null){if(o!=null)throw Error(it(92));if(wh(d)){if(1<d.length)throw Error(it(93));d=d[0]}o=d}o==null&&(o=""),d=o}r._wrapperState={initialValue:ya(d)}}function a1(r,o){var d=ya(o.value),_=ya(o.defaultValue);d!=null&&(d=""+d,d!==r.value&&(r.value=d),o.defaultValue==null&&r.defaultValue!==d&&(r.defaultValue=d)),_!=null&&(r.defaultValue=""+_)}function xx(r){var o=r.textContent;o===r._wrapperState.initialValue&&o!==""&&o!==null&&(r.value=o)}function l1(r){switch(r){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Og(r,o){return r==null||r==="http://www.w3.org/1999/xhtml"?l1(o):r==="http://www.w3.org/2000/svg"&&o==="foreignObject"?"http://www.w3.org/1999/xhtml":r}var gp,c1=function(r){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(o,d,_,x){MSApp.execUnsafeLocalFunction(function(){return r(o,d,_,x)})}:r}(function(r,o){if(r.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in r)r.innerHTML=o;else{for(gp=gp||document.createElement("div"),gp.innerHTML="<svg>"+o.valueOf().toString()+"</svg>",o=gp.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(;o.firstChild;)r.appendChild(o.firstChild)}});function jh(r,o){if(o){var d=r.firstChild;if(d&&d===r.lastChild&&d.nodeType===3){d.nodeValue=o;return}}r.textContent=o}var Ch={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},$T=["Webkit","ms","Moz","O"];Object.keys(Ch).forEach(function(r){$T.forEach(function(o){o=o+r.charAt(0).toUpperCase()+r.substring(1),Ch[o]=Ch[r]})});function u1(r,o,d){return o==null||typeof o=="boolean"||o===""?"":d||typeof o!="number"||o===0||Ch.hasOwnProperty(r)&&Ch[r]?(""+o).trim():o+"px"}function h1(r,o){r=r.style;for(var d in o)if(o.hasOwnProperty(d)){var _=d.indexOf("--")===0,x=u1(d,o[d],_);d==="float"&&(d="cssFloat"),_?r.setProperty(d,x):r[d]=x}}var UT=en({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ng(r,o){if(o){if(UT[r]&&(o.children!=null||o.dangerouslySetInnerHTML!=null))throw Error(it(137,r));if(o.dangerouslySetInnerHTML!=null){if(o.children!=null)throw Error(it(60));if(typeof o.dangerouslySetInnerHTML!="object"||!("__html"in o.dangerouslySetInnerHTML))throw Error(it(61))}if(o.style!=null&&typeof o.style!="object")throw Error(it(62))}}function Vg(r,o){if(r.indexOf("-")===-1)return typeof o.is=="string";switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var $g=null;function F_(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var Ug=null,Uc=null,Zc=null;function bx(r){if(r=td(r)){if(typeof Ug!="function")throw Error(it(280));var o=r.stateNode;o&&(o=Tf(o),Ug(r.stateNode,r.type,o))}}function d1(r){Uc?Zc?Zc.push(r):Zc=[r]:Uc=r}function p1(){if(Uc){var r=Uc,o=Zc;if(Zc=Uc=null,bx(r),o)for(r=0;r<o.length;r++)bx(o[r])}}function f1(r,o){return r(o)}function m1(){}var ng=!1;function g1(r,o,d){if(ng)return r(o,d);ng=!0;try{return f1(r,o,d)}finally{ng=!1,(Uc!==null||Zc!==null)&&(m1(),p1())}}function Fh(r,o){var d=r.stateNode;if(d===null)return null;var _=Tf(d);if(_===null)return null;d=_[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(_=!_.disabled)||(r=r.type,_=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!_;break e;default:r=!1}if(r)return null;if(d&&typeof d!="function")throw Error(it(231,o,typeof d));return d}var Zg=!1;if(Mo)try{var dh={};Object.defineProperty(dh,"passive",{get:function(){Zg=!0}}),window.addEventListener("test",dh,dh),window.removeEventListener("test",dh,dh)}catch{Zg=!1}function ZT(r,o,d,_,x,P,b,c,U){var Q=Array.prototype.slice.call(arguments,3);try{o.apply(d,Q)}catch(ne){this.onError(ne)}}var Mh=!1,Hp=null,Wp=!1,Gg=null,GT={onError:function(r){Mh=!0,Hp=r}};function qT(r,o,d,_,x,P,b,c,U){Mh=!1,Hp=null,ZT.apply(GT,arguments)}function HT(r,o,d,_,x,P,b,c,U){if(qT.apply(this,arguments),Mh){if(Mh){var Q=Hp;Mh=!1,Hp=null}else throw Error(it(198));Wp||(Wp=!0,Gg=Q)}}function Cl(r){var o=r,d=r;if(r.alternate)for(;o.return;)o=o.return;else{r=o;do o=r,o.flags&4098&&(d=o.return),r=o.return;while(r)}return o.tag===3?d:null}function _1(r){if(r.tag===13){var o=r.memoizedState;if(o===null&&(r=r.alternate,r!==null&&(o=r.memoizedState)),o!==null)return o.dehydrated}return null}function wx(r){if(Cl(r)!==r)throw Error(it(188))}function WT(r){var o=r.alternate;if(!o){if(o=Cl(r),o===null)throw Error(it(188));return o!==r?null:r}for(var d=r,_=o;;){var x=d.return;if(x===null)break;var P=x.alternate;if(P===null){if(_=x.return,_!==null){d=_;continue}break}if(x.child===P.child){for(P=x.child;P;){if(P===d)return wx(x),r;if(P===_)return wx(x),o;P=P.sibling}throw Error(it(188))}if(d.return!==_.return)d=x,_=P;else{for(var b=!1,c=x.child;c;){if(c===d){b=!0,d=x,_=P;break}if(c===_){b=!0,_=x,d=P;break}c=c.sibling}if(!b){for(c=P.child;c;){if(c===d){b=!0,d=P,_=x;break}if(c===_){b=!0,_=P,d=x;break}c=c.sibling}if(!b)throw Error(it(189))}}if(d.alternate!==_)throw Error(it(190))}if(d.tag!==3)throw Error(it(188));return d.stateNode.current===d?r:o}function y1(r){return r=WT(r),r!==null?v1(r):null}function v1(r){if(r.tag===5||r.tag===6)return r;for(r=r.child;r!==null;){var o=v1(r);if(o!==null)return o;r=r.sibling}return null}var x1=Xi.unstable_scheduleCallback,Tx=Xi.unstable_cancelCallback,XT=Xi.unstable_shouldYield,KT=Xi.unstable_requestPaint,_n=Xi.unstable_now,YT=Xi.unstable_getCurrentPriorityLevel,B_=Xi.unstable_ImmediatePriority,b1=Xi.unstable_UserBlockingPriority,Xp=Xi.unstable_NormalPriority,QT=Xi.unstable_LowPriority,w1=Xi.unstable_IdlePriority,vf=null,eo=null;function JT(r){if(eo&&typeof eo.onCommitFiberRoot=="function")try{eo.onCommitFiberRoot(vf,r,void 0,(r.current.flags&128)===128)}catch{}}var zs=Math.clz32?Math.clz32:rS,eS=Math.log,tS=Math.LN2;function rS(r){return r>>>=0,r===0?32:31-(eS(r)/tS|0)|0}var _p=64,yp=4194304;function Th(r){switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return r&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return r}}function Kp(r,o){var d=r.pendingLanes;if(d===0)return 0;var _=0,x=r.suspendedLanes,P=r.pingedLanes,b=d&268435455;if(b!==0){var c=b&~x;c!==0?_=Th(c):(P&=b,P!==0&&(_=Th(P)))}else b=d&~x,b!==0?_=Th(b):P!==0&&(_=Th(P));if(_===0)return 0;if(o!==0&&o!==_&&!(o&x)&&(x=_&-_,P=o&-o,x>=P||x===16&&(P&4194240)!==0))return o;if(_&4&&(_|=d&16),o=r.entangledLanes,o!==0)for(r=r.entanglements,o&=_;0<o;)d=31-zs(o),x=1<<d,_|=r[d],o&=~x;return _}function nS(r,o){switch(r){case 1:case 2:case 4:return o+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function iS(r,o){for(var d=r.suspendedLanes,_=r.pingedLanes,x=r.expirationTimes,P=r.pendingLanes;0<P;){var b=31-zs(P),c=1<<b,U=x[b];U===-1?(!(c&d)||c&_)&&(x[b]=nS(c,o)):U<=o&&(r.expiredLanes|=c),P&=~c}}function qg(r){return r=r.pendingLanes&-1073741825,r!==0?r:r&1073741824?1073741824:0}function T1(){var r=_p;return _p<<=1,!(_p&4194240)&&(_p=64),r}function ig(r){for(var o=[],d=0;31>d;d++)o.push(r);return o}function Jh(r,o,d){r.pendingLanes|=o,o!==536870912&&(r.suspendedLanes=0,r.pingedLanes=0),r=r.eventTimes,o=31-zs(o),r[o]=d}function sS(r,o){var d=r.pendingLanes&~o;r.pendingLanes=o,r.suspendedLanes=0,r.pingedLanes=0,r.expiredLanes&=o,r.mutableReadLanes&=o,r.entangledLanes&=o,o=r.entanglements;var _=r.eventTimes;for(r=r.expirationTimes;0<d;){var x=31-zs(d),P=1<<x;o[x]=0,_[x]=-1,r[x]=-1,d&=~P}}function O_(r,o){var d=r.entangledLanes|=o;for(r=r.entanglements;d;){var _=31-zs(d),x=1<<_;x&o|r[_]&o&&(r[_]|=o),d&=~x}}var Mr=0;function S1(r){return r&=-r,1<r?4<r?r&268435455?16:536870912:4:1}var P1,N_,C1,M1,k1,Hg=!1,vp=[],ua=null,ha=null,da=null,Bh=new Map,Oh=new Map,oa=[],oS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sx(r,o){switch(r){case"focusin":case"focusout":ua=null;break;case"dragenter":case"dragleave":ha=null;break;case"mouseover":case"mouseout":da=null;break;case"pointerover":case"pointerout":Bh.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":Oh.delete(o.pointerId)}}function ph(r,o,d,_,x,P){return r===null||r.nativeEvent!==P?(r={blockedOn:o,domEventName:d,eventSystemFlags:_,nativeEvent:P,targetContainers:[x]},o!==null&&(o=td(o),o!==null&&N_(o)),r):(r.eventSystemFlags|=_,o=r.targetContainers,x!==null&&o.indexOf(x)===-1&&o.push(x),r)}function aS(r,o,d,_,x){switch(o){case"focusin":return ua=ph(ua,r,o,d,_,x),!0;case"dragenter":return ha=ph(ha,r,o,d,_,x),!0;case"mouseover":return da=ph(da,r,o,d,_,x),!0;case"pointerover":var P=x.pointerId;return Bh.set(P,ph(Bh.get(P)||null,r,o,d,_,x)),!0;case"gotpointercapture":return P=x.pointerId,Oh.set(P,ph(Oh.get(P)||null,r,o,d,_,x)),!0}return!1}function E1(r){var o=dl(r.target);if(o!==null){var d=Cl(o);if(d!==null){if(o=d.tag,o===13){if(o=_1(d),o!==null){r.blockedOn=o,k1(r.priority,function(){C1(d)});return}}else if(o===3&&d.stateNode.current.memoizedState.isDehydrated){r.blockedOn=d.tag===3?d.stateNode.containerInfo:null;return}}}r.blockedOn=null}function Rp(r){if(r.blockedOn!==null)return!1;for(var o=r.targetContainers;0<o.length;){var d=Wg(r.domEventName,r.eventSystemFlags,o[0],r.nativeEvent);if(d===null){d=r.nativeEvent;var _=new d.constructor(d.type,d);$g=_,d.target.dispatchEvent(_),$g=null}else return o=td(d),o!==null&&N_(o),r.blockedOn=d,!1;o.shift()}return!0}function Px(r,o,d){Rp(r)&&d.delete(o)}function lS(){Hg=!1,ua!==null&&Rp(ua)&&(ua=null),ha!==null&&Rp(ha)&&(ha=null),da!==null&&Rp(da)&&(da=null),Bh.forEach(Px),Oh.forEach(Px)}function fh(r,o){r.blockedOn===o&&(r.blockedOn=null,Hg||(Hg=!0,Xi.unstable_scheduleCallback(Xi.unstable_NormalPriority,lS)))}function Nh(r){function o(x){return fh(x,r)}if(0<vp.length){fh(vp[0],r);for(var d=1;d<vp.length;d++){var _=vp[d];_.blockedOn===r&&(_.blockedOn=null)}}for(ua!==null&&fh(ua,r),ha!==null&&fh(ha,r),da!==null&&fh(da,r),Bh.forEach(o),Oh.forEach(o),d=0;d<oa.length;d++)_=oa[d],_.blockedOn===r&&(_.blockedOn=null);for(;0<oa.length&&(d=oa[0],d.blockedOn===null);)E1(d),d.blockedOn===null&&oa.shift()}var Gc=Ao.ReactCurrentBatchConfig,Yp=!0;function cS(r,o,d,_){var x=Mr,P=Gc.transition;Gc.transition=null;try{Mr=1,V_(r,o,d,_)}finally{Mr=x,Gc.transition=P}}function uS(r,o,d,_){var x=Mr,P=Gc.transition;Gc.transition=null;try{Mr=4,V_(r,o,d,_)}finally{Mr=x,Gc.transition=P}}function V_(r,o,d,_){if(Yp){var x=Wg(r,o,d,_);if(x===null)fg(r,o,_,Qp,d),Sx(r,_);else if(aS(x,r,o,d,_))_.stopPropagation();else if(Sx(r,_),o&4&&-1<oS.indexOf(r)){for(;x!==null;){var P=td(x);if(P!==null&&P1(P),P=Wg(r,o,d,_),P===null&&fg(r,o,_,Qp,d),P===x)break;x=P}x!==null&&_.stopPropagation()}else fg(r,o,_,null,d)}}var Qp=null;function Wg(r,o,d,_){if(Qp=null,r=F_(_),r=dl(r),r!==null)if(o=Cl(r),o===null)r=null;else if(d=o.tag,d===13){if(r=_1(o),r!==null)return r;r=null}else if(d===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;r=null}else o!==r&&(r=null);return Qp=r,null}function I1(r){switch(r){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(YT()){case B_:return 1;case b1:return 4;case Xp:case QT:return 16;case w1:return 536870912;default:return 16}default:return 16}}var la=null,$_=null,Dp=null;function A1(){if(Dp)return Dp;var r,o=$_,d=o.length,_,x="value"in la?la.value:la.textContent,P=x.length;for(r=0;r<d&&o[r]===x[r];r++);var b=d-r;for(_=1;_<=b&&o[d-_]===x[P-_];_++);return Dp=x.slice(r,1<_?1-_:void 0)}function Lp(r){var o=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&o===13&&(r=13)):r=o,r===10&&(r=13),32<=r||r===13?r:0}function xp(){return!0}function Cx(){return!1}function Yi(r){function o(d,_,x,P,b){this._reactName=d,this._targetInst=x,this.type=_,this.nativeEvent=P,this.target=b,this.currentTarget=null;for(var c in r)r.hasOwnProperty(c)&&(d=r[c],this[c]=d?d(P):P[c]);return this.isDefaultPrevented=(P.defaultPrevented!=null?P.defaultPrevented:P.returnValue===!1)?xp:Cx,this.isPropagationStopped=Cx,this}return en(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var d=this.nativeEvent;d&&(d.preventDefault?d.preventDefault():typeof d.returnValue!="unknown"&&(d.returnValue=!1),this.isDefaultPrevented=xp)},stopPropagation:function(){var d=this.nativeEvent;d&&(d.stopPropagation?d.stopPropagation():typeof d.cancelBubble!="unknown"&&(d.cancelBubble=!0),this.isPropagationStopped=xp)},persist:function(){},isPersistent:xp}),o}var nu={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},U_=Yi(nu),ed=en({},nu,{view:0,detail:0}),hS=Yi(ed),sg,og,mh,xf=en({},ed,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Z_,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==mh&&(mh&&r.type==="mousemove"?(sg=r.screenX-mh.screenX,og=r.screenY-mh.screenY):og=sg=0,mh=r),sg)},movementY:function(r){return"movementY"in r?r.movementY:og}}),Mx=Yi(xf),dS=en({},xf,{dataTransfer:0}),pS=Yi(dS),fS=en({},ed,{relatedTarget:0}),ag=Yi(fS),mS=en({},nu,{animationName:0,elapsedTime:0,pseudoElement:0}),gS=Yi(mS),_S=en({},nu,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),yS=Yi(_S),vS=en({},nu,{data:0}),kx=Yi(vS),xS={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},bS={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},wS={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function TS(r){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(r):(r=wS[r])?!!o[r]:!1}function Z_(){return TS}var SS=en({},ed,{key:function(r){if(r.key){var o=xS[r.key]||r.key;if(o!=="Unidentified")return o}return r.type==="keypress"?(r=Lp(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?bS[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Z_,charCode:function(r){return r.type==="keypress"?Lp(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?Lp(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),PS=Yi(SS),CS=en({},xf,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ex=Yi(CS),MS=en({},ed,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Z_}),kS=Yi(MS),ES=en({},nu,{propertyName:0,elapsedTime:0,pseudoElement:0}),IS=Yi(ES),AS=en({},xf,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),zS=Yi(AS),RS=[9,13,27,32],G_=Mo&&"CompositionEvent"in window,kh=null;Mo&&"documentMode"in document&&(kh=document.documentMode);var DS=Mo&&"TextEvent"in window&&!kh,z1=Mo&&(!G_||kh&&8<kh&&11>=kh),Ix=" ",Ax=!1;function R1(r,o){switch(r){case"keyup":return RS.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function D1(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var zc=!1;function LS(r,o){switch(r){case"compositionend":return D1(o);case"keypress":return o.which!==32?null:(Ax=!0,Ix);case"textInput":return r=o.data,r===Ix&&Ax?null:r;default:return null}}function jS(r,o){if(zc)return r==="compositionend"||!G_&&R1(r,o)?(r=A1(),Dp=$_=la=null,zc=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return z1&&o.locale!=="ko"?null:o.data;default:return null}}var FS={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function zx(r){var o=r&&r.nodeName&&r.nodeName.toLowerCase();return o==="input"?!!FS[r.type]:o==="textarea"}function L1(r,o,d,_){d1(_),o=Jp(o,"onChange"),0<o.length&&(d=new U_("onChange","change",null,d,_),r.push({event:d,listeners:o}))}var Eh=null,Vh=null;function BS(r){q1(r,0)}function bf(r){var o=Lc(r);if(s1(o))return r}function OS(r,o){if(r==="change")return o}var j1=!1;if(Mo){var lg;if(Mo){var cg="oninput"in document;if(!cg){var Rx=document.createElement("div");Rx.setAttribute("oninput","return;"),cg=typeof Rx.oninput=="function"}lg=cg}else lg=!1;j1=lg&&(!document.documentMode||9<document.documentMode)}function Dx(){Eh&&(Eh.detachEvent("onpropertychange",F1),Vh=Eh=null)}function F1(r){if(r.propertyName==="value"&&bf(Vh)){var o=[];L1(o,Vh,r,F_(r)),g1(BS,o)}}function NS(r,o,d){r==="focusin"?(Dx(),Eh=o,Vh=d,Eh.attachEvent("onpropertychange",F1)):r==="focusout"&&Dx()}function VS(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return bf(Vh)}function $S(r,o){if(r==="click")return bf(o)}function US(r,o){if(r==="input"||r==="change")return bf(o)}function ZS(r,o){return r===o&&(r!==0||1/r===1/o)||r!==r&&o!==o}var Ds=typeof Object.is=="function"?Object.is:ZS;function $h(r,o){if(Ds(r,o))return!0;if(typeof r!="object"||r===null||typeof o!="object"||o===null)return!1;var d=Object.keys(r),_=Object.keys(o);if(d.length!==_.length)return!1;for(_=0;_<d.length;_++){var x=d[_];if(!Ig.call(o,x)||!Ds(r[x],o[x]))return!1}return!0}function Lx(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function jx(r,o){var d=Lx(r);r=0;for(var _;d;){if(d.nodeType===3){if(_=r+d.textContent.length,r<=o&&_>=o)return{node:d,offset:o-r};r=_}e:{for(;d;){if(d.nextSibling){d=d.nextSibling;break e}d=d.parentNode}d=void 0}d=Lx(d)}}function B1(r,o){return r&&o?r===o?!0:r&&r.nodeType===3?!1:o&&o.nodeType===3?B1(r,o.parentNode):"contains"in r?r.contains(o):r.compareDocumentPosition?!!(r.compareDocumentPosition(o)&16):!1:!1}function O1(){for(var r=window,o=qp();o instanceof r.HTMLIFrameElement;){try{var d=typeof o.contentWindow.location.href=="string"}catch{d=!1}if(d)r=o.contentWindow;else break;o=qp(r.document)}return o}function q_(r){var o=r&&r.nodeName&&r.nodeName.toLowerCase();return o&&(o==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||o==="textarea"||r.contentEditable==="true")}function GS(r){var o=O1(),d=r.focusedElem,_=r.selectionRange;if(o!==d&&d&&d.ownerDocument&&B1(d.ownerDocument.documentElement,d)){if(_!==null&&q_(d)){if(o=_.start,r=_.end,r===void 0&&(r=o),"selectionStart"in d)d.selectionStart=o,d.selectionEnd=Math.min(r,d.value.length);else if(r=(o=d.ownerDocument||document)&&o.defaultView||window,r.getSelection){r=r.getSelection();var x=d.textContent.length,P=Math.min(_.start,x);_=_.end===void 0?P:Math.min(_.end,x),!r.extend&&P>_&&(x=_,_=P,P=x),x=jx(d,P);var b=jx(d,_);x&&b&&(r.rangeCount!==1||r.anchorNode!==x.node||r.anchorOffset!==x.offset||r.focusNode!==b.node||r.focusOffset!==b.offset)&&(o=o.createRange(),o.setStart(x.node,x.offset),r.removeAllRanges(),P>_?(r.addRange(o),r.extend(b.node,b.offset)):(o.setEnd(b.node,b.offset),r.addRange(o)))}}for(o=[],r=d;r=r.parentNode;)r.nodeType===1&&o.push({element:r,left:r.scrollLeft,top:r.scrollTop});for(typeof d.focus=="function"&&d.focus(),d=0;d<o.length;d++)r=o[d],r.element.scrollLeft=r.left,r.element.scrollTop=r.top}}var qS=Mo&&"documentMode"in document&&11>=document.documentMode,Rc=null,Xg=null,Ih=null,Kg=!1;function Fx(r,o,d){var _=d.window===d?d.document:d.nodeType===9?d:d.ownerDocument;Kg||Rc==null||Rc!==qp(_)||(_=Rc,"selectionStart"in _&&q_(_)?_={start:_.selectionStart,end:_.selectionEnd}:(_=(_.ownerDocument&&_.ownerDocument.defaultView||window).getSelection(),_={anchorNode:_.anchorNode,anchorOffset:_.anchorOffset,focusNode:_.focusNode,focusOffset:_.focusOffset}),Ih&&$h(Ih,_)||(Ih=_,_=Jp(Xg,"onSelect"),0<_.length&&(o=new U_("onSelect","select",null,o,d),r.push({event:o,listeners:_}),o.target=Rc)))}function bp(r,o){var d={};return d[r.toLowerCase()]=o.toLowerCase(),d["Webkit"+r]="webkit"+o,d["Moz"+r]="moz"+o,d}var Dc={animationend:bp("Animation","AnimationEnd"),animationiteration:bp("Animation","AnimationIteration"),animationstart:bp("Animation","AnimationStart"),transitionend:bp("Transition","TransitionEnd")},ug={},N1={};Mo&&(N1=document.createElement("div").style,"AnimationEvent"in window||(delete Dc.animationend.animation,delete Dc.animationiteration.animation,delete Dc.animationstart.animation),"TransitionEvent"in window||delete Dc.transitionend.transition);function wf(r){if(ug[r])return ug[r];if(!Dc[r])return r;var o=Dc[r],d;for(d in o)if(o.hasOwnProperty(d)&&d in N1)return ug[r]=o[d];return r}var V1=wf("animationend"),$1=wf("animationiteration"),U1=wf("animationstart"),Z1=wf("transitionend"),G1=new Map,Bx="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function xa(r,o){G1.set(r,o),Pl(o,[r])}for(var hg=0;hg<Bx.length;hg++){var dg=Bx[hg],HS=dg.toLowerCase(),WS=dg[0].toUpperCase()+dg.slice(1);xa(HS,"on"+WS)}xa(V1,"onAnimationEnd");xa($1,"onAnimationIteration");xa(U1,"onAnimationStart");xa("dblclick","onDoubleClick");xa("focusin","onFocus");xa("focusout","onBlur");xa(Z1,"onTransitionEnd");Wc("onMouseEnter",["mouseout","mouseover"]);Wc("onMouseLeave",["mouseout","mouseover"]);Wc("onPointerEnter",["pointerout","pointerover"]);Wc("onPointerLeave",["pointerout","pointerover"]);Pl("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Pl("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Pl("onBeforeInput",["compositionend","keypress","textInput","paste"]);Pl("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Pl("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Pl("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Sh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),XS=new Set("cancel close invalid load scroll toggle".split(" ").concat(Sh));function Ox(r,o,d){var _=r.type||"unknown-event";r.currentTarget=d,HT(_,o,void 0,r),r.currentTarget=null}function q1(r,o){o=(o&4)!==0;for(var d=0;d<r.length;d++){var _=r[d],x=_.event;_=_.listeners;e:{var P=void 0;if(o)for(var b=_.length-1;0<=b;b--){var c=_[b],U=c.instance,Q=c.currentTarget;if(c=c.listener,U!==P&&x.isPropagationStopped())break e;Ox(x,c,Q),P=U}else for(b=0;b<_.length;b++){if(c=_[b],U=c.instance,Q=c.currentTarget,c=c.listener,U!==P&&x.isPropagationStopped())break e;Ox(x,c,Q),P=U}}}if(Wp)throw r=Gg,Wp=!1,Gg=null,r}function Ur(r,o){var d=o[t_];d===void 0&&(d=o[t_]=new Set);var _=r+"__bubble";d.has(_)||(H1(o,r,2,!1),d.add(_))}function pg(r,o,d){var _=0;o&&(_|=4),H1(d,r,_,o)}var wp="_reactListening"+Math.random().toString(36).slice(2);function Uh(r){if(!r[wp]){r[wp]=!0,e1.forEach(function(d){d!=="selectionchange"&&(XS.has(d)||pg(d,!1,r),pg(d,!0,r))});var o=r.nodeType===9?r:r.ownerDocument;o===null||o[wp]||(o[wp]=!0,pg("selectionchange",!1,o))}}function H1(r,o,d,_){switch(I1(o)){case 1:var x=cS;break;case 4:x=uS;break;default:x=V_}d=x.bind(null,o,d,r),x=void 0,!Zg||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(x=!0),_?x!==void 0?r.addEventListener(o,d,{capture:!0,passive:x}):r.addEventListener(o,d,!0):x!==void 0?r.addEventListener(o,d,{passive:x}):r.addEventListener(o,d,!1)}function fg(r,o,d,_,x){var P=_;if(!(o&1)&&!(o&2)&&_!==null)e:for(;;){if(_===null)return;var b=_.tag;if(b===3||b===4){var c=_.stateNode.containerInfo;if(c===x||c.nodeType===8&&c.parentNode===x)break;if(b===4)for(b=_.return;b!==null;){var U=b.tag;if((U===3||U===4)&&(U=b.stateNode.containerInfo,U===x||U.nodeType===8&&U.parentNode===x))return;b=b.return}for(;c!==null;){if(b=dl(c),b===null)return;if(U=b.tag,U===5||U===6){_=P=b;continue e}c=c.parentNode}}_=_.return}g1(function(){var Q=P,ne=F_(d),ye=[];e:{var me=G1.get(r);if(me!==void 0){var re=U_,ce=r;switch(r){case"keypress":if(Lp(d)===0)break e;case"keydown":case"keyup":re=PS;break;case"focusin":ce="focus",re=ag;break;case"focusout":ce="blur",re=ag;break;case"beforeblur":case"afterblur":re=ag;break;case"click":if(d.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":re=Mx;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":re=pS;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":re=kS;break;case V1:case $1:case U1:re=gS;break;case Z1:re=IS;break;case"scroll":re=hS;break;case"wheel":re=zS;break;case"copy":case"cut":case"paste":re=yS;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":re=Ex}var Le=(o&4)!==0,Qe=!Le&&r==="scroll",pe=Le?me!==null?me+"Capture":null:me;Le=[];for(var le=Q,ve;le!==null;){ve=le;var Be=ve.stateNode;if(ve.tag===5&&Be!==null&&(ve=Be,pe!==null&&(Be=Fh(le,pe),Be!=null&&Le.push(Zh(le,Be,ve)))),Qe)break;le=le.return}0<Le.length&&(me=new re(me,ce,null,d,ne),ye.push({event:me,listeners:Le}))}}if(!(o&7)){e:{if(me=r==="mouseover"||r==="pointerover",re=r==="mouseout"||r==="pointerout",me&&d!==$g&&(ce=d.relatedTarget||d.fromElement)&&(dl(ce)||ce[ko]))break e;if((re||me)&&(me=ne.window===ne?ne:(me=ne.ownerDocument)?me.defaultView||me.parentWindow:window,re?(ce=d.relatedTarget||d.toElement,re=Q,ce=ce?dl(ce):null,ce!==null&&(Qe=Cl(ce),ce!==Qe||ce.tag!==5&&ce.tag!==6)&&(ce=null)):(re=null,ce=Q),re!==ce)){if(Le=Mx,Be="onMouseLeave",pe="onMouseEnter",le="mouse",(r==="pointerout"||r==="pointerover")&&(Le=Ex,Be="onPointerLeave",pe="onPointerEnter",le="pointer"),Qe=re==null?me:Lc(re),ve=ce==null?me:Lc(ce),me=new Le(Be,le+"leave",re,d,ne),me.target=Qe,me.relatedTarget=ve,Be=null,dl(ne)===Q&&(Le=new Le(pe,le+"enter",ce,d,ne),Le.target=ve,Le.relatedTarget=Qe,Be=Le),Qe=Be,re&&ce)t:{for(Le=re,pe=ce,le=0,ve=Le;ve;ve=Cc(ve))le++;for(ve=0,Be=pe;Be;Be=Cc(Be))ve++;for(;0<le-ve;)Le=Cc(Le),le--;for(;0<ve-le;)pe=Cc(pe),ve--;for(;le--;){if(Le===pe||pe!==null&&Le===pe.alternate)break t;Le=Cc(Le),pe=Cc(pe)}Le=null}else Le=null;re!==null&&Nx(ye,me,re,Le,!1),ce!==null&&Qe!==null&&Nx(ye,Qe,ce,Le,!0)}}e:{if(me=Q?Lc(Q):window,re=me.nodeName&&me.nodeName.toLowerCase(),re==="select"||re==="input"&&me.type==="file")var We=OS;else if(zx(me))if(j1)We=US;else{We=VS;var Je=NS}else(re=me.nodeName)&&re.toLowerCase()==="input"&&(me.type==="checkbox"||me.type==="radio")&&(We=$S);if(We&&(We=We(r,Q))){L1(ye,We,d,ne);break e}Je&&Je(r,me,Q),r==="focusout"&&(Je=me._wrapperState)&&Je.controlled&&me.type==="number"&&Fg(me,"number",me.value)}switch(Je=Q?Lc(Q):window,r){case"focusin":(zx(Je)||Je.contentEditable==="true")&&(Rc=Je,Xg=Q,Ih=null);break;case"focusout":Ih=Xg=Rc=null;break;case"mousedown":Kg=!0;break;case"contextmenu":case"mouseup":case"dragend":Kg=!1,Fx(ye,d,ne);break;case"selectionchange":if(qS)break;case"keydown":case"keyup":Fx(ye,d,ne)}var st;if(G_)e:{switch(r){case"compositionstart":var rt="onCompositionStart";break e;case"compositionend":rt="onCompositionEnd";break e;case"compositionupdate":rt="onCompositionUpdate";break e}rt=void 0}else zc?R1(r,d)&&(rt="onCompositionEnd"):r==="keydown"&&d.keyCode===229&&(rt="onCompositionStart");rt&&(z1&&d.locale!=="ko"&&(zc||rt!=="onCompositionStart"?rt==="onCompositionEnd"&&zc&&(st=A1()):(la=ne,$_="value"in la?la.value:la.textContent,zc=!0)),Je=Jp(Q,rt),0<Je.length&&(rt=new kx(rt,r,null,d,ne),ye.push({event:rt,listeners:Je}),st?rt.data=st:(st=D1(d),st!==null&&(rt.data=st)))),(st=DS?LS(r,d):jS(r,d))&&(Q=Jp(Q,"onBeforeInput"),0<Q.length&&(ne=new kx("onBeforeInput","beforeinput",null,d,ne),ye.push({event:ne,listeners:Q}),ne.data=st))}q1(ye,o)})}function Zh(r,o,d){return{instance:r,listener:o,currentTarget:d}}function Jp(r,o){for(var d=o+"Capture",_=[];r!==null;){var x=r,P=x.stateNode;x.tag===5&&P!==null&&(x=P,P=Fh(r,d),P!=null&&_.unshift(Zh(r,P,x)),P=Fh(r,o),P!=null&&_.push(Zh(r,P,x))),r=r.return}return _}function Cc(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5);return r||null}function Nx(r,o,d,_,x){for(var P=o._reactName,b=[];d!==null&&d!==_;){var c=d,U=c.alternate,Q=c.stateNode;if(U!==null&&U===_)break;c.tag===5&&Q!==null&&(c=Q,x?(U=Fh(d,P),U!=null&&b.unshift(Zh(d,U,c))):x||(U=Fh(d,P),U!=null&&b.push(Zh(d,U,c)))),d=d.return}b.length!==0&&r.push({event:o,listeners:b})}var KS=/\r\n?/g,YS=/\u0000|\uFFFD/g;function Vx(r){return(typeof r=="string"?r:""+r).replace(KS,`
`).replace(YS,"")}function Tp(r,o,d){if(o=Vx(o),Vx(r)!==o&&d)throw Error(it(425))}function ef(){}var Yg=null,Qg=null;function Jg(r,o){return r==="textarea"||r==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var e_=typeof setTimeout=="function"?setTimeout:void 0,QS=typeof clearTimeout=="function"?clearTimeout:void 0,$x=typeof Promise=="function"?Promise:void 0,JS=typeof queueMicrotask=="function"?queueMicrotask:typeof $x<"u"?function(r){return $x.resolve(null).then(r).catch(eP)}:e_;function eP(r){setTimeout(function(){throw r})}function mg(r,o){var d=o,_=0;do{var x=d.nextSibling;if(r.removeChild(d),x&&x.nodeType===8)if(d=x.data,d==="/$"){if(_===0){r.removeChild(x),Nh(o);return}_--}else d!=="$"&&d!=="$?"&&d!=="$!"||_++;d=x}while(d);Nh(o)}function pa(r){for(;r!=null;r=r.nextSibling){var o=r.nodeType;if(o===1||o===3)break;if(o===8){if(o=r.data,o==="$"||o==="$!"||o==="$?")break;if(o==="/$")return null}}return r}function Ux(r){r=r.previousSibling;for(var o=0;r;){if(r.nodeType===8){var d=r.data;if(d==="$"||d==="$!"||d==="$?"){if(o===0)return r;o--}else d==="/$"&&o++}r=r.previousSibling}return null}var iu=Math.random().toString(36).slice(2),Js="__reactFiber$"+iu,Gh="__reactProps$"+iu,ko="__reactContainer$"+iu,t_="__reactEvents$"+iu,tP="__reactListeners$"+iu,rP="__reactHandles$"+iu;function dl(r){var o=r[Js];if(o)return o;for(var d=r.parentNode;d;){if(o=d[ko]||d[Js]){if(d=o.alternate,o.child!==null||d!==null&&d.child!==null)for(r=Ux(r);r!==null;){if(d=r[Js])return d;r=Ux(r)}return o}r=d,d=r.parentNode}return null}function td(r){return r=r[Js]||r[ko],!r||r.tag!==5&&r.tag!==6&&r.tag!==13&&r.tag!==3?null:r}function Lc(r){if(r.tag===5||r.tag===6)return r.stateNode;throw Error(it(33))}function Tf(r){return r[Gh]||null}var r_=[],jc=-1;function ba(r){return{current:r}}function Zr(r){0>jc||(r.current=r_[jc],r_[jc]=null,jc--)}function Br(r,o){jc++,r_[jc]=r.current,r.current=o}var va={},li=ba(va),Ei=ba(!1),vl=va;function Xc(r,o){var d=r.type.contextTypes;if(!d)return va;var _=r.stateNode;if(_&&_.__reactInternalMemoizedUnmaskedChildContext===o)return _.__reactInternalMemoizedMaskedChildContext;var x={},P;for(P in d)x[P]=o[P];return _&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=o,r.__reactInternalMemoizedMaskedChildContext=x),x}function Ii(r){return r=r.childContextTypes,r!=null}function tf(){Zr(Ei),Zr(li)}function Zx(r,o,d){if(li.current!==va)throw Error(it(168));Br(li,o),Br(Ei,d)}function W1(r,o,d){var _=r.stateNode;if(o=o.childContextTypes,typeof _.getChildContext!="function")return d;_=_.getChildContext();for(var x in _)if(!(x in o))throw Error(it(108,NT(r)||"Unknown",x));return en({},d,_)}function rf(r){return r=(r=r.stateNode)&&r.__reactInternalMemoizedMergedChildContext||va,vl=li.current,Br(li,r),Br(Ei,Ei.current),!0}function Gx(r,o,d){var _=r.stateNode;if(!_)throw Error(it(169));d?(r=W1(r,o,vl),_.__reactInternalMemoizedMergedChildContext=r,Zr(Ei),Zr(li),Br(li,r)):Zr(Ei),Br(Ei,d)}var To=null,Sf=!1,gg=!1;function X1(r){To===null?To=[r]:To.push(r)}function nP(r){Sf=!0,X1(r)}function wa(){if(!gg&&To!==null){gg=!0;var r=0,o=Mr;try{var d=To;for(Mr=1;r<d.length;r++){var _=d[r];do _=_(!0);while(_!==null)}To=null,Sf=!1}catch(x){throw To!==null&&(To=To.slice(r+1)),x1(B_,wa),x}finally{Mr=o,gg=!1}}return null}var Fc=[],Bc=0,nf=null,sf=0,cs=[],us=0,xl=null,So=1,Po="";function ul(r,o){Fc[Bc++]=sf,Fc[Bc++]=nf,nf=r,sf=o}function K1(r,o,d){cs[us++]=So,cs[us++]=Po,cs[us++]=xl,xl=r;var _=So;r=Po;var x=32-zs(_)-1;_&=~(1<<x),d+=1;var P=32-zs(o)+x;if(30<P){var b=x-x%5;P=(_&(1<<b)-1).toString(32),_>>=b,x-=b,So=1<<32-zs(o)+x|d<<x|_,Po=P+r}else So=1<<P|d<<x|_,Po=r}function H_(r){r.return!==null&&(ul(r,1),K1(r,1,0))}function W_(r){for(;r===nf;)nf=Fc[--Bc],Fc[Bc]=null,sf=Fc[--Bc],Fc[Bc]=null;for(;r===xl;)xl=cs[--us],cs[us]=null,Po=cs[--us],cs[us]=null,So=cs[--us],cs[us]=null}var Wi=null,Hi=null,Wr=!1,As=null;function Y1(r,o){var d=hs(5,null,null,0);d.elementType="DELETED",d.stateNode=o,d.return=r,o=r.deletions,o===null?(r.deletions=[d],r.flags|=16):o.push(d)}function qx(r,o){switch(r.tag){case 5:var d=r.type;return o=o.nodeType!==1||d.toLowerCase()!==o.nodeName.toLowerCase()?null:o,o!==null?(r.stateNode=o,Wi=r,Hi=pa(o.firstChild),!0):!1;case 6:return o=r.pendingProps===""||o.nodeType!==3?null:o,o!==null?(r.stateNode=o,Wi=r,Hi=null,!0):!1;case 13:return o=o.nodeType!==8?null:o,o!==null?(d=xl!==null?{id:So,overflow:Po}:null,r.memoizedState={dehydrated:o,treeContext:d,retryLane:1073741824},d=hs(18,null,null,0),d.stateNode=o,d.return=r,r.child=d,Wi=r,Hi=null,!0):!1;default:return!1}}function n_(r){return(r.mode&1)!==0&&(r.flags&128)===0}function i_(r){if(Wr){var o=Hi;if(o){var d=o;if(!qx(r,o)){if(n_(r))throw Error(it(418));o=pa(d.nextSibling);var _=Wi;o&&qx(r,o)?Y1(_,d):(r.flags=r.flags&-4097|2,Wr=!1,Wi=r)}}else{if(n_(r))throw Error(it(418));r.flags=r.flags&-4097|2,Wr=!1,Wi=r}}}function Hx(r){for(r=r.return;r!==null&&r.tag!==5&&r.tag!==3&&r.tag!==13;)r=r.return;Wi=r}function Sp(r){if(r!==Wi)return!1;if(!Wr)return Hx(r),Wr=!0,!1;var o;if((o=r.tag!==3)&&!(o=r.tag!==5)&&(o=r.type,o=o!=="head"&&o!=="body"&&!Jg(r.type,r.memoizedProps)),o&&(o=Hi)){if(n_(r))throw Q1(),Error(it(418));for(;o;)Y1(r,o),o=pa(o.nextSibling)}if(Hx(r),r.tag===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(it(317));e:{for(r=r.nextSibling,o=0;r;){if(r.nodeType===8){var d=r.data;if(d==="/$"){if(o===0){Hi=pa(r.nextSibling);break e}o--}else d!=="$"&&d!=="$!"&&d!=="$?"||o++}r=r.nextSibling}Hi=null}}else Hi=Wi?pa(r.stateNode.nextSibling):null;return!0}function Q1(){for(var r=Hi;r;)r=pa(r.nextSibling)}function Kc(){Hi=Wi=null,Wr=!1}function X_(r){As===null?As=[r]:As.push(r)}var iP=Ao.ReactCurrentBatchConfig;function gh(r,o,d){if(r=d.ref,r!==null&&typeof r!="function"&&typeof r!="object"){if(d._owner){if(d=d._owner,d){if(d.tag!==1)throw Error(it(309));var _=d.stateNode}if(!_)throw Error(it(147,r));var x=_,P=""+r;return o!==null&&o.ref!==null&&typeof o.ref=="function"&&o.ref._stringRef===P?o.ref:(o=function(b){var c=x.refs;b===null?delete c[P]:c[P]=b},o._stringRef=P,o)}if(typeof r!="string")throw Error(it(284));if(!d._owner)throw Error(it(290,r))}return r}function Pp(r,o){throw r=Object.prototype.toString.call(o),Error(it(31,r==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":r))}function Wx(r){var o=r._init;return o(r._payload)}function J1(r){function o(pe,le){if(r){var ve=pe.deletions;ve===null?(pe.deletions=[le],pe.flags|=16):ve.push(le)}}function d(pe,le){if(!r)return null;for(;le!==null;)o(pe,le),le=le.sibling;return null}function _(pe,le){for(pe=new Map;le!==null;)le.key!==null?pe.set(le.key,le):pe.set(le.index,le),le=le.sibling;return pe}function x(pe,le){return pe=_a(pe,le),pe.index=0,pe.sibling=null,pe}function P(pe,le,ve){return pe.index=ve,r?(ve=pe.alternate,ve!==null?(ve=ve.index,ve<le?(pe.flags|=2,le):ve):(pe.flags|=2,le)):(pe.flags|=1048576,le)}function b(pe){return r&&pe.alternate===null&&(pe.flags|=2),pe}function c(pe,le,ve,Be){return le===null||le.tag!==6?(le=Tg(ve,pe.mode,Be),le.return=pe,le):(le=x(le,ve),le.return=pe,le)}function U(pe,le,ve,Be){var We=ve.type;return We===Ac?ne(pe,le,ve.props.children,Be,ve.key):le!==null&&(le.elementType===We||typeof We=="object"&&We!==null&&We.$$typeof===ia&&Wx(We)===le.type)?(Be=x(le,ve.props),Be.ref=gh(pe,le,ve),Be.return=pe,Be):(Be=$p(ve.type,ve.key,ve.props,null,pe.mode,Be),Be.ref=gh(pe,le,ve),Be.return=pe,Be)}function Q(pe,le,ve,Be){return le===null||le.tag!==4||le.stateNode.containerInfo!==ve.containerInfo||le.stateNode.implementation!==ve.implementation?(le=Sg(ve,pe.mode,Be),le.return=pe,le):(le=x(le,ve.children||[]),le.return=pe,le)}function ne(pe,le,ve,Be,We){return le===null||le.tag!==7?(le=_l(ve,pe.mode,Be,We),le.return=pe,le):(le=x(le,ve),le.return=pe,le)}function ye(pe,le,ve){if(typeof le=="string"&&le!==""||typeof le=="number")return le=Tg(""+le,pe.mode,ve),le.return=pe,le;if(typeof le=="object"&&le!==null){switch(le.$$typeof){case fp:return ve=$p(le.type,le.key,le.props,null,pe.mode,ve),ve.ref=gh(pe,null,le),ve.return=pe,ve;case Ic:return le=Sg(le,pe.mode,ve),le.return=pe,le;case ia:var Be=le._init;return ye(pe,Be(le._payload),ve)}if(wh(le)||hh(le))return le=_l(le,pe.mode,ve,null),le.return=pe,le;Pp(pe,le)}return null}function me(pe,le,ve,Be){var We=le!==null?le.key:null;if(typeof ve=="string"&&ve!==""||typeof ve=="number")return We!==null?null:c(pe,le,""+ve,Be);if(typeof ve=="object"&&ve!==null){switch(ve.$$typeof){case fp:return ve.key===We?U(pe,le,ve,Be):null;case Ic:return ve.key===We?Q(pe,le,ve,Be):null;case ia:return We=ve._init,me(pe,le,We(ve._payload),Be)}if(wh(ve)||hh(ve))return We!==null?null:ne(pe,le,ve,Be,null);Pp(pe,ve)}return null}function re(pe,le,ve,Be,We){if(typeof Be=="string"&&Be!==""||typeof Be=="number")return pe=pe.get(ve)||null,c(le,pe,""+Be,We);if(typeof Be=="object"&&Be!==null){switch(Be.$$typeof){case fp:return pe=pe.get(Be.key===null?ve:Be.key)||null,U(le,pe,Be,We);case Ic:return pe=pe.get(Be.key===null?ve:Be.key)||null,Q(le,pe,Be,We);case ia:var Je=Be._init;return re(pe,le,ve,Je(Be._payload),We)}if(wh(Be)||hh(Be))return pe=pe.get(ve)||null,ne(le,pe,Be,We,null);Pp(le,Be)}return null}function ce(pe,le,ve,Be){for(var We=null,Je=null,st=le,rt=le=0,Zt=null;st!==null&&rt<ve.length;rt++){st.index>rt?(Zt=st,st=null):Zt=st.sibling;var zt=me(pe,st,ve[rt],Be);if(zt===null){st===null&&(st=Zt);break}r&&st&&zt.alternate===null&&o(pe,st),le=P(zt,le,rt),Je===null?We=zt:Je.sibling=zt,Je=zt,st=Zt}if(rt===ve.length)return d(pe,st),Wr&&ul(pe,rt),We;if(st===null){for(;rt<ve.length;rt++)st=ye(pe,ve[rt],Be),st!==null&&(le=P(st,le,rt),Je===null?We=st:Je.sibling=st,Je=st);return Wr&&ul(pe,rt),We}for(st=_(pe,st);rt<ve.length;rt++)Zt=re(st,pe,rt,ve[rt],Be),Zt!==null&&(r&&Zt.alternate!==null&&st.delete(Zt.key===null?rt:Zt.key),le=P(Zt,le,rt),Je===null?We=Zt:Je.sibling=Zt,Je=Zt);return r&&st.forEach(function(ur){return o(pe,ur)}),Wr&&ul(pe,rt),We}function Le(pe,le,ve,Be){var We=hh(ve);if(typeof We!="function")throw Error(it(150));if(ve=We.call(ve),ve==null)throw Error(it(151));for(var Je=We=null,st=le,rt=le=0,Zt=null,zt=ve.next();st!==null&&!zt.done;rt++,zt=ve.next()){st.index>rt?(Zt=st,st=null):Zt=st.sibling;var ur=me(pe,st,zt.value,Be);if(ur===null){st===null&&(st=Zt);break}r&&st&&ur.alternate===null&&o(pe,st),le=P(ur,le,rt),Je===null?We=ur:Je.sibling=ur,Je=ur,st=Zt}if(zt.done)return d(pe,st),Wr&&ul(pe,rt),We;if(st===null){for(;!zt.done;rt++,zt=ve.next())zt=ye(pe,zt.value,Be),zt!==null&&(le=P(zt,le,rt),Je===null?We=zt:Je.sibling=zt,Je=zt);return Wr&&ul(pe,rt),We}for(st=_(pe,st);!zt.done;rt++,zt=ve.next())zt=re(st,pe,rt,zt.value,Be),zt!==null&&(r&&zt.alternate!==null&&st.delete(zt.key===null?rt:zt.key),le=P(zt,le,rt),Je===null?We=zt:Je.sibling=zt,Je=zt);return r&&st.forEach(function(hr){return o(pe,hr)}),Wr&&ul(pe,rt),We}function Qe(pe,le,ve,Be){if(typeof ve=="object"&&ve!==null&&ve.type===Ac&&ve.key===null&&(ve=ve.props.children),typeof ve=="object"&&ve!==null){switch(ve.$$typeof){case fp:e:{for(var We=ve.key,Je=le;Je!==null;){if(Je.key===We){if(We=ve.type,We===Ac){if(Je.tag===7){d(pe,Je.sibling),le=x(Je,ve.props.children),le.return=pe,pe=le;break e}}else if(Je.elementType===We||typeof We=="object"&&We!==null&&We.$$typeof===ia&&Wx(We)===Je.type){d(pe,Je.sibling),le=x(Je,ve.props),le.ref=gh(pe,Je,ve),le.return=pe,pe=le;break e}d(pe,Je);break}else o(pe,Je);Je=Je.sibling}ve.type===Ac?(le=_l(ve.props.children,pe.mode,Be,ve.key),le.return=pe,pe=le):(Be=$p(ve.type,ve.key,ve.props,null,pe.mode,Be),Be.ref=gh(pe,le,ve),Be.return=pe,pe=Be)}return b(pe);case Ic:e:{for(Je=ve.key;le!==null;){if(le.key===Je)if(le.tag===4&&le.stateNode.containerInfo===ve.containerInfo&&le.stateNode.implementation===ve.implementation){d(pe,le.sibling),le=x(le,ve.children||[]),le.return=pe,pe=le;break e}else{d(pe,le);break}else o(pe,le);le=le.sibling}le=Sg(ve,pe.mode,Be),le.return=pe,pe=le}return b(pe);case ia:return Je=ve._init,Qe(pe,le,Je(ve._payload),Be)}if(wh(ve))return ce(pe,le,ve,Be);if(hh(ve))return Le(pe,le,ve,Be);Pp(pe,ve)}return typeof ve=="string"&&ve!==""||typeof ve=="number"?(ve=""+ve,le!==null&&le.tag===6?(d(pe,le.sibling),le=x(le,ve),le.return=pe,pe=le):(d(pe,le),le=Tg(ve,pe.mode,Be),le.return=pe,pe=le),b(pe)):d(pe,le)}return Qe}var Yc=J1(!0),eb=J1(!1),of=ba(null),af=null,Oc=null,K_=null;function Y_(){K_=Oc=af=null}function Q_(r){var o=of.current;Zr(of),r._currentValue=o}function s_(r,o,d){for(;r!==null;){var _=r.alternate;if((r.childLanes&o)!==o?(r.childLanes|=o,_!==null&&(_.childLanes|=o)):_!==null&&(_.childLanes&o)!==o&&(_.childLanes|=o),r===d)break;r=r.return}}function qc(r,o){af=r,K_=Oc=null,r=r.dependencies,r!==null&&r.firstContext!==null&&(r.lanes&o&&(ki=!0),r.firstContext=null)}function ps(r){var o=r._currentValue;if(K_!==r)if(r={context:r,memoizedValue:o,next:null},Oc===null){if(af===null)throw Error(it(308));Oc=r,af.dependencies={lanes:0,firstContext:r}}else Oc=Oc.next=r;return o}var pl=null;function J_(r){pl===null?pl=[r]:pl.push(r)}function tb(r,o,d,_){var x=o.interleaved;return x===null?(d.next=d,J_(o)):(d.next=x.next,x.next=d),o.interleaved=d,Eo(r,_)}function Eo(r,o){r.lanes|=o;var d=r.alternate;for(d!==null&&(d.lanes|=o),d=r,r=r.return;r!==null;)r.childLanes|=o,d=r.alternate,d!==null&&(d.childLanes|=o),d=r,r=r.return;return d.tag===3?d.stateNode:null}var sa=!1;function ey(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function rb(r,o){r=r.updateQueue,o.updateQueue===r&&(o.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,effects:r.effects})}function Co(r,o){return{eventTime:r,lane:o,tag:0,payload:null,callback:null,next:null}}function fa(r,o,d){var _=r.updateQueue;if(_===null)return null;if(_=_.shared,gr&2){var x=_.pending;return x===null?o.next=o:(o.next=x.next,x.next=o),_.pending=o,Eo(r,d)}return x=_.interleaved,x===null?(o.next=o,J_(_)):(o.next=x.next,x.next=o),_.interleaved=o,Eo(r,d)}function jp(r,o,d){if(o=o.updateQueue,o!==null&&(o=o.shared,(d&4194240)!==0)){var _=o.lanes;_&=r.pendingLanes,d|=_,o.lanes=d,O_(r,d)}}function Xx(r,o){var d=r.updateQueue,_=r.alternate;if(_!==null&&(_=_.updateQueue,d===_)){var x=null,P=null;if(d=d.firstBaseUpdate,d!==null){do{var b={eventTime:d.eventTime,lane:d.lane,tag:d.tag,payload:d.payload,callback:d.callback,next:null};P===null?x=P=b:P=P.next=b,d=d.next}while(d!==null);P===null?x=P=o:P=P.next=o}else x=P=o;d={baseState:_.baseState,firstBaseUpdate:x,lastBaseUpdate:P,shared:_.shared,effects:_.effects},r.updateQueue=d;return}r=d.lastBaseUpdate,r===null?d.firstBaseUpdate=o:r.next=o,d.lastBaseUpdate=o}function lf(r,o,d,_){var x=r.updateQueue;sa=!1;var P=x.firstBaseUpdate,b=x.lastBaseUpdate,c=x.shared.pending;if(c!==null){x.shared.pending=null;var U=c,Q=U.next;U.next=null,b===null?P=Q:b.next=Q,b=U;var ne=r.alternate;ne!==null&&(ne=ne.updateQueue,c=ne.lastBaseUpdate,c!==b&&(c===null?ne.firstBaseUpdate=Q:c.next=Q,ne.lastBaseUpdate=U))}if(P!==null){var ye=x.baseState;b=0,ne=Q=U=null,c=P;do{var me=c.lane,re=c.eventTime;if((_&me)===me){ne!==null&&(ne=ne.next={eventTime:re,lane:0,tag:c.tag,payload:c.payload,callback:c.callback,next:null});e:{var ce=r,Le=c;switch(me=o,re=d,Le.tag){case 1:if(ce=Le.payload,typeof ce=="function"){ye=ce.call(re,ye,me);break e}ye=ce;break e;case 3:ce.flags=ce.flags&-65537|128;case 0:if(ce=Le.payload,me=typeof ce=="function"?ce.call(re,ye,me):ce,me==null)break e;ye=en({},ye,me);break e;case 2:sa=!0}}c.callback!==null&&c.lane!==0&&(r.flags|=64,me=x.effects,me===null?x.effects=[c]:me.push(c))}else re={eventTime:re,lane:me,tag:c.tag,payload:c.payload,callback:c.callback,next:null},ne===null?(Q=ne=re,U=ye):ne=ne.next=re,b|=me;if(c=c.next,c===null){if(c=x.shared.pending,c===null)break;me=c,c=me.next,me.next=null,x.lastBaseUpdate=me,x.shared.pending=null}}while(!0);if(ne===null&&(U=ye),x.baseState=U,x.firstBaseUpdate=Q,x.lastBaseUpdate=ne,o=x.shared.interleaved,o!==null){x=o;do b|=x.lane,x=x.next;while(x!==o)}else P===null&&(x.shared.lanes=0);wl|=b,r.lanes=b,r.memoizedState=ye}}function Kx(r,o,d){if(r=o.effects,o.effects=null,r!==null)for(o=0;o<r.length;o++){var _=r[o],x=_.callback;if(x!==null){if(_.callback=null,_=d,typeof x!="function")throw Error(it(191,x));x.call(_)}}}var rd={},to=ba(rd),qh=ba(rd),Hh=ba(rd);function fl(r){if(r===rd)throw Error(it(174));return r}function ty(r,o){switch(Br(Hh,o),Br(qh,r),Br(to,rd),r=o.nodeType,r){case 9:case 11:o=(o=o.documentElement)?o.namespaceURI:Og(null,"");break;default:r=r===8?o.parentNode:o,o=r.namespaceURI||null,r=r.tagName,o=Og(o,r)}Zr(to),Br(to,o)}function Qc(){Zr(to),Zr(qh),Zr(Hh)}function nb(r){fl(Hh.current);var o=fl(to.current),d=Og(o,r.type);o!==d&&(Br(qh,r),Br(to,d))}function ry(r){qh.current===r&&(Zr(to),Zr(qh))}var Qr=ba(0);function cf(r){for(var o=r;o!==null;){if(o.tag===13){var d=o.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||d.data==="$?"||d.data==="$!"))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if(o.flags&128)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===r)break;for(;o.sibling===null;){if(o.return===null||o.return===r)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var _g=[];function ny(){for(var r=0;r<_g.length;r++)_g[r]._workInProgressVersionPrimary=null;_g.length=0}var Fp=Ao.ReactCurrentDispatcher,yg=Ao.ReactCurrentBatchConfig,bl=0,Jr=null,jn=null,Un=null,uf=!1,Ah=!1,Wh=0,sP=0;function ii(){throw Error(it(321))}function iy(r,o){if(o===null)return!1;for(var d=0;d<o.length&&d<r.length;d++)if(!Ds(r[d],o[d]))return!1;return!0}function sy(r,o,d,_,x,P){if(bl=P,Jr=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,Fp.current=r===null||r.memoizedState===null?cP:uP,r=d(_,x),Ah){P=0;do{if(Ah=!1,Wh=0,25<=P)throw Error(it(301));P+=1,Un=jn=null,o.updateQueue=null,Fp.current=hP,r=d(_,x)}while(Ah)}if(Fp.current=hf,o=jn!==null&&jn.next!==null,bl=0,Un=jn=Jr=null,uf=!1,o)throw Error(it(300));return r}function oy(){var r=Wh!==0;return Wh=0,r}function Qs(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Un===null?Jr.memoizedState=Un=r:Un=Un.next=r,Un}function fs(){if(jn===null){var r=Jr.alternate;r=r!==null?r.memoizedState:null}else r=jn.next;var o=Un===null?Jr.memoizedState:Un.next;if(o!==null)Un=o,jn=r;else{if(r===null)throw Error(it(310));jn=r,r={memoizedState:jn.memoizedState,baseState:jn.baseState,baseQueue:jn.baseQueue,queue:jn.queue,next:null},Un===null?Jr.memoizedState=Un=r:Un=Un.next=r}return Un}function Xh(r,o){return typeof o=="function"?o(r):o}function vg(r){var o=fs(),d=o.queue;if(d===null)throw Error(it(311));d.lastRenderedReducer=r;var _=jn,x=_.baseQueue,P=d.pending;if(P!==null){if(x!==null){var b=x.next;x.next=P.next,P.next=b}_.baseQueue=x=P,d.pending=null}if(x!==null){P=x.next,_=_.baseState;var c=b=null,U=null,Q=P;do{var ne=Q.lane;if((bl&ne)===ne)U!==null&&(U=U.next={lane:0,action:Q.action,hasEagerState:Q.hasEagerState,eagerState:Q.eagerState,next:null}),_=Q.hasEagerState?Q.eagerState:r(_,Q.action);else{var ye={lane:ne,action:Q.action,hasEagerState:Q.hasEagerState,eagerState:Q.eagerState,next:null};U===null?(c=U=ye,b=_):U=U.next=ye,Jr.lanes|=ne,wl|=ne}Q=Q.next}while(Q!==null&&Q!==P);U===null?b=_:U.next=c,Ds(_,o.memoizedState)||(ki=!0),o.memoizedState=_,o.baseState=b,o.baseQueue=U,d.lastRenderedState=_}if(r=d.interleaved,r!==null){x=r;do P=x.lane,Jr.lanes|=P,wl|=P,x=x.next;while(x!==r)}else x===null&&(d.lanes=0);return[o.memoizedState,d.dispatch]}function xg(r){var o=fs(),d=o.queue;if(d===null)throw Error(it(311));d.lastRenderedReducer=r;var _=d.dispatch,x=d.pending,P=o.memoizedState;if(x!==null){d.pending=null;var b=x=x.next;do P=r(P,b.action),b=b.next;while(b!==x);Ds(P,o.memoizedState)||(ki=!0),o.memoizedState=P,o.baseQueue===null&&(o.baseState=P),d.lastRenderedState=P}return[P,_]}function ib(){}function sb(r,o){var d=Jr,_=fs(),x=o(),P=!Ds(_.memoizedState,x);if(P&&(_.memoizedState=x,ki=!0),_=_.queue,ay(lb.bind(null,d,_,r),[r]),_.getSnapshot!==o||P||Un!==null&&Un.memoizedState.tag&1){if(d.flags|=2048,Kh(9,ab.bind(null,d,_,x,o),void 0,null),Zn===null)throw Error(it(349));bl&30||ob(d,o,x)}return x}function ob(r,o,d){r.flags|=16384,r={getSnapshot:o,value:d},o=Jr.updateQueue,o===null?(o={lastEffect:null,stores:null},Jr.updateQueue=o,o.stores=[r]):(d=o.stores,d===null?o.stores=[r]:d.push(r))}function ab(r,o,d,_){o.value=d,o.getSnapshot=_,cb(o)&&ub(r)}function lb(r,o,d){return d(function(){cb(o)&&ub(r)})}function cb(r){var o=r.getSnapshot;r=r.value;try{var d=o();return!Ds(r,d)}catch{return!0}}function ub(r){var o=Eo(r,1);o!==null&&Rs(o,r,1,-1)}function Yx(r){var o=Qs();return typeof r=="function"&&(r=r()),o.memoizedState=o.baseState=r,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Xh,lastRenderedState:r},o.queue=r,r=r.dispatch=lP.bind(null,Jr,r),[o.memoizedState,r]}function Kh(r,o,d,_){return r={tag:r,create:o,destroy:d,deps:_,next:null},o=Jr.updateQueue,o===null?(o={lastEffect:null,stores:null},Jr.updateQueue=o,o.lastEffect=r.next=r):(d=o.lastEffect,d===null?o.lastEffect=r.next=r:(_=d.next,d.next=r,r.next=_,o.lastEffect=r)),r}function hb(){return fs().memoizedState}function Bp(r,o,d,_){var x=Qs();Jr.flags|=r,x.memoizedState=Kh(1|o,d,void 0,_===void 0?null:_)}function Pf(r,o,d,_){var x=fs();_=_===void 0?null:_;var P=void 0;if(jn!==null){var b=jn.memoizedState;if(P=b.destroy,_!==null&&iy(_,b.deps)){x.memoizedState=Kh(o,d,P,_);return}}Jr.flags|=r,x.memoizedState=Kh(1|o,d,P,_)}function Qx(r,o){return Bp(8390656,8,r,o)}function ay(r,o){return Pf(2048,8,r,o)}function db(r,o){return Pf(4,2,r,o)}function pb(r,o){return Pf(4,4,r,o)}function fb(r,o){if(typeof o=="function")return r=r(),o(r),function(){o(null)};if(o!=null)return r=r(),o.current=r,function(){o.current=null}}function mb(r,o,d){return d=d!=null?d.concat([r]):null,Pf(4,4,fb.bind(null,o,r),d)}function ly(){}function gb(r,o){var d=fs();o=o===void 0?null:o;var _=d.memoizedState;return _!==null&&o!==null&&iy(o,_[1])?_[0]:(d.memoizedState=[r,o],r)}function _b(r,o){var d=fs();o=o===void 0?null:o;var _=d.memoizedState;return _!==null&&o!==null&&iy(o,_[1])?_[0]:(r=r(),d.memoizedState=[r,o],r)}function yb(r,o,d){return bl&21?(Ds(d,o)||(d=T1(),Jr.lanes|=d,wl|=d,r.baseState=!0),o):(r.baseState&&(r.baseState=!1,ki=!0),r.memoizedState=d)}function oP(r,o){var d=Mr;Mr=d!==0&&4>d?d:4,r(!0);var _=yg.transition;yg.transition={};try{r(!1),o()}finally{Mr=d,yg.transition=_}}function vb(){return fs().memoizedState}function aP(r,o,d){var _=ga(r);if(d={lane:_,action:d,hasEagerState:!1,eagerState:null,next:null},xb(r))bb(o,d);else if(d=tb(r,o,d,_),d!==null){var x=_i();Rs(d,r,_,x),wb(d,o,_)}}function lP(r,o,d){var _=ga(r),x={lane:_,action:d,hasEagerState:!1,eagerState:null,next:null};if(xb(r))bb(o,x);else{var P=r.alternate;if(r.lanes===0&&(P===null||P.lanes===0)&&(P=o.lastRenderedReducer,P!==null))try{var b=o.lastRenderedState,c=P(b,d);if(x.hasEagerState=!0,x.eagerState=c,Ds(c,b)){var U=o.interleaved;U===null?(x.next=x,J_(o)):(x.next=U.next,U.next=x),o.interleaved=x;return}}catch{}finally{}d=tb(r,o,x,_),d!==null&&(x=_i(),Rs(d,r,_,x),wb(d,o,_))}}function xb(r){var o=r.alternate;return r===Jr||o!==null&&o===Jr}function bb(r,o){Ah=uf=!0;var d=r.pending;d===null?o.next=o:(o.next=d.next,d.next=o),r.pending=o}function wb(r,o,d){if(d&4194240){var _=o.lanes;_&=r.pendingLanes,d|=_,o.lanes=d,O_(r,d)}}var hf={readContext:ps,useCallback:ii,useContext:ii,useEffect:ii,useImperativeHandle:ii,useInsertionEffect:ii,useLayoutEffect:ii,useMemo:ii,useReducer:ii,useRef:ii,useState:ii,useDebugValue:ii,useDeferredValue:ii,useTransition:ii,useMutableSource:ii,useSyncExternalStore:ii,useId:ii,unstable_isNewReconciler:!1},cP={readContext:ps,useCallback:function(r,o){return Qs().memoizedState=[r,o===void 0?null:o],r},useContext:ps,useEffect:Qx,useImperativeHandle:function(r,o,d){return d=d!=null?d.concat([r]):null,Bp(4194308,4,fb.bind(null,o,r),d)},useLayoutEffect:function(r,o){return Bp(4194308,4,r,o)},useInsertionEffect:function(r,o){return Bp(4,2,r,o)},useMemo:function(r,o){var d=Qs();return o=o===void 0?null:o,r=r(),d.memoizedState=[r,o],r},useReducer:function(r,o,d){var _=Qs();return o=d!==void 0?d(o):o,_.memoizedState=_.baseState=o,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:o},_.queue=r,r=r.dispatch=aP.bind(null,Jr,r),[_.memoizedState,r]},useRef:function(r){var o=Qs();return r={current:r},o.memoizedState=r},useState:Yx,useDebugValue:ly,useDeferredValue:function(r){return Qs().memoizedState=r},useTransition:function(){var r=Yx(!1),o=r[0];return r=oP.bind(null,r[1]),Qs().memoizedState=r,[o,r]},useMutableSource:function(){},useSyncExternalStore:function(r,o,d){var _=Jr,x=Qs();if(Wr){if(d===void 0)throw Error(it(407));d=d()}else{if(d=o(),Zn===null)throw Error(it(349));bl&30||ob(_,o,d)}x.memoizedState=d;var P={value:d,getSnapshot:o};return x.queue=P,Qx(lb.bind(null,_,P,r),[r]),_.flags|=2048,Kh(9,ab.bind(null,_,P,d,o),void 0,null),d},useId:function(){var r=Qs(),o=Zn.identifierPrefix;if(Wr){var d=Po,_=So;d=(_&~(1<<32-zs(_)-1)).toString(32)+d,o=":"+o+"R"+d,d=Wh++,0<d&&(o+="H"+d.toString(32)),o+=":"}else d=sP++,o=":"+o+"r"+d.toString(32)+":";return r.memoizedState=o},unstable_isNewReconciler:!1},uP={readContext:ps,useCallback:gb,useContext:ps,useEffect:ay,useImperativeHandle:mb,useInsertionEffect:db,useLayoutEffect:pb,useMemo:_b,useReducer:vg,useRef:hb,useState:function(){return vg(Xh)},useDebugValue:ly,useDeferredValue:function(r){var o=fs();return yb(o,jn.memoizedState,r)},useTransition:function(){var r=vg(Xh)[0],o=fs().memoizedState;return[r,o]},useMutableSource:ib,useSyncExternalStore:sb,useId:vb,unstable_isNewReconciler:!1},hP={readContext:ps,useCallback:gb,useContext:ps,useEffect:ay,useImperativeHandle:mb,useInsertionEffect:db,useLayoutEffect:pb,useMemo:_b,useReducer:xg,useRef:hb,useState:function(){return xg(Xh)},useDebugValue:ly,useDeferredValue:function(r){var o=fs();return jn===null?o.memoizedState=r:yb(o,jn.memoizedState,r)},useTransition:function(){var r=xg(Xh)[0],o=fs().memoizedState;return[r,o]},useMutableSource:ib,useSyncExternalStore:sb,useId:vb,unstable_isNewReconciler:!1};function Es(r,o){if(r&&r.defaultProps){o=en({},o),r=r.defaultProps;for(var d in r)o[d]===void 0&&(o[d]=r[d]);return o}return o}function o_(r,o,d,_){o=r.memoizedState,d=d(_,o),d=d==null?o:en({},o,d),r.memoizedState=d,r.lanes===0&&(r.updateQueue.baseState=d)}var Cf={isMounted:function(r){return(r=r._reactInternals)?Cl(r)===r:!1},enqueueSetState:function(r,o,d){r=r._reactInternals;var _=_i(),x=ga(r),P=Co(_,x);P.payload=o,d!=null&&(P.callback=d),o=fa(r,P,x),o!==null&&(Rs(o,r,x,_),jp(o,r,x))},enqueueReplaceState:function(r,o,d){r=r._reactInternals;var _=_i(),x=ga(r),P=Co(_,x);P.tag=1,P.payload=o,d!=null&&(P.callback=d),o=fa(r,P,x),o!==null&&(Rs(o,r,x,_),jp(o,r,x))},enqueueForceUpdate:function(r,o){r=r._reactInternals;var d=_i(),_=ga(r),x=Co(d,_);x.tag=2,o!=null&&(x.callback=o),o=fa(r,x,_),o!==null&&(Rs(o,r,_,d),jp(o,r,_))}};function Jx(r,o,d,_,x,P,b){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(_,P,b):o.prototype&&o.prototype.isPureReactComponent?!$h(d,_)||!$h(x,P):!0}function Tb(r,o,d){var _=!1,x=va,P=o.contextType;return typeof P=="object"&&P!==null?P=ps(P):(x=Ii(o)?vl:li.current,_=o.contextTypes,P=(_=_!=null)?Xc(r,x):va),o=new o(d,P),r.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,o.updater=Cf,r.stateNode=o,o._reactInternals=r,_&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=x,r.__reactInternalMemoizedMaskedChildContext=P),o}function e0(r,o,d,_){r=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(d,_),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(d,_),o.state!==r&&Cf.enqueueReplaceState(o,o.state,null)}function a_(r,o,d,_){var x=r.stateNode;x.props=d,x.state=r.memoizedState,x.refs={},ey(r);var P=o.contextType;typeof P=="object"&&P!==null?x.context=ps(P):(P=Ii(o)?vl:li.current,x.context=Xc(r,P)),x.state=r.memoizedState,P=o.getDerivedStateFromProps,typeof P=="function"&&(o_(r,o,P,d),x.state=r.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof x.getSnapshotBeforeUpdate=="function"||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(o=x.state,typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount(),o!==x.state&&Cf.enqueueReplaceState(x,x.state,null),lf(r,d,x,_),x.state=r.memoizedState),typeof x.componentDidMount=="function"&&(r.flags|=4194308)}function Jc(r,o){try{var d="",_=o;do d+=OT(_),_=_.return;while(_);var x=d}catch(P){x=`
Error generating stack: `+P.message+`
`+P.stack}return{value:r,source:o,stack:x,digest:null}}function bg(r,o,d){return{value:r,source:null,stack:d??null,digest:o??null}}function l_(r,o){try{console.error(o.value)}catch(d){setTimeout(function(){throw d})}}var dP=typeof WeakMap=="function"?WeakMap:Map;function Sb(r,o,d){d=Co(-1,d),d.tag=3,d.payload={element:null};var _=o.value;return d.callback=function(){pf||(pf=!0,y_=_),l_(r,o)},d}function Pb(r,o,d){d=Co(-1,d),d.tag=3;var _=r.type.getDerivedStateFromError;if(typeof _=="function"){var x=o.value;d.payload=function(){return _(x)},d.callback=function(){l_(r,o)}}var P=r.stateNode;return P!==null&&typeof P.componentDidCatch=="function"&&(d.callback=function(){l_(r,o),typeof _!="function"&&(ma===null?ma=new Set([this]):ma.add(this));var b=o.stack;this.componentDidCatch(o.value,{componentStack:b!==null?b:""})}),d}function t0(r,o,d){var _=r.pingCache;if(_===null){_=r.pingCache=new dP;var x=new Set;_.set(o,x)}else x=_.get(o),x===void 0&&(x=new Set,_.set(o,x));x.has(d)||(x.add(d),r=CP.bind(null,r,o,d),o.then(r,r))}function r0(r){do{var o;if((o=r.tag===13)&&(o=r.memoizedState,o=o!==null?o.dehydrated!==null:!0),o)return r;r=r.return}while(r!==null);return null}function n0(r,o,d,_,x){return r.mode&1?(r.flags|=65536,r.lanes=x,r):(r===o?r.flags|=65536:(r.flags|=128,d.flags|=131072,d.flags&=-52805,d.tag===1&&(d.alternate===null?d.tag=17:(o=Co(-1,1),o.tag=2,fa(d,o,1))),d.lanes|=1),r)}var pP=Ao.ReactCurrentOwner,ki=!1;function gi(r,o,d,_){o.child=r===null?eb(o,null,d,_):Yc(o,r.child,d,_)}function i0(r,o,d,_,x){d=d.render;var P=o.ref;return qc(o,x),_=sy(r,o,d,_,P,x),d=oy(),r!==null&&!ki?(o.updateQueue=r.updateQueue,o.flags&=-2053,r.lanes&=~x,Io(r,o,x)):(Wr&&d&&H_(o),o.flags|=1,gi(r,o,_,x),o.child)}function s0(r,o,d,_,x){if(r===null){var P=d.type;return typeof P=="function"&&!gy(P)&&P.defaultProps===void 0&&d.compare===null&&d.defaultProps===void 0?(o.tag=15,o.type=P,Cb(r,o,P,_,x)):(r=$p(d.type,null,_,o,o.mode,x),r.ref=o.ref,r.return=o,o.child=r)}if(P=r.child,!(r.lanes&x)){var b=P.memoizedProps;if(d=d.compare,d=d!==null?d:$h,d(b,_)&&r.ref===o.ref)return Io(r,o,x)}return o.flags|=1,r=_a(P,_),r.ref=o.ref,r.return=o,o.child=r}function Cb(r,o,d,_,x){if(r!==null){var P=r.memoizedProps;if($h(P,_)&&r.ref===o.ref)if(ki=!1,o.pendingProps=_=P,(r.lanes&x)!==0)r.flags&131072&&(ki=!0);else return o.lanes=r.lanes,Io(r,o,x)}return c_(r,o,d,_,x)}function Mb(r,o,d){var _=o.pendingProps,x=_.children,P=r!==null?r.memoizedState:null;if(_.mode==="hidden")if(!(o.mode&1))o.memoizedState={baseLanes:0,cachePool:null,transitions:null},Br(Vc,qi),qi|=d;else{if(!(d&1073741824))return r=P!==null?P.baseLanes|d:d,o.lanes=o.childLanes=1073741824,o.memoizedState={baseLanes:r,cachePool:null,transitions:null},o.updateQueue=null,Br(Vc,qi),qi|=r,null;o.memoizedState={baseLanes:0,cachePool:null,transitions:null},_=P!==null?P.baseLanes:d,Br(Vc,qi),qi|=_}else P!==null?(_=P.baseLanes|d,o.memoizedState=null):_=d,Br(Vc,qi),qi|=_;return gi(r,o,x,d),o.child}function kb(r,o){var d=o.ref;(r===null&&d!==null||r!==null&&r.ref!==d)&&(o.flags|=512,o.flags|=2097152)}function c_(r,o,d,_,x){var P=Ii(d)?vl:li.current;return P=Xc(o,P),qc(o,x),d=sy(r,o,d,_,P,x),_=oy(),r!==null&&!ki?(o.updateQueue=r.updateQueue,o.flags&=-2053,r.lanes&=~x,Io(r,o,x)):(Wr&&_&&H_(o),o.flags|=1,gi(r,o,d,x),o.child)}function o0(r,o,d,_,x){if(Ii(d)){var P=!0;rf(o)}else P=!1;if(qc(o,x),o.stateNode===null)Op(r,o),Tb(o,d,_),a_(o,d,_,x),_=!0;else if(r===null){var b=o.stateNode,c=o.memoizedProps;b.props=c;var U=b.context,Q=d.contextType;typeof Q=="object"&&Q!==null?Q=ps(Q):(Q=Ii(d)?vl:li.current,Q=Xc(o,Q));var ne=d.getDerivedStateFromProps,ye=typeof ne=="function"||typeof b.getSnapshotBeforeUpdate=="function";ye||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(c!==_||U!==Q)&&e0(o,b,_,Q),sa=!1;var me=o.memoizedState;b.state=me,lf(o,_,b,x),U=o.memoizedState,c!==_||me!==U||Ei.current||sa?(typeof ne=="function"&&(o_(o,d,ne,_),U=o.memoizedState),(c=sa||Jx(o,d,c,_,me,U,Q))?(ye||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount()),typeof b.componentDidMount=="function"&&(o.flags|=4194308)):(typeof b.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=_,o.memoizedState=U),b.props=_,b.state=U,b.context=Q,_=c):(typeof b.componentDidMount=="function"&&(o.flags|=4194308),_=!1)}else{b=o.stateNode,rb(r,o),c=o.memoizedProps,Q=o.type===o.elementType?c:Es(o.type,c),b.props=Q,ye=o.pendingProps,me=b.context,U=d.contextType,typeof U=="object"&&U!==null?U=ps(U):(U=Ii(d)?vl:li.current,U=Xc(o,U));var re=d.getDerivedStateFromProps;(ne=typeof re=="function"||typeof b.getSnapshotBeforeUpdate=="function")||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(c!==ye||me!==U)&&e0(o,b,_,U),sa=!1,me=o.memoizedState,b.state=me,lf(o,_,b,x);var ce=o.memoizedState;c!==ye||me!==ce||Ei.current||sa?(typeof re=="function"&&(o_(o,d,re,_),ce=o.memoizedState),(Q=sa||Jx(o,d,Q,_,me,ce,U)||!1)?(ne||typeof b.UNSAFE_componentWillUpdate!="function"&&typeof b.componentWillUpdate!="function"||(typeof b.componentWillUpdate=="function"&&b.componentWillUpdate(_,ce,U),typeof b.UNSAFE_componentWillUpdate=="function"&&b.UNSAFE_componentWillUpdate(_,ce,U)),typeof b.componentDidUpdate=="function"&&(o.flags|=4),typeof b.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof b.componentDidUpdate!="function"||c===r.memoizedProps&&me===r.memoizedState||(o.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||c===r.memoizedProps&&me===r.memoizedState||(o.flags|=1024),o.memoizedProps=_,o.memoizedState=ce),b.props=_,b.state=ce,b.context=U,_=Q):(typeof b.componentDidUpdate!="function"||c===r.memoizedProps&&me===r.memoizedState||(o.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||c===r.memoizedProps&&me===r.memoizedState||(o.flags|=1024),_=!1)}return u_(r,o,d,_,P,x)}function u_(r,o,d,_,x,P){kb(r,o);var b=(o.flags&128)!==0;if(!_&&!b)return x&&Gx(o,d,!1),Io(r,o,P);_=o.stateNode,pP.current=o;var c=b&&typeof d.getDerivedStateFromError!="function"?null:_.render();return o.flags|=1,r!==null&&b?(o.child=Yc(o,r.child,null,P),o.child=Yc(o,null,c,P)):gi(r,o,c,P),o.memoizedState=_.state,x&&Gx(o,d,!0),o.child}function Eb(r){var o=r.stateNode;o.pendingContext?Zx(r,o.pendingContext,o.pendingContext!==o.context):o.context&&Zx(r,o.context,!1),ty(r,o.containerInfo)}function a0(r,o,d,_,x){return Kc(),X_(x),o.flags|=256,gi(r,o,d,_),o.child}var h_={dehydrated:null,treeContext:null,retryLane:0};function d_(r){return{baseLanes:r,cachePool:null,transitions:null}}function Ib(r,o,d){var _=o.pendingProps,x=Qr.current,P=!1,b=(o.flags&128)!==0,c;if((c=b)||(c=r!==null&&r.memoizedState===null?!1:(x&2)!==0),c?(P=!0,o.flags&=-129):(r===null||r.memoizedState!==null)&&(x|=1),Br(Qr,x&1),r===null)return i_(o),r=o.memoizedState,r!==null&&(r=r.dehydrated,r!==null)?(o.mode&1?r.data==="$!"?o.lanes=8:o.lanes=1073741824:o.lanes=1,null):(b=_.children,r=_.fallback,P?(_=o.mode,P=o.child,b={mode:"hidden",children:b},!(_&1)&&P!==null?(P.childLanes=0,P.pendingProps=b):P=Ef(b,_,0,null),r=_l(r,_,d,null),P.return=o,r.return=o,P.sibling=r,o.child=P,o.child.memoizedState=d_(d),o.memoizedState=h_,r):cy(o,b));if(x=r.memoizedState,x!==null&&(c=x.dehydrated,c!==null))return fP(r,o,b,_,c,x,d);if(P){P=_.fallback,b=o.mode,x=r.child,c=x.sibling;var U={mode:"hidden",children:_.children};return!(b&1)&&o.child!==x?(_=o.child,_.childLanes=0,_.pendingProps=U,o.deletions=null):(_=_a(x,U),_.subtreeFlags=x.subtreeFlags&14680064),c!==null?P=_a(c,P):(P=_l(P,b,d,null),P.flags|=2),P.return=o,_.return=o,_.sibling=P,o.child=_,_=P,P=o.child,b=r.child.memoizedState,b=b===null?d_(d):{baseLanes:b.baseLanes|d,cachePool:null,transitions:b.transitions},P.memoizedState=b,P.childLanes=r.childLanes&~d,o.memoizedState=h_,_}return P=r.child,r=P.sibling,_=_a(P,{mode:"visible",children:_.children}),!(o.mode&1)&&(_.lanes=d),_.return=o,_.sibling=null,r!==null&&(d=o.deletions,d===null?(o.deletions=[r],o.flags|=16):d.push(r)),o.child=_,o.memoizedState=null,_}function cy(r,o){return o=Ef({mode:"visible",children:o},r.mode,0,null),o.return=r,r.child=o}function Cp(r,o,d,_){return _!==null&&X_(_),Yc(o,r.child,null,d),r=cy(o,o.pendingProps.children),r.flags|=2,o.memoizedState=null,r}function fP(r,o,d,_,x,P,b){if(d)return o.flags&256?(o.flags&=-257,_=bg(Error(it(422))),Cp(r,o,b,_)):o.memoizedState!==null?(o.child=r.child,o.flags|=128,null):(P=_.fallback,x=o.mode,_=Ef({mode:"visible",children:_.children},x,0,null),P=_l(P,x,b,null),P.flags|=2,_.return=o,P.return=o,_.sibling=P,o.child=_,o.mode&1&&Yc(o,r.child,null,b),o.child.memoizedState=d_(b),o.memoizedState=h_,P);if(!(o.mode&1))return Cp(r,o,b,null);if(x.data==="$!"){if(_=x.nextSibling&&x.nextSibling.dataset,_)var c=_.dgst;return _=c,P=Error(it(419)),_=bg(P,_,void 0),Cp(r,o,b,_)}if(c=(b&r.childLanes)!==0,ki||c){if(_=Zn,_!==null){switch(b&-b){case 4:x=2;break;case 16:x=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:x=32;break;case 536870912:x=268435456;break;default:x=0}x=x&(_.suspendedLanes|b)?0:x,x!==0&&x!==P.retryLane&&(P.retryLane=x,Eo(r,x),Rs(_,r,x,-1))}return my(),_=bg(Error(it(421))),Cp(r,o,b,_)}return x.data==="$?"?(o.flags|=128,o.child=r.child,o=MP.bind(null,r),x._reactRetry=o,null):(r=P.treeContext,Hi=pa(x.nextSibling),Wi=o,Wr=!0,As=null,r!==null&&(cs[us++]=So,cs[us++]=Po,cs[us++]=xl,So=r.id,Po=r.overflow,xl=o),o=cy(o,_.children),o.flags|=4096,o)}function l0(r,o,d){r.lanes|=o;var _=r.alternate;_!==null&&(_.lanes|=o),s_(r.return,o,d)}function wg(r,o,d,_,x){var P=r.memoizedState;P===null?r.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:_,tail:d,tailMode:x}:(P.isBackwards=o,P.rendering=null,P.renderingStartTime=0,P.last=_,P.tail=d,P.tailMode=x)}function Ab(r,o,d){var _=o.pendingProps,x=_.revealOrder,P=_.tail;if(gi(r,o,_.children,d),_=Qr.current,_&2)_=_&1|2,o.flags|=128;else{if(r!==null&&r.flags&128)e:for(r=o.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&l0(r,d,o);else if(r.tag===19)l0(r,d,o);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===o)break e;for(;r.sibling===null;){if(r.return===null||r.return===o)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}_&=1}if(Br(Qr,_),!(o.mode&1))o.memoizedState=null;else switch(x){case"forwards":for(d=o.child,x=null;d!==null;)r=d.alternate,r!==null&&cf(r)===null&&(x=d),d=d.sibling;d=x,d===null?(x=o.child,o.child=null):(x=d.sibling,d.sibling=null),wg(o,!1,x,d,P);break;case"backwards":for(d=null,x=o.child,o.child=null;x!==null;){if(r=x.alternate,r!==null&&cf(r)===null){o.child=x;break}r=x.sibling,x.sibling=d,d=x,x=r}wg(o,!0,d,null,P);break;case"together":wg(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function Op(r,o){!(o.mode&1)&&r!==null&&(r.alternate=null,o.alternate=null,o.flags|=2)}function Io(r,o,d){if(r!==null&&(o.dependencies=r.dependencies),wl|=o.lanes,!(d&o.childLanes))return null;if(r!==null&&o.child!==r.child)throw Error(it(153));if(o.child!==null){for(r=o.child,d=_a(r,r.pendingProps),o.child=d,d.return=o;r.sibling!==null;)r=r.sibling,d=d.sibling=_a(r,r.pendingProps),d.return=o;d.sibling=null}return o.child}function mP(r,o,d){switch(o.tag){case 3:Eb(o),Kc();break;case 5:nb(o);break;case 1:Ii(o.type)&&rf(o);break;case 4:ty(o,o.stateNode.containerInfo);break;case 10:var _=o.type._context,x=o.memoizedProps.value;Br(of,_._currentValue),_._currentValue=x;break;case 13:if(_=o.memoizedState,_!==null)return _.dehydrated!==null?(Br(Qr,Qr.current&1),o.flags|=128,null):d&o.child.childLanes?Ib(r,o,d):(Br(Qr,Qr.current&1),r=Io(r,o,d),r!==null?r.sibling:null);Br(Qr,Qr.current&1);break;case 19:if(_=(d&o.childLanes)!==0,r.flags&128){if(_)return Ab(r,o,d);o.flags|=128}if(x=o.memoizedState,x!==null&&(x.rendering=null,x.tail=null,x.lastEffect=null),Br(Qr,Qr.current),_)break;return null;case 22:case 23:return o.lanes=0,Mb(r,o,d)}return Io(r,o,d)}var zb,p_,Rb,Db;zb=function(r,o){for(var d=o.child;d!==null;){if(d.tag===5||d.tag===6)r.appendChild(d.stateNode);else if(d.tag!==4&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===o)break;for(;d.sibling===null;){if(d.return===null||d.return===o)return;d=d.return}d.sibling.return=d.return,d=d.sibling}};p_=function(){};Rb=function(r,o,d,_){var x=r.memoizedProps;if(x!==_){r=o.stateNode,fl(to.current);var P=null;switch(d){case"input":x=Lg(r,x),_=Lg(r,_),P=[];break;case"select":x=en({},x,{value:void 0}),_=en({},_,{value:void 0}),P=[];break;case"textarea":x=Bg(r,x),_=Bg(r,_),P=[];break;default:typeof x.onClick!="function"&&typeof _.onClick=="function"&&(r.onclick=ef)}Ng(d,_);var b;d=null;for(Q in x)if(!_.hasOwnProperty(Q)&&x.hasOwnProperty(Q)&&x[Q]!=null)if(Q==="style"){var c=x[Q];for(b in c)c.hasOwnProperty(b)&&(d||(d={}),d[b]="")}else Q!=="dangerouslySetInnerHTML"&&Q!=="children"&&Q!=="suppressContentEditableWarning"&&Q!=="suppressHydrationWarning"&&Q!=="autoFocus"&&(Lh.hasOwnProperty(Q)?P||(P=[]):(P=P||[]).push(Q,null));for(Q in _){var U=_[Q];if(c=x!=null?x[Q]:void 0,_.hasOwnProperty(Q)&&U!==c&&(U!=null||c!=null))if(Q==="style")if(c){for(b in c)!c.hasOwnProperty(b)||U&&U.hasOwnProperty(b)||(d||(d={}),d[b]="");for(b in U)U.hasOwnProperty(b)&&c[b]!==U[b]&&(d||(d={}),d[b]=U[b])}else d||(P||(P=[]),P.push(Q,d)),d=U;else Q==="dangerouslySetInnerHTML"?(U=U?U.__html:void 0,c=c?c.__html:void 0,U!=null&&c!==U&&(P=P||[]).push(Q,U)):Q==="children"?typeof U!="string"&&typeof U!="number"||(P=P||[]).push(Q,""+U):Q!=="suppressContentEditableWarning"&&Q!=="suppressHydrationWarning"&&(Lh.hasOwnProperty(Q)?(U!=null&&Q==="onScroll"&&Ur("scroll",r),P||c===U||(P=[])):(P=P||[]).push(Q,U))}d&&(P=P||[]).push("style",d);var Q=P;(o.updateQueue=Q)&&(o.flags|=4)}};Db=function(r,o,d,_){d!==_&&(o.flags|=4)};function _h(r,o){if(!Wr)switch(r.tailMode){case"hidden":o=r.tail;for(var d=null;o!==null;)o.alternate!==null&&(d=o),o=o.sibling;d===null?r.tail=null:d.sibling=null;break;case"collapsed":d=r.tail;for(var _=null;d!==null;)d.alternate!==null&&(_=d),d=d.sibling;_===null?o||r.tail===null?r.tail=null:r.tail.sibling=null:_.sibling=null}}function si(r){var o=r.alternate!==null&&r.alternate.child===r.child,d=0,_=0;if(o)for(var x=r.child;x!==null;)d|=x.lanes|x.childLanes,_|=x.subtreeFlags&14680064,_|=x.flags&14680064,x.return=r,x=x.sibling;else for(x=r.child;x!==null;)d|=x.lanes|x.childLanes,_|=x.subtreeFlags,_|=x.flags,x.return=r,x=x.sibling;return r.subtreeFlags|=_,r.childLanes=d,o}function gP(r,o,d){var _=o.pendingProps;switch(W_(o),o.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return si(o),null;case 1:return Ii(o.type)&&tf(),si(o),null;case 3:return _=o.stateNode,Qc(),Zr(Ei),Zr(li),ny(),_.pendingContext&&(_.context=_.pendingContext,_.pendingContext=null),(r===null||r.child===null)&&(Sp(o)?o.flags|=4:r===null||r.memoizedState.isDehydrated&&!(o.flags&256)||(o.flags|=1024,As!==null&&(b_(As),As=null))),p_(r,o),si(o),null;case 5:ry(o);var x=fl(Hh.current);if(d=o.type,r!==null&&o.stateNode!=null)Rb(r,o,d,_,x),r.ref!==o.ref&&(o.flags|=512,o.flags|=2097152);else{if(!_){if(o.stateNode===null)throw Error(it(166));return si(o),null}if(r=fl(to.current),Sp(o)){_=o.stateNode,d=o.type;var P=o.memoizedProps;switch(_[Js]=o,_[Gh]=P,r=(o.mode&1)!==0,d){case"dialog":Ur("cancel",_),Ur("close",_);break;case"iframe":case"object":case"embed":Ur("load",_);break;case"video":case"audio":for(x=0;x<Sh.length;x++)Ur(Sh[x],_);break;case"source":Ur("error",_);break;case"img":case"image":case"link":Ur("error",_),Ur("load",_);break;case"details":Ur("toggle",_);break;case"input":_x(_,P),Ur("invalid",_);break;case"select":_._wrapperState={wasMultiple:!!P.multiple},Ur("invalid",_);break;case"textarea":vx(_,P),Ur("invalid",_)}Ng(d,P),x=null;for(var b in P)if(P.hasOwnProperty(b)){var c=P[b];b==="children"?typeof c=="string"?_.textContent!==c&&(P.suppressHydrationWarning!==!0&&Tp(_.textContent,c,r),x=["children",c]):typeof c=="number"&&_.textContent!==""+c&&(P.suppressHydrationWarning!==!0&&Tp(_.textContent,c,r),x=["children",""+c]):Lh.hasOwnProperty(b)&&c!=null&&b==="onScroll"&&Ur("scroll",_)}switch(d){case"input":mp(_),yx(_,P,!0);break;case"textarea":mp(_),xx(_);break;case"select":case"option":break;default:typeof P.onClick=="function"&&(_.onclick=ef)}_=x,o.updateQueue=_,_!==null&&(o.flags|=4)}else{b=x.nodeType===9?x:x.ownerDocument,r==="http://www.w3.org/1999/xhtml"&&(r=l1(d)),r==="http://www.w3.org/1999/xhtml"?d==="script"?(r=b.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild)):typeof _.is=="string"?r=b.createElement(d,{is:_.is}):(r=b.createElement(d),d==="select"&&(b=r,_.multiple?b.multiple=!0:_.size&&(b.size=_.size))):r=b.createElementNS(r,d),r[Js]=o,r[Gh]=_,zb(r,o,!1,!1),o.stateNode=r;e:{switch(b=Vg(d,_),d){case"dialog":Ur("cancel",r),Ur("close",r),x=_;break;case"iframe":case"object":case"embed":Ur("load",r),x=_;break;case"video":case"audio":for(x=0;x<Sh.length;x++)Ur(Sh[x],r);x=_;break;case"source":Ur("error",r),x=_;break;case"img":case"image":case"link":Ur("error",r),Ur("load",r),x=_;break;case"details":Ur("toggle",r),x=_;break;case"input":_x(r,_),x=Lg(r,_),Ur("invalid",r);break;case"option":x=_;break;case"select":r._wrapperState={wasMultiple:!!_.multiple},x=en({},_,{value:void 0}),Ur("invalid",r);break;case"textarea":vx(r,_),x=Bg(r,_),Ur("invalid",r);break;default:x=_}Ng(d,x),c=x;for(P in c)if(c.hasOwnProperty(P)){var U=c[P];P==="style"?h1(r,U):P==="dangerouslySetInnerHTML"?(U=U?U.__html:void 0,U!=null&&c1(r,U)):P==="children"?typeof U=="string"?(d!=="textarea"||U!=="")&&jh(r,U):typeof U=="number"&&jh(r,""+U):P!=="suppressContentEditableWarning"&&P!=="suppressHydrationWarning"&&P!=="autoFocus"&&(Lh.hasOwnProperty(P)?U!=null&&P==="onScroll"&&Ur("scroll",r):U!=null&&R_(r,P,U,b))}switch(d){case"input":mp(r),yx(r,_,!1);break;case"textarea":mp(r),xx(r);break;case"option":_.value!=null&&r.setAttribute("value",""+ya(_.value));break;case"select":r.multiple=!!_.multiple,P=_.value,P!=null?$c(r,!!_.multiple,P,!1):_.defaultValue!=null&&$c(r,!!_.multiple,_.defaultValue,!0);break;default:typeof x.onClick=="function"&&(r.onclick=ef)}switch(d){case"button":case"input":case"select":case"textarea":_=!!_.autoFocus;break e;case"img":_=!0;break e;default:_=!1}}_&&(o.flags|=4)}o.ref!==null&&(o.flags|=512,o.flags|=2097152)}return si(o),null;case 6:if(r&&o.stateNode!=null)Db(r,o,r.memoizedProps,_);else{if(typeof _!="string"&&o.stateNode===null)throw Error(it(166));if(d=fl(Hh.current),fl(to.current),Sp(o)){if(_=o.stateNode,d=o.memoizedProps,_[Js]=o,(P=_.nodeValue!==d)&&(r=Wi,r!==null))switch(r.tag){case 3:Tp(_.nodeValue,d,(r.mode&1)!==0);break;case 5:r.memoizedProps.suppressHydrationWarning!==!0&&Tp(_.nodeValue,d,(r.mode&1)!==0)}P&&(o.flags|=4)}else _=(d.nodeType===9?d:d.ownerDocument).createTextNode(_),_[Js]=o,o.stateNode=_}return si(o),null;case 13:if(Zr(Qr),_=o.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(Wr&&Hi!==null&&o.mode&1&&!(o.flags&128))Q1(),Kc(),o.flags|=98560,P=!1;else if(P=Sp(o),_!==null&&_.dehydrated!==null){if(r===null){if(!P)throw Error(it(318));if(P=o.memoizedState,P=P!==null?P.dehydrated:null,!P)throw Error(it(317));P[Js]=o}else Kc(),!(o.flags&128)&&(o.memoizedState=null),o.flags|=4;si(o),P=!1}else As!==null&&(b_(As),As=null),P=!0;if(!P)return o.flags&65536?o:null}return o.flags&128?(o.lanes=d,o):(_=_!==null,_!==(r!==null&&r.memoizedState!==null)&&_&&(o.child.flags|=8192,o.mode&1&&(r===null||Qr.current&1?Fn===0&&(Fn=3):my())),o.updateQueue!==null&&(o.flags|=4),si(o),null);case 4:return Qc(),p_(r,o),r===null&&Uh(o.stateNode.containerInfo),si(o),null;case 10:return Q_(o.type._context),si(o),null;case 17:return Ii(o.type)&&tf(),si(o),null;case 19:if(Zr(Qr),P=o.memoizedState,P===null)return si(o),null;if(_=(o.flags&128)!==0,b=P.rendering,b===null)if(_)_h(P,!1);else{if(Fn!==0||r!==null&&r.flags&128)for(r=o.child;r!==null;){if(b=cf(r),b!==null){for(o.flags|=128,_h(P,!1),_=b.updateQueue,_!==null&&(o.updateQueue=_,o.flags|=4),o.subtreeFlags=0,_=d,d=o.child;d!==null;)P=d,r=_,P.flags&=14680066,b=P.alternate,b===null?(P.childLanes=0,P.lanes=r,P.child=null,P.subtreeFlags=0,P.memoizedProps=null,P.memoizedState=null,P.updateQueue=null,P.dependencies=null,P.stateNode=null):(P.childLanes=b.childLanes,P.lanes=b.lanes,P.child=b.child,P.subtreeFlags=0,P.deletions=null,P.memoizedProps=b.memoizedProps,P.memoizedState=b.memoizedState,P.updateQueue=b.updateQueue,P.type=b.type,r=b.dependencies,P.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),d=d.sibling;return Br(Qr,Qr.current&1|2),o.child}r=r.sibling}P.tail!==null&&_n()>eu&&(o.flags|=128,_=!0,_h(P,!1),o.lanes=4194304)}else{if(!_)if(r=cf(b),r!==null){if(o.flags|=128,_=!0,d=r.updateQueue,d!==null&&(o.updateQueue=d,o.flags|=4),_h(P,!0),P.tail===null&&P.tailMode==="hidden"&&!b.alternate&&!Wr)return si(o),null}else 2*_n()-P.renderingStartTime>eu&&d!==1073741824&&(o.flags|=128,_=!0,_h(P,!1),o.lanes=4194304);P.isBackwards?(b.sibling=o.child,o.child=b):(d=P.last,d!==null?d.sibling=b:o.child=b,P.last=b)}return P.tail!==null?(o=P.tail,P.rendering=o,P.tail=o.sibling,P.renderingStartTime=_n(),o.sibling=null,d=Qr.current,Br(Qr,_?d&1|2:d&1),o):(si(o),null);case 22:case 23:return fy(),_=o.memoizedState!==null,r!==null&&r.memoizedState!==null!==_&&(o.flags|=8192),_&&o.mode&1?qi&1073741824&&(si(o),o.subtreeFlags&6&&(o.flags|=8192)):si(o),null;case 24:return null;case 25:return null}throw Error(it(156,o.tag))}function _P(r,o){switch(W_(o),o.tag){case 1:return Ii(o.type)&&tf(),r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 3:return Qc(),Zr(Ei),Zr(li),ny(),r=o.flags,r&65536&&!(r&128)?(o.flags=r&-65537|128,o):null;case 5:return ry(o),null;case 13:if(Zr(Qr),r=o.memoizedState,r!==null&&r.dehydrated!==null){if(o.alternate===null)throw Error(it(340));Kc()}return r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 19:return Zr(Qr),null;case 4:return Qc(),null;case 10:return Q_(o.type._context),null;case 22:case 23:return fy(),null;case 24:return null;default:return null}}var Mp=!1,oi=!1,yP=typeof WeakSet=="function"?WeakSet:Set,vt=null;function Nc(r,o){var d=r.ref;if(d!==null)if(typeof d=="function")try{d(null)}catch(_){ln(r,o,_)}else d.current=null}function f_(r,o,d){try{d()}catch(_){ln(r,o,_)}}var c0=!1;function vP(r,o){if(Yg=Yp,r=O1(),q_(r)){if("selectionStart"in r)var d={start:r.selectionStart,end:r.selectionEnd};else e:{d=(d=r.ownerDocument)&&d.defaultView||window;var _=d.getSelection&&d.getSelection();if(_&&_.rangeCount!==0){d=_.anchorNode;var x=_.anchorOffset,P=_.focusNode;_=_.focusOffset;try{d.nodeType,P.nodeType}catch{d=null;break e}var b=0,c=-1,U=-1,Q=0,ne=0,ye=r,me=null;t:for(;;){for(var re;ye!==d||x!==0&&ye.nodeType!==3||(c=b+x),ye!==P||_!==0&&ye.nodeType!==3||(U=b+_),ye.nodeType===3&&(b+=ye.nodeValue.length),(re=ye.firstChild)!==null;)me=ye,ye=re;for(;;){if(ye===r)break t;if(me===d&&++Q===x&&(c=b),me===P&&++ne===_&&(U=b),(re=ye.nextSibling)!==null)break;ye=me,me=ye.parentNode}ye=re}d=c===-1||U===-1?null:{start:c,end:U}}else d=null}d=d||{start:0,end:0}}else d=null;for(Qg={focusedElem:r,selectionRange:d},Yp=!1,vt=o;vt!==null;)if(o=vt,r=o.child,(o.subtreeFlags&1028)!==0&&r!==null)r.return=o,vt=r;else for(;vt!==null;){o=vt;try{var ce=o.alternate;if(o.flags&1024)switch(o.tag){case 0:case 11:case 15:break;case 1:if(ce!==null){var Le=ce.memoizedProps,Qe=ce.memoizedState,pe=o.stateNode,le=pe.getSnapshotBeforeUpdate(o.elementType===o.type?Le:Es(o.type,Le),Qe);pe.__reactInternalSnapshotBeforeUpdate=le}break;case 3:var ve=o.stateNode.containerInfo;ve.nodeType===1?ve.textContent="":ve.nodeType===9&&ve.documentElement&&ve.removeChild(ve.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(it(163))}}catch(Be){ln(o,o.return,Be)}if(r=o.sibling,r!==null){r.return=o.return,vt=r;break}vt=o.return}return ce=c0,c0=!1,ce}function zh(r,o,d){var _=o.updateQueue;if(_=_!==null?_.lastEffect:null,_!==null){var x=_=_.next;do{if((x.tag&r)===r){var P=x.destroy;x.destroy=void 0,P!==void 0&&f_(o,d,P)}x=x.next}while(x!==_)}}function Mf(r,o){if(o=o.updateQueue,o=o!==null?o.lastEffect:null,o!==null){var d=o=o.next;do{if((d.tag&r)===r){var _=d.create;d.destroy=_()}d=d.next}while(d!==o)}}function m_(r){var o=r.ref;if(o!==null){var d=r.stateNode;switch(r.tag){case 5:r=d;break;default:r=d}typeof o=="function"?o(r):o.current=r}}function Lb(r){var o=r.alternate;o!==null&&(r.alternate=null,Lb(o)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(o=r.stateNode,o!==null&&(delete o[Js],delete o[Gh],delete o[t_],delete o[tP],delete o[rP])),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}function jb(r){return r.tag===5||r.tag===3||r.tag===4}function u0(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||jb(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function g_(r,o,d){var _=r.tag;if(_===5||_===6)r=r.stateNode,o?d.nodeType===8?d.parentNode.insertBefore(r,o):d.insertBefore(r,o):(d.nodeType===8?(o=d.parentNode,o.insertBefore(r,d)):(o=d,o.appendChild(r)),d=d._reactRootContainer,d!=null||o.onclick!==null||(o.onclick=ef));else if(_!==4&&(r=r.child,r!==null))for(g_(r,o,d),r=r.sibling;r!==null;)g_(r,o,d),r=r.sibling}function __(r,o,d){var _=r.tag;if(_===5||_===6)r=r.stateNode,o?d.insertBefore(r,o):d.appendChild(r);else if(_!==4&&(r=r.child,r!==null))for(__(r,o,d),r=r.sibling;r!==null;)__(r,o,d),r=r.sibling}var Qn=null,Is=!1;function na(r,o,d){for(d=d.child;d!==null;)Fb(r,o,d),d=d.sibling}function Fb(r,o,d){if(eo&&typeof eo.onCommitFiberUnmount=="function")try{eo.onCommitFiberUnmount(vf,d)}catch{}switch(d.tag){case 5:oi||Nc(d,o);case 6:var _=Qn,x=Is;Qn=null,na(r,o,d),Qn=_,Is=x,Qn!==null&&(Is?(r=Qn,d=d.stateNode,r.nodeType===8?r.parentNode.removeChild(d):r.removeChild(d)):Qn.removeChild(d.stateNode));break;case 18:Qn!==null&&(Is?(r=Qn,d=d.stateNode,r.nodeType===8?mg(r.parentNode,d):r.nodeType===1&&mg(r,d),Nh(r)):mg(Qn,d.stateNode));break;case 4:_=Qn,x=Is,Qn=d.stateNode.containerInfo,Is=!0,na(r,o,d),Qn=_,Is=x;break;case 0:case 11:case 14:case 15:if(!oi&&(_=d.updateQueue,_!==null&&(_=_.lastEffect,_!==null))){x=_=_.next;do{var P=x,b=P.destroy;P=P.tag,b!==void 0&&(P&2||P&4)&&f_(d,o,b),x=x.next}while(x!==_)}na(r,o,d);break;case 1:if(!oi&&(Nc(d,o),_=d.stateNode,typeof _.componentWillUnmount=="function"))try{_.props=d.memoizedProps,_.state=d.memoizedState,_.componentWillUnmount()}catch(c){ln(d,o,c)}na(r,o,d);break;case 21:na(r,o,d);break;case 22:d.mode&1?(oi=(_=oi)||d.memoizedState!==null,na(r,o,d),oi=_):na(r,o,d);break;default:na(r,o,d)}}function h0(r){var o=r.updateQueue;if(o!==null){r.updateQueue=null;var d=r.stateNode;d===null&&(d=r.stateNode=new yP),o.forEach(function(_){var x=kP.bind(null,r,_);d.has(_)||(d.add(_),_.then(x,x))})}}function ks(r,o){var d=o.deletions;if(d!==null)for(var _=0;_<d.length;_++){var x=d[_];try{var P=r,b=o,c=b;e:for(;c!==null;){switch(c.tag){case 5:Qn=c.stateNode,Is=!1;break e;case 3:Qn=c.stateNode.containerInfo,Is=!0;break e;case 4:Qn=c.stateNode.containerInfo,Is=!0;break e}c=c.return}if(Qn===null)throw Error(it(160));Fb(P,b,x),Qn=null,Is=!1;var U=x.alternate;U!==null&&(U.return=null),x.return=null}catch(Q){ln(x,o,Q)}}if(o.subtreeFlags&12854)for(o=o.child;o!==null;)Bb(o,r),o=o.sibling}function Bb(r,o){var d=r.alternate,_=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:if(ks(o,r),Ks(r),_&4){try{zh(3,r,r.return),Mf(3,r)}catch(Le){ln(r,r.return,Le)}try{zh(5,r,r.return)}catch(Le){ln(r,r.return,Le)}}break;case 1:ks(o,r),Ks(r),_&512&&d!==null&&Nc(d,d.return);break;case 5:if(ks(o,r),Ks(r),_&512&&d!==null&&Nc(d,d.return),r.flags&32){var x=r.stateNode;try{jh(x,"")}catch(Le){ln(r,r.return,Le)}}if(_&4&&(x=r.stateNode,x!=null)){var P=r.memoizedProps,b=d!==null?d.memoizedProps:P,c=r.type,U=r.updateQueue;if(r.updateQueue=null,U!==null)try{c==="input"&&P.type==="radio"&&P.name!=null&&o1(x,P),Vg(c,b);var Q=Vg(c,P);for(b=0;b<U.length;b+=2){var ne=U[b],ye=U[b+1];ne==="style"?h1(x,ye):ne==="dangerouslySetInnerHTML"?c1(x,ye):ne==="children"?jh(x,ye):R_(x,ne,ye,Q)}switch(c){case"input":jg(x,P);break;case"textarea":a1(x,P);break;case"select":var me=x._wrapperState.wasMultiple;x._wrapperState.wasMultiple=!!P.multiple;var re=P.value;re!=null?$c(x,!!P.multiple,re,!1):me!==!!P.multiple&&(P.defaultValue!=null?$c(x,!!P.multiple,P.defaultValue,!0):$c(x,!!P.multiple,P.multiple?[]:"",!1))}x[Gh]=P}catch(Le){ln(r,r.return,Le)}}break;case 6:if(ks(o,r),Ks(r),_&4){if(r.stateNode===null)throw Error(it(162));x=r.stateNode,P=r.memoizedProps;try{x.nodeValue=P}catch(Le){ln(r,r.return,Le)}}break;case 3:if(ks(o,r),Ks(r),_&4&&d!==null&&d.memoizedState.isDehydrated)try{Nh(o.containerInfo)}catch(Le){ln(r,r.return,Le)}break;case 4:ks(o,r),Ks(r);break;case 13:ks(o,r),Ks(r),x=r.child,x.flags&8192&&(P=x.memoizedState!==null,x.stateNode.isHidden=P,!P||x.alternate!==null&&x.alternate.memoizedState!==null||(dy=_n())),_&4&&h0(r);break;case 22:if(ne=d!==null&&d.memoizedState!==null,r.mode&1?(oi=(Q=oi)||ne,ks(o,r),oi=Q):ks(o,r),Ks(r),_&8192){if(Q=r.memoizedState!==null,(r.stateNode.isHidden=Q)&&!ne&&r.mode&1)for(vt=r,ne=r.child;ne!==null;){for(ye=vt=ne;vt!==null;){switch(me=vt,re=me.child,me.tag){case 0:case 11:case 14:case 15:zh(4,me,me.return);break;case 1:Nc(me,me.return);var ce=me.stateNode;if(typeof ce.componentWillUnmount=="function"){_=me,d=me.return;try{o=_,ce.props=o.memoizedProps,ce.state=o.memoizedState,ce.componentWillUnmount()}catch(Le){ln(_,d,Le)}}break;case 5:Nc(me,me.return);break;case 22:if(me.memoizedState!==null){p0(ye);continue}}re!==null?(re.return=me,vt=re):p0(ye)}ne=ne.sibling}e:for(ne=null,ye=r;;){if(ye.tag===5){if(ne===null){ne=ye;try{x=ye.stateNode,Q?(P=x.style,typeof P.setProperty=="function"?P.setProperty("display","none","important"):P.display="none"):(c=ye.stateNode,U=ye.memoizedProps.style,b=U!=null&&U.hasOwnProperty("display")?U.display:null,c.style.display=u1("display",b))}catch(Le){ln(r,r.return,Le)}}}else if(ye.tag===6){if(ne===null)try{ye.stateNode.nodeValue=Q?"":ye.memoizedProps}catch(Le){ln(r,r.return,Le)}}else if((ye.tag!==22&&ye.tag!==23||ye.memoizedState===null||ye===r)&&ye.child!==null){ye.child.return=ye,ye=ye.child;continue}if(ye===r)break e;for(;ye.sibling===null;){if(ye.return===null||ye.return===r)break e;ne===ye&&(ne=null),ye=ye.return}ne===ye&&(ne=null),ye.sibling.return=ye.return,ye=ye.sibling}}break;case 19:ks(o,r),Ks(r),_&4&&h0(r);break;case 21:break;default:ks(o,r),Ks(r)}}function Ks(r){var o=r.flags;if(o&2){try{e:{for(var d=r.return;d!==null;){if(jb(d)){var _=d;break e}d=d.return}throw Error(it(160))}switch(_.tag){case 5:var x=_.stateNode;_.flags&32&&(jh(x,""),_.flags&=-33);var P=u0(r);__(r,P,x);break;case 3:case 4:var b=_.stateNode.containerInfo,c=u0(r);g_(r,c,b);break;default:throw Error(it(161))}}catch(U){ln(r,r.return,U)}r.flags&=-3}o&4096&&(r.flags&=-4097)}function xP(r,o,d){vt=r,Ob(r)}function Ob(r,o,d){for(var _=(r.mode&1)!==0;vt!==null;){var x=vt,P=x.child;if(x.tag===22&&_){var b=x.memoizedState!==null||Mp;if(!b){var c=x.alternate,U=c!==null&&c.memoizedState!==null||oi;c=Mp;var Q=oi;if(Mp=b,(oi=U)&&!Q)for(vt=x;vt!==null;)b=vt,U=b.child,b.tag===22&&b.memoizedState!==null?f0(x):U!==null?(U.return=b,vt=U):f0(x);for(;P!==null;)vt=P,Ob(P),P=P.sibling;vt=x,Mp=c,oi=Q}d0(r)}else x.subtreeFlags&8772&&P!==null?(P.return=x,vt=P):d0(r)}}function d0(r){for(;vt!==null;){var o=vt;if(o.flags&8772){var d=o.alternate;try{if(o.flags&8772)switch(o.tag){case 0:case 11:case 15:oi||Mf(5,o);break;case 1:var _=o.stateNode;if(o.flags&4&&!oi)if(d===null)_.componentDidMount();else{var x=o.elementType===o.type?d.memoizedProps:Es(o.type,d.memoizedProps);_.componentDidUpdate(x,d.memoizedState,_.__reactInternalSnapshotBeforeUpdate)}var P=o.updateQueue;P!==null&&Kx(o,P,_);break;case 3:var b=o.updateQueue;if(b!==null){if(d=null,o.child!==null)switch(o.child.tag){case 5:d=o.child.stateNode;break;case 1:d=o.child.stateNode}Kx(o,b,d)}break;case 5:var c=o.stateNode;if(d===null&&o.flags&4){d=c;var U=o.memoizedProps;switch(o.type){case"button":case"input":case"select":case"textarea":U.autoFocus&&d.focus();break;case"img":U.src&&(d.src=U.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(o.memoizedState===null){var Q=o.alternate;if(Q!==null){var ne=Q.memoizedState;if(ne!==null){var ye=ne.dehydrated;ye!==null&&Nh(ye)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(it(163))}oi||o.flags&512&&m_(o)}catch(me){ln(o,o.return,me)}}if(o===r){vt=null;break}if(d=o.sibling,d!==null){d.return=o.return,vt=d;break}vt=o.return}}function p0(r){for(;vt!==null;){var o=vt;if(o===r){vt=null;break}var d=o.sibling;if(d!==null){d.return=o.return,vt=d;break}vt=o.return}}function f0(r){for(;vt!==null;){var o=vt;try{switch(o.tag){case 0:case 11:case 15:var d=o.return;try{Mf(4,o)}catch(U){ln(o,d,U)}break;case 1:var _=o.stateNode;if(typeof _.componentDidMount=="function"){var x=o.return;try{_.componentDidMount()}catch(U){ln(o,x,U)}}var P=o.return;try{m_(o)}catch(U){ln(o,P,U)}break;case 5:var b=o.return;try{m_(o)}catch(U){ln(o,b,U)}}}catch(U){ln(o,o.return,U)}if(o===r){vt=null;break}var c=o.sibling;if(c!==null){c.return=o.return,vt=c;break}vt=o.return}}var bP=Math.ceil,df=Ao.ReactCurrentDispatcher,uy=Ao.ReactCurrentOwner,ds=Ao.ReactCurrentBatchConfig,gr=0,Zn=null,Mn=null,Jn=0,qi=0,Vc=ba(0),Fn=0,Yh=null,wl=0,kf=0,hy=0,Rh=null,Mi=null,dy=0,eu=1/0,wo=null,pf=!1,y_=null,ma=null,kp=!1,ca=null,ff=0,Dh=0,v_=null,Np=-1,Vp=0;function _i(){return gr&6?_n():Np!==-1?Np:Np=_n()}function ga(r){return r.mode&1?gr&2&&Jn!==0?Jn&-Jn:iP.transition!==null?(Vp===0&&(Vp=T1()),Vp):(r=Mr,r!==0||(r=window.event,r=r===void 0?16:I1(r.type)),r):1}function Rs(r,o,d,_){if(50<Dh)throw Dh=0,v_=null,Error(it(185));Jh(r,d,_),(!(gr&2)||r!==Zn)&&(r===Zn&&(!(gr&2)&&(kf|=d),Fn===4&&aa(r,Jn)),Ai(r,_),d===1&&gr===0&&!(o.mode&1)&&(eu=_n()+500,Sf&&wa()))}function Ai(r,o){var d=r.callbackNode;iS(r,o);var _=Kp(r,r===Zn?Jn:0);if(_===0)d!==null&&Tx(d),r.callbackNode=null,r.callbackPriority=0;else if(o=_&-_,r.callbackPriority!==o){if(d!=null&&Tx(d),o===1)r.tag===0?nP(m0.bind(null,r)):X1(m0.bind(null,r)),JS(function(){!(gr&6)&&wa()}),d=null;else{switch(S1(_)){case 1:d=B_;break;case 4:d=b1;break;case 16:d=Xp;break;case 536870912:d=w1;break;default:d=Xp}d=Hb(d,Nb.bind(null,r))}r.callbackPriority=o,r.callbackNode=d}}function Nb(r,o){if(Np=-1,Vp=0,gr&6)throw Error(it(327));var d=r.callbackNode;if(Hc()&&r.callbackNode!==d)return null;var _=Kp(r,r===Zn?Jn:0);if(_===0)return null;if(_&30||_&r.expiredLanes||o)o=mf(r,_);else{o=_;var x=gr;gr|=2;var P=$b();(Zn!==r||Jn!==o)&&(wo=null,eu=_n()+500,gl(r,o));do try{SP();break}catch(c){Vb(r,c)}while(!0);Y_(),df.current=P,gr=x,Mn!==null?o=0:(Zn=null,Jn=0,o=Fn)}if(o!==0){if(o===2&&(x=qg(r),x!==0&&(_=x,o=x_(r,x))),o===1)throw d=Yh,gl(r,0),aa(r,_),Ai(r,_n()),d;if(o===6)aa(r,_);else{if(x=r.current.alternate,!(_&30)&&!wP(x)&&(o=mf(r,_),o===2&&(P=qg(r),P!==0&&(_=P,o=x_(r,P))),o===1))throw d=Yh,gl(r,0),aa(r,_),Ai(r,_n()),d;switch(r.finishedWork=x,r.finishedLanes=_,o){case 0:case 1:throw Error(it(345));case 2:hl(r,Mi,wo);break;case 3:if(aa(r,_),(_&130023424)===_&&(o=dy+500-_n(),10<o)){if(Kp(r,0)!==0)break;if(x=r.suspendedLanes,(x&_)!==_){_i(),r.pingedLanes|=r.suspendedLanes&x;break}r.timeoutHandle=e_(hl.bind(null,r,Mi,wo),o);break}hl(r,Mi,wo);break;case 4:if(aa(r,_),(_&4194240)===_)break;for(o=r.eventTimes,x=-1;0<_;){var b=31-zs(_);P=1<<b,b=o[b],b>x&&(x=b),_&=~P}if(_=x,_=_n()-_,_=(120>_?120:480>_?480:1080>_?1080:1920>_?1920:3e3>_?3e3:4320>_?4320:1960*bP(_/1960))-_,10<_){r.timeoutHandle=e_(hl.bind(null,r,Mi,wo),_);break}hl(r,Mi,wo);break;case 5:hl(r,Mi,wo);break;default:throw Error(it(329))}}}return Ai(r,_n()),r.callbackNode===d?Nb.bind(null,r):null}function x_(r,o){var d=Rh;return r.current.memoizedState.isDehydrated&&(gl(r,o).flags|=256),r=mf(r,o),r!==2&&(o=Mi,Mi=d,o!==null&&b_(o)),r}function b_(r){Mi===null?Mi=r:Mi.push.apply(Mi,r)}function wP(r){for(var o=r;;){if(o.flags&16384){var d=o.updateQueue;if(d!==null&&(d=d.stores,d!==null))for(var _=0;_<d.length;_++){var x=d[_],P=x.getSnapshot;x=x.value;try{if(!Ds(P(),x))return!1}catch{return!1}}}if(d=o.child,o.subtreeFlags&16384&&d!==null)d.return=o,o=d;else{if(o===r)break;for(;o.sibling===null;){if(o.return===null||o.return===r)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function aa(r,o){for(o&=~hy,o&=~kf,r.suspendedLanes|=o,r.pingedLanes&=~o,r=r.expirationTimes;0<o;){var d=31-zs(o),_=1<<d;r[d]=-1,o&=~_}}function m0(r){if(gr&6)throw Error(it(327));Hc();var o=Kp(r,0);if(!(o&1))return Ai(r,_n()),null;var d=mf(r,o);if(r.tag!==0&&d===2){var _=qg(r);_!==0&&(o=_,d=x_(r,_))}if(d===1)throw d=Yh,gl(r,0),aa(r,o),Ai(r,_n()),d;if(d===6)throw Error(it(345));return r.finishedWork=r.current.alternate,r.finishedLanes=o,hl(r,Mi,wo),Ai(r,_n()),null}function py(r,o){var d=gr;gr|=1;try{return r(o)}finally{gr=d,gr===0&&(eu=_n()+500,Sf&&wa())}}function Tl(r){ca!==null&&ca.tag===0&&!(gr&6)&&Hc();var o=gr;gr|=1;var d=ds.transition,_=Mr;try{if(ds.transition=null,Mr=1,r)return r()}finally{Mr=_,ds.transition=d,gr=o,!(gr&6)&&wa()}}function fy(){qi=Vc.current,Zr(Vc)}function gl(r,o){r.finishedWork=null,r.finishedLanes=0;var d=r.timeoutHandle;if(d!==-1&&(r.timeoutHandle=-1,QS(d)),Mn!==null)for(d=Mn.return;d!==null;){var _=d;switch(W_(_),_.tag){case 1:_=_.type.childContextTypes,_!=null&&tf();break;case 3:Qc(),Zr(Ei),Zr(li),ny();break;case 5:ry(_);break;case 4:Qc();break;case 13:Zr(Qr);break;case 19:Zr(Qr);break;case 10:Q_(_.type._context);break;case 22:case 23:fy()}d=d.return}if(Zn=r,Mn=r=_a(r.current,null),Jn=qi=o,Fn=0,Yh=null,hy=kf=wl=0,Mi=Rh=null,pl!==null){for(o=0;o<pl.length;o++)if(d=pl[o],_=d.interleaved,_!==null){d.interleaved=null;var x=_.next,P=d.pending;if(P!==null){var b=P.next;P.next=x,_.next=b}d.pending=_}pl=null}return r}function Vb(r,o){do{var d=Mn;try{if(Y_(),Fp.current=hf,uf){for(var _=Jr.memoizedState;_!==null;){var x=_.queue;x!==null&&(x.pending=null),_=_.next}uf=!1}if(bl=0,Un=jn=Jr=null,Ah=!1,Wh=0,uy.current=null,d===null||d.return===null){Fn=1,Yh=o,Mn=null;break}e:{var P=r,b=d.return,c=d,U=o;if(o=Jn,c.flags|=32768,U!==null&&typeof U=="object"&&typeof U.then=="function"){var Q=U,ne=c,ye=ne.tag;if(!(ne.mode&1)&&(ye===0||ye===11||ye===15)){var me=ne.alternate;me?(ne.updateQueue=me.updateQueue,ne.memoizedState=me.memoizedState,ne.lanes=me.lanes):(ne.updateQueue=null,ne.memoizedState=null)}var re=r0(b);if(re!==null){re.flags&=-257,n0(re,b,c,P,o),re.mode&1&&t0(P,Q,o),o=re,U=Q;var ce=o.updateQueue;if(ce===null){var Le=new Set;Le.add(U),o.updateQueue=Le}else ce.add(U);break e}else{if(!(o&1)){t0(P,Q,o),my();break e}U=Error(it(426))}}else if(Wr&&c.mode&1){var Qe=r0(b);if(Qe!==null){!(Qe.flags&65536)&&(Qe.flags|=256),n0(Qe,b,c,P,o),X_(Jc(U,c));break e}}P=U=Jc(U,c),Fn!==4&&(Fn=2),Rh===null?Rh=[P]:Rh.push(P),P=b;do{switch(P.tag){case 3:P.flags|=65536,o&=-o,P.lanes|=o;var pe=Sb(P,U,o);Xx(P,pe);break e;case 1:c=U;var le=P.type,ve=P.stateNode;if(!(P.flags&128)&&(typeof le.getDerivedStateFromError=="function"||ve!==null&&typeof ve.componentDidCatch=="function"&&(ma===null||!ma.has(ve)))){P.flags|=65536,o&=-o,P.lanes|=o;var Be=Pb(P,c,o);Xx(P,Be);break e}}P=P.return}while(P!==null)}Zb(d)}catch(We){o=We,Mn===d&&d!==null&&(Mn=d=d.return);continue}break}while(!0)}function $b(){var r=df.current;return df.current=hf,r===null?hf:r}function my(){(Fn===0||Fn===3||Fn===2)&&(Fn=4),Zn===null||!(wl&268435455)&&!(kf&268435455)||aa(Zn,Jn)}function mf(r,o){var d=gr;gr|=2;var _=$b();(Zn!==r||Jn!==o)&&(wo=null,gl(r,o));do try{TP();break}catch(x){Vb(r,x)}while(!0);if(Y_(),gr=d,df.current=_,Mn!==null)throw Error(it(261));return Zn=null,Jn=0,Fn}function TP(){for(;Mn!==null;)Ub(Mn)}function SP(){for(;Mn!==null&&!XT();)Ub(Mn)}function Ub(r){var o=qb(r.alternate,r,qi);r.memoizedProps=r.pendingProps,o===null?Zb(r):Mn=o,uy.current=null}function Zb(r){var o=r;do{var d=o.alternate;if(r=o.return,o.flags&32768){if(d=_P(d,o),d!==null){d.flags&=32767,Mn=d;return}if(r!==null)r.flags|=32768,r.subtreeFlags=0,r.deletions=null;else{Fn=6,Mn=null;return}}else if(d=gP(d,o,qi),d!==null){Mn=d;return}if(o=o.sibling,o!==null){Mn=o;return}Mn=o=r}while(o!==null);Fn===0&&(Fn=5)}function hl(r,o,d){var _=Mr,x=ds.transition;try{ds.transition=null,Mr=1,PP(r,o,d,_)}finally{ds.transition=x,Mr=_}return null}function PP(r,o,d,_){do Hc();while(ca!==null);if(gr&6)throw Error(it(327));d=r.finishedWork;var x=r.finishedLanes;if(d===null)return null;if(r.finishedWork=null,r.finishedLanes=0,d===r.current)throw Error(it(177));r.callbackNode=null,r.callbackPriority=0;var P=d.lanes|d.childLanes;if(sS(r,P),r===Zn&&(Mn=Zn=null,Jn=0),!(d.subtreeFlags&2064)&&!(d.flags&2064)||kp||(kp=!0,Hb(Xp,function(){return Hc(),null})),P=(d.flags&15990)!==0,d.subtreeFlags&15990||P){P=ds.transition,ds.transition=null;var b=Mr;Mr=1;var c=gr;gr|=4,uy.current=null,vP(r,d),Bb(d,r),GS(Qg),Yp=!!Yg,Qg=Yg=null,r.current=d,xP(d),KT(),gr=c,Mr=b,ds.transition=P}else r.current=d;if(kp&&(kp=!1,ca=r,ff=x),P=r.pendingLanes,P===0&&(ma=null),JT(d.stateNode),Ai(r,_n()),o!==null)for(_=r.onRecoverableError,d=0;d<o.length;d++)x=o[d],_(x.value,{componentStack:x.stack,digest:x.digest});if(pf)throw pf=!1,r=y_,y_=null,r;return ff&1&&r.tag!==0&&Hc(),P=r.pendingLanes,P&1?r===v_?Dh++:(Dh=0,v_=r):Dh=0,wa(),null}function Hc(){if(ca!==null){var r=S1(ff),o=ds.transition,d=Mr;try{if(ds.transition=null,Mr=16>r?16:r,ca===null)var _=!1;else{if(r=ca,ca=null,ff=0,gr&6)throw Error(it(331));var x=gr;for(gr|=4,vt=r.current;vt!==null;){var P=vt,b=P.child;if(vt.flags&16){var c=P.deletions;if(c!==null){for(var U=0;U<c.length;U++){var Q=c[U];for(vt=Q;vt!==null;){var ne=vt;switch(ne.tag){case 0:case 11:case 15:zh(8,ne,P)}var ye=ne.child;if(ye!==null)ye.return=ne,vt=ye;else for(;vt!==null;){ne=vt;var me=ne.sibling,re=ne.return;if(Lb(ne),ne===Q){vt=null;break}if(me!==null){me.return=re,vt=me;break}vt=re}}}var ce=P.alternate;if(ce!==null){var Le=ce.child;if(Le!==null){ce.child=null;do{var Qe=Le.sibling;Le.sibling=null,Le=Qe}while(Le!==null)}}vt=P}}if(P.subtreeFlags&2064&&b!==null)b.return=P,vt=b;else e:for(;vt!==null;){if(P=vt,P.flags&2048)switch(P.tag){case 0:case 11:case 15:zh(9,P,P.return)}var pe=P.sibling;if(pe!==null){pe.return=P.return,vt=pe;break e}vt=P.return}}var le=r.current;for(vt=le;vt!==null;){b=vt;var ve=b.child;if(b.subtreeFlags&2064&&ve!==null)ve.return=b,vt=ve;else e:for(b=le;vt!==null;){if(c=vt,c.flags&2048)try{switch(c.tag){case 0:case 11:case 15:Mf(9,c)}}catch(We){ln(c,c.return,We)}if(c===b){vt=null;break e}var Be=c.sibling;if(Be!==null){Be.return=c.return,vt=Be;break e}vt=c.return}}if(gr=x,wa(),eo&&typeof eo.onPostCommitFiberRoot=="function")try{eo.onPostCommitFiberRoot(vf,r)}catch{}_=!0}return _}finally{Mr=d,ds.transition=o}}return!1}function g0(r,o,d){o=Jc(d,o),o=Sb(r,o,1),r=fa(r,o,1),o=_i(),r!==null&&(Jh(r,1,o),Ai(r,o))}function ln(r,o,d){if(r.tag===3)g0(r,r,d);else for(;o!==null;){if(o.tag===3){g0(o,r,d);break}else if(o.tag===1){var _=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof _.componentDidCatch=="function"&&(ma===null||!ma.has(_))){r=Jc(d,r),r=Pb(o,r,1),o=fa(o,r,1),r=_i(),o!==null&&(Jh(o,1,r),Ai(o,r));break}}o=o.return}}function CP(r,o,d){var _=r.pingCache;_!==null&&_.delete(o),o=_i(),r.pingedLanes|=r.suspendedLanes&d,Zn===r&&(Jn&d)===d&&(Fn===4||Fn===3&&(Jn&130023424)===Jn&&500>_n()-dy?gl(r,0):hy|=d),Ai(r,o)}function Gb(r,o){o===0&&(r.mode&1?(o=yp,yp<<=1,!(yp&130023424)&&(yp=4194304)):o=1);var d=_i();r=Eo(r,o),r!==null&&(Jh(r,o,d),Ai(r,d))}function MP(r){var o=r.memoizedState,d=0;o!==null&&(d=o.retryLane),Gb(r,d)}function kP(r,o){var d=0;switch(r.tag){case 13:var _=r.stateNode,x=r.memoizedState;x!==null&&(d=x.retryLane);break;case 19:_=r.stateNode;break;default:throw Error(it(314))}_!==null&&_.delete(o),Gb(r,d)}var qb;qb=function(r,o,d){if(r!==null)if(r.memoizedProps!==o.pendingProps||Ei.current)ki=!0;else{if(!(r.lanes&d)&&!(o.flags&128))return ki=!1,mP(r,o,d);ki=!!(r.flags&131072)}else ki=!1,Wr&&o.flags&1048576&&K1(o,sf,o.index);switch(o.lanes=0,o.tag){case 2:var _=o.type;Op(r,o),r=o.pendingProps;var x=Xc(o,li.current);qc(o,d),x=sy(null,o,_,r,x,d);var P=oy();return o.flags|=1,typeof x=="object"&&x!==null&&typeof x.render=="function"&&x.$$typeof===void 0?(o.tag=1,o.memoizedState=null,o.updateQueue=null,Ii(_)?(P=!0,rf(o)):P=!1,o.memoizedState=x.state!==null&&x.state!==void 0?x.state:null,ey(o),x.updater=Cf,o.stateNode=x,x._reactInternals=o,a_(o,_,r,d),o=u_(null,o,_,!0,P,d)):(o.tag=0,Wr&&P&&H_(o),gi(null,o,x,d),o=o.child),o;case 16:_=o.elementType;e:{switch(Op(r,o),r=o.pendingProps,x=_._init,_=x(_._payload),o.type=_,x=o.tag=IP(_),r=Es(_,r),x){case 0:o=c_(null,o,_,r,d);break e;case 1:o=o0(null,o,_,r,d);break e;case 11:o=i0(null,o,_,r,d);break e;case 14:o=s0(null,o,_,Es(_.type,r),d);break e}throw Error(it(306,_,""))}return o;case 0:return _=o.type,x=o.pendingProps,x=o.elementType===_?x:Es(_,x),c_(r,o,_,x,d);case 1:return _=o.type,x=o.pendingProps,x=o.elementType===_?x:Es(_,x),o0(r,o,_,x,d);case 3:e:{if(Eb(o),r===null)throw Error(it(387));_=o.pendingProps,P=o.memoizedState,x=P.element,rb(r,o),lf(o,_,null,d);var b=o.memoizedState;if(_=b.element,P.isDehydrated)if(P={element:_,isDehydrated:!1,cache:b.cache,pendingSuspenseBoundaries:b.pendingSuspenseBoundaries,transitions:b.transitions},o.updateQueue.baseState=P,o.memoizedState=P,o.flags&256){x=Jc(Error(it(423)),o),o=a0(r,o,_,d,x);break e}else if(_!==x){x=Jc(Error(it(424)),o),o=a0(r,o,_,d,x);break e}else for(Hi=pa(o.stateNode.containerInfo.firstChild),Wi=o,Wr=!0,As=null,d=eb(o,null,_,d),o.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling;else{if(Kc(),_===x){o=Io(r,o,d);break e}gi(r,o,_,d)}o=o.child}return o;case 5:return nb(o),r===null&&i_(o),_=o.type,x=o.pendingProps,P=r!==null?r.memoizedProps:null,b=x.children,Jg(_,x)?b=null:P!==null&&Jg(_,P)&&(o.flags|=32),kb(r,o),gi(r,o,b,d),o.child;case 6:return r===null&&i_(o),null;case 13:return Ib(r,o,d);case 4:return ty(o,o.stateNode.containerInfo),_=o.pendingProps,r===null?o.child=Yc(o,null,_,d):gi(r,o,_,d),o.child;case 11:return _=o.type,x=o.pendingProps,x=o.elementType===_?x:Es(_,x),i0(r,o,_,x,d);case 7:return gi(r,o,o.pendingProps,d),o.child;case 8:return gi(r,o,o.pendingProps.children,d),o.child;case 12:return gi(r,o,o.pendingProps.children,d),o.child;case 10:e:{if(_=o.type._context,x=o.pendingProps,P=o.memoizedProps,b=x.value,Br(of,_._currentValue),_._currentValue=b,P!==null)if(Ds(P.value,b)){if(P.children===x.children&&!Ei.current){o=Io(r,o,d);break e}}else for(P=o.child,P!==null&&(P.return=o);P!==null;){var c=P.dependencies;if(c!==null){b=P.child;for(var U=c.firstContext;U!==null;){if(U.context===_){if(P.tag===1){U=Co(-1,d&-d),U.tag=2;var Q=P.updateQueue;if(Q!==null){Q=Q.shared;var ne=Q.pending;ne===null?U.next=U:(U.next=ne.next,ne.next=U),Q.pending=U}}P.lanes|=d,U=P.alternate,U!==null&&(U.lanes|=d),s_(P.return,d,o),c.lanes|=d;break}U=U.next}}else if(P.tag===10)b=P.type===o.type?null:P.child;else if(P.tag===18){if(b=P.return,b===null)throw Error(it(341));b.lanes|=d,c=b.alternate,c!==null&&(c.lanes|=d),s_(b,d,o),b=P.sibling}else b=P.child;if(b!==null)b.return=P;else for(b=P;b!==null;){if(b===o){b=null;break}if(P=b.sibling,P!==null){P.return=b.return,b=P;break}b=b.return}P=b}gi(r,o,x.children,d),o=o.child}return o;case 9:return x=o.type,_=o.pendingProps.children,qc(o,d),x=ps(x),_=_(x),o.flags|=1,gi(r,o,_,d),o.child;case 14:return _=o.type,x=Es(_,o.pendingProps),x=Es(_.type,x),s0(r,o,_,x,d);case 15:return Cb(r,o,o.type,o.pendingProps,d);case 17:return _=o.type,x=o.pendingProps,x=o.elementType===_?x:Es(_,x),Op(r,o),o.tag=1,Ii(_)?(r=!0,rf(o)):r=!1,qc(o,d),Tb(o,_,x),a_(o,_,x,d),u_(null,o,_,!0,r,d);case 19:return Ab(r,o,d);case 22:return Mb(r,o,d)}throw Error(it(156,o.tag))};function Hb(r,o){return x1(r,o)}function EP(r,o,d,_){this.tag=r,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=_,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function hs(r,o,d,_){return new EP(r,o,d,_)}function gy(r){return r=r.prototype,!(!r||!r.isReactComponent)}function IP(r){if(typeof r=="function")return gy(r)?1:0;if(r!=null){if(r=r.$$typeof,r===L_)return 11;if(r===j_)return 14}return 2}function _a(r,o){var d=r.alternate;return d===null?(d=hs(r.tag,o,r.key,r.mode),d.elementType=r.elementType,d.type=r.type,d.stateNode=r.stateNode,d.alternate=r,r.alternate=d):(d.pendingProps=o,d.type=r.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=r.flags&14680064,d.childLanes=r.childLanes,d.lanes=r.lanes,d.child=r.child,d.memoizedProps=r.memoizedProps,d.memoizedState=r.memoizedState,d.updateQueue=r.updateQueue,o=r.dependencies,d.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},d.sibling=r.sibling,d.index=r.index,d.ref=r.ref,d}function $p(r,o,d,_,x,P){var b=2;if(_=r,typeof r=="function")gy(r)&&(b=1);else if(typeof r=="string")b=5;else e:switch(r){case Ac:return _l(d.children,x,P,o);case D_:b=8,x|=8;break;case Ag:return r=hs(12,d,o,x|2),r.elementType=Ag,r.lanes=P,r;case zg:return r=hs(13,d,o,x),r.elementType=zg,r.lanes=P,r;case Rg:return r=hs(19,d,o,x),r.elementType=Rg,r.lanes=P,r;case n1:return Ef(d,x,P,o);default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case t1:b=10;break e;case r1:b=9;break e;case L_:b=11;break e;case j_:b=14;break e;case ia:b=16,_=null;break e}throw Error(it(130,r==null?r:typeof r,""))}return o=hs(b,d,o,x),o.elementType=r,o.type=_,o.lanes=P,o}function _l(r,o,d,_){return r=hs(7,r,_,o),r.lanes=d,r}function Ef(r,o,d,_){return r=hs(22,r,_,o),r.elementType=n1,r.lanes=d,r.stateNode={isHidden:!1},r}function Tg(r,o,d){return r=hs(6,r,null,o),r.lanes=d,r}function Sg(r,o,d){return o=hs(4,r.children!==null?r.children:[],r.key,o),o.lanes=d,o.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},o}function AP(r,o,d,_,x){this.tag=o,this.containerInfo=r,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ig(0),this.expirationTimes=ig(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ig(0),this.identifierPrefix=_,this.onRecoverableError=x,this.mutableSourceEagerHydrationData=null}function _y(r,o,d,_,x,P,b,c,U){return r=new AP(r,o,d,c,U),o===1?(o=1,P===!0&&(o|=8)):o=0,P=hs(3,null,null,o),r.current=P,P.stateNode=r,P.memoizedState={element:_,isDehydrated:d,cache:null,transitions:null,pendingSuspenseBoundaries:null},ey(P),r}function zP(r,o,d){var _=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ic,key:_==null?null:""+_,children:r,containerInfo:o,implementation:d}}function Wb(r){if(!r)return va;r=r._reactInternals;e:{if(Cl(r)!==r||r.tag!==1)throw Error(it(170));var o=r;do{switch(o.tag){case 3:o=o.stateNode.context;break e;case 1:if(Ii(o.type)){o=o.stateNode.__reactInternalMemoizedMergedChildContext;break e}}o=o.return}while(o!==null);throw Error(it(171))}if(r.tag===1){var d=r.type;if(Ii(d))return W1(r,d,o)}return o}function Xb(r,o,d,_,x,P,b,c,U){return r=_y(d,_,!0,r,x,P,b,c,U),r.context=Wb(null),d=r.current,_=_i(),x=ga(d),P=Co(_,x),P.callback=o??null,fa(d,P,x),r.current.lanes=x,Jh(r,x,_),Ai(r,_),r}function If(r,o,d,_){var x=o.current,P=_i(),b=ga(x);return d=Wb(d),o.context===null?o.context=d:o.pendingContext=d,o=Co(P,b),o.payload={element:r},_=_===void 0?null:_,_!==null&&(o.callback=_),r=fa(x,o,b),r!==null&&(Rs(r,x,b,P),jp(r,x,b)),b}function gf(r){if(r=r.current,!r.child)return null;switch(r.child.tag){case 5:return r.child.stateNode;default:return r.child.stateNode}}function _0(r,o){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var d=r.retryLane;r.retryLane=d!==0&&d<o?d:o}}function yy(r,o){_0(r,o),(r=r.alternate)&&_0(r,o)}function RP(){return null}var Kb=typeof reportError=="function"?reportError:function(r){console.error(r)};function vy(r){this._internalRoot=r}Af.prototype.render=vy.prototype.render=function(r){var o=this._internalRoot;if(o===null)throw Error(it(409));If(r,o,null,null)};Af.prototype.unmount=vy.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var o=r.containerInfo;Tl(function(){If(null,r,null,null)}),o[ko]=null}};function Af(r){this._internalRoot=r}Af.prototype.unstable_scheduleHydration=function(r){if(r){var o=M1();r={blockedOn:null,target:r,priority:o};for(var d=0;d<oa.length&&o!==0&&o<oa[d].priority;d++);oa.splice(d,0,r),d===0&&E1(r)}};function xy(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function zf(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11&&(r.nodeType!==8||r.nodeValue!==" react-mount-point-unstable "))}function y0(){}function DP(r,o,d,_,x){if(x){if(typeof _=="function"){var P=_;_=function(){var Q=gf(b);P.call(Q)}}var b=Xb(o,_,r,0,null,!1,!1,"",y0);return r._reactRootContainer=b,r[ko]=b.current,Uh(r.nodeType===8?r.parentNode:r),Tl(),b}for(;x=r.lastChild;)r.removeChild(x);if(typeof _=="function"){var c=_;_=function(){var Q=gf(U);c.call(Q)}}var U=_y(r,0,!1,null,null,!1,!1,"",y0);return r._reactRootContainer=U,r[ko]=U.current,Uh(r.nodeType===8?r.parentNode:r),Tl(function(){If(o,U,d,_)}),U}function Rf(r,o,d,_,x){var P=d._reactRootContainer;if(P){var b=P;if(typeof x=="function"){var c=x;x=function(){var U=gf(b);c.call(U)}}If(o,b,r,x)}else b=DP(d,o,r,x,_);return gf(b)}P1=function(r){switch(r.tag){case 3:var o=r.stateNode;if(o.current.memoizedState.isDehydrated){var d=Th(o.pendingLanes);d!==0&&(O_(o,d|1),Ai(o,_n()),!(gr&6)&&(eu=_n()+500,wa()))}break;case 13:Tl(function(){var _=Eo(r,1);if(_!==null){var x=_i();Rs(_,r,1,x)}}),yy(r,1)}};N_=function(r){if(r.tag===13){var o=Eo(r,134217728);if(o!==null){var d=_i();Rs(o,r,134217728,d)}yy(r,134217728)}};C1=function(r){if(r.tag===13){var o=ga(r),d=Eo(r,o);if(d!==null){var _=_i();Rs(d,r,o,_)}yy(r,o)}};M1=function(){return Mr};k1=function(r,o){var d=Mr;try{return Mr=r,o()}finally{Mr=d}};Ug=function(r,o,d){switch(o){case"input":if(jg(r,d),o=d.name,d.type==="radio"&&o!=null){for(d=r;d.parentNode;)d=d.parentNode;for(d=d.querySelectorAll("input[name="+JSON.stringify(""+o)+'][type="radio"]'),o=0;o<d.length;o++){var _=d[o];if(_!==r&&_.form===r.form){var x=Tf(_);if(!x)throw Error(it(90));s1(_),jg(_,x)}}}break;case"textarea":a1(r,d);break;case"select":o=d.value,o!=null&&$c(r,!!d.multiple,o,!1)}};f1=py;m1=Tl;var LP={usingClientEntryPoint:!1,Events:[td,Lc,Tf,d1,p1,py]},yh={findFiberByHostInstance:dl,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},jP={bundleType:yh.bundleType,version:yh.version,rendererPackageName:yh.rendererPackageName,rendererConfig:yh.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ao.ReactCurrentDispatcher,findHostInstanceByFiber:function(r){return r=y1(r),r===null?null:r.stateNode},findFiberByHostInstance:yh.findFiberByHostInstance||RP,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ep=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ep.isDisabled&&Ep.supportsFiber)try{vf=Ep.inject(jP),eo=Ep}catch{}}Ki.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=LP;Ki.createPortal=function(r,o){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!xy(o))throw Error(it(200));return zP(r,o,null,d)};Ki.createRoot=function(r,o){if(!xy(r))throw Error(it(299));var d=!1,_="",x=Kb;return o!=null&&(o.unstable_strictMode===!0&&(d=!0),o.identifierPrefix!==void 0&&(_=o.identifierPrefix),o.onRecoverableError!==void 0&&(x=o.onRecoverableError)),o=_y(r,1,!1,null,null,d,!1,_,x),r[ko]=o.current,Uh(r.nodeType===8?r.parentNode:r),new vy(o)};Ki.findDOMNode=function(r){if(r==null)return null;if(r.nodeType===1)return r;var o=r._reactInternals;if(o===void 0)throw typeof r.render=="function"?Error(it(188)):(r=Object.keys(r).join(","),Error(it(268,r)));return r=y1(o),r=r===null?null:r.stateNode,r};Ki.flushSync=function(r){return Tl(r)};Ki.hydrate=function(r,o,d){if(!zf(o))throw Error(it(200));return Rf(null,r,o,!0,d)};Ki.hydrateRoot=function(r,o,d){if(!xy(r))throw Error(it(405));var _=d!=null&&d.hydratedSources||null,x=!1,P="",b=Kb;if(d!=null&&(d.unstable_strictMode===!0&&(x=!0),d.identifierPrefix!==void 0&&(P=d.identifierPrefix),d.onRecoverableError!==void 0&&(b=d.onRecoverableError)),o=Xb(o,null,r,1,d??null,x,!1,P,b),r[ko]=o.current,Uh(r),_)for(r=0;r<_.length;r++)d=_[r],x=d._getVersion,x=x(d._source),o.mutableSourceEagerHydrationData==null?o.mutableSourceEagerHydrationData=[d,x]:o.mutableSourceEagerHydrationData.push(d,x);return new Af(o)};Ki.render=function(r,o,d){if(!zf(o))throw Error(it(200));return Rf(null,r,o,!1,d)};Ki.unmountComponentAtNode=function(r){if(!zf(r))throw Error(it(40));return r._reactRootContainer?(Tl(function(){Rf(null,null,r,!1,function(){r._reactRootContainer=null,r[ko]=null})}),!0):!1};Ki.unstable_batchedUpdates=py;Ki.unstable_renderSubtreeIntoContainer=function(r,o,d,_){if(!zf(d))throw Error(it(200));if(r==null||r._reactInternals===void 0)throw Error(it(38));return Rf(r,o,d,!1,_)};Ki.version="18.3.1-next-f1338f8080-20240426";function Yb(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Yb)}catch(r){console.error(r)}}Yb(),Y0.exports=Ki;var FP=Y0.exports,Qb,v0=FP;Qb=v0.createRoot,v0.hydrateRoot;function Jb(r,o){return function(){return r.apply(o,arguments)}}const{toString:BP}=Object.prototype,{getPrototypeOf:by}=Object,{iterator:Df,toStringTag:ew}=Symbol,Lf=(r=>o=>{const d=BP.call(o);return r[d]||(r[d]=d.slice(8,-1).toLowerCase())})(Object.create(null)),Ls=r=>(r=r.toLowerCase(),o=>Lf(o)===r),jf=r=>o=>typeof o===r,{isArray:su}=Array,tu=jf("undefined");function nd(r){return r!==null&&!tu(r)&&r.constructor!==null&&!tu(r.constructor)&&zi(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}const tw=Ls("ArrayBuffer");function OP(r){let o;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?o=ArrayBuffer.isView(r):o=r&&r.buffer&&tw(r.buffer),o}const NP=jf("string"),zi=jf("function"),rw=jf("number"),id=r=>r!==null&&typeof r=="object",VP=r=>r===!0||r===!1,Up=r=>{if(Lf(r)!=="object")return!1;const o=by(r);return(o===null||o===Object.prototype||Object.getPrototypeOf(o)===null)&&!(ew in r)&&!(Df in r)},$P=r=>{if(!id(r)||nd(r))return!1;try{return Object.keys(r).length===0&&Object.getPrototypeOf(r)===Object.prototype}catch{return!1}},UP=Ls("Date"),ZP=Ls("File"),GP=Ls("Blob"),qP=Ls("FileList"),HP=r=>id(r)&&zi(r.pipe),WP=r=>{let o;return r&&(typeof FormData=="function"&&r instanceof FormData||zi(r.append)&&((o=Lf(r))==="formdata"||o==="object"&&zi(r.toString)&&r.toString()==="[object FormData]"))},XP=Ls("URLSearchParams"),[KP,YP,QP,JP]=["ReadableStream","Request","Response","Headers"].map(Ls),eC=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function sd(r,o,{allOwnKeys:d=!1}={}){if(r===null||typeof r>"u")return;let _,x;if(typeof r!="object"&&(r=[r]),su(r))for(_=0,x=r.length;_<x;_++)o.call(null,r[_],_,r);else{if(nd(r))return;const P=d?Object.getOwnPropertyNames(r):Object.keys(r),b=P.length;let c;for(_=0;_<b;_++)c=P[_],o.call(null,r[c],c,r)}}function nw(r,o){if(nd(r))return null;o=o.toLowerCase();const d=Object.keys(r);let _=d.length,x;for(;_-- >0;)if(x=d[_],o===x.toLowerCase())return x;return null}const ml=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,iw=r=>!tu(r)&&r!==ml;function w_(){const{caseless:r,skipUndefined:o}=iw(this)&&this||{},d={},_=(x,P)=>{const b=r&&nw(d,P)||P;Up(d[b])&&Up(x)?d[b]=w_(d[b],x):Up(x)?d[b]=w_({},x):su(x)?d[b]=x.slice():(!o||!tu(x))&&(d[b]=x)};for(let x=0,P=arguments.length;x<P;x++)arguments[x]&&sd(arguments[x],_);return d}const tC=(r,o,d,{allOwnKeys:_}={})=>(sd(o,(x,P)=>{d&&zi(x)?r[P]=Jb(x,d):r[P]=x},{allOwnKeys:_}),r),rC=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),nC=(r,o,d,_)=>{r.prototype=Object.create(o.prototype,_),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:o.prototype}),d&&Object.assign(r.prototype,d)},iC=(r,o,d,_)=>{let x,P,b;const c={};if(o=o||{},r==null)return o;do{for(x=Object.getOwnPropertyNames(r),P=x.length;P-- >0;)b=x[P],(!_||_(b,r,o))&&!c[b]&&(o[b]=r[b],c[b]=!0);r=d!==!1&&by(r)}while(r&&(!d||d(r,o))&&r!==Object.prototype);return o},sC=(r,o,d)=>{r=String(r),(d===void 0||d>r.length)&&(d=r.length),d-=o.length;const _=r.indexOf(o,d);return _!==-1&&_===d},oC=r=>{if(!r)return null;if(su(r))return r;let o=r.length;if(!rw(o))return null;const d=new Array(o);for(;o-- >0;)d[o]=r[o];return d},aC=(r=>o=>r&&o instanceof r)(typeof Uint8Array<"u"&&by(Uint8Array)),lC=(r,o)=>{const _=(r&&r[Df]).call(r);let x;for(;(x=_.next())&&!x.done;){const P=x.value;o.call(r,P[0],P[1])}},cC=(r,o)=>{let d;const _=[];for(;(d=r.exec(o))!==null;)_.push(d);return _},uC=Ls("HTMLFormElement"),hC=r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(d,_,x){return _.toUpperCase()+x}),x0=(({hasOwnProperty:r})=>(o,d)=>r.call(o,d))(Object.prototype),dC=Ls("RegExp"),sw=(r,o)=>{const d=Object.getOwnPropertyDescriptors(r),_={};sd(d,(x,P)=>{let b;(b=o(x,P,r))!==!1&&(_[P]=b||x)}),Object.defineProperties(r,_)},pC=r=>{sw(r,(o,d)=>{if(zi(r)&&["arguments","caller","callee"].indexOf(d)!==-1)return!1;const _=r[d];if(zi(_)){if(o.enumerable=!1,"writable"in o){o.writable=!1;return}o.set||(o.set=()=>{throw Error("Can not rewrite read-only method '"+d+"'")})}})},fC=(r,o)=>{const d={},_=x=>{x.forEach(P=>{d[P]=!0})};return su(r)?_(r):_(String(r).split(o)),d},mC=()=>{},gC=(r,o)=>r!=null&&Number.isFinite(r=+r)?r:o;function _C(r){return!!(r&&zi(r.append)&&r[ew]==="FormData"&&r[Df])}const yC=r=>{const o=new Array(10),d=(_,x)=>{if(id(_)){if(o.indexOf(_)>=0)return;if(nd(_))return _;if(!("toJSON"in _)){o[x]=_;const P=su(_)?[]:{};return sd(_,(b,c)=>{const U=d(b,x+1);!tu(U)&&(P[c]=U)}),o[x]=void 0,P}}return _};return d(r,0)},vC=Ls("AsyncFunction"),xC=r=>r&&(id(r)||zi(r))&&zi(r.then)&&zi(r.catch),ow=((r,o)=>r?setImmediate:o?((d,_)=>(ml.addEventListener("message",({source:x,data:P})=>{x===ml&&P===d&&_.length&&_.shift()()},!1),x=>{_.push(x),ml.postMessage(d,"*")}))(`axios@${Math.random()}`,[]):d=>setTimeout(d))(typeof setImmediate=="function",zi(ml.postMessage)),bC=typeof queueMicrotask<"u"?queueMicrotask.bind(ml):typeof process<"u"&&process.nextTick||ow,wC=r=>r!=null&&zi(r[Df]),je={isArray:su,isArrayBuffer:tw,isBuffer:nd,isFormData:WP,isArrayBufferView:OP,isString:NP,isNumber:rw,isBoolean:VP,isObject:id,isPlainObject:Up,isEmptyObject:$P,isReadableStream:KP,isRequest:YP,isResponse:QP,isHeaders:JP,isUndefined:tu,isDate:UP,isFile:ZP,isBlob:GP,isRegExp:dC,isFunction:zi,isStream:HP,isURLSearchParams:XP,isTypedArray:aC,isFileList:qP,forEach:sd,merge:w_,extend:tC,trim:eC,stripBOM:rC,inherits:nC,toFlatObject:iC,kindOf:Lf,kindOfTest:Ls,endsWith:sC,toArray:oC,forEachEntry:lC,matchAll:cC,isHTMLForm:uC,hasOwnProperty:x0,hasOwnProp:x0,reduceDescriptors:sw,freezeMethods:pC,toObjectSet:fC,toCamelCase:hC,noop:mC,toFiniteNumber:gC,findKey:nw,global:ml,isContextDefined:iw,isSpecCompliantForm:_C,toJSONObject:yC,isAsyncFn:vC,isThenable:xC,setImmediate:ow,asap:bC,isIterable:wC};function er(r,o,d,_,x){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",o&&(this.code=o),d&&(this.config=d),_&&(this.request=_),x&&(this.response=x,this.status=x.status?x.status:null)}je.inherits(er,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:je.toJSONObject(this.config),code:this.code,status:this.status}}});const aw=er.prototype,lw={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{lw[r]={value:r}});Object.defineProperties(er,lw);Object.defineProperty(aw,"isAxiosError",{value:!0});er.from=(r,o,d,_,x,P)=>{const b=Object.create(aw);je.toFlatObject(r,b,function(ne){return ne!==Error.prototype},Q=>Q!=="isAxiosError");const c=r&&r.message?r.message:"Error",U=o==null&&r?r.code:o;return er.call(b,c,U,d,_,x),r&&b.cause==null&&Object.defineProperty(b,"cause",{value:r,configurable:!0}),b.name=r&&r.name||"Error",P&&Object.assign(b,P),b};const TC=null;function T_(r){return je.isPlainObject(r)||je.isArray(r)}function cw(r){return je.endsWith(r,"[]")?r.slice(0,-2):r}function b0(r,o,d){return r?r.concat(o).map(function(x,P){return x=cw(x),!d&&P?"["+x+"]":x}).join(d?".":""):o}function SC(r){return je.isArray(r)&&!r.some(T_)}const PC=je.toFlatObject(je,{},null,function(o){return/^is[A-Z]/.test(o)});function Ff(r,o,d){if(!je.isObject(r))throw new TypeError("target must be an object");o=o||new FormData,d=je.toFlatObject(d,{metaTokens:!0,dots:!1,indexes:!1},!1,function(Le,Qe){return!je.isUndefined(Qe[Le])});const _=d.metaTokens,x=d.visitor||ne,P=d.dots,b=d.indexes,U=(d.Blob||typeof Blob<"u"&&Blob)&&je.isSpecCompliantForm(o);if(!je.isFunction(x))throw new TypeError("visitor must be a function");function Q(ce){if(ce===null)return"";if(je.isDate(ce))return ce.toISOString();if(je.isBoolean(ce))return ce.toString();if(!U&&je.isBlob(ce))throw new er("Blob is not supported. Use a Buffer instead.");return je.isArrayBuffer(ce)||je.isTypedArray(ce)?U&&typeof Blob=="function"?new Blob([ce]):Buffer.from(ce):ce}function ne(ce,Le,Qe){let pe=ce;if(ce&&!Qe&&typeof ce=="object"){if(je.endsWith(Le,"{}"))Le=_?Le:Le.slice(0,-2),ce=JSON.stringify(ce);else if(je.isArray(ce)&&SC(ce)||(je.isFileList(ce)||je.endsWith(Le,"[]"))&&(pe=je.toArray(ce)))return Le=cw(Le),pe.forEach(function(ve,Be){!(je.isUndefined(ve)||ve===null)&&o.append(b===!0?b0([Le],Be,P):b===null?Le:Le+"[]",Q(ve))}),!1}return T_(ce)?!0:(o.append(b0(Qe,Le,P),Q(ce)),!1)}const ye=[],me=Object.assign(PC,{defaultVisitor:ne,convertValue:Q,isVisitable:T_});function re(ce,Le){if(!je.isUndefined(ce)){if(ye.indexOf(ce)!==-1)throw Error("Circular reference detected in "+Le.join("."));ye.push(ce),je.forEach(ce,function(pe,le){(!(je.isUndefined(pe)||pe===null)&&x.call(o,pe,je.isString(le)?le.trim():le,Le,me))===!0&&re(pe,Le?Le.concat(le):[le])}),ye.pop()}}if(!je.isObject(r))throw new TypeError("data must be an object");return re(r),o}function w0(r){const o={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(_){return o[_]})}function wy(r,o){this._pairs=[],r&&Ff(r,this,o)}const uw=wy.prototype;uw.append=function(o,d){this._pairs.push([o,d])};uw.toString=function(o){const d=o?function(_){return o.call(this,_,w0)}:w0;return this._pairs.map(function(x){return d(x[0])+"="+d(x[1])},"").join("&")};function CC(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function hw(r,o,d){if(!o)return r;const _=d&&d.encode||CC;je.isFunction(d)&&(d={serialize:d});const x=d&&d.serialize;let P;if(x?P=x(o,d):P=je.isURLSearchParams(o)?o.toString():new wy(o,d).toString(_),P){const b=r.indexOf("#");b!==-1&&(r=r.slice(0,b)),r+=(r.indexOf("?")===-1?"?":"&")+P}return r}class T0{constructor(){this.handlers=[]}use(o,d,_){return this.handlers.push({fulfilled:o,rejected:d,synchronous:_?_.synchronous:!1,runWhen:_?_.runWhen:null}),this.handlers.length-1}eject(o){this.handlers[o]&&(this.handlers[o]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(o){je.forEach(this.handlers,function(_){_!==null&&o(_)})}}const dw={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},MC=typeof URLSearchParams<"u"?URLSearchParams:wy,kC=typeof FormData<"u"?FormData:null,EC=typeof Blob<"u"?Blob:null,IC={isBrowser:!0,classes:{URLSearchParams:MC,FormData:kC,Blob:EC},protocols:["http","https","file","blob","url","data"]},Ty=typeof window<"u"&&typeof document<"u",S_=typeof navigator=="object"&&navigator||void 0,AC=Ty&&(!S_||["ReactNative","NativeScript","NS"].indexOf(S_.product)<0),zC=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",RC=Ty&&window.location.href||"http://localhost",DC=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Ty,hasStandardBrowserEnv:AC,hasStandardBrowserWebWorkerEnv:zC,navigator:S_,origin:RC},Symbol.toStringTag,{value:"Module"})),ai={...DC,...IC};function LC(r,o){return Ff(r,new ai.classes.URLSearchParams,{visitor:function(d,_,x,P){return ai.isNode&&je.isBuffer(d)?(this.append(_,d.toString("base64")),!1):P.defaultVisitor.apply(this,arguments)},...o})}function jC(r){return je.matchAll(/\w+|\[(\w*)]/g,r).map(o=>o[0]==="[]"?"":o[1]||o[0])}function FC(r){const o={},d=Object.keys(r);let _;const x=d.length;let P;for(_=0;_<x;_++)P=d[_],o[P]=r[P];return o}function pw(r){function o(d,_,x,P){let b=d[P++];if(b==="__proto__")return!0;const c=Number.isFinite(+b),U=P>=d.length;return b=!b&&je.isArray(x)?x.length:b,U?(je.hasOwnProp(x,b)?x[b]=[x[b],_]:x[b]=_,!c):((!x[b]||!je.isObject(x[b]))&&(x[b]=[]),o(d,_,x[b],P)&&je.isArray(x[b])&&(x[b]=FC(x[b])),!c)}if(je.isFormData(r)&&je.isFunction(r.entries)){const d={};return je.forEachEntry(r,(_,x)=>{o(jC(_),x,d,0)}),d}return null}function BC(r,o,d){if(je.isString(r))try{return(o||JSON.parse)(r),je.trim(r)}catch(_){if(_.name!=="SyntaxError")throw _}return(d||JSON.stringify)(r)}const od={transitional:dw,adapter:["xhr","http","fetch"],transformRequest:[function(o,d){const _=d.getContentType()||"",x=_.indexOf("application/json")>-1,P=je.isObject(o);if(P&&je.isHTMLForm(o)&&(o=new FormData(o)),je.isFormData(o))return x?JSON.stringify(pw(o)):o;if(je.isArrayBuffer(o)||je.isBuffer(o)||je.isStream(o)||je.isFile(o)||je.isBlob(o)||je.isReadableStream(o))return o;if(je.isArrayBufferView(o))return o.buffer;if(je.isURLSearchParams(o))return d.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),o.toString();let c;if(P){if(_.indexOf("application/x-www-form-urlencoded")>-1)return LC(o,this.formSerializer).toString();if((c=je.isFileList(o))||_.indexOf("multipart/form-data")>-1){const U=this.env&&this.env.FormData;return Ff(c?{"files[]":o}:o,U&&new U,this.formSerializer)}}return P||x?(d.setContentType("application/json",!1),BC(o)):o}],transformResponse:[function(o){const d=this.transitional||od.transitional,_=d&&d.forcedJSONParsing,x=this.responseType==="json";if(je.isResponse(o)||je.isReadableStream(o))return o;if(o&&je.isString(o)&&(_&&!this.responseType||x)){const b=!(d&&d.silentJSONParsing)&&x;try{return JSON.parse(o,this.parseReviver)}catch(c){if(b)throw c.name==="SyntaxError"?er.from(c,er.ERR_BAD_RESPONSE,this,null,this.response):c}}return o}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ai.classes.FormData,Blob:ai.classes.Blob},validateStatus:function(o){return o>=200&&o<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};je.forEach(["delete","get","head","post","put","patch"],r=>{od.headers[r]={}});const OC=je.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),NC=r=>{const o={};let d,_,x;return r&&r.split(`
`).forEach(function(b){x=b.indexOf(":"),d=b.substring(0,x).trim().toLowerCase(),_=b.substring(x+1).trim(),!(!d||o[d]&&OC[d])&&(d==="set-cookie"?o[d]?o[d].push(_):o[d]=[_]:o[d]=o[d]?o[d]+", "+_:_)}),o},S0=Symbol("internals");function vh(r){return r&&String(r).trim().toLowerCase()}function Zp(r){return r===!1||r==null?r:je.isArray(r)?r.map(Zp):String(r)}function VC(r){const o=Object.create(null),d=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let _;for(;_=d.exec(r);)o[_[1]]=_[2];return o}const $C=r=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(r.trim());function Pg(r,o,d,_,x){if(je.isFunction(_))return _.call(this,o,d);if(x&&(o=d),!!je.isString(o)){if(je.isString(_))return o.indexOf(_)!==-1;if(je.isRegExp(_))return _.test(o)}}function UC(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(o,d,_)=>d.toUpperCase()+_)}function ZC(r,o){const d=je.toCamelCase(" "+o);["get","set","has"].forEach(_=>{Object.defineProperty(r,_+d,{value:function(x,P,b){return this[_].call(this,o,x,P,b)},configurable:!0})})}let Ri=class{constructor(o){o&&this.set(o)}set(o,d,_){const x=this;function P(c,U,Q){const ne=vh(U);if(!ne)throw new Error("header name must be a non-empty string");const ye=je.findKey(x,ne);(!ye||x[ye]===void 0||Q===!0||Q===void 0&&x[ye]!==!1)&&(x[ye||U]=Zp(c))}const b=(c,U)=>je.forEach(c,(Q,ne)=>P(Q,ne,U));if(je.isPlainObject(o)||o instanceof this.constructor)b(o,d);else if(je.isString(o)&&(o=o.trim())&&!$C(o))b(NC(o),d);else if(je.isObject(o)&&je.isIterable(o)){let c={},U,Q;for(const ne of o){if(!je.isArray(ne))throw TypeError("Object iterator must return a key-value pair");c[Q=ne[0]]=(U=c[Q])?je.isArray(U)?[...U,ne[1]]:[U,ne[1]]:ne[1]}b(c,d)}else o!=null&&P(d,o,_);return this}get(o,d){if(o=vh(o),o){const _=je.findKey(this,o);if(_){const x=this[_];if(!d)return x;if(d===!0)return VC(x);if(je.isFunction(d))return d.call(this,x,_);if(je.isRegExp(d))return d.exec(x);throw new TypeError("parser must be boolean|regexp|function")}}}has(o,d){if(o=vh(o),o){const _=je.findKey(this,o);return!!(_&&this[_]!==void 0&&(!d||Pg(this,this[_],_,d)))}return!1}delete(o,d){const _=this;let x=!1;function P(b){if(b=vh(b),b){const c=je.findKey(_,b);c&&(!d||Pg(_,_[c],c,d))&&(delete _[c],x=!0)}}return je.isArray(o)?o.forEach(P):P(o),x}clear(o){const d=Object.keys(this);let _=d.length,x=!1;for(;_--;){const P=d[_];(!o||Pg(this,this[P],P,o,!0))&&(delete this[P],x=!0)}return x}normalize(o){const d=this,_={};return je.forEach(this,(x,P)=>{const b=je.findKey(_,P);if(b){d[b]=Zp(x),delete d[P];return}const c=o?UC(P):String(P).trim();c!==P&&delete d[P],d[c]=Zp(x),_[c]=!0}),this}concat(...o){return this.constructor.concat(this,...o)}toJSON(o){const d=Object.create(null);return je.forEach(this,(_,x)=>{_!=null&&_!==!1&&(d[x]=o&&je.isArray(_)?_.join(", "):_)}),d}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([o,d])=>o+": "+d).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(o){return o instanceof this?o:new this(o)}static concat(o,...d){const _=new this(o);return d.forEach(x=>_.set(x)),_}static accessor(o){const _=(this[S0]=this[S0]={accessors:{}}).accessors,x=this.prototype;function P(b){const c=vh(b);_[c]||(ZC(x,b),_[c]=!0)}return je.isArray(o)?o.forEach(P):P(o),this}};Ri.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);je.reduceDescriptors(Ri.prototype,({value:r},o)=>{let d=o[0].toUpperCase()+o.slice(1);return{get:()=>r,set(_){this[d]=_}}});je.freezeMethods(Ri);function Cg(r,o){const d=this||od,_=o||d,x=Ri.from(_.headers);let P=_.data;return je.forEach(r,function(c){P=c.call(d,P,x.normalize(),o?o.status:void 0)}),x.normalize(),P}function fw(r){return!!(r&&r.__CANCEL__)}function ou(r,o,d){er.call(this,r??"canceled",er.ERR_CANCELED,o,d),this.name="CanceledError"}je.inherits(ou,er,{__CANCEL__:!0});function mw(r,o,d){const _=d.config.validateStatus;!d.status||!_||_(d.status)?r(d):o(new er("Request failed with status code "+d.status,[er.ERR_BAD_REQUEST,er.ERR_BAD_RESPONSE][Math.floor(d.status/100)-4],d.config,d.request,d))}function GC(r){const o=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return o&&o[1]||""}function qC(r,o){r=r||10;const d=new Array(r),_=new Array(r);let x=0,P=0,b;return o=o!==void 0?o:1e3,function(U){const Q=Date.now(),ne=_[P];b||(b=Q),d[x]=U,_[x]=Q;let ye=P,me=0;for(;ye!==x;)me+=d[ye++],ye=ye%r;if(x=(x+1)%r,x===P&&(P=(P+1)%r),Q-b<o)return;const re=ne&&Q-ne;return re?Math.round(me*1e3/re):void 0}}function HC(r,o){let d=0,_=1e3/o,x,P;const b=(Q,ne=Date.now())=>{d=ne,x=null,P&&(clearTimeout(P),P=null),r(...Q)};return[(...Q)=>{const ne=Date.now(),ye=ne-d;ye>=_?b(Q,ne):(x=Q,P||(P=setTimeout(()=>{P=null,b(x)},_-ye)))},()=>x&&b(x)]}const _f=(r,o,d=3)=>{let _=0;const x=qC(50,250);return HC(P=>{const b=P.loaded,c=P.lengthComputable?P.total:void 0,U=b-_,Q=x(U),ne=b<=c;_=b;const ye={loaded:b,total:c,progress:c?b/c:void 0,bytes:U,rate:Q||void 0,estimated:Q&&c&&ne?(c-b)/Q:void 0,event:P,lengthComputable:c!=null,[o?"download":"upload"]:!0};r(ye)},d)},P0=(r,o)=>{const d=r!=null;return[_=>o[0]({lengthComputable:d,total:r,loaded:_}),o[1]]},C0=r=>(...o)=>je.asap(()=>r(...o)),WC=ai.hasStandardBrowserEnv?((r,o)=>d=>(d=new URL(d,ai.origin),r.protocol===d.protocol&&r.host===d.host&&(o||r.port===d.port)))(new URL(ai.origin),ai.navigator&&/(msie|trident)/i.test(ai.navigator.userAgent)):()=>!0,XC=ai.hasStandardBrowserEnv?{write(r,o,d,_,x,P){const b=[r+"="+encodeURIComponent(o)];je.isNumber(d)&&b.push("expires="+new Date(d).toGMTString()),je.isString(_)&&b.push("path="+_),je.isString(x)&&b.push("domain="+x),P===!0&&b.push("secure"),document.cookie=b.join("; ")},read(r){const o=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return o?decodeURIComponent(o[3]):null},remove(r){this.write(r,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function KC(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function YC(r,o){return o?r.replace(/\/?\/$/,"")+"/"+o.replace(/^\/+/,""):r}function gw(r,o,d){let _=!KC(o);return r&&(_||d==!1)?YC(r,o):o}const M0=r=>r instanceof Ri?{...r}:r;function Sl(r,o){o=o||{};const d={};function _(Q,ne,ye,me){return je.isPlainObject(Q)&&je.isPlainObject(ne)?je.merge.call({caseless:me},Q,ne):je.isPlainObject(ne)?je.merge({},ne):je.isArray(ne)?ne.slice():ne}function x(Q,ne,ye,me){if(je.isUndefined(ne)){if(!je.isUndefined(Q))return _(void 0,Q,ye,me)}else return _(Q,ne,ye,me)}function P(Q,ne){if(!je.isUndefined(ne))return _(void 0,ne)}function b(Q,ne){if(je.isUndefined(ne)){if(!je.isUndefined(Q))return _(void 0,Q)}else return _(void 0,ne)}function c(Q,ne,ye){if(ye in o)return _(Q,ne);if(ye in r)return _(void 0,Q)}const U={url:P,method:P,data:P,baseURL:b,transformRequest:b,transformResponse:b,paramsSerializer:b,timeout:b,timeoutMessage:b,withCredentials:b,withXSRFToken:b,adapter:b,responseType:b,xsrfCookieName:b,xsrfHeaderName:b,onUploadProgress:b,onDownloadProgress:b,decompress:b,maxContentLength:b,maxBodyLength:b,beforeRedirect:b,transport:b,httpAgent:b,httpsAgent:b,cancelToken:b,socketPath:b,responseEncoding:b,validateStatus:c,headers:(Q,ne,ye)=>x(M0(Q),M0(ne),ye,!0)};return je.forEach(Object.keys({...r,...o}),function(ne){const ye=U[ne]||x,me=ye(r[ne],o[ne],ne);je.isUndefined(me)&&ye!==c||(d[ne]=me)}),d}const _w=r=>{const o=Sl({},r);let{data:d,withXSRFToken:_,xsrfHeaderName:x,xsrfCookieName:P,headers:b,auth:c}=o;if(o.headers=b=Ri.from(b),o.url=hw(gw(o.baseURL,o.url,o.allowAbsoluteUrls),r.params,r.paramsSerializer),c&&b.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):""))),je.isFormData(d)){if(ai.hasStandardBrowserEnv||ai.hasStandardBrowserWebWorkerEnv)b.setContentType(void 0);else if(je.isFunction(d.getHeaders)){const U=d.getHeaders(),Q=["content-type","content-length"];Object.entries(U).forEach(([ne,ye])=>{Q.includes(ne.toLowerCase())&&b.set(ne,ye)})}}if(ai.hasStandardBrowserEnv&&(_&&je.isFunction(_)&&(_=_(o)),_||_!==!1&&WC(o.url))){const U=x&&P&&XC.read(P);U&&b.set(x,U)}return o},QC=typeof XMLHttpRequest<"u",JC=QC&&function(r){return new Promise(function(d,_){const x=_w(r);let P=x.data;const b=Ri.from(x.headers).normalize();let{responseType:c,onUploadProgress:U,onDownloadProgress:Q}=x,ne,ye,me,re,ce;function Le(){re&&re(),ce&&ce(),x.cancelToken&&x.cancelToken.unsubscribe(ne),x.signal&&x.signal.removeEventListener("abort",ne)}let Qe=new XMLHttpRequest;Qe.open(x.method.toUpperCase(),x.url,!0),Qe.timeout=x.timeout;function pe(){if(!Qe)return;const ve=Ri.from("getAllResponseHeaders"in Qe&&Qe.getAllResponseHeaders()),We={data:!c||c==="text"||c==="json"?Qe.responseText:Qe.response,status:Qe.status,statusText:Qe.statusText,headers:ve,config:r,request:Qe};mw(function(st){d(st),Le()},function(st){_(st),Le()},We),Qe=null}"onloadend"in Qe?Qe.onloadend=pe:Qe.onreadystatechange=function(){!Qe||Qe.readyState!==4||Qe.status===0&&!(Qe.responseURL&&Qe.responseURL.indexOf("file:")===0)||setTimeout(pe)},Qe.onabort=function(){Qe&&(_(new er("Request aborted",er.ECONNABORTED,r,Qe)),Qe=null)},Qe.onerror=function(Be){const We=Be&&Be.message?Be.message:"Network Error",Je=new er(We,er.ERR_NETWORK,r,Qe);Je.event=Be||null,_(Je),Qe=null},Qe.ontimeout=function(){let Be=x.timeout?"timeout of "+x.timeout+"ms exceeded":"timeout exceeded";const We=x.transitional||dw;x.timeoutErrorMessage&&(Be=x.timeoutErrorMessage),_(new er(Be,We.clarifyTimeoutError?er.ETIMEDOUT:er.ECONNABORTED,r,Qe)),Qe=null},P===void 0&&b.setContentType(null),"setRequestHeader"in Qe&&je.forEach(b.toJSON(),function(Be,We){Qe.setRequestHeader(We,Be)}),je.isUndefined(x.withCredentials)||(Qe.withCredentials=!!x.withCredentials),c&&c!=="json"&&(Qe.responseType=x.responseType),Q&&([me,ce]=_f(Q,!0),Qe.addEventListener("progress",me)),U&&Qe.upload&&([ye,re]=_f(U),Qe.upload.addEventListener("progress",ye),Qe.upload.addEventListener("loadend",re)),(x.cancelToken||x.signal)&&(ne=ve=>{Qe&&(_(!ve||ve.type?new ou(null,r,Qe):ve),Qe.abort(),Qe=null)},x.cancelToken&&x.cancelToken.subscribe(ne),x.signal&&(x.signal.aborted?ne():x.signal.addEventListener("abort",ne)));const le=GC(x.url);if(le&&ai.protocols.indexOf(le)===-1){_(new er("Unsupported protocol "+le+":",er.ERR_BAD_REQUEST,r));return}Qe.send(P||null)})},eM=(r,o)=>{const{length:d}=r=r?r.filter(Boolean):[];if(o||d){let _=new AbortController,x;const P=function(Q){if(!x){x=!0,c();const ne=Q instanceof Error?Q:this.reason;_.abort(ne instanceof er?ne:new ou(ne instanceof Error?ne.message:ne))}};let b=o&&setTimeout(()=>{b=null,P(new er(`timeout ${o} of ms exceeded`,er.ETIMEDOUT))},o);const c=()=>{r&&(b&&clearTimeout(b),b=null,r.forEach(Q=>{Q.unsubscribe?Q.unsubscribe(P):Q.removeEventListener("abort",P)}),r=null)};r.forEach(Q=>Q.addEventListener("abort",P));const{signal:U}=_;return U.unsubscribe=()=>je.asap(c),U}},tM=function*(r,o){let d=r.byteLength;if(d<o){yield r;return}let _=0,x;for(;_<d;)x=_+o,yield r.slice(_,x),_=x},rM=async function*(r,o){for await(const d of nM(r))yield*tM(d,o)},nM=async function*(r){if(r[Symbol.asyncIterator]){yield*r;return}const o=r.getReader();try{for(;;){const{done:d,value:_}=await o.read();if(d)break;yield _}}finally{await o.cancel()}},k0=(r,o,d,_)=>{const x=rM(r,o);let P=0,b,c=U=>{b||(b=!0,_&&_(U))};return new ReadableStream({async pull(U){try{const{done:Q,value:ne}=await x.next();if(Q){c(),U.close();return}let ye=ne.byteLength;if(d){let me=P+=ye;d(me)}U.enqueue(new Uint8Array(ne))}catch(Q){throw c(Q),Q}},cancel(U){return c(U),x.return()}},{highWaterMark:2})},E0=64*1024,{isFunction:Ip}=je,iM=(({Request:r,Response:o})=>({Request:r,Response:o}))(je.global),{ReadableStream:I0,TextEncoder:A0}=je.global,z0=(r,...o)=>{try{return!!r(...o)}catch{return!1}},sM=r=>{r=je.merge.call({skipUndefined:!0},iM,r);const{fetch:o,Request:d,Response:_}=r,x=o?Ip(o):typeof fetch=="function",P=Ip(d),b=Ip(_);if(!x)return!1;const c=x&&Ip(I0),U=x&&(typeof A0=="function"?(ce=>Le=>ce.encode(Le))(new A0):async ce=>new Uint8Array(await new d(ce).arrayBuffer())),Q=P&&c&&z0(()=>{let ce=!1;const Le=new d(ai.origin,{body:new I0,method:"POST",get duplex(){return ce=!0,"half"}}).headers.has("Content-Type");return ce&&!Le}),ne=b&&c&&z0(()=>je.isReadableStream(new _("").body)),ye={stream:ne&&(ce=>ce.body)};x&&["text","arrayBuffer","blob","formData","stream"].forEach(ce=>{!ye[ce]&&(ye[ce]=(Le,Qe)=>{let pe=Le&&Le[ce];if(pe)return pe.call(Le);throw new er(`Response type '${ce}' is not supported`,er.ERR_NOT_SUPPORT,Qe)})});const me=async ce=>{if(ce==null)return 0;if(je.isBlob(ce))return ce.size;if(je.isSpecCompliantForm(ce))return(await new d(ai.origin,{method:"POST",body:ce}).arrayBuffer()).byteLength;if(je.isArrayBufferView(ce)||je.isArrayBuffer(ce))return ce.byteLength;if(je.isURLSearchParams(ce)&&(ce=ce+""),je.isString(ce))return(await U(ce)).byteLength},re=async(ce,Le)=>{const Qe=je.toFiniteNumber(ce.getContentLength());return Qe??me(Le)};return async ce=>{let{url:Le,method:Qe,data:pe,signal:le,cancelToken:ve,timeout:Be,onDownloadProgress:We,onUploadProgress:Je,responseType:st,headers:rt,withCredentials:Zt="same-origin",fetchOptions:zt}=_w(ce),ur=o||fetch;st=st?(st+"").toLowerCase():"text";let hr=eM([le,ve&&ve.toAbortSignal()],Be),_r=null;const Wt=hr&&hr.unsubscribe&&(()=>{hr.unsubscribe()});let tn;try{if(Je&&Q&&Qe!=="get"&&Qe!=="head"&&(tn=await re(rt,pe))!==0){let Gt=new d(Le,{method:"POST",body:pe,duplex:"half"}),Xt;if(je.isFormData(pe)&&(Xt=Gt.headers.get("content-type"))&&rt.setContentType(Xt),Gt.body){const[yn,br]=P0(tn,_f(C0(Je)));pe=k0(Gt.body,E0,yn,br)}}je.isString(Zt)||(Zt=Zt?"include":"omit");const dr=P&&"credentials"in d.prototype,Gr={...zt,signal:hr,method:Qe.toUpperCase(),headers:rt.normalize().toJSON(),body:pe,duplex:"half",credentials:dr?Zt:void 0};_r=P&&new d(Le,Gr);let qe=await(P?ur(_r,zt):ur(Le,Gr));const ft=ne&&(st==="stream"||st==="response");if(ne&&(We||ft&&Wt)){const Gt={};["status","statusText","headers"].forEach(Tr=>{Gt[Tr]=qe[Tr]});const Xt=je.toFiniteNumber(qe.headers.get("content-length")),[yn,br]=We&&P0(Xt,_f(C0(We),!0))||[];qe=new _(k0(qe.body,E0,yn,()=>{br&&br(),Wt&&Wt()}),Gt)}st=st||"text";let bt=await ye[je.findKey(ye,st)||"text"](qe,ce);return!ft&&Wt&&Wt(),await new Promise((Gt,Xt)=>{mw(Gt,Xt,{data:bt,headers:Ri.from(qe.headers),status:qe.status,statusText:qe.statusText,config:ce,request:_r})})}catch(dr){throw Wt&&Wt(),dr&&dr.name==="TypeError"&&/Load failed|fetch/i.test(dr.message)?Object.assign(new er("Network Error",er.ERR_NETWORK,ce,_r),{cause:dr.cause||dr}):er.from(dr,dr&&dr.code,ce,_r)}}},oM=new Map,yw=r=>{let o=r?r.env:{};const{fetch:d,Request:_,Response:x}=o,P=[_,x,d];let b=P.length,c=b,U,Q,ne=oM;for(;c--;)U=P[c],Q=ne.get(U),Q===void 0&&ne.set(U,Q=c?new Map:sM(o)),ne=Q;return Q};yw();const P_={http:TC,xhr:JC,fetch:{get:yw}};je.forEach(P_,(r,o)=>{if(r){try{Object.defineProperty(r,"name",{value:o})}catch{}Object.defineProperty(r,"adapterName",{value:o})}});const R0=r=>`- ${r}`,aM=r=>je.isFunction(r)||r===null||r===!1,vw={getAdapter:(r,o)=>{r=je.isArray(r)?r:[r];const{length:d}=r;let _,x;const P={};for(let b=0;b<d;b++){_=r[b];let c;if(x=_,!aM(_)&&(x=P_[(c=String(_)).toLowerCase()],x===void 0))throw new er(`Unknown adapter '${c}'`);if(x&&(je.isFunction(x)||(x=x.get(o))))break;P[c||"#"+b]=x}if(!x){const b=Object.entries(P).map(([U,Q])=>`adapter ${U} `+(Q===!1?"is not supported by the environment":"is not available in the build"));let c=d?b.length>1?`since :
`+b.map(R0).join(`
`):" "+R0(b[0]):"as no adapter specified";throw new er("There is no suitable adapter to dispatch the request "+c,"ERR_NOT_SUPPORT")}return x},adapters:P_};function Mg(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new ou(null,r)}function D0(r){return Mg(r),r.headers=Ri.from(r.headers),r.data=Cg.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),vw.getAdapter(r.adapter||od.adapter,r)(r).then(function(_){return Mg(r),_.data=Cg.call(r,r.transformResponse,_),_.headers=Ri.from(_.headers),_},function(_){return fw(_)||(Mg(r),_&&_.response&&(_.response.data=Cg.call(r,r.transformResponse,_.response),_.response.headers=Ri.from(_.response.headers))),Promise.reject(_)})}const xw="1.12.2",Bf={};["object","boolean","number","function","string","symbol"].forEach((r,o)=>{Bf[r]=function(_){return typeof _===r||"a"+(o<1?"n ":" ")+r}});const L0={};Bf.transitional=function(o,d,_){function x(P,b){return"[Axios v"+xw+"] Transitional option '"+P+"'"+b+(_?". "+_:"")}return(P,b,c)=>{if(o===!1)throw new er(x(b," has been removed"+(d?" in "+d:"")),er.ERR_DEPRECATED);return d&&!L0[b]&&(L0[b]=!0,console.warn(x(b," has been deprecated since v"+d+" and will be removed in the near future"))),o?o(P,b,c):!0}};Bf.spelling=function(o){return(d,_)=>(console.warn(`${_} is likely a misspelling of ${o}`),!0)};function lM(r,o,d){if(typeof r!="object")throw new er("options must be an object",er.ERR_BAD_OPTION_VALUE);const _=Object.keys(r);let x=_.length;for(;x-- >0;){const P=_[x],b=o[P];if(b){const c=r[P],U=c===void 0||b(c,P,r);if(U!==!0)throw new er("option "+P+" must be "+U,er.ERR_BAD_OPTION_VALUE);continue}if(d!==!0)throw new er("Unknown option "+P,er.ERR_BAD_OPTION)}}const Gp={assertOptions:lM,validators:Bf},Ys=Gp.validators;let yl=class{constructor(o){this.defaults=o||{},this.interceptors={request:new T0,response:new T0}}async request(o,d){try{return await this._request(o,d)}catch(_){if(_ instanceof Error){let x={};Error.captureStackTrace?Error.captureStackTrace(x):x=new Error;const P=x.stack?x.stack.replace(/^.+\n/,""):"";try{_.stack?P&&!String(_.stack).endsWith(P.replace(/^.+\n.+\n/,""))&&(_.stack+=`
`+P):_.stack=P}catch{}}throw _}}_request(o,d){typeof o=="string"?(d=d||{},d.url=o):d=o||{},d=Sl(this.defaults,d);const{transitional:_,paramsSerializer:x,headers:P}=d;_!==void 0&&Gp.assertOptions(_,{silentJSONParsing:Ys.transitional(Ys.boolean),forcedJSONParsing:Ys.transitional(Ys.boolean),clarifyTimeoutError:Ys.transitional(Ys.boolean)},!1),x!=null&&(je.isFunction(x)?d.paramsSerializer={serialize:x}:Gp.assertOptions(x,{encode:Ys.function,serialize:Ys.function},!0)),d.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?d.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:d.allowAbsoluteUrls=!0),Gp.assertOptions(d,{baseUrl:Ys.spelling("baseURL"),withXsrfToken:Ys.spelling("withXSRFToken")},!0),d.method=(d.method||this.defaults.method||"get").toLowerCase();let b=P&&je.merge(P.common,P[d.method]);P&&je.forEach(["delete","get","head","post","put","patch","common"],ce=>{delete P[ce]}),d.headers=Ri.concat(b,P);const c=[];let U=!0;this.interceptors.request.forEach(function(Le){typeof Le.runWhen=="function"&&Le.runWhen(d)===!1||(U=U&&Le.synchronous,c.unshift(Le.fulfilled,Le.rejected))});const Q=[];this.interceptors.response.forEach(function(Le){Q.push(Le.fulfilled,Le.rejected)});let ne,ye=0,me;if(!U){const ce=[D0.bind(this),void 0];for(ce.unshift(...c),ce.push(...Q),me=ce.length,ne=Promise.resolve(d);ye<me;)ne=ne.then(ce[ye++],ce[ye++]);return ne}me=c.length;let re=d;for(;ye<me;){const ce=c[ye++],Le=c[ye++];try{re=ce(re)}catch(Qe){Le.call(this,Qe);break}}try{ne=D0.call(this,re)}catch(ce){return Promise.reject(ce)}for(ye=0,me=Q.length;ye<me;)ne=ne.then(Q[ye++],Q[ye++]);return ne}getUri(o){o=Sl(this.defaults,o);const d=gw(o.baseURL,o.url,o.allowAbsoluteUrls);return hw(d,o.params,o.paramsSerializer)}};je.forEach(["delete","get","head","options"],function(o){yl.prototype[o]=function(d,_){return this.request(Sl(_||{},{method:o,url:d,data:(_||{}).data}))}});je.forEach(["post","put","patch"],function(o){function d(_){return function(P,b,c){return this.request(Sl(c||{},{method:o,headers:_?{"Content-Type":"multipart/form-data"}:{},url:P,data:b}))}}yl.prototype[o]=d(),yl.prototype[o+"Form"]=d(!0)});let cM=class bw{constructor(o){if(typeof o!="function")throw new TypeError("executor must be a function.");let d;this.promise=new Promise(function(P){d=P});const _=this;this.promise.then(x=>{if(!_._listeners)return;let P=_._listeners.length;for(;P-- >0;)_._listeners[P](x);_._listeners=null}),this.promise.then=x=>{let P;const b=new Promise(c=>{_.subscribe(c),P=c}).then(x);return b.cancel=function(){_.unsubscribe(P)},b},o(function(P,b,c){_.reason||(_.reason=new ou(P,b,c),d(_.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(o){if(this.reason){o(this.reason);return}this._listeners?this._listeners.push(o):this._listeners=[o]}unsubscribe(o){if(!this._listeners)return;const d=this._listeners.indexOf(o);d!==-1&&this._listeners.splice(d,1)}toAbortSignal(){const o=new AbortController,d=_=>{o.abort(_)};return this.subscribe(d),o.signal.unsubscribe=()=>this.unsubscribe(d),o.signal}static source(){let o;return{token:new bw(function(x){o=x}),cancel:o}}};function uM(r){return function(d){return r.apply(null,d)}}function hM(r){return je.isObject(r)&&r.isAxiosError===!0}const C_={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(C_).forEach(([r,o])=>{C_[o]=r});function ww(r){const o=new yl(r),d=Jb(yl.prototype.request,o);return je.extend(d,yl.prototype,o,{allOwnKeys:!0}),je.extend(d,o,null,{allOwnKeys:!0}),d.create=function(x){return ww(Sl(r,x))},d}const Ct=ww(od);Ct.Axios=yl;Ct.CanceledError=ou;Ct.CancelToken=cM;Ct.isCancel=fw;Ct.VERSION=xw;Ct.toFormData=Ff;Ct.AxiosError=er;Ct.Cancel=Ct.CanceledError;Ct.all=function(o){return Promise.all(o)};Ct.spread=uM;Ct.isAxiosError=hM;Ct.mergeConfig=Sl;Ct.AxiosHeaders=Ri;Ct.formToJSON=r=>pw(je.isHTMLForm(r)?new FormData(r):r);Ct.getAdapter=vw.getAdapter;Ct.HttpStatusCode=C_;Ct.default=Ct;const{Axios:TM,AxiosError:SM,CanceledError:PM,isCancel:CM,CancelToken:MM,VERSION:kM,all:EM,Cancel:IM,isAxiosError:AM,spread:zM,toFormData:RM,AxiosHeaders:DM,HttpStatusCode:LM,formToJSON:jM,getAdapter:FM,mergeConfig:BM}=Ct;var Tw={exports:{}};/**
 * TrackAsia GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/track-asia/trackasia-gl-js/blob/v2.0.1/LICENSE.txt
 */(function(r,o){(function(d,_){r.exports=_()})(uT,function(){var d={},_={};function x(b,c,U){if(_[b]=U,b==="index"){var Q="var sharedModule = {}; ("+_.shared+")(sharedModule); ("+_.worker+")(sharedModule);",ne={};return _.shared(ne),_.index(d,ne),typeof window<"u"&&d.setWorkerUrl(window.URL.createObjectURL(new Blob([Q],{type:"text/javascript"}))),d}}x("shared",["exports"],function(b){function c(s,t,i,a){return new(i||(i=Promise))(function(h,m){function g(C){try{T(a.next(C))}catch(k){m(k)}}function v(C){try{T(a.throw(C))}catch(k){m(k)}}function T(C){var k;C.done?h(C.value):(k=C.value,k instanceof i?k:new i(function(I){I(k)})).then(g,v)}T((a=a.apply(s,t||[])).next())})}function U(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var Q,ne;function ye(){if(ne)return Q;function s(t,i){this.x=t,this.y=i}return ne=1,Q=s,s.prototype={clone:function(){return new s(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,i){return this.clone()._rotateAround(t,i)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var i=t.x-this.x,a=t.y-this.y;return i*i+a*a},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,i){return Math.atan2(this.x*i-this.y*t,this.x*t+this.y*i)},_matMult:function(t){var i=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=i,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var i=Math.cos(t),a=Math.sin(t),h=a*this.x+i*this.y;return this.x=i*this.x-a*this.y,this.y=h,this},_rotateAround:function(t,i){var a=Math.cos(t),h=Math.sin(t),m=i.y+h*(this.x-i.x)+a*(this.y-i.y);return this.x=i.x+a*(this.x-i.x)-h*(this.y-i.y),this.y=m,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},s.convert=function(t){return t instanceof s?t:Array.isArray(t)?new s(t[0],t[1]):t},Q}typeof SuppressedError=="function"&&SuppressedError;var me,re,ce=U(ye()),Le=function(){if(re)return me;function s(t,i,a,h){this.cx=3*t,this.bx=3*(a-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(h-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=i,this.p2x=a,this.p2y=h}return re=1,me=s,s.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,i){if(i===void 0&&(i=1e-6),t<0)return 0;if(t>1)return 1;for(var a=t,h=0;h<8;h++){var m=this.sampleCurveX(a)-t;if(Math.abs(m)<i)return a;var g=this.sampleCurveDerivativeX(a);if(Math.abs(g)<1e-6)break;a-=m/g}var v=0,T=1;for(a=t,h=0;h<20&&(m=this.sampleCurveX(a),!(Math.abs(m-t)<i));h++)t>m?v=a:T=a,a=.5*(T-v)+v;return a},solve:function(t,i){return this.sampleCurveY(this.solveCurveX(t,i))}},me}(),Qe=U(Le);let pe,le;function ve(){return pe==null&&(pe=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),pe}function Be(){if(le==null&&(le=!1,ve())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let a=0;a<5*5;a++){const h=4*a;t.fillStyle=`rgb(${h},${h+1},${h+2})`,t.fillRect(a%5,Math.floor(a/5),1,1)}const i=t.getImageData(0,0,5,5).data;for(let a=0;a<5*5*4;a++)if(a%4!=3&&i[a]!==a){le=!0;break}}}return le||!1}var We=1e-6,Je=typeof Float32Array<"u"?Float32Array:Array;function st(){var s=new Je(9);return Je!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[5]=0,s[6]=0,s[7]=0),s[0]=1,s[4]=1,s[8]=1,s}function rt(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function Zt(){var s=new Je(3);return Je!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s}function zt(s){return Math.hypot(s[0],s[1],s[2])}function ur(s,t,i){var a=new Je(3);return a[0]=s,a[1]=t,a[2]=i,a}Math.hypot||(Math.hypot=function(){for(var s=0,t=arguments.length;t--;)s+=arguments[t]*arguments[t];return Math.sqrt(s)});var hr,_r=zt;function Wt(s,t,i){var a=t[0],h=t[1],m=t[2],g=t[3];return s[0]=i[0]*a+i[4]*h+i[8]*m+i[12]*g,s[1]=i[1]*a+i[5]*h+i[9]*m+i[13]*g,s[2]=i[2]*a+i[6]*h+i[10]*m+i[14]*g,s[3]=i[3]*a+i[7]*h+i[11]*m+i[15]*g,s}function tn(){var s=new Je(4);return Je!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s[3]=1,s}function dr(){var s=new Je(2);return Je!=Float32Array&&(s[0]=0,s[1]=0),s}function Gr(s,t){var i=new Je(2);return i[0]=s,i[1]=t,i}Zt(),hr=new Je(4),Je!=Float32Array&&(hr[0]=0,hr[1]=0,hr[2]=0,hr[3]=0),Zt(),ur(1,0,0),ur(0,1,0),tn(),tn(),st(),dr();const qe=8192;function ft(s,t,i){return t*(qe/(s.tileSize*Math.pow(2,i-s.tileID.overscaledZ)))}function bt(s,t){return(s%t+t)%t}function Gt(s,t,i){return s*(1-i)+t*i}function Xt(s){if(s<=0)return 0;if(s>=1)return 1;const t=s*s,i=t*s;return 4*(s<.5?i:3*(s-t)+i-.75)}function yn(s,t,i,a){const h=new Qe(s,t,i,a);return m=>h.solve(m)}const br=yn(.25,.1,.25,1);function Tr(s,t,i){return Math.min(i,Math.max(t,s))}function cn(s,t,i){const a=i-t,h=((s-t)%a+a)%a+t;return h===t?i:h}function Xr(s,...t){for(const i of t)for(const a in i)s[a]=i[a];return s}let Ae=1;function Ut(s,t,i){const a={};for(const h in s)a[h]=t.call(this,s[h],h,s);return a}function Yt(s,t,i){const a={};for(const h in s)t.call(this,s[h],h,s)&&(a[h]=s[h]);return a}function yr(s){return Array.isArray(s)?s.map(yr):typeof s=="object"&&s?Ut(s,yr):s}const qr={};function Sr(s){qr[s]||(typeof console<"u"&&console.warn(s),qr[s]=!0)}function mr(s,t,i){return(i.y-s.y)*(t.x-s.x)>(t.y-s.y)*(i.x-s.x)}function nr(s){return typeof WorkerGlobalScope<"u"&&s!==void 0&&s instanceof WorkerGlobalScope}let Qi=null;function rn(s){return typeof ImageBitmap<"u"&&s instanceof ImageBitmap}const Di="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ci(s,t,i,a,h){return c(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const m=new VideoFrame(s,{timestamp:0});try{const g=m==null?void 0:m.format;if(!g||!g.startsWith("BGR")&&!g.startsWith("RGB"))throw new Error(`Unrecognized format ${g}`);const v=g.startsWith("BGR"),T=new Uint8ClampedArray(a*h*4);if(yield m.copyTo(T,function(C,k,I,D,j){const F=4*Math.max(1,0),N=(Math.max(0,I)-I)*D*4+F,G=4*D,Y=Math.max(0,k),he=Math.max(0,I);return{rect:{x:Y,y:he,width:Math.min(C.width,k+D)-Y,height:Math.min(C.height,I+j)-he},layout:[{offset:N,stride:G}]}}(s,t,i,a,h)),v)for(let C=0;C<T.length;C+=4){const k=T[C];T[C]=T[C+2],T[C+2]=k}return T}finally{m.close()}})}let un,kn;function Ji(s,t,i,a){return s.addEventListener(t,i,a),{unsubscribe:()=>{s.removeEventListener(t,i,a)}}}function js(s){return s*Math.PI/180}function es(s){return s/Math.PI*180}const ro={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},no={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},io="AbortError";function ts(){return new Error(io)}const Gn={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Li(s){return Gn.REGISTERED_PROTOCOLS[s.substring(0,s.indexOf("://"))]}const ms="global-dispatcher";class qn extends Error{constructor(t,i,a,h){super(`AJAXError: ${i} (${t}): ${a}`),this.status=t,this.statusText=i,this.url=a,this.body=h}}const En=()=>nr(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,xi=function(s,t){if(/:\/\//.test(s.url)&&!/^https?:|^file:/.test(s.url)){const a=Li(s.url);if(a)return a(s,t);if(nr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:s,targetMapId:ms},t)}if(!(/^file:/.test(i=s.url)||/^file:/.test(En())&&!/^\w+:/.test(i))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(a,h){return c(this,void 0,void 0,function*(){const m=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,cache:a.cache,referrer:En(),signal:h.signal});let g,v;a.type!=="json"||m.headers.has("Accept")||m.headers.set("Accept","application/json");try{g=yield fetch(m)}catch(C){throw new qn(0,C.message,a.url,new Blob)}if(!g.ok){const C=yield g.blob();throw new qn(g.status,g.statusText,a.url,C)}v=a.type==="arrayBuffer"||a.type==="image"?g.arrayBuffer():a.type==="json"?g.json():g.text();const T=yield v;if(h.signal.aborted)throw ts();return{data:T,cacheControl:g.headers.get("Cache-Control"),expires:g.headers.get("Expires")}})}(s,t);if(nr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:s,mustQueue:!0,targetMapId:ms},t)}var i;return function(a,h){return new Promise((m,g)=>{var v;const T=new XMLHttpRequest;T.open(a.method||"GET",a.url,!0),a.type!=="arrayBuffer"&&a.type!=="image"||(T.responseType="arraybuffer");for(const C in a.headers)T.setRequestHeader(C,a.headers[C]);a.type==="json"&&(T.responseType="text",!((v=a.headers)===null||v===void 0)&&v.Accept||T.setRequestHeader("Accept","application/json")),T.withCredentials=a.credentials==="include",T.onerror=()=>{g(new Error(T.statusText))},T.onload=()=>{if(!h.signal.aborted)if((T.status>=200&&T.status<300||T.status===0)&&T.response!==null){let C=T.response;if(a.type==="json")try{C=JSON.parse(T.response)}catch(k){return void g(k)}m({data:C,cacheControl:T.getResponseHeader("Cache-Control"),expires:T.getResponseHeader("Expires")})}else{const C=new Blob([T.response],{type:T.getResponseHeader("Content-Type")});g(new qn(T.status,T.statusText,a.url,C))}},h.signal.addEventListener("abort",()=>{T.abort(),g(ts())}),T.send(a.body)})}(s,t)};function ge(s){if(!s||s.indexOf("://")<=0||s.indexOf("data:image/")===0||s.indexOf("blob:")===0)return!0;const t=new URL(s),i=window.location;return t.protocol===i.protocol&&t.host===i.host}function V(s,t,i){i[s]&&i[s].indexOf(t)!==-1||(i[s]=i[s]||[],i[s].push(t))}function $(s,t,i){if(i&&i[s]){const a=i[s].indexOf(t);a!==-1&&i[s].splice(a,1)}}class H{constructor(t,i={}){Xr(this,i),this.type=t}}class te extends H{constructor(t,i={}){super("error",Xr({error:t},i))}}class de{on(t,i){return this._listeners=this._listeners||{},V(t,i,this._listeners),{unsubscribe:()=>{this.off(t,i)}}}off(t,i){return $(t,i,this._listeners),$(t,i,this._oneTimeListeners),this}once(t,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},V(t,i,this._oneTimeListeners),this):new Promise(a=>this.once(t,a))}fire(t,i){typeof t=="string"&&(t=new H(t,i||{}));const a=t.type;if(this.listens(a)){t.target=this;const h=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const v of h)v.call(this,t);const m=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const v of m)$(a,v,this._oneTimeListeners),v.call(this,t);const g=this._eventedParent;g&&(Xr(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(t))}else t instanceof te&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,i){return this._eventedParent=t,this._eventedParentData=i,this}}var q={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Te=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function _e(s,t){const i={};for(const a in s)a!=="ref"&&(i[a]=s[a]);return Te.forEach(a=>{a in t&&(i[a]=t[a])}),i}function be(s,t){if(Array.isArray(s)){if(!Array.isArray(t)||s.length!==t.length)return!1;for(let i=0;i<s.length;i++)if(!be(s[i],t[i]))return!1;return!0}if(typeof s=="object"&&s!==null&&t!==null){if(typeof t!="object"||Object.keys(s).length!==Object.keys(t).length)return!1;for(const i in s)if(!be(s[i],t[i]))return!1;return!0}return s===t}function Ce(s,t){s.push(t)}function xe(s,t,i){Ce(i,{command:"addSource",args:[s,t[s]]})}function $e(s,t,i){Ce(t,{command:"removeSource",args:[s]}),i[s]=!0}function tt(s,t,i,a){$e(s,i,a),xe(s,t,i)}function ot(s,t,i){let a;for(a in s[i])if(Object.prototype.hasOwnProperty.call(s[i],a)&&a!=="data"&&!be(s[i][a],t[i][a]))return!1;for(a in t[i])if(Object.prototype.hasOwnProperty.call(t[i],a)&&a!=="data"&&!be(s[i][a],t[i][a]))return!1;return!0}function xt(s,t,i,a,h,m){s=s||{},t=t||{};for(const g in s)Object.prototype.hasOwnProperty.call(s,g)&&(be(s[g],t[g])||i.push({command:m,args:[a,g,t[g],h]}));for(const g in t)Object.prototype.hasOwnProperty.call(t,g)&&!Object.prototype.hasOwnProperty.call(s,g)&&(be(s[g],t[g])||i.push({command:m,args:[a,g,t[g],h]}))}function Lt(s){return s.id}function Tt(s,t){return s[t.id]=t,s}class Ie{constructor(t,i,a,h){this.message=(t?`${t}: `:"")+a,h&&(this.identifier=h),i!=null&&i.__line__&&(this.line=i.__line__)}}function or(s,...t){for(const i of t)for(const a in i)s[a]=i[a];return s}class qt extends Error{constructor(t,i){super(i),this.message=i,this.key=t}}class tr{constructor(t,i=[]){this.parent=t,this.bindings={};for(const[a,h]of i)this.bindings[a]=h}concat(t){return new tr(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Mt={kind:"null"},Ve={kind:"number"},St={kind:"string"},kt={kind:"boolean"},Pr={kind:"color"},Rr={kind:"projectionDefinition"},hn={kind:"object"},Ft={kind:"value"},Fs={kind:"collator"},so={kind:"formatted"},gs={kind:"padding"},oo={kind:"colorArray"},ji={kind:"numberArray"},_s={kind:"resolvedImage"},Or={kind:"variableAnchorOffsetCollection"};function Hn(s,t){return{kind:"array",itemType:s,N:t}}function Cr(s){if(s.kind==="array"){const t=Cr(s.itemType);return typeof s.N=="number"?`array<${t}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${t}>`}return s.kind}const ao=[Mt,Ve,St,kt,Pr,Rr,so,hn,Hn(Ft),gs,ji,oo,_s,Or];function Bs(s,t){if(t.kind==="error")return null;if(s.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Bs(s.itemType,t.itemType))&&(typeof s.N!="number"||s.N===t.N))return null}else{if(s.kind===t.kind)return null;if(s.kind==="value"){for(const i of ao)if(!Bs(i,t))return null}}return`Expected ${Cr(s)} but found ${Cr(t)} instead.`}function Ta(s,t){return t.some(i=>i.kind===s.kind)}function ys(s,t){return t.some(i=>i==="null"?s===null:i==="array"?Array.isArray(s):i==="object"?s&&!Array.isArray(s)&&typeof s=="object":i===typeof s)}function Fi(s,t){return s.kind==="array"&&t.kind==="array"?s.itemType.kind===t.itemType.kind&&typeof s.N=="number":s.kind===t.kind}const Ml=.96422,Sa=.82521,Oe=4/29,we=6/29,He=3*we*we,Ke=we*we*we,yt=Math.PI/180,lt=180/Math.PI;function ht(s){return(s%=360)<0&&(s+=360),s}function ct([s,t,i,a]){let h,m;const g=Nt((.2225045*(s=Dt(s))+.7168786*(t=Dt(t))+.0606169*(i=Dt(i)))/1);s===t&&t===i?h=m=g:(h=Nt((.4360747*s+.3850649*t+.1430804*i)/Ml),m=Nt((.0139322*s+.0971045*t+.7141733*i)/Sa));const v=116*g-16;return[v<0?0:v,500*(h-g),200*(g-m),a]}function Dt(s){return s<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function Nt(s){return s>Ke?Math.pow(s,1/3):s/He+Oe}function ar([s,t,i,a]){let h=(s+16)/116,m=isNaN(t)?h:h+t/500,g=isNaN(i)?h:h-i/200;return h=1*mt(h),m=Ml*mt(m),g=Sa*mt(g),[At(3.1338561*m-1.6168667*h-.4906146*g),At(-.9787684*m+1.9161415*h+.033454*g),At(.0719453*m-.2289914*h+1.4052427*g),a]}function At(s){return(s=s<=.00304?12.92*s:1.055*Math.pow(s,1/2.4)-.055)<0?0:s>1?1:s}function mt(s){return s>we?s*s*s:He*(s-Oe)}const Bt=Object.hasOwn||function(s,t){return Object.prototype.hasOwnProperty.call(s,t)};function Ht(s,t){return Bt(s,t)?s[t]:void 0}function gt(s){return parseInt(s.padEnd(2,s),16)/255}function Ot(s,t){return Rt(t?s/100:s,0,1)}function Rt(s,t,i){return Math.min(Math.max(t,s),i)}function Et(s){return!s.some(Number.isNaN)}const vs={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function vn(s,t,i){return s+i*(t-s)}function rs(s,t,i){return s.map((a,h)=>vn(a,t[h],i))}class Kt{constructor(t,i,a,h=1,m=!0){this.r=t,this.g=i,this.b=a,this.a=h,m||(this.r*=h,this.g*=h,this.b*=h,h||this.overwriteGetter("rgb",[t,i,a,h]))}static parse(t){if(t instanceof Kt)return t;if(typeof t!="string")return;const i=function(a){if((a=a.toLowerCase().trim())==="transparent")return[0,0,0,0];const h=Ht(vs,a);if(h){const[g,v,T]=h;return[g/255,v/255,T/255,1]}if(a.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(a)){const g=a.length<6?1:2;let v=1;return[gt(a.slice(v,v+=g)),gt(a.slice(v,v+=g)),gt(a.slice(v,v+=g)),gt(a.slice(v,v+g)||"ff")]}if(a.startsWith("rgb")){const g=a.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[v,T,C,k,I,D,j,F,N,G,Y,he]=g,ee=[k||" ",j||" ",G].join("");if(ee==="  "||ee==="  /"||ee===",,"||ee===",,,"){const L=[C,D,N].join(""),Z=L==="%%%"?100:L===""?255:0;if(Z){const ie=[Rt(+T/Z,0,1),Rt(+I/Z,0,1),Rt(+F/Z,0,1),Y?Ot(+Y,he):1];if(Et(ie))return ie}}return}}const m=a.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(m){const[g,v,T,C,k,I,D,j,F]=m,N=[T||" ",k||" ",D].join("");if(N==="  "||N==="  /"||N===",,"||N===",,,"){const G=[+v,Rt(+C,0,100),Rt(+I,0,100),j?Ot(+j,F):1];if(Et(G))return function([Y,he,ee,L]){function Z(ie){const Pe=(ie+Y/30)%12,Ue=he*Math.min(ee,1-ee);return ee-Ue*Math.max(-1,Math.min(Pe-3,9-Pe,1))}return Y=ht(Y),he/=100,ee/=100,[Z(0),Z(8),Z(4),L]}(G)}}}(t);return i?new Kt(...i,!1):void 0}get rgb(){const{r:t,g:i,b:a,a:h}=this,m=h||1/0;return this.overwriteGetter("rgb",[t/m,i/m,a/m,h])}get hcl(){return this.overwriteGetter("hcl",function(t){const[i,a,h,m]=ct(t),g=Math.sqrt(a*a+h*h);return[Math.round(1e4*g)?ht(Math.atan2(h,a)*lt):NaN,g,i,m]}(this.rgb))}get lab(){return this.overwriteGetter("lab",ct(this.rgb))}overwriteGetter(t,i){return Object.defineProperty(this,t,{value:i}),i}toString(){const[t,i,a,h]=this.rgb;return`rgba(${[t,i,a].map(m=>Math.round(255*m)).join(",")},${h})`}static interpolate(t,i,a,h="rgb"){switch(h){case"rgb":{const[m,g,v,T]=rs(t.rgb,i.rgb,a);return new Kt(m,g,v,T,!1)}case"hcl":{const[m,g,v,T]=t.hcl,[C,k,I,D]=i.hcl;let j,F;if(isNaN(m)||isNaN(C))isNaN(m)?isNaN(C)?j=NaN:(j=C,v!==1&&v!==0||(F=k)):(j=m,I!==1&&I!==0||(F=g));else{let ee=C-m;C>m&&ee>180?ee-=360:C<m&&m-C>180&&(ee+=360),j=m+a*ee}const[N,G,Y,he]=function([ee,L,Z,ie]){return ee=isNaN(ee)?0:ee*yt,ar([Z,Math.cos(ee)*L,Math.sin(ee)*L,ie])}([j,F??vn(g,k,a),vn(v,I,a),vn(T,D,a)]);return new Kt(N,G,Y,he,!1)}case"lab":{const[m,g,v,T]=ar(rs(t.lab,i.lab,a));return new Kt(m,g,v,T,!1)}}}}Kt.black=new Kt(0,0,0,1),Kt.white=new Kt(1,1,1,1),Kt.transparent=new Kt(0,0,0,0),Kt.red=new Kt(1,0,0,1);class Pa{constructor(t,i,a){this.sensitivity=t?i?"variant":"case":i?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,i){return this.collator.compare(t,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Ca=["bottom","center","top"];class zo{constructor(t,i,a,h,m,g){this.text=t,this.image=i,this.scale=a,this.fontStack=h,this.textColor=m,this.verticalAlign=g}}class ti{constructor(t){this.sections=t}static fromString(t){return new ti([new zo(t,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof ti?t:ti.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class In{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof In)return t;if(typeof t=="number")return new In([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const i of t)if(typeof i!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new In(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,i,a){return new In(rs(t.values,i.values,a))}}class Kr{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Kr)return t;if(typeof t=="number")return new Kr([t]);if(Array.isArray(t)){for(const i of t)if(typeof i!="number")return;return new Kr(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,i,a){return new Kr(rs(t.values,i.values,a))}}class An{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof An)return t;if(typeof t=="string"){const a=Kt.parse(t);return a?new An([a]):void 0}if(!Array.isArray(t))return;const i=[];for(const a of t){if(typeof a!="string")return;const h=Kt.parse(a);if(!h)return;i.push(h)}return new An(i)}toString(){return JSON.stringify(this.values)}static interpolate(t,i,a,h="rgb"){const m=[];if(t.values.length!=i.values.length)throw new Error(`colorArray: Arrays have mismatched length (${t.values.length} vs. ${i.values.length}), cannot interpolate.`);for(let g=0;g<t.values.length;g++)m.push(Kt.interpolate(t.values[g],i.values[g],a,h));return new An(m)}}class kr extends Error{constructor(t){super(t),this.name="RuntimeError"}toJSON(){return this.message}}const Ro=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Wn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Wn)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let i=0;i<t.length;i+=2){const a=t[i],h=t[i+1];if(typeof a!="string"||!Ro.has(a)||!Array.isArray(h)||h.length!==2||typeof h[0]!="number"||typeof h[1]!="number")return}return new Wn(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,i,a){const h=t.values,m=i.values;if(h.length!==m.length)throw new kr(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${i.toString()}`);const g=[];for(let v=0;v<h.length;v+=2){if(h[v]!==m[v])throw new kr(`Cannot interpolate values containing mismatched anchors. from[${v}]: ${h[v]}, to[${v}]: ${m[v]}`);g.push(h[v]);const[T,C]=h[v+1],[k,I]=m[v+1];g.push([vn(T,k,a),vn(C,I,a)])}return new Wn(g)}}class ui{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new ui({name:t,available:!1}):null}}class ri{constructor(t,i,a){this.from=t,this.to=i,this.transition=a}static interpolate(t,i,a){return new ri(t,i,a)}static parse(t){return t instanceof ri?t:Array.isArray(t)&&t.length===3&&typeof t[0]=="string"&&typeof t[1]=="string"&&typeof t[2]=="number"?new ri(t[0],t[1],t[2]):typeof t=="object"&&typeof t.from=="string"&&typeof t.to=="string"&&typeof t.transition=="number"?new ri(t.from,t.to,t.transition):typeof t=="string"?new ri(t,t,1):void 0}}function Ma(s,t,i,a){return typeof s=="number"&&s>=0&&s<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof i=="number"&&i>=0&&i<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[s,t,i,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[s,t,i,a]:[s,t,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function vr(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof ri||s instanceof Kt||s instanceof Pa||s instanceof ti||s instanceof In||s instanceof Kr||s instanceof An||s instanceof Wn||s instanceof ui)return!0;if(Array.isArray(s)){for(const t of s)if(!vr(t))return!1;return!0}if(typeof s=="object"){for(const t in s)if(!vr(s[t]))return!1;return!0}return!1}function Nr(s){if(s===null)return Mt;if(typeof s=="string")return St;if(typeof s=="boolean")return kt;if(typeof s=="number")return Ve;if(s instanceof Kt)return Pr;if(s instanceof ri)return Rr;if(s instanceof Pa)return Fs;if(s instanceof ti)return so;if(s instanceof In)return gs;if(s instanceof Kr)return ji;if(s instanceof An)return oo;if(s instanceof Wn)return Or;if(s instanceof ui)return _s;if(Array.isArray(s)){const t=s.length;let i;for(const a of s){const h=Nr(a);if(i){if(i===h)continue;i=Ft;break}i=h}return Hn(i||Ft,t)}return hn}function ir(s){const t=typeof s;return s===null?"":t==="string"||t==="number"||t==="boolean"?String(s):s instanceof Kt||s instanceof ri||s instanceof ti||s instanceof In||s instanceof Kr||s instanceof An||s instanceof Wn||s instanceof ui?s.toString():JSON.stringify(s)}class jt{constructor(t,i){this.type=t,this.value=i}static parse(t,i){if(t.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!vr(t[1]))return i.error("invalid value");const a=t[1];let h=Nr(a);const m=i.expectedType;return h.kind!=="array"||h.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(h=m),new jt(h,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Do={string:St,number:Ve,boolean:kt,object:hn};class Vt{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let a,h=1;const m=t[0];if(m==="array"){let v,T;if(t.length>2){const C=t[1];if(typeof C!="string"||!(C in Do)||C==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);v=Do[C],h++}else v=Ft;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return i.error('The length argument to "array" must be a positive integer literal',2);T=t[2],h++}a=Hn(v,T)}else{if(!Do[m])throw new Error(`Types doesn't contain name = ${m}`);a=Do[m]}const g=[];for(;h<t.length;h++){const v=i.parse(t[h],h,Ft);if(!v)return null;g.push(v)}return new Vt(a,g)}evaluate(t){for(let i=0;i<this.args.length;i++){const a=this.args[i].evaluate(t);if(!Bs(this.type,Nr(a)))return a;if(i===this.args.length-1)throw new kr(`Expected value to be of type ${Cr(this.type)}, but found ${Cr(Nr(a))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const kl={"to-boolean":kt,"to-color":Pr,"to-number":Ve,"to-string":St};class Bn{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");const a=t[0];if(!kl[a])throw new Error(`Can't parse ${a} as it is not part of the known types`);if((a==="to-boolean"||a==="to-string")&&t.length!==2)return i.error("Expected one argument.");const h=kl[a],m=[];for(let g=1;g<t.length;g++){const v=i.parse(t[g],g,Ft);if(!v)return null;m.push(v)}return new Bn(h,m)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let i,a;for(const h of this.args){if(i=h.evaluate(t),a=null,i instanceof Kt)return i;if(typeof i=="string"){const m=t.parseColor(i);if(m)return m}else if(Array.isArray(i)&&(a=i.length<3||i.length>4?`Invalid rgba value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Ma(i[0],i[1],i[2],i[3]),!a))return new Kt(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new kr(a||`Could not parse color from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"padding":{let i;for(const a of this.args){i=a.evaluate(t);const h=In.parse(i);if(h)return h}throw new kr(`Could not parse padding from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"numberArray":{let i;for(const a of this.args){i=a.evaluate(t);const h=Kr.parse(i);if(h)return h}throw new kr(`Could not parse numberArray from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"colorArray":{let i;for(const a of this.args){i=a.evaluate(t);const h=An.parse(i);if(h)return h}throw new kr(`Could not parse colorArray from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"variableAnchorOffsetCollection":{let i;for(const a of this.args){i=a.evaluate(t);const h=Wn.parse(i);if(h)return h}throw new kr(`Could not parse variableAnchorOffsetCollection from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"number":{let i=null;for(const a of this.args){if(i=a.evaluate(t),i===null)return 0;const h=Number(i);if(!isNaN(h))return h}throw new kr(`Could not convert ${JSON.stringify(i)} to number.`)}case"formatted":return ti.fromString(ir(this.args[0].evaluate(t)));case"resolvedImage":return ui.fromString(ir(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return ir(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const au=["Unknown","Point","LineString","Polygon"];class lu{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?au[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let i=this._parseColorCache.get(t);return i||(i=Kt.parse(t),this._parseColorCache.set(t,i)),i}}class ka{constructor(t,i,a=[],h,m=new tr,g=[]){this.registry=t,this.path=a,this.key=a.map(v=>`[${v}]`).join(""),this.scope=m,this.errors=g,this.expectedType=h,this._isConstant=i}parse(t,i,a,h,m={}){return i?this.concat(i,a,h)._parse(t,m):this._parse(t,m)}_parse(t,i){function a(h,m,g){return g==="assert"?new Vt(m,[h]):g==="coerce"?new Bn(m,[h]):h}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=t[0];if(typeof h!="string")return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[h];if(m){let g=m.parse(t,this);if(!g)return null;if(this.expectedType){const v=this.expectedType,T=g.type;if(v.kind!=="string"&&v.kind!=="number"&&v.kind!=="boolean"&&v.kind!=="object"&&v.kind!=="array"||T.kind!=="value"){if(v.kind==="projectionDefinition"&&["string","array"].includes(T.kind)||["color","formatted","resolvedImage"].includes(v.kind)&&["value","string"].includes(T.kind)||["padding","numberArray"].includes(v.kind)&&["value","number","array"].includes(T.kind)||v.kind==="colorArray"&&["value","string","array"].includes(T.kind)||v.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(T.kind))g=a(g,v,i.typeAnnotation||"coerce");else if(this.checkSubtype(v,T))return null}else g=a(g,v,i.typeAnnotation||"assert")}if(!(g instanceof jt)&&g.type.kind!=="resolvedImage"&&this._isConstant(g)){const v=new lu;try{g=new jt(g.type,g.evaluate(v))}catch(T){return this.error(T.message),null}}return g}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,i,a){const h=typeof t=="number"?this.path.concat(t):this.path,m=a?this.scope.concat(a):this.scope;return new ka(this.registry,this._isConstant,h,i||null,m,this.errors)}error(t,...i){const a=`${this.key}${i.map(h=>`[${h}]`).join("")}`;this.errors.push(new qt(a,t))}checkSubtype(t,i){const a=Bs(t,i);return a&&this.error(a),a}}class Lo{constructor(t,i){this.type=i.type,this.bindings=[].concat(t),this.result=i}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const i of this.bindings)t(i[1]);t(this.result)}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const a=[];for(let m=1;m<t.length-1;m+=2){const g=t[m];if(typeof g!="string")return i.error(`Expected string, but found ${typeof g} instead.`,m);if(/[^a-zA-Z0-9_]/.test(g))return i.error("Variable names must contain only alphanumeric characters or '_'.",m);const v=i.parse(t[m+1],m+1);if(!v)return null;a.push([g,v])}const h=i.parse(t[t.length-1],t.length-1,i.expectedType,a);return h?new Lo(a,h):null}outputDefined(){return this.result.outputDefined()}}class Ea{constructor(t,i){this.type=i.type,this.name=t,this.boundExpression=i}static parse(t,i){if(t.length!==2||typeof t[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const a=t[1];return i.scope.has(a)?new Ea(a,i.scope.get(a)):i.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class cu{constructor(t,i,a){this.type=t,this.index=i,this.input=a}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const a=i.parse(t[1],1,Ve),h=i.parse(t[2],2,Hn(i.expectedType||Ft));return a&&h?new cu(h.type.itemType,a,h):null}evaluate(t){const i=this.index.evaluate(t),a=this.input.evaluate(t);if(i<0)throw new kr(`Array index out of bounds: ${i} < 0.`);if(i>=a.length)throw new kr(`Array index out of bounds: ${i} > ${a.length-1}.`);if(i!==Math.floor(i))throw new kr(`Array index must be an integer, but found ${i} instead.`);return a[i]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class El{constructor(t,i){this.type=kt,this.needle=t,this.haystack=i}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const a=i.parse(t[1],1,Ft),h=i.parse(t[2],2,Ft);return a&&h?Ta(a.type,[kt,St,Ve,Mt,Ft])?new El(a,h):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Cr(a.type)} instead`):null}evaluate(t){const i=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!a)return!1;if(!ys(i,["boolean","string","number","null"]))throw new kr(`Expected first argument to be of type boolean, string, number or null, but found ${Cr(Nr(i))} instead.`);if(!ys(a,["string","array"]))throw new kr(`Expected second argument to be of type array or string, but found ${Cr(Nr(a))} instead.`);return a.indexOf(i)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class Ia{constructor(t,i,a){this.type=Ve,this.needle=t,this.haystack=i,this.fromIndex=a}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const a=i.parse(t[1],1,Ft),h=i.parse(t[2],2,Ft);if(!a||!h)return null;if(!Ta(a.type,[kt,St,Ve,Mt,Ft]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Cr(a.type)} instead`);if(t.length===4){const m=i.parse(t[3],3,Ve);return m?new Ia(a,h,m):null}return new Ia(a,h)}evaluate(t){const i=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!ys(i,["boolean","string","number","null"]))throw new kr(`Expected first argument to be of type boolean, string, number or null, but found ${Cr(Nr(i))} instead.`);let h;if(this.fromIndex&&(h=this.fromIndex.evaluate(t)),ys(a,["string"])){const m=a.indexOf(i,h);return m===-1?-1:[...a.slice(0,m)].length}if(ys(a,["array"]))return a.indexOf(i,h);throw new kr(`Expected second argument to be of type array or string, but found ${Cr(Nr(a))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class lo{constructor(t,i,a,h,m,g){this.inputType=t,this.type=i,this.input=a,this.cases=h,this.outputs=m,this.otherwise=g}static parse(t,i){if(t.length<5)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return i.error("Expected an even number of arguments.");let a,h;i.expectedType&&i.expectedType.kind!=="value"&&(h=i.expectedType);const m={},g=[];for(let C=2;C<t.length-1;C+=2){let k=t[C];const I=t[C+1];Array.isArray(k)||(k=[k]);const D=i.concat(C);if(k.length===0)return D.error("Expected at least one branch label.");for(const F of k){if(typeof F!="number"&&typeof F!="string")return D.error("Branch labels must be numbers or strings.");if(typeof F=="number"&&Math.abs(F)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof F=="number"&&Math.floor(F)!==F)return D.error("Numeric branch labels must be integer values.");if(a){if(D.checkSubtype(a,Nr(F)))return null}else a=Nr(F);if(m[String(F)]!==void 0)return D.error("Branch labels must be unique.");m[String(F)]=g.length}const j=i.parse(I,C,h);if(!j)return null;h=h||j.type,g.push(j)}const v=i.parse(t[1],1,Ft);if(!v)return null;const T=i.parse(t[t.length-1],t.length-1,h);return T?v.type.kind!=="value"&&i.concat(1).checkSubtype(a,v.type)?null:new lo(a,h,v,m,g,T):null}evaluate(t){const i=this.input.evaluate(t);return(Nr(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class xn{constructor(t,i,a){this.type=t,this.branches=i,this.otherwise=a}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return i.error("Expected an odd number of arguments.");let a;i.expectedType&&i.expectedType.kind!=="value"&&(a=i.expectedType);const h=[];for(let g=1;g<t.length-1;g+=2){const v=i.parse(t[g],g,kt);if(!v)return null;const T=i.parse(t[g+1],g+1,a);if(!T)return null;h.push([v,T]),a=a||T.type}const m=i.parse(t[t.length-1],t.length-1,a);if(!m)return null;if(!a)throw new Error("Can't infer output type");return new xn(a,h,m)}evaluate(t){for(const[i,a]of this.branches)if(i.evaluate(t))return a.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[i,a]of this.branches)t(i),t(a);t(this.otherwise)}outputDefined(){return this.branches.every(([t,i])=>i.outputDefined())&&this.otherwise.outputDefined()}}class co{constructor(t,i,a,h){this.type=t,this.input=i,this.beginIndex=a,this.endIndex=h}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const a=i.parse(t[1],1,Ft),h=i.parse(t[2],2,Ve);if(!a||!h)return null;if(!Ta(a.type,[Hn(Ft),St,Ft]))return i.error(`Expected first argument to be of type array or string, but found ${Cr(a.type)} instead`);if(t.length===4){const m=i.parse(t[3],3,Ve);return m?new co(a.type,a,h,m):null}return new co(a.type,a,h)}evaluate(t){const i=this.input.evaluate(t),a=this.beginIndex.evaluate(t);let h;if(this.endIndex&&(h=this.endIndex.evaluate(t)),ys(i,["string"]))return[...i].slice(a,h).join("");if(ys(i,["array"]))return i.slice(a,h);throw new kr(`Expected first argument to be of type array or string, but found ${Cr(Nr(i))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Aa(s,t){const i=s.length-1;let a,h,m=0,g=i,v=0;for(;m<=g;)if(v=Math.floor((m+g)/2),a=s[v],h=s[v+1],a<=t){if(v===i||t<h)return v;m=v+1}else{if(!(a>t))throw new kr("Input is not a number.");g=v-1}return 0}class Os{constructor(t,i,a){this.type=t,this.input=i,this.labels=[],this.outputs=[];for(const[h,m]of a)this.labels.push(h),this.outputs.push(m)}static parse(t,i){if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");const a=i.parse(t[1],1,Ve);if(!a)return null;const h=[];let m=null;i.expectedType&&i.expectedType.kind!=="value"&&(m=i.expectedType);for(let g=1;g<t.length;g+=2){const v=g===1?-1/0:t[g],T=t[g+1],C=g,k=g+1;if(typeof v!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(h.length&&h[h.length-1][0]>=v)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',C);const I=i.parse(T,k,m);if(!I)return null;m=m||I.type,h.push([v,I])}return new Os(m,a,h)}evaluate(t){const i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(t);const h=this.input.evaluate(t);if(h<=i[0])return a[0].evaluate(t);const m=i.length;return h>=i[m-1]?a[m-1].evaluate(t):a[Aa(i,h)].evaluate(t)}eachChild(t){t(this.input);for(const i of this.outputs)t(i)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function bn(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var Il,Al,ad=function(){if(Al)return Il;function s(t,i,a,h){this.cx=3*t,this.bx=3*(a-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(h-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=i,this.p2x=a,this.p2y=h}return Al=1,Il=s,s.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,i){if(i===void 0&&(i=1e-6),t<0)return 0;if(t>1)return 1;for(var a=t,h=0;h<8;h++){var m=this.sampleCurveX(a)-t;if(Math.abs(m)<i)return a;var g=this.sampleCurveDerivativeX(a);if(Math.abs(g)<1e-6)break;a-=m/g}var v=0,T=1;for(a=t,h=0;h<20&&(m=this.sampleCurveX(a),!(Math.abs(m-t)<i));h++)t>m?v=a:T=a,a=.5*(T-v)+v;return a},solve:function(t,i){return this.sampleCurveY(this.solveCurveX(t,i))}},Il}(),Of=bn(ad);class On{constructor(t,i,a,h,m){this.type=t,this.operator=i,this.interpolation=a,this.input=h,this.labels=[],this.outputs=[];for(const[g,v]of m)this.labels.push(g),this.outputs.push(v)}static interpolationFactor(t,i,a,h){let m=0;if(t.name==="exponential")m=za(i,t.base,a,h);else if(t.name==="linear")m=za(i,1,a,h);else if(t.name==="cubic-bezier"){const g=t.controlPoints;m=new Of(g[0],g[1],g[2],g[3]).solve(za(i,1,a,h))}return m}static parse(t,i){let[a,h,m,...g]=t;if(!Array.isArray(h)||h.length===0)return i.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const C=h[1];if(typeof C!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:C}}else{if(h[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const C=h.slice(1);if(C.length!==4||C.some(k=>typeof k!="number"||k<0||k>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:C}}}if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(m=i.parse(m,2,Ve),!m)return null;const v=[];let T=null;a!=="interpolate-hcl"&&a!=="interpolate-lab"||i.expectedType==oo?i.expectedType&&i.expectedType.kind!=="value"&&(T=i.expectedType):T=Pr;for(let C=0;C<g.length;C+=2){const k=g[C],I=g[C+1],D=C+3,j=C+4;if(typeof k!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(v.length&&v[v.length-1][0]>=k)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);const F=i.parse(I,j,T);if(!F)return null;T=T||F.type,v.push([k,F])}return Fi(T,Ve)||Fi(T,Rr)||Fi(T,Pr)||Fi(T,gs)||Fi(T,ji)||Fi(T,oo)||Fi(T,Or)||Fi(T,Hn(Ve))?new On(T,a,h,m,v):i.error(`Type ${Cr(T)} is not interpolatable.`)}evaluate(t){const i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(t);const h=this.input.evaluate(t);if(h<=i[0])return a[0].evaluate(t);const m=i.length;if(h>=i[m-1])return a[m-1].evaluate(t);const g=Aa(i,h),v=On.interpolationFactor(this.interpolation,h,i[g],i[g+1]),T=a[g].evaluate(t),C=a[g+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return vn(T,C,v);case"color":return Kt.interpolate(T,C,v);case"padding":return In.interpolate(T,C,v);case"colorArray":return An.interpolate(T,C,v);case"numberArray":return Kr.interpolate(T,C,v);case"variableAnchorOffsetCollection":return Wn.interpolate(T,C,v);case"array":return rs(T,C,v);case"projectionDefinition":return ri.interpolate(T,C,v)}case"interpolate-hcl":switch(this.type.kind){case"color":return Kt.interpolate(T,C,v,"hcl");case"colorArray":return An.interpolate(T,C,v,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Kt.interpolate(T,C,v,"lab");case"colorArray":return An.interpolate(T,C,v,"lab")}}}eachChild(t){t(this.input);for(const i of this.outputs)t(i)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function za(s,t,i,a){const h=a-i,m=s-i;return h===0?0:t===1?m/h:(Math.pow(t,m)-1)/(Math.pow(t,h)-1)}const ns={color:Kt.interpolate,number:vn,padding:In.interpolate,numberArray:Kr.interpolate,colorArray:An.interpolate,variableAnchorOffsetCollection:Wn.interpolate,array:rs};class uo{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let a=null;const h=i.expectedType;h&&h.kind!=="value"&&(a=h);const m=[];for(const v of t.slice(1)){const T=i.parse(v,1+m.length,a,void 0,{typeAnnotation:"omit"});if(!T)return null;a=a||T.type,m.push(T)}if(!a)throw new Error("No output type");const g=h&&m.some(v=>Bs(h,v.type));return new uo(g?Ft:a,m)}evaluate(t){let i,a=null,h=0;for(const m of this.args)if(h++,a=m.evaluate(t),a&&a instanceof ui&&!a.available&&(i||(i=a.name),a=null,h===this.args.length&&(a=i)),a!==null)break;return a}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function Ra(s,t){return s==="=="||s==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function bi(s,t,i,a){return a.compare(t,i)===0}function ho(s,t,i){const a=s!=="=="&&s!=="!=";return class Sw{constructor(m,g,v){this.type=kt,this.lhs=m,this.rhs=g,this.collator=v,this.hasUntypedArgument=m.type.kind==="value"||g.type.kind==="value"}static parse(m,g){if(m.length!==3&&m.length!==4)return g.error("Expected two or three arguments.");const v=m[0];let T=g.parse(m[1],1,Ft);if(!T)return null;if(!Ra(v,T.type))return g.concat(1).error(`"${v}" comparisons are not supported for type '${Cr(T.type)}'.`);let C=g.parse(m[2],2,Ft);if(!C)return null;if(!Ra(v,C.type))return g.concat(2).error(`"${v}" comparisons are not supported for type '${Cr(C.type)}'.`);if(T.type.kind!==C.type.kind&&T.type.kind!=="value"&&C.type.kind!=="value")return g.error(`Cannot compare types '${Cr(T.type)}' and '${Cr(C.type)}'.`);a&&(T.type.kind==="value"&&C.type.kind!=="value"?T=new Vt(C.type,[T]):T.type.kind!=="value"&&C.type.kind==="value"&&(C=new Vt(T.type,[C])));let k=null;if(m.length===4){if(T.type.kind!=="string"&&C.type.kind!=="string"&&T.type.kind!=="value"&&C.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(k=g.parse(m[3],3,Fs),!k)return null}return new Sw(T,C,k)}evaluate(m){const g=this.lhs.evaluate(m),v=this.rhs.evaluate(m);if(a&&this.hasUntypedArgument){const T=Nr(g),C=Nr(v);if(T.kind!==C.kind||T.kind!=="string"&&T.kind!=="number")throw new kr(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${T.kind}, ${C.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const T=Nr(g),C=Nr(v);if(T.kind!=="string"||C.kind!=="string")return t(m,g,v)}return this.collator?i(m,g,v,this.collator.evaluate(m)):t(m,g,v)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}}}const zl=ho("==",function(s,t,i){return t===i},bi),Nf=ho("!=",function(s,t,i){return t!==i},function(s,t,i,a){return!bi(0,t,i,a)}),uu=ho("<",function(s,t,i){return t<i},function(s,t,i,a){return a.compare(t,i)<0}),Vf=ho(">",function(s,t,i){return t>i},function(s,t,i,a){return a.compare(t,i)>0}),$f=ho("<=",function(s,t,i){return t<=i},function(s,t,i,a){return a.compare(t,i)<=0}),Uf=ho(">=",function(s,t,i){return t>=i},function(s,t,i,a){return a.compare(t,i)>=0});class Rl{constructor(t,i,a){this.type=Fs,this.locale=a,this.caseSensitive=t,this.diacriticSensitive=i}static parse(t,i){if(t.length!==2)return i.error("Expected one argument.");const a=t[1];if(typeof a!="object"||Array.isArray(a))return i.error("Collator options argument must be an object.");const h=i.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,kt);if(!h)return null;const m=i.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,kt);if(!m)return null;let g=null;return a.locale&&(g=i.parse(a.locale,1,St),!g)?null:new Rl(h,m,g)}evaluate(t){return new Pa(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class jo{constructor(t,i,a,h,m){this.type=St,this.number=t,this.locale=i,this.currency=a,this.minFractionDigits=h,this.maxFractionDigits=m}static parse(t,i){if(t.length!==3)return i.error("Expected two arguments.");const a=i.parse(t[1],1,Ve);if(!a)return null;const h=t[2];if(typeof h!="object"||Array.isArray(h))return i.error("NumberFormat options argument must be an object.");let m=null;if(h.locale&&(m=i.parse(h.locale,1,St),!m))return null;let g=null;if(h.currency&&(g=i.parse(h.currency,1,St),!g))return null;let v=null;if(h["min-fraction-digits"]&&(v=i.parse(h["min-fraction-digits"],1,Ve),!v))return null;let T=null;return h["max-fraction-digits"]&&(T=i.parse(h["max-fraction-digits"],1,Ve),!T)?null:new jo(a,m,g,v,T)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Dl{constructor(t){this.type=so,this.sections=t}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");const a=t[1];if(!Array.isArray(a)&&typeof a=="object")return i.error("First argument must be an image or text section.");const h=[];let m=!1;for(let g=1;g<=t.length-1;++g){const v=t[g];if(m&&typeof v=="object"&&!Array.isArray(v)){m=!1;let T=null;if(v["font-scale"]&&(T=i.parse(v["font-scale"],1,Ve),!T))return null;let C=null;if(v["text-font"]&&(C=i.parse(v["text-font"],1,Hn(St)),!C))return null;let k=null;if(v["text-color"]&&(k=i.parse(v["text-color"],1,Pr),!k))return null;let I=null;if(v["vertical-align"]){if(typeof v["vertical-align"]=="string"&&!Ca.includes(v["vertical-align"]))return i.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${v["vertical-align"]}' instead.`);if(I=i.parse(v["vertical-align"],1,St),!I)return null}const D=h[h.length-1];D.scale=T,D.font=C,D.textColor=k,D.verticalAlign=I}else{const T=i.parse(t[g],1,Ft);if(!T)return null;const C=T.type.kind;if(C!=="string"&&C!=="value"&&C!=="null"&&C!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,h.push({content:T,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Dl(h)}evaluate(t){return new ti(this.sections.map(i=>{const a=i.content.evaluate(t);return Nr(a)===_s?new zo("",a,null,null,null,i.verticalAlign?i.verticalAlign.evaluate(t):null):new zo(ir(a),null,i.scale?i.scale.evaluate(t):null,i.font?i.font.evaluate(t).join(","):null,i.textColor?i.textColor.evaluate(t):null,i.verticalAlign?i.verticalAlign.evaluate(t):null)}))}eachChild(t){for(const i of this.sections)t(i.content),i.scale&&t(i.scale),i.font&&t(i.font),i.textColor&&t(i.textColor),i.verticalAlign&&t(i.verticalAlign)}outputDefined(){return!1}}class Ll{constructor(t){this.type=_s,this.input=t}static parse(t,i){if(t.length!==2)return i.error("Expected two arguments.");const a=i.parse(t[1],1,St);return a?new Ll(a):i.error("No image name provided.")}evaluate(t){const i=this.input.evaluate(t),a=ui.fromString(i);return a&&t.availableImages&&(a.available=t.availableImages.indexOf(i)>-1),a}eachChild(t){t(this.input)}outputDefined(){return!1}}class jl{constructor(t){this.type=Ve,this.input=t}static parse(t,i){if(t.length!==2)return i.error(`Expected 1 argument, but found ${t.length-1} instead.`);const a=i.parse(t[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Cr(a.type)} instead.`):new jl(a):null}evaluate(t){const i=this.input.evaluate(t);if(typeof i=="string")return[...i].length;if(Array.isArray(i))return i.length;throw new kr(`Expected value to be of type string or array, but found ${Cr(Nr(i))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const is=8192;function ld(s,t){const i=(180+s[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,h=Math.pow(2,t.z);return[Math.round(i*h*is),Math.round(a*h*is)]}function hu(s,t){const i=Math.pow(2,t.z);return[(h=(s[0]/is+t.x)/i,360*h-180),(a=(s[1]/is+t.y)/i,360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90)];var a,h}function Da(s,t){s[0]=Math.min(s[0],t[0]),s[1]=Math.min(s[1],t[1]),s[2]=Math.max(s[2],t[0]),s[3]=Math.max(s[3],t[1])}function La(s,t){return!(s[0]<=t[0]||s[2]>=t[2]||s[1]<=t[1]||s[3]>=t[3])}function Zf(s,t,i){const a=s[0]-t[0],h=s[1]-t[1],m=s[0]-i[0],g=s[1]-i[1];return a*g-m*h==0&&a*m<=0&&h*g<=0}function Fl(s,t,i,a){return(h=[a[0]-i[0],a[1]-i[1]])[0]*(m=[t[0]-s[0],t[1]-s[1]])[1]-h[1]*m[0]!=0&&!(!dd(s,t,i,a)||!dd(i,a,s,t));var h,m}function cd(s,t,i){for(const a of i)for(let h=0;h<a.length-1;++h)if(Fl(s,t,a[h],a[h+1]))return!0;return!1}function po(s,t,i=!1){let a=!1;for(const v of t)for(let T=0;T<v.length-1;T++){if(Zf(s,v[T],v[T+1]))return i;(m=v[T])[1]>(h=s)[1]!=(g=v[T+1])[1]>h[1]&&h[0]<(g[0]-m[0])*(h[1]-m[1])/(g[1]-m[1])+m[0]&&(a=!a)}var h,m,g;return a}function ud(s,t){for(const i of t)if(po(s,i))return!0;return!1}function hd(s,t){for(const i of s)if(!po(i,t))return!1;for(let i=0;i<s.length-1;++i)if(cd(s[i],s[i+1],t))return!1;return!0}function Gf(s,t){for(const i of t)if(hd(s,i))return!0;return!1}function dd(s,t,i,a){const h=a[0]-i[0],m=a[1]-i[1],g=(s[0]-i[0])*m-h*(s[1]-i[1]),v=(t[0]-i[0])*m-h*(t[1]-i[1]);return g>0&&v<0||g<0&&v>0}function ja(s,t,i){const a=[];for(let h=0;h<s.length;h++){const m=[];for(let g=0;g<s[h].length;g++){const v=ld(s[h][g],i);Da(t,v),m.push(v)}a.push(m)}return a}function pd(s,t,i){const a=[];for(let h=0;h<s.length;h++){const m=ja(s[h],t,i);a.push(m)}return a}function fd(s,t,i,a){if(s[0]<i[0]||s[0]>i[2]){const h=.5*a;let m=s[0]-i[0]>h?-a:i[0]-s[0]>h?a:0;m===0&&(m=s[0]-i[2]>h?-a:i[2]-s[0]>h?a:0),s[0]+=m}Da(t,s)}function md(s,t,i,a){const h=Math.pow(2,a.z)*is,m=[a.x*is,a.y*is],g=[];for(const v of s)for(const T of v){const C=[T.x+m[0],T.y+m[1]];fd(C,t,i,h),g.push(C)}return g}function du(s,t,i,a){const h=Math.pow(2,a.z)*is,m=[a.x*is,a.y*is],g=[];for(const T of s){const C=[];for(const k of T){const I=[k.x+m[0],k.y+m[1]];Da(t,I),C.push(I)}g.push(C)}if(t[2]-t[0]<=h/2){(v=t)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const T of g)for(const C of T)fd(C,t,i,h)}var v;return g}class Ns{constructor(t,i){this.type=kt,this.geojson=t,this.geometries=i}static parse(t,i){if(t.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(vr(t[1])){const a=t[1];if(a.type==="FeatureCollection"){const h=[];for(const m of a.features){const{type:g,coordinates:v}=m.geometry;g==="Polygon"&&h.push(v),g==="MultiPolygon"&&h.push(...v)}if(h.length)return new Ns(a,{type:"MultiPolygon",coordinates:h})}else if(a.type==="Feature"){const h=a.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Ns(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new Ns(a,a)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(i,a){const h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if(a.type==="Polygon"){const v=ja(a.coordinates,m,g),T=md(i.geometry(),h,m,g);if(!La(h,m))return!1;for(const C of T)if(!po(C,v))return!1}if(a.type==="MultiPolygon"){const v=pd(a.coordinates,m,g),T=md(i.geometry(),h,m,g);if(!La(h,m))return!1;for(const C of T)if(!ud(C,v))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(i,a){const h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if(a.type==="Polygon"){const v=ja(a.coordinates,m,g),T=du(i.geometry(),h,m,g);if(!La(h,m))return!1;for(const C of T)if(!hd(C,v))return!1}if(a.type==="MultiPolygon"){const v=pd(a.coordinates,m,g),T=du(i.geometry(),h,m,g);if(!La(h,m))return!1;for(const C of T)if(!Gf(C,v))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let gd=class{constructor(s=[],t=(i,a)=>i<a?-1:i>a?1:0){if(this.data=s,this.length=this.data.length,this.compare=t,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(s){this.data.push(s),this._up(this.length++)}pop(){if(this.length===0)return;const s=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),s}peek(){return this.data[0]}_up(s){const{data:t,compare:i}=this,a=t[s];for(;s>0;){const h=s-1>>1,m=t[h];if(i(a,m)>=0)break;t[s]=m,s=h}t[s]=a}_down(s){const{data:t,compare:i}=this,a=this.length>>1,h=t[s];for(;s<a;){let m=1+(s<<1);const g=m+1;if(g<this.length&&i(t[g],t[m])<0&&(m=g),i(t[m],h)>=0)break;t[s]=t[m],s=m}t[s]=h}};function _d(s,t,i=0,a=s.length-1,h=yd){for(;a>i;){if(a-i>600){const T=a-i+1,C=t-i+1,k=Math.log(T),I=.5*Math.exp(2*k/3),D=.5*Math.sqrt(k*I*(T-I)/T)*(C-T/2<0?-1:1);_d(s,t,Math.max(i,Math.floor(t-C*I/T+D)),Math.min(a,Math.floor(t+(T-C)*I/T+D)),h)}const m=s[t];let g=i,v=a;for(Fo(s,i,t),h(s[a],m)>0&&Fo(s,i,a);g<v;){for(Fo(s,g,v),g++,v--;h(s[g],m)<0;)g++;for(;h(s[v],m)>0;)v--}h(s[i],m)===0?Fo(s,i,v):(v++,Fo(s,v,a)),v<=t&&(i=v+1),t<=v&&(a=v-1)}}function Fo(s,t,i){const a=s[t];s[t]=s[i],s[i]=a}function yd(s,t){return s<t?-1:s>t?1:0}function Bl(s,t){if(s.length<=1)return[s];const i=[];let a,h;for(const m of s){const g=Hf(m);g!==0&&(m.area=Math.abs(g),h===void 0&&(h=g<0),h===g<0?(a&&i.push(a),a=[m]):a.push(m))}if(a&&i.push(a),t>1)for(let m=0;m<i.length;m++)i[m].length<=t||(_d(i[m],t,1,i[m].length-1,qf),i[m]=i[m].slice(0,t));return i}function qf(s,t){return t.area-s.area}function Hf(s){let t=0;for(let i,a,h=0,m=s.length,g=m-1;h<m;g=h++)i=s[h],a=s[g],t+=(a.x-i.x)*(i.y+a.y);return t}const pu=1/298.257223563,vd=pu*(2-pu),xd=Math.PI/180;class fu{constructor(t){const i=6378.137*xd*1e3,a=Math.cos(t*xd),h=1/(1-vd*(1-a*a)),m=Math.sqrt(h);this.kx=i*m*a,this.ky=i*m*h*(1-vd)}distance(t,i){const a=this.wrap(t[0]-i[0])*this.kx,h=(t[1]-i[1])*this.ky;return Math.sqrt(a*a+h*h)}pointOnLine(t,i){let a,h,m,g,v=1/0;for(let T=0;T<t.length-1;T++){let C=t[T][0],k=t[T][1],I=this.wrap(t[T+1][0]-C)*this.kx,D=(t[T+1][1]-k)*this.ky,j=0;I===0&&D===0||(j=(this.wrap(i[0]-C)*this.kx*I+(i[1]-k)*this.ky*D)/(I*I+D*D),j>1?(C=t[T+1][0],k=t[T+1][1]):j>0&&(C+=I/this.kx*j,k+=D/this.ky*j)),I=this.wrap(i[0]-C)*this.kx,D=(i[1]-k)*this.ky;const F=I*I+D*D;F<v&&(v=F,a=C,h=k,m=T,g=j)}return{point:[a,h],index:m,t:Math.max(0,Math.min(1,g))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function bd(s,t){return t[0]-s[0]}function lr(s){return s[1]-s[0]+1}function xs(s,t){return s[1]>=s[0]&&s[1]<t}function mu(s,t){if(s[0]>s[1])return[null,null];const i=lr(s);if(t){if(i===2)return[s,null];const h=Math.floor(i/2);return[[s[0],s[0]+h],[s[0]+h,s[1]]]}if(i===1)return[s,null];const a=Math.floor(i/2)-1;return[[s[0],s[0]+a],[s[0]+a+1,s[1]]]}function gu(s,t){if(!xs(t,s.length))return[1/0,1/0,-1/0,-1/0];const i=[1/0,1/0,-1/0,-1/0];for(let a=t[0];a<=t[1];++a)Da(i,s[a]);return i}function _u(s){const t=[1/0,1/0,-1/0,-1/0];for(const i of s)for(const a of i)Da(t,a);return t}function wd(s){return s[0]!==-1/0&&s[1]!==-1/0&&s[2]!==1/0&&s[3]!==1/0}function yu(s,t,i){if(!wd(s)||!wd(t))return NaN;let a=0,h=0;return s[2]<t[0]&&(a=t[0]-s[2]),s[0]>t[2]&&(a=s[0]-t[2]),s[1]>t[3]&&(h=s[1]-t[3]),s[3]<t[1]&&(h=t[1]-s[3]),i.distance([0,0],[a,h])}function fo(s,t,i){const a=i.pointOnLine(t,s);return i.distance(s,a.point)}function vu(s,t,i,a,h){const m=Math.min(fo(s,[i,a],h),fo(t,[i,a],h)),g=Math.min(fo(i,[s,t],h),fo(a,[s,t],h));return Math.min(m,g)}function Wf(s,t,i,a,h){if(!xs(t,s.length)||!xs(a,i.length))return 1/0;let m=1/0;for(let g=t[0];g<t[1];++g){const v=s[g],T=s[g+1];for(let C=a[0];C<a[1];++C){const k=i[C],I=i[C+1];if(Fl(v,T,k,I))return 0;m=Math.min(m,vu(v,T,k,I,h))}}return m}function Xf(s,t,i,a,h){if(!xs(t,s.length)||!xs(a,i.length))return NaN;let m=1/0;for(let g=t[0];g<=t[1];++g)for(let v=a[0];v<=a[1];++v)if(m=Math.min(m,h.distance(s[g],i[v])),m===0)return m;return m}function Kf(s,t,i){if(po(s,t,!0))return 0;let a=1/0;for(const h of t){const m=h[0],g=h[h.length-1];if(m!==g&&(a=Math.min(a,fo(s,[g,m],i)),a===0))return a;const v=i.pointOnLine(h,s);if(a=Math.min(a,i.distance(s,v.point)),a===0)return a}return a}function Yf(s,t,i,a){if(!xs(t,s.length))return NaN;for(let m=t[0];m<=t[1];++m)if(po(s[m],i,!0))return 0;let h=1/0;for(let m=t[0];m<t[1];++m){const g=s[m],v=s[m+1];for(const T of i)for(let C=0,k=T.length,I=k-1;C<k;I=C++){const D=T[I],j=T[C];if(Fl(g,v,D,j))return 0;h=Math.min(h,vu(g,v,D,j,a))}}return h}function Td(s,t){for(const i of s)for(const a of i)if(po(a,t,!0))return!0;return!1}function Qf(s,t,i,a=1/0){const h=_u(s),m=_u(t);if(a!==1/0&&yu(h,m,i)>=a)return a;if(La(h,m)){if(Td(s,t))return 0}else if(Td(t,s))return 0;let g=1/0;for(const v of s)for(let T=0,C=v.length,k=C-1;T<C;k=T++){const I=v[k],D=v[T];for(const j of t)for(let F=0,N=j.length,G=N-1;F<N;G=F++){const Y=j[G],he=j[F];if(Fl(I,D,Y,he))return 0;g=Math.min(g,vu(I,D,Y,he,i))}}return g}function Sd(s,t,i,a,h,m){if(!m)return;const g=yu(gu(a,m),h,i);g<t&&s.push([g,m,[0,0]])}function Ol(s,t,i,a,h,m,g){if(!m||!g)return;const v=yu(gu(a,m),gu(h,g),i);v<t&&s.push([v,m,g])}function Nl(s,t,i,a,h=1/0){let m=Math.min(a.distance(s[0],i[0][0]),h);if(m===0)return m;const g=new gd([[0,[0,s.length-1],[0,0]]],bd),v=_u(i);for(;g.length>0;){const T=g.pop();if(T[0]>=m)continue;const C=T[1],k=t?50:100;if(lr(C)<=k){if(!xs(C,s.length))return NaN;if(t){const I=Yf(s,C,i,a);if(isNaN(I)||I===0)return I;m=Math.min(m,I)}else for(let I=C[0];I<=C[1];++I){const D=Kf(s[I],i,a);if(m=Math.min(m,D),m===0)return 0}}else{const I=mu(C,t);Sd(g,m,a,s,v,I[0]),Sd(g,m,a,s,v,I[1])}}return m}function Vl(s,t,i,a,h,m=1/0){let g=Math.min(m,h.distance(s[0],i[0]));if(g===0)return g;const v=new gd([[0,[0,s.length-1],[0,i.length-1]]],bd);for(;v.length>0;){const T=v.pop();if(T[0]>=g)continue;const C=T[1],k=T[2],I=t?50:100,D=a?50:100;if(lr(C)<=I&&lr(k)<=D){if(!xs(C,s.length)&&xs(k,i.length))return NaN;let j;if(t&&a)j=Wf(s,C,i,k,h),g=Math.min(g,j);else if(t&&!a){const F=s.slice(C[0],C[1]+1);for(let N=k[0];N<=k[1];++N)if(j=fo(i[N],F,h),g=Math.min(g,j),g===0)return g}else if(!t&&a){const F=i.slice(k[0],k[1]+1);for(let N=C[0];N<=C[1];++N)if(j=fo(s[N],F,h),g=Math.min(g,j),g===0)return g}else j=Xf(s,C,i,k,h),g=Math.min(g,j)}else{const j=mu(C,t),F=mu(k,a);Ol(v,g,h,s,i,j[0],F[0]),Ol(v,g,h,s,i,j[0],F[1]),Ol(v,g,h,s,i,j[1],F[0]),Ol(v,g,h,s,i,j[1],F[1])}}return g}function xu(s){return s.type==="MultiPolygon"?s.coordinates.map(t=>({type:"Polygon",coordinates:t})):s.type==="MultiLineString"?s.coordinates.map(t=>({type:"LineString",coordinates:t})):s.type==="MultiPoint"?s.coordinates.map(t=>({type:"Point",coordinates:t})):[s]}class mo{constructor(t,i){this.type=Ve,this.geojson=t,this.geometries=i}static parse(t,i){if(t.length!==2)return i.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(vr(t[1])){const a=t[1];if(a.type==="FeatureCollection")return new mo(a,a.features.map(h=>xu(h.geometry)).flat());if(a.type==="Feature")return new mo(a,xu(a.geometry));if("type"in a&&"coordinates"in a)return new mo(a,xu(a))}return i.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(i,a){const h=i.geometry(),m=h.flat().map(T=>hu([T.x,T.y],i.canonical));if(h.length===0)return NaN;const g=new fu(m[0][1]);let v=1/0;for(const T of a){switch(T.type){case"Point":v=Math.min(v,Vl(m,!1,[T.coordinates],!1,g,v));break;case"LineString":v=Math.min(v,Vl(m,!1,T.coordinates,!0,g,v));break;case"Polygon":v=Math.min(v,Nl(m,!1,T.coordinates,g,v))}if(v===0)return v}return v}(t,this.geometries);if(t.geometryType()==="LineString")return function(i,a){const h=i.geometry(),m=h.flat().map(T=>hu([T.x,T.y],i.canonical));if(h.length===0)return NaN;const g=new fu(m[0][1]);let v=1/0;for(const T of a){switch(T.type){case"Point":v=Math.min(v,Vl(m,!0,[T.coordinates],!1,g,v));break;case"LineString":v=Math.min(v,Vl(m,!0,T.coordinates,!0,g,v));break;case"Polygon":v=Math.min(v,Nl(m,!0,T.coordinates,g,v))}if(v===0)return v}return v}(t,this.geometries);if(t.geometryType()==="Polygon")return function(i,a){const h=i.geometry();if(h.length===0||h[0].length===0)return NaN;const m=Bl(h,0).map(T=>T.map(C=>C.map(k=>hu([k.x,k.y],i.canonical)))),g=new fu(m[0][0][0][1]);let v=1/0;for(const T of a)for(const C of m){switch(T.type){case"Point":v=Math.min(v,Nl([T.coordinates],!1,C,g,v));break;case"LineString":v=Math.min(v,Nl(T.coordinates,!0,C,g,v));break;case"Polygon":v=Math.min(v,Qf(C,T.coordinates,g,v))}if(v===0)return v}return v}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class $l{constructor(t){this.type=Ft,this.key=t}static parse(t,i){if(t.length!==2)return i.error(`Expected 1 argument, but found ${t.length-1} instead.`);const a=t[1];return a==null?i.error("Global state property must be defined."):typeof a!="string"?i.error(`Global state property must be string, but found ${typeof t[1]} instead.`):new $l(a)}evaluate(t){var i;const a=(i=t.globals)===null||i===void 0?void 0:i.globalState;return a&&Object.keys(a).length!==0?Ht(a,this.key):null}eachChild(){}outputDefined(){return!1}}const Bo={"==":zl,"!=":Nf,">":Vf,"<":uu,">=":Uf,"<=":$f,array:Vt,at:cu,boolean:Vt,case:xn,coalesce:uo,collator:Rl,format:Dl,image:Ll,in:El,"index-of":Ia,interpolate:On,"interpolate-hcl":On,"interpolate-lab":On,length:jl,let:Lo,literal:jt,match:lo,number:Vt,"number-format":jo,object:Vt,slice:co,step:Os,string:Vt,"to-boolean":Bn,"to-color":Bn,"to-number":Bn,"to-string":Bn,var:Ea,within:Ns,distance:mo,"global-state":$l};class wi{constructor(t,i,a,h){this.name=t,this.type=i,this._evaluate=a,this.args=h}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,i){const a=t[0],h=wi.definitions[a];if(!h)return i.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(h)?h[0]:h.type,g=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,v=g.filter(([C])=>!Array.isArray(C)||C.length===t.length-1);let T=null;for(const[C,k]of v){T=new ka(i.registry,Ul,i.path,null,i.scope);const I=[];let D=!1;for(let j=1;j<t.length;j++){const F=t[j],N=Array.isArray(C)?C[j-1]:C.type,G=T.parse(F,1+I.length,N);if(!G){D=!0;break}I.push(G)}if(!D)if(Array.isArray(C)&&C.length!==I.length)T.error(`Expected ${C.length} arguments, but found ${I.length} instead.`);else{for(let j=0;j<I.length;j++){const F=Array.isArray(C)?C[j]:C.type,N=I[j];T.concat(j+1).checkSubtype(F,N.type)}if(T.errors.length===0)return new wi(a,m,k,I)}}if(v.length===1)i.errors.push(...T.errors);else{const C=(v.length?v:g).map(([I])=>{return D=I,Array.isArray(D)?`(${D.map(Cr).join(", ")})`:`(${Cr(D.type)}...)`;var D}).join(" | "),k=[];for(let I=1;I<t.length;I++){const D=i.parse(t[I],1+k.length);if(!D)return null;k.push(Cr(D.type))}i.error(`Expected arguments of type ${C}, but found (${k.join(", ")}) instead.`)}return null}static register(t,i){wi.definitions=i;for(const a in i)t[a]=wi}}function Pd(s,[t,i,a,h]){t=t.evaluate(s),i=i.evaluate(s),a=a.evaluate(s);const m=h?h.evaluate(s):1,g=Ma(t,i,a,m);if(g)throw new kr(g);return new Kt(t/255,i/255,a/255,m,!1)}function Cd(s,t){return s in t}function bu(s,t){const i=t[s];return i===void 0?null:i}function go(s){return{type:s}}function Ul(s){if(s instanceof Ea)return Ul(s.boundExpression);if(s instanceof wi&&s.name==="error"||s instanceof Rl||s instanceof Ns||s instanceof mo||s instanceof $l)return!1;const t=s instanceof Bn||s instanceof Vt;let i=!0;return s.eachChild(a=>{i=t?i&&Ul(a):i&&a instanceof jt}),!!i&&Zl(s)&&Gl(s,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Zl(s){if(s instanceof wi&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof Ns||s instanceof mo)return!1;let t=!0;return s.eachChild(i=>{t&&!Zl(i)&&(t=!1)}),t}function Fa(s){if(s instanceof wi&&s.name==="feature-state")return!1;let t=!0;return s.eachChild(i=>{t&&!Fa(i)&&(t=!1)}),t}function Gl(s,t){if(s instanceof wi&&t.indexOf(s.name)>=0)return!1;let i=!0;return s.eachChild(a=>{i&&!Gl(a,t)&&(i=!1)}),i}function ql(s){return{result:"success",value:s}}function Oo(s){return{result:"error",value:s}}function No(s){return s["property-type"]==="data-driven"||s["property-type"]==="cross-faded-data-driven"}function Md(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function Hl(s){return!!s.expression&&s.expression.interpolated}function Qt(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}function Wl(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)&&Nr(s)===hn}function Xl(s){return s}function wu(s,t){const i=s.stops&&typeof s.stops[0][0]=="object",a=i||!(i||s.property!==void 0),h=s.type||(Hl(t)?"exponential":"interval"),m=function(k){switch(k.type){case"color":return Kt.parse;case"padding":return In.parse;case"numberArray":return Kr.parse;case"colorArray":return An.parse;default:return null}}(t);if(m&&((s=or({},s)).stops&&(s.stops=s.stops.map(k=>[k[0],m(k[1])])),s.default=m(s.default?s.default:t.default)),s.colorSpace&&(g=s.colorSpace)!=="rgb"&&g!=="hcl"&&g!=="lab")throw new Error(`Unknown color space: "${s.colorSpace}"`);var g;const v=function(k){switch(k){case"exponential":return kd;case"interval":return em;case"categorical":return Jf;case"identity":return tm;default:throw new Error(`Unknown function type "${k}"`)}}(h);let T,C;if(h==="categorical"){T=Object.create(null);for(const k of s.stops)T[k[0]]=k[1];C=typeof s.stops[0][0]}if(i){const k={},I=[];for(let F=0;F<s.stops.length;F++){const N=s.stops[F],G=N[0].zoom;k[G]===void 0&&(k[G]={zoom:G,type:s.type,property:s.property,default:s.default,stops:[]},I.push(G)),k[G].stops.push([N[0].value,N[1]])}const D=[];for(const F of I)D.push([k[F].zoom,wu(k[F],t)]);const j={name:"linear"};return{kind:"composite",interpolationType:j,interpolationFactor:On.interpolationFactor.bind(void 0,j),zoomStops:D.map(F=>F[0]),evaluate:({zoom:F},N)=>kd({stops:D,base:s.base},t,F).evaluate(F,N)}}if(a){const k=h==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:k,interpolationFactor:On.interpolationFactor.bind(void 0,k),zoomStops:s.stops.map(I=>I[0]),evaluate:({zoom:I})=>v(s,t,I,T,C)}}return{kind:"source",evaluate(k,I){const D=I&&I.properties?I.properties[s.property]:void 0;return D===void 0?Ba(s.default,t.default):v(s,t,D,T,C)}}}function Ba(s,t,i){return s!==void 0?s:t!==void 0?t:i!==void 0?i:void 0}function Jf(s,t,i,a,h){return Ba(typeof i===h?a[i]:void 0,s.default,t.default)}function em(s,t,i){if(Qt(i)!=="number")return Ba(s.default,t.default);const a=s.stops.length;if(a===1||i<=s.stops[0][0])return s.stops[0][1];if(i>=s.stops[a-1][0])return s.stops[a-1][1];const h=Aa(s.stops.map(m=>m[0]),i);return s.stops[h][1]}function kd(s,t,i){const a=s.base!==void 0?s.base:1;if(Qt(i)!=="number")return Ba(s.default,t.default);const h=s.stops.length;if(h===1||i<=s.stops[0][0])return s.stops[0][1];if(i>=s.stops[h-1][0])return s.stops[h-1][1];const m=Aa(s.stops.map(k=>k[0]),i),g=function(k,I,D,j){const F=j-D,N=k-D;return F===0?0:I===1?N/F:(Math.pow(I,N)-1)/(Math.pow(I,F)-1)}(i,a,s.stops[m][0],s.stops[m+1][0]),v=s.stops[m][1],T=s.stops[m+1][1],C=ns[t.type]||Xl;return typeof v.evaluate=="function"?{evaluate(...k){const I=v.evaluate.apply(void 0,k),D=T.evaluate.apply(void 0,k);if(I!==void 0&&D!==void 0)return C(I,D,g,s.colorSpace)}}:C(v,T,g,s.colorSpace)}function tm(s,t,i){switch(t.type){case"color":i=Kt.parse(i);break;case"formatted":i=ti.fromString(i.toString());break;case"resolvedImage":i=ui.fromString(i.toString());break;case"padding":i=In.parse(i);break;case"colorArray":i=An.parse(i);break;case"numberArray":i=Kr.parse(i);break;default:Qt(i)===t.type||t.type==="enum"&&t.values[i]||(i=void 0)}return Ba(i,s.default,t.default)}wi.register(Bo,{error:[{kind:"error"},[St],(s,[t])=>{throw new kr(t.evaluate(s))}],typeof:[St,[Ft],(s,[t])=>Cr(Nr(t.evaluate(s)))],"to-rgba":[Hn(Ve,4),[Pr],(s,[t])=>{const[i,a,h,m]=t.evaluate(s).rgb;return[255*i,255*a,255*h,m]}],rgb:[Pr,[Ve,Ve,Ve],Pd],rgba:[Pr,[Ve,Ve,Ve,Ve],Pd],has:{type:kt,overloads:[[[St],(s,[t])=>Cd(t.evaluate(s),s.properties())],[[St,hn],(s,[t,i])=>Cd(t.evaluate(s),i.evaluate(s))]]},get:{type:Ft,overloads:[[[St],(s,[t])=>bu(t.evaluate(s),s.properties())],[[St,hn],(s,[t,i])=>bu(t.evaluate(s),i.evaluate(s))]]},"feature-state":[Ft,[St],(s,[t])=>bu(t.evaluate(s),s.featureState||{})],properties:[hn,[],s=>s.properties()],"geometry-type":[St,[],s=>s.geometryType()],id:[Ft,[],s=>s.id()],zoom:[Ve,[],s=>s.globals.zoom],"heatmap-density":[Ve,[],s=>s.globals.heatmapDensity||0],"line-progress":[Ve,[],s=>s.globals.lineProgress||0],accumulated:[Ft,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[Ve,go(Ve),(s,t)=>{let i=0;for(const a of t)i+=a.evaluate(s);return i}],"*":[Ve,go(Ve),(s,t)=>{let i=1;for(const a of t)i*=a.evaluate(s);return i}],"-":{type:Ve,overloads:[[[Ve,Ve],(s,[t,i])=>t.evaluate(s)-i.evaluate(s)],[[Ve],(s,[t])=>-t.evaluate(s)]]},"/":[Ve,[Ve,Ve],(s,[t,i])=>t.evaluate(s)/i.evaluate(s)],"%":[Ve,[Ve,Ve],(s,[t,i])=>t.evaluate(s)%i.evaluate(s)],ln2:[Ve,[],()=>Math.LN2],pi:[Ve,[],()=>Math.PI],e:[Ve,[],()=>Math.E],"^":[Ve,[Ve,Ve],(s,[t,i])=>Math.pow(t.evaluate(s),i.evaluate(s))],sqrt:[Ve,[Ve],(s,[t])=>Math.sqrt(t.evaluate(s))],log10:[Ve,[Ve],(s,[t])=>Math.log(t.evaluate(s))/Math.LN10],ln:[Ve,[Ve],(s,[t])=>Math.log(t.evaluate(s))],log2:[Ve,[Ve],(s,[t])=>Math.log(t.evaluate(s))/Math.LN2],sin:[Ve,[Ve],(s,[t])=>Math.sin(t.evaluate(s))],cos:[Ve,[Ve],(s,[t])=>Math.cos(t.evaluate(s))],tan:[Ve,[Ve],(s,[t])=>Math.tan(t.evaluate(s))],asin:[Ve,[Ve],(s,[t])=>Math.asin(t.evaluate(s))],acos:[Ve,[Ve],(s,[t])=>Math.acos(t.evaluate(s))],atan:[Ve,[Ve],(s,[t])=>Math.atan(t.evaluate(s))],min:[Ve,go(Ve),(s,t)=>Math.min(...t.map(i=>i.evaluate(s)))],max:[Ve,go(Ve),(s,t)=>Math.max(...t.map(i=>i.evaluate(s)))],abs:[Ve,[Ve],(s,[t])=>Math.abs(t.evaluate(s))],round:[Ve,[Ve],(s,[t])=>{const i=t.evaluate(s);return i<0?-Math.round(-i):Math.round(i)}],floor:[Ve,[Ve],(s,[t])=>Math.floor(t.evaluate(s))],ceil:[Ve,[Ve],(s,[t])=>Math.ceil(t.evaluate(s))],"filter-==":[kt,[St,Ft],(s,[t,i])=>s.properties()[t.value]===i.value],"filter-id-==":[kt,[Ft],(s,[t])=>s.id()===t.value],"filter-type-==":[kt,[St],(s,[t])=>s.geometryType()===t.value],"filter-<":[kt,[St,Ft],(s,[t,i])=>{const a=s.properties()[t.value],h=i.value;return typeof a==typeof h&&a<h}],"filter-id-<":[kt,[Ft],(s,[t])=>{const i=s.id(),a=t.value;return typeof i==typeof a&&i<a}],"filter->":[kt,[St,Ft],(s,[t,i])=>{const a=s.properties()[t.value],h=i.value;return typeof a==typeof h&&a>h}],"filter-id->":[kt,[Ft],(s,[t])=>{const i=s.id(),a=t.value;return typeof i==typeof a&&i>a}],"filter-<=":[kt,[St,Ft],(s,[t,i])=>{const a=s.properties()[t.value],h=i.value;return typeof a==typeof h&&a<=h}],"filter-id-<=":[kt,[Ft],(s,[t])=>{const i=s.id(),a=t.value;return typeof i==typeof a&&i<=a}],"filter->=":[kt,[St,Ft],(s,[t,i])=>{const a=s.properties()[t.value],h=i.value;return typeof a==typeof h&&a>=h}],"filter-id->=":[kt,[Ft],(s,[t])=>{const i=s.id(),a=t.value;return typeof i==typeof a&&i>=a}],"filter-has":[kt,[Ft],(s,[t])=>t.value in s.properties()],"filter-has-id":[kt,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[kt,[Hn(St)],(s,[t])=>t.value.indexOf(s.geometryType())>=0],"filter-id-in":[kt,[Hn(Ft)],(s,[t])=>t.value.indexOf(s.id())>=0],"filter-in-small":[kt,[St,Hn(Ft)],(s,[t,i])=>i.value.indexOf(s.properties()[t.value])>=0],"filter-in-large":[kt,[St,Hn(Ft)],(s,[t,i])=>function(a,h,m,g){for(;m<=g;){const v=m+g>>1;if(h[v]===a)return!0;h[v]>a?g=v-1:m=v+1}return!1}(s.properties()[t.value],i.value,0,i.value.length-1)],all:{type:kt,overloads:[[[kt,kt],(s,[t,i])=>t.evaluate(s)&&i.evaluate(s)],[go(kt),(s,t)=>{for(const i of t)if(!i.evaluate(s))return!1;return!0}]]},any:{type:kt,overloads:[[[kt,kt],(s,[t,i])=>t.evaluate(s)||i.evaluate(s)],[go(kt),(s,t)=>{for(const i of t)if(i.evaluate(s))return!0;return!1}]]},"!":[kt,[kt],(s,[t])=>!t.evaluate(s)],"is-supported-script":[kt,[St],(s,[t])=>{const i=s.globals&&s.globals.isSupportedScript;return!i||i(t.evaluate(s))}],upcase:[St,[St],(s,[t])=>t.evaluate(s).toUpperCase()],downcase:[St,[St],(s,[t])=>t.evaluate(s).toLowerCase()],concat:[St,go(Ft),(s,t)=>t.map(i=>ir(i.evaluate(s))).join("")],"resolved-locale":[St,[Fs],(s,[t])=>t.evaluate(s).resolvedLocale()]});class Kl{constructor(t,i){this.expression=t,this._warningHistory={},this._evaluator=new lu,this._defaultValue=i?function(a){if(a.type==="color"&&Wl(a.default))return new Kt(0,0,0,0);switch(a.type){case"color":return Kt.parse(a.default)||null;case"padding":return In.parse(a.default)||null;case"numberArray":return Kr.parse(a.default)||null;case"colorArray":return An.parse(a.default)||null;case"variableAnchorOffsetCollection":return Wn.parse(a.default)||null;case"projectionDefinition":return ri.parse(a.default)||null;default:return a.default===void 0?null:a.default}}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(t,i,a,h,m,g){return this._evaluator.globals=t,this._evaluator.feature=i,this._evaluator.featureState=a,this._evaluator.canonical=h,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g,this.expression.evaluate(this._evaluator)}evaluate(t,i,a,h,m,g){this._evaluator.globals=t,this._evaluator.feature=i||null,this._evaluator.featureState=a||null,this._evaluator.canonical=h,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g||null;try{const v=this.expression.evaluate(this._evaluator);if(v==null||typeof v=="number"&&v!=v)return this._defaultValue;if(this._enumValues&&!(v in this._enumValues))throw new kr(`Expected value to be one of ${Object.keys(this._enumValues).map(T=>JSON.stringify(T)).join(", ")}, but found ${JSON.stringify(v)} instead.`);return v}catch(v){return this._warningHistory[v.message]||(this._warningHistory[v.message]=!0,typeof console<"u"&&console.warn(v.message)),this._defaultValue}}}function Oa(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in Bo}function Yl(s,t){const i=new ka(Bo,Ul,[],t?function(h){const m={color:Pr,string:St,number:Ve,enum:St,boolean:kt,formatted:so,padding:gs,numberArray:ji,colorArray:oo,projectionDefinition:Rr,resolvedImage:_s,variableAnchorOffsetCollection:Or};return h.type==="array"?Hn(m[h.value]||Ft,h.length):m[h.type]}(t):void 0),a=i.parse(s,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?ql(new Kl(a,t)):Oo(i.errors)}class Tu{constructor(t,i){this.kind=t,this._styleExpression=i,this.isStateDependent=t!=="constant"&&!Fa(i.expression)}evaluateWithoutErrorHandling(t,i,a,h,m,g){return this._styleExpression.evaluateWithoutErrorHandling(t,i,a,h,m,g)}evaluate(t,i,a,h,m,g){return this._styleExpression.evaluate(t,i,a,h,m,g)}}class Ql{constructor(t,i,a,h){this.kind=t,this.zoomStops=a,this._styleExpression=i,this.isStateDependent=t!=="camera"&&!Fa(i.expression),this.interpolationType=h}evaluateWithoutErrorHandling(t,i,a,h,m,g){return this._styleExpression.evaluateWithoutErrorHandling(t,i,a,h,m,g)}evaluate(t,i,a,h,m,g){return this._styleExpression.evaluate(t,i,a,h,m,g)}interpolationFactor(t,i,a){return this.interpolationType?On.interpolationFactor(this.interpolationType,t,i,a):0}}function Su(s,t){const i=Yl(s,t);if(i.result==="error")return i;const a=i.value.expression,h=Zl(a);if(!h&&!No(t))return Oo([new qt("","data expressions not supported")]);const m=Gl(a,["zoom"]);if(!m&&!Md(t))return Oo([new qt("","zoom expressions not supported")]);const g=Va(a);return g||m?g instanceof qt?Oo([g]):g instanceof On&&!Hl(t)?Oo([new qt("",'"interpolate" expressions cannot be used with this property')]):ql(g?new Ql(h?"camera":"composite",i.value,g.labels,g instanceof On?g.interpolation:void 0):new Tu(h?"constant":"source",i.value)):Oo([new qt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Na{constructor(t,i){this._parameters=t,this._specification=i,or(this,wu(this._parameters,this._specification))}static deserialize(t){return new Na(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Va(s){let t=null;if(s instanceof Lo)t=Va(s.result);else if(s instanceof uo){for(const i of s.args)if(t=Va(i),t)break}else(s instanceof Os||s instanceof On)&&s.input instanceof wi&&s.input.name==="zoom"&&(t=s);return t instanceof qt||s.eachChild(i=>{const a=Va(i);a instanceof qt?t=a:!t&&a?t=new qt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&a&&t!==a&&(t=new qt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function $a(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const t of s.slice(1))if(!$a(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const Pu={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ua(s){if(s==null)return{filter:()=>!0,needGeometry:!1};$a(s)||(s=ec(s));const t=Yl(s,Pu);if(t.result==="error")throw new Error(t.value.map(i=>`${i.key}: ${i.message}`).join(", "));return{filter:(i,a,h)=>t.value.evaluate(i,a,{},h),needGeometry:Ed(s)}}function Jl(s,t){return s<t?-1:s>t?1:0}function Ed(s){if(!Array.isArray(s))return!1;if(s[0]==="within"||s[0]==="distance")return!0;for(let t=1;t<s.length;t++)if(Ed(s[t]))return!0;return!1}function ec(s){if(!s)return!0;const t=s[0];return s.length<=1?t!=="any":t==="=="?Cu(s[1],s[2],"=="):t==="!="?tc(Cu(s[1],s[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Cu(s[1],s[2],t):t==="any"?(i=s.slice(1),["any"].concat(i.map(ec))):t==="all"?["all"].concat(s.slice(1).map(ec)):t==="none"?["all"].concat(s.slice(1).map(ec).map(tc)):t==="in"?Id(s[1],s.slice(2)):t==="!in"?tc(Id(s[1],s.slice(2))):t==="has"?Ad(s[1]):t!=="!has"||tc(Ad(s[1]));var i}function Cu(s,t,i){switch(s){case"$type":return[`filter-type-${i}`,t];case"$id":return[`filter-id-${i}`,t];default:return[`filter-${i}`,s,t]}}function Id(s,t){if(t.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(i=>typeof i!=typeof t[0])?["filter-in-large",s,["literal",t.sort(Jl)]]:["filter-in-small",s,["literal",t]]}}function Ad(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function tc(s){return["!",s]}function rc(s){const t=typeof s;if(t==="number"||t==="boolean"||t==="string"||s==null)return JSON.stringify(s);if(Array.isArray(s)){let h="[";for(const m of s)h+=`${rc(m)},`;return`${h}]`}const i=Object.keys(s).sort();let a="{";for(let h=0;h<i.length;h++)a+=`${JSON.stringify(i[h])}:${rc(s[i[h]])},`;return`${a}}`}function zd(s){let t="";for(const i of Te)t+=`/${rc(s[i])}`;return t}function Za(s){const t=s.value;return t?[new Ie(s.key,t,"constants have been deprecated as of v8")]:[]}function Hr(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function Vs(s){if(Array.isArray(s))return s.map(Vs);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const t={};for(const i in s)t[i]=Vs(s[i]);return t}return Hr(s)}function hi(s){const t=s.key,i=s.value,a=s.valueSpec||{},h=s.objectElementValidators||{},m=s.style,g=s.styleSpec,v=s.validateSpec;let T=[];const C=Qt(i);if(C!=="object")return[new Ie(t,i,`object expected, ${C} found`)];for(const k in i){const I=k.split(".")[0],D=Ht(a,I)||a["*"];let j;if(Ht(h,I))j=h[I];else if(Ht(a,I))j=v;else if(h["*"])j=h["*"];else{if(!a["*"]){T.push(new Ie(t,i[k],`unknown property "${k}"`));continue}j=v}T=T.concat(j({key:(t&&`${t}.`)+k,value:i[k],valueSpec:D,style:m,styleSpec:g,object:i,objectKey:k,validateSpec:v},i))}for(const k in a)h[k]||a[k].required&&a[k].default===void 0&&i[k]===void 0&&T.push(new Ie(t,i,`missing required property "${k}"`));return T}function Mu(s){const t=s.value,i=s.valueSpec,a=s.style,h=s.styleSpec,m=s.key,g=s.arrayElementValidator||s.validateSpec;if(Qt(t)!=="array")return[new Ie(m,t,`array expected, ${Qt(t)} found`)];if(i.length&&t.length!==i.length)return[new Ie(m,t,`array length ${i.length} expected, length ${t.length} found`)];if(i["min-length"]&&t.length<i["min-length"])return[new Ie(m,t,`array length at least ${i["min-length"]} expected, length ${t.length} found`)];let v={type:i.value,values:i.values};h.$version<7&&(v.function=i.function),Qt(i.value)==="object"&&(v=i.value);let T=[];for(let C=0;C<t.length;C++)T=T.concat(g({array:t,arrayIndex:C,value:t[C],valueSpec:v,validateSpec:s.validateSpec,style:a,styleSpec:h,key:`${m}[${C}]`}));return T}function Ga(s){const t=s.key,i=s.value,a=s.valueSpec;let h=Qt(i);return h==="number"&&i!=i&&(h="NaN"),h!=="number"?[new Ie(t,i,`number expected, ${h} found`)]:"minimum"in a&&i<a.minimum?[new Ie(t,i,`${i} is less than the minimum value ${a.minimum}`)]:"maximum"in a&&i>a.maximum?[new Ie(t,i,`${i} is greater than the maximum value ${a.maximum}`)]:[]}function ku(s){const t=s.valueSpec,i=Hr(s.value.type);let a,h,m,g={};const v=i!=="categorical"&&s.value.property===void 0,T=!v,C=Qt(s.value.stops)==="array"&&Qt(s.value.stops[0])==="array"&&Qt(s.value.stops[0][0])==="object",k=hi({key:s.key,value:s.value,valueSpec:s.styleSpec.function,validateSpec:s.validateSpec,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(j){if(i==="identity")return[new Ie(j.key,j.value,'identity function may not have a "stops" property')];let F=[];const N=j.value;return F=F.concat(Mu({key:j.key,value:N,valueSpec:j.valueSpec,validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec,arrayElementValidator:I})),Qt(N)==="array"&&N.length===0&&F.push(new Ie(j.key,N,"array must have at least one stop")),F},default:function(j){return j.validateSpec({key:j.key,value:j.value,valueSpec:t,validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec})}}});return i==="identity"&&v&&k.push(new Ie(s.key,s.value,'missing required property "property"')),i==="identity"||s.value.stops||k.push(new Ie(s.key,s.value,'missing required property "stops"')),i==="exponential"&&s.valueSpec.expression&&!Hl(s.valueSpec)&&k.push(new Ie(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(T&&!No(s.valueSpec)?k.push(new Ie(s.key,s.value,"property functions not supported")):v&&!Md(s.valueSpec)&&k.push(new Ie(s.key,s.value,"zoom functions not supported"))),i!=="categorical"&&!C||s.value.property!==void 0||k.push(new Ie(s.key,s.value,'"property" property is required')),k;function I(j){let F=[];const N=j.value,G=j.key;if(Qt(N)!=="array")return[new Ie(G,N,`array expected, ${Qt(N)} found`)];if(N.length!==2)return[new Ie(G,N,`array length 2 expected, length ${N.length} found`)];if(C){if(Qt(N[0])!=="object")return[new Ie(G,N,`object expected, ${Qt(N[0])} found`)];if(N[0].zoom===void 0)return[new Ie(G,N,"object stop key must have zoom")];if(N[0].value===void 0)return[new Ie(G,N,"object stop key must have value")];if(m&&m>Hr(N[0].zoom))return[new Ie(G,N[0].zoom,"stop zoom values must appear in ascending order")];Hr(N[0].zoom)!==m&&(m=Hr(N[0].zoom),h=void 0,g={}),F=F.concat(hi({key:`${G}[0]`,value:N[0],valueSpec:{zoom:{}},validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec,objectElementValidators:{zoom:Ga,value:D}}))}else F=F.concat(D({key:`${G}[0]`,value:N[0],validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec},N));return Oa(Vs(N[1]))?F.concat([new Ie(`${G}[1]`,N[1],"expressions are not allowed in function stops.")]):F.concat(j.validateSpec({key:`${G}[1]`,value:N[1],valueSpec:t,validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec}))}function D(j,F){const N=Qt(j.value),G=Hr(j.value),Y=j.value!==null?j.value:F;if(a){if(N!==a)return[new Ie(j.key,Y,`${N} stop domain type must match previous stop domain type ${a}`)]}else a=N;if(N!=="number"&&N!=="string"&&N!=="boolean")return[new Ie(j.key,Y,"stop domain value must be a number, string, or boolean")];if(N!=="number"&&i!=="categorical"){let he=`number expected, ${N} found`;return No(t)&&i===void 0&&(he+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ie(j.key,Y,he)]}return i!=="categorical"||N!=="number"||isFinite(G)&&Math.floor(G)===G?i!=="categorical"&&N==="number"&&h!==void 0&&G<h?[new Ie(j.key,Y,"stop domain values must appear in ascending order")]:(h=G,i==="categorical"&&G in g?[new Ie(j.key,Y,"stop domain values must be unique")]:(g[G]=!0,[])):[new Ie(j.key,Y,`integer expected, found ${G}`)]}}function ss(s){const t=(s.expressionContext==="property"?Su:Yl)(Vs(s.value),s.valueSpec);if(t.result==="error")return t.value.map(a=>new Ie(`${s.key}${a.key}`,s.value,a.message));const i=t.value.expression||t.value._styleExpression.expression;if(s.expressionContext==="property"&&s.propertyKey==="text-font"&&!i.outputDefined())return[new Ie(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if(s.expressionContext==="property"&&s.propertyType==="layout"&&!Fa(i))return[new Ie(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if(s.expressionContext==="filter"&&!Fa(i))return[new Ie(s.key,s.value,'"feature-state" data expressions are not supported with filters.')];if(s.expressionContext&&s.expressionContext.indexOf("cluster")===0){if(!Gl(i,["zoom","feature-state"]))return[new Ie(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(s.expressionContext==="cluster-initial"&&!Zl(i))return[new Ie(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Eu(s){const t=s.key,i=s.value,a=Qt(i);return a!=="string"?[new Ie(t,i,`color expected, ${a} found`)]:Kt.parse(String(i))?[]:[new Ie(t,i,`color expected, "${i}" found`)]}function qa(s){const t=s.key,i=s.value,a=s.valueSpec,h=[];return Array.isArray(a.values)?a.values.indexOf(Hr(i))===-1&&h.push(new Ie(t,i,`expected one of [${a.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(a.values).indexOf(Hr(i))===-1&&h.push(new Ie(t,i,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(i)} found`)),h}function Iu(s){return $a(Vs(s.value))?ss(or({},s,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Rd(s)}function Rd(s){const t=s.value,i=s.key;if(Qt(t)!=="array")return[new Ie(i,t,`array expected, ${Qt(t)} found`)];const a=s.styleSpec;let h,m=[];if(t.length<1)return[new Ie(i,t,"filter array must have at least 1 element")];switch(m=m.concat(qa({key:`${i}[0]`,value:t[0],valueSpec:a.filter_operator,style:s.style,styleSpec:s.styleSpec})),Hr(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Hr(t[1])==="$type"&&m.push(new Ie(i,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&m.push(new Ie(i,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(h=Qt(t[1]),h!=="string"&&m.push(new Ie(`${i}[1]`,t[1],`string expected, ${h} found`)));for(let g=2;g<t.length;g++)h=Qt(t[g]),Hr(t[1])==="$type"?m=m.concat(qa({key:`${i}[${g}]`,value:t[g],valueSpec:a.geometry_type,style:s.style,styleSpec:s.styleSpec})):h!=="string"&&h!=="number"&&h!=="boolean"&&m.push(new Ie(`${i}[${g}]`,t[g],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let g=1;g<t.length;g++)m=m.concat(Rd({key:`${i}[${g}]`,value:t[g],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":h=Qt(t[1]),t.length!==2?m.push(new Ie(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):h!=="string"&&m.push(new Ie(`${i}[1]`,t[1],`string expected, ${h} found`))}return m}function Dd(s,t){const i=s.key,a=s.validateSpec,h=s.style,m=s.styleSpec,g=s.value,v=s.objectKey,T=m[`${t}_${s.layerType}`];if(!T)return[];const C=v.match(/^(.*)-transition$/);if(t==="paint"&&C&&T[C[1]]&&T[C[1]].transition)return a({key:i,value:g,valueSpec:m.transition,style:h,styleSpec:m});const k=s.valueSpec||T[v];if(!k)return[new Ie(i,g,`unknown property "${v}"`)];let I;if(Qt(g)==="string"&&No(k)&&!k.tokens&&(I=/^{([^}]+)}$/.exec(g)))return[new Ie(i,g,`"${v}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(I[1])} }\`.`)];const D=[];return s.layerType==="symbol"&&(v==="text-field"&&h&&!h.glyphs&&D.push(new Ie(i,g,'use of "text-field" requires a style "glyphs" property')),v==="text-font"&&Wl(Vs(g))&&Hr(g.type)==="identity"&&D.push(new Ie(i,g,'"text-font" does not support identity functions'))),D.concat(a({key:s.key,value:g,valueSpec:k,style:h,styleSpec:m,expressionContext:"property",propertyType:t,propertyKey:v}))}function Ld(s){return Dd(s,"paint")}function Vo(s){return Dd(s,"layout")}function $o(s){let t=[];const i=s.value,a=s.key,h=s.style,m=s.styleSpec;if(Qt(i)!=="object")return[new Ie(a,i,`object expected, ${Qt(i)} found`)];i.type||i.ref||t.push(new Ie(a,i,'either "type" or "ref" is required'));let g=Hr(i.type);const v=Hr(i.ref);if(i.id){const T=Hr(i.id);for(let C=0;C<s.arrayIndex;C++){const k=h.layers[C];Hr(k.id)===T&&t.push(new Ie(a,i.id,`duplicate layer id "${i.id}", previously used at line ${k.id.__line__}`))}}if("ref"in i){let T;["type","source","source-layer","filter","layout"].forEach(C=>{C in i&&t.push(new Ie(a,i[C],`"${C}" is prohibited for ref layers`))}),h.layers.forEach(C=>{Hr(C.id)===v&&(T=C)}),T?T.ref?t.push(new Ie(a,i.ref,"ref cannot reference another ref layer")):g=Hr(T.type):t.push(new Ie(a,i.ref,`ref layer "${v}" not found`))}else if(g!=="background")if(i.source){const T=h.sources&&h.sources[i.source],C=T&&Hr(T.type);T?C==="vector"&&g==="raster"?t.push(new Ie(a,i.source,`layer "${i.id}" requires a raster source`)):C!=="raster-dem"&&g==="hillshade"?t.push(new Ie(a,i.source,`layer "${i.id}" requires a raster-dem source`)):C==="raster"&&g!=="raster"?t.push(new Ie(a,i.source,`layer "${i.id}" requires a vector source`)):C!=="vector"||i["source-layer"]?C==="raster-dem"&&g!=="hillshade"?t.push(new Ie(a,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):g!=="line"||!i.paint||!i.paint["line-gradient"]||C==="geojson"&&T.lineMetrics||t.push(new Ie(a,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Ie(a,i,`layer "${i.id}" must specify a "source-layer"`)):t.push(new Ie(a,i.source,`source "${i.source}" not found`))}else t.push(new Ie(a,i,'missing required property "source"'));return t=t.concat(hi({key:a,value:i,valueSpec:m.layer,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,objectElementValidators:{"*":()=>[],type:()=>s.validateSpec({key:`${a}.type`,value:i.type,valueSpec:m.layer.type,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,object:i,objectKey:"type"}),filter:Iu,layout:T=>hi({layer:i,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":C=>Vo(or({layerType:g},C))}}),paint:T=>hi({layer:i,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":C=>Ld(or({layerType:g},C))}})}})),t}function dn(s){const t=s.value,i=s.key,a=Qt(t);return a!=="string"?[new Ie(i,t,`string expected, ${a} found`)]:[]}const Uo={promoteId:function({key:s,value:t}){if(Qt(t)==="string")return dn({key:s,value:t});{const i=[];for(const a in t)i.push(...dn({key:`${s}.${a}`,value:t[a]}));return i}}};function Au(s){const t=s.value,i=s.key,a=s.styleSpec,h=s.style,m=s.validateSpec;if(!t.type)return[new Ie(i,t,'"type" is required')];const g=Hr(t.type);let v;switch(g){case"vector":case"raster":return v=hi({key:i,value:t,valueSpec:a[`source_${g.replace("-","_")}`],style:s.style,styleSpec:a,objectElementValidators:Uo,validateSpec:m}),v;case"raster-dem":return v=function(T){var C;const k=(C=T.sourceName)!==null&&C!==void 0?C:"",I=T.value,D=T.styleSpec,j=D.source_raster_dem,F=T.style;let N=[];const G=Qt(I);if(I===void 0)return N;if(G!=="object")return N.push(new Ie("source_raster_dem",I,`object expected, ${G} found`)),N;const Y=Hr(I.encoding)==="custom",he=["redFactor","greenFactor","blueFactor","baseShift"],ee=T.value.encoding?`"${T.value.encoding}"`:"Default";for(const L in I)!Y&&he.includes(L)?N.push(new Ie(L,I[L],`In "${k}": "${L}" is only valid when "encoding" is set to "custom". ${ee} encoding found`)):j[L]?N=N.concat(T.validateSpec({key:L,value:I[L],valueSpec:j[L],validateSpec:T.validateSpec,style:F,styleSpec:D})):N.push(new Ie(L,I[L],`unknown property "${L}"`));return N}({sourceName:i,value:t,style:s.style,styleSpec:a,validateSpec:m}),v;case"geojson":if(v=hi({key:i,value:t,valueSpec:a.source_geojson,style:h,styleSpec:a,validateSpec:m,objectElementValidators:Uo}),t.cluster)for(const T in t.clusterProperties){const[C,k]=t.clusterProperties[T],I=typeof C=="string"?[C,["accumulated"],["get",T]]:C;v.push(...ss({key:`${i}.${T}.map`,value:k,expressionContext:"cluster-map"})),v.push(...ss({key:`${i}.${T}.reduce`,value:I,expressionContext:"cluster-reduce"}))}return v;case"video":return hi({key:i,value:t,valueSpec:a.source_video,style:h,validateSpec:m,styleSpec:a});case"image":return hi({key:i,value:t,valueSpec:a.source_image,style:h,validateSpec:m,styleSpec:a});case"canvas":return[new Ie(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return qa({key:`${i}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function jd(s){const t=s.value,i=s.styleSpec,a=i.light,h=s.style;let m=[];const g=Qt(t);if(t===void 0)return m;if(g!=="object")return m=m.concat([new Ie("light",t,`object expected, ${g} found`)]),m;for(const v in t){const T=v.match(/^(.*)-transition$/);m=m.concat(T&&a[T[1]]&&a[T[1]].transition?s.validateSpec({key:v,value:t[v],valueSpec:i.transition,validateSpec:s.validateSpec,style:h,styleSpec:i}):a[v]?s.validateSpec({key:v,value:t[v],valueSpec:a[v],validateSpec:s.validateSpec,style:h,styleSpec:i}):[new Ie(v,t[v],`unknown property "${v}"`)])}return m}function Fd(s){const t=s.value,i=s.styleSpec,a=i.sky,h=s.style,m=Qt(t);if(t===void 0)return[];if(m!=="object")return[new Ie("sky",t,`object expected, ${m} found`)];let g=[];for(const v in t)g=g.concat(a[v]?s.validateSpec({key:v,value:t[v],valueSpec:a[v],style:h,styleSpec:i}):[new Ie(v,t[v],`unknown property "${v}"`)]);return g}function Zo(s){const t=s.value,i=s.styleSpec,a=i.terrain,h=s.style;let m=[];const g=Qt(t);if(t===void 0)return m;if(g!=="object")return m=m.concat([new Ie("terrain",t,`object expected, ${g} found`)]),m;for(const v in t)m=m.concat(a[v]?s.validateSpec({key:v,value:t[v],valueSpec:a[v],validateSpec:s.validateSpec,style:h,styleSpec:i}):[new Ie(v,t[v],`unknown property "${v}"`)]);return m}function zu(s){let t=[];const i=s.value,a=s.key;if(Array.isArray(i)){const h=[],m=[];for(const g in i)i[g].id&&h.includes(i[g].id)&&t.push(new Ie(a,i,`all the sprites' ids must be unique, but ${i[g].id} is duplicated`)),h.push(i[g].id),i[g].url&&m.includes(i[g].url)&&t.push(new Ie(a,i,`all the sprites' URLs must be unique, but ${i[g].url} is duplicated`)),m.push(i[g].url),t=t.concat(hi({key:`${a}[${g}]`,value:i[g],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:s.validateSpec}));return t}return dn({key:a,value:i})}function nc(s){return t=s.value,t&&t.constructor===Object?[]:[new Ie(s.key,s.value,`object expected, ${Qt(s.value)} found`)];var t}const Bd={"*":()=>[],array:Mu,boolean:function(s){const t=s.value,i=s.key,a=Qt(t);return a!=="boolean"?[new Ie(i,t,`boolean expected, ${a} found`)]:[]},number:Ga,color:Eu,constants:Za,enum:qa,filter:Iu,function:ku,layer:$o,object:hi,source:Au,light:jd,sky:Fd,terrain:Zo,projection:function(s){const t=s.value,i=s.styleSpec,a=i.projection,h=s.style,m=Qt(t);if(t===void 0)return[];if(m!=="object")return[new Ie("projection",t,`object expected, ${m} found`)];let g=[];for(const v in t)g=g.concat(a[v]?s.validateSpec({key:v,value:t[v],valueSpec:a[v],style:h,styleSpec:i}):[new Ie(v,t[v],`unknown property "${v}"`)]);return g},projectionDefinition:function(s){const t=s.key;let i=s.value;i=i instanceof String?i.valueOf():i;const a=Qt(i);return a!=="array"||function(h){return Array.isArray(h)&&h.length===3&&typeof h[0]=="string"&&typeof h[1]=="string"&&typeof h[2]=="number"}(i)||function(h){return!!["interpolate","step","literal"].includes(h[0])}(i)?["array","string"].includes(a)?[]:[new Ie(t,i,`projection expected, invalid type "${a}" found`)]:[new Ie(t,i,`projection expected, invalid array ${JSON.stringify(i)} found`)]},string:dn,formatted:function(s){return dn(s).length===0?[]:ss(s)},resolvedImage:function(s){return dn(s).length===0?[]:ss(s)},padding:function(s){const t=s.key,i=s.value;if(Qt(i)==="array"){if(i.length<1||i.length>4)return[new Ie(t,i,`padding requires 1 to 4 values; ${i.length} values found`)];const a={type:"number"};let h=[];for(let m=0;m<i.length;m++)h=h.concat(s.validateSpec({key:`${t}[${m}]`,value:i[m],validateSpec:s.validateSpec,valueSpec:a}));return h}return Ga({key:t,value:i,valueSpec:{}})},numberArray:function(s){const t=s.key,i=s.value;if(Qt(i)==="array"){const a={type:"number"};if(i.length<1)return[new Ie(t,i,"array length at least 1 expected, length 0 found")];let h=[];for(let m=0;m<i.length;m++)h=h.concat(s.validateSpec({key:`${t}[${m}]`,value:i[m],validateSpec:s.validateSpec,valueSpec:a}));return h}return Ga({key:t,value:i,valueSpec:{}})},colorArray:function(s){const t=s.key,i=s.value;if(Qt(i)==="array"){if(i.length<1)return[new Ie(t,i,"array length at least 1 expected, length 0 found")];let a=[];for(let h=0;h<i.length;h++)a=a.concat(Eu({key:`${t}[${h}]`,value:i[h]}));return a}return Eu({key:t,value:i})},variableAnchorOffsetCollection:function(s){const t=s.key,i=s.value,a=Qt(i),h=s.styleSpec;if(a!=="array"||i.length<1||i.length%2!=0)return[new Ie(t,i,"variableAnchorOffsetCollection requires a non-empty array of even length")];let m=[];for(let g=0;g<i.length;g+=2)m=m.concat(qa({key:`${t}[${g}]`,value:i[g],valueSpec:h.layout_symbol["text-anchor"]})),m=m.concat(Mu({key:`${t}[${g+1}]`,value:i[g+1],valueSpec:{length:2,value:"number"},validateSpec:s.validateSpec,style:s.style,styleSpec:h}));return m},sprite:zu,state:nc};function Go(s){const t=s.value,i=s.valueSpec,a=s.styleSpec;return s.validateSpec=Go,i.expression&&Wl(Hr(t))?ku(s):i.expression&&Oa(Vs(t))?ss(s):i.type&&Bd[i.type]?Bd[i.type](s):hi(or({},s,{valueSpec:i.type?a[i.type]:i}))}function Od(s){const t=s.value,i=s.key,a=dn(s);return a.length||(t.indexOf("{fontstack}")===-1&&a.push(new Ie(i,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&a.push(new Ie(i,t,'"glyphs" url must include a "{range}" token'))),a}function Nn(s,t=q){let i=[];return i=i.concat(Go({key:"",value:s,valueSpec:t.$root,styleSpec:t,style:s,validateSpec:Go,objectElementValidators:{glyphs:Od,"*":()=>[]}})),s.constants&&(i=i.concat(Za({key:"constants",value:s.constants}))),qo(i)}function Bi(s){return function(t){return s({...t,validateSpec:Go})}}function qo(s){return[].concat(s).sort((t,i)=>t.line-i.line)}function Oi(s){return function(...t){return qo(s.apply(this,t))}}Nn.source=Oi(Bi(Au)),Nn.sprite=Oi(Bi(zu)),Nn.glyphs=Oi(Bi(Od)),Nn.light=Oi(Bi(jd)),Nn.sky=Oi(Bi(Fd)),Nn.terrain=Oi(Bi(Zo)),Nn.state=Oi(Bi(nc)),Nn.layer=Oi(Bi($o)),Nn.filter=Oi(Bi(Iu)),Nn.paintProperty=Oi(Bi(Ld)),Nn.layoutProperty=Oi(Bi(Vo));const Ho=Nn,ic=Ho.light,rm=Ho.sky,Ru=Ho.paintProperty,sc=Ho.layoutProperty;function Du(s,t){let i=!1;if(t&&t.length)for(const a of t)s.fire(new te(new Error(a.message))),i=!0;return i}class Wo{constructor(t,i,a){const h=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const g=new Int32Array(this.arrayBuffer);t=g[0],this.d=(i=g[1])+2*(a=g[2]);for(let T=0;T<this.d*this.d;T++){const C=g[3+T],k=g[3+T+1];h.push(C===k?null:g.subarray(C,k))}const v=g[3+h.length+1];this.keys=g.subarray(g[3+h.length],v),this.bboxes=g.subarray(v),this.insert=this._insertReadonly}else{this.d=i+2*a;for(let g=0;g<this.d*this.d;g++)h.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=t,this.padding=a,this.scale=i/t,this.uid=0;const m=a/i*t;this.min=-m,this.max=t+m}insert(t,i,a,h,m){this._forEachCell(i,a,h,m,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(i),this.bboxes.push(a),this.bboxes.push(h),this.bboxes.push(m)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,i,a,h,m,g){this.cells[m].push(g)}query(t,i,a,h,m){const g=this.min,v=this.max;if(t<=g&&i<=g&&v<=a&&v<=h&&!m)return Array.prototype.slice.call(this.keys);{const T=[];return this._forEachCell(t,i,a,h,this._queryCell,T,{},m),T}}_queryCell(t,i,a,h,m,g,v,T){const C=this.cells[m];if(C!==null){const k=this.keys,I=this.bboxes;for(let D=0;D<C.length;D++){const j=C[D];if(v[j]===void 0){const F=4*j;(T?T(I[F+0],I[F+1],I[F+2],I[F+3]):t<=I[F+2]&&i<=I[F+3]&&a>=I[F+0]&&h>=I[F+1])?(v[j]=!0,g.push(k[j])):v[j]=!1}}}}_forEachCell(t,i,a,h,m,g,v,T){const C=this._convertToCellCoord(t),k=this._convertToCellCoord(i),I=this._convertToCellCoord(a),D=this._convertToCellCoord(h);for(let j=C;j<=I;j++)for(let F=k;F<=D;F++){const N=this.d*F+j;if((!T||T(this._convertFromCellCoord(j),this._convertFromCellCoord(F),this._convertFromCellCoord(j+1),this._convertFromCellCoord(F+1)))&&m.call(this,t,i,a,h,N,g,v,T))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,i=3+this.cells.length+1+1;let a=0;for(let g=0;g<this.cells.length;g++)a+=this.cells[g].length;const h=new Int32Array(i+a+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;let m=i;for(let g=0;g<t.length;g++){const v=t[g];h[3+g]=m,h.set(v,m),m+=v.length}return h[3+t.length]=m,h.set(this.keys,m),m+=this.keys.length,h[3+t.length+1]=m,h.set(this.bboxes,m),m+=this.bboxes.length,h.buffer}static serialize(t,i){const a=t.toArrayBuffer();return i&&i.push(a),{buffer:a}}static deserialize(t){return new Wo(t.buffer)}}const os={};function at(s,t,i={}){if(os[s])throw new Error(`${s} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:s,writeable:!1}),os[s]={klass:t,omit:i.omit||[],shallow:i.shallow||[]}}at("Object",Object),at("TransferableGridIndex",Wo),at("Color",Kt),at("Error",Error),at("AJAXError",qn),at("ResolvedImage",ui),at("StylePropertyFunction",Na),at("StyleExpression",Kl,{omit:["_evaluator"]}),at("ZoomDependentExpression",Ql),at("ZoomConstantExpression",Tu),at("CompoundExpression",wi,{omit:["_evaluate"]});for(const s in Bo)Bo[s]._classRegistryKey||at(`Expression_${s}`,Bo[s]);function oc(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function ac(s){return s.$name||s.constructor._classRegistryKey}function Nd(s){return!function(t){if(t===null||typeof t!="object")return!1;const i=ac(t);return!(!i||i==="Object")}(s)&&(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||s instanceof Blob||s instanceof Error||oc(s)||rn(s)||ArrayBuffer.isView(s)||s instanceof ImageData)}function Xo(s,t){if(Nd(s))return(oc(s)||rn(s))&&t&&t.push(s),ArrayBuffer.isView(s)&&t&&t.push(s.buffer),s instanceof ImageData&&t&&t.push(s.data.buffer),s;if(Array.isArray(s)){const m=[];for(const g of s)m.push(Xo(g,t));return m}if(typeof s!="object")throw new Error("can't serialize object of type "+typeof s);const i=ac(s);if(!i)throw new Error(`can't serialize object of unregistered class ${s.constructor.name}`);if(!os[i])throw new Error(`${i} is not registered.`);const{klass:a}=os[i],h=a.serialize?a.serialize(s,t):{};if(a.serialize){if(t&&h===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const m in s){if(!s.hasOwnProperty(m)||os[i].omit.indexOf(m)>=0)continue;const g=s[m];h[m]=os[i].shallow.indexOf(m)>=0?g:Xo(g,t)}s instanceof Error&&(h.message=s.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return i!=="Object"&&(h.$name=i),h}function Ha(s){if(Nd(s))return s;if(Array.isArray(s))return s.map(Ha);if(typeof s!="object")throw new Error("can't deserialize object of type "+typeof s);const t=ac(s)||"Object";if(!os[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:i}=os[t];if(!i)throw new Error(`can't deserialize unregistered class ${t}`);if(i.deserialize)return i.deserialize(s);const a=Object.create(i.prototype);for(const h of Object.keys(s)){if(h==="$name")continue;const m=s[h];a[h]=os[t].shallow.indexOf(h)>=0?m:Ha(m)}return a}class Lu{constructor(){this.first=!0}update(t,i){const a=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=i):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=i),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=a,!0))}}const Jt={"Latin-1 Supplement":s=>s>=128&&s<=255,"Hangul Jamo":s=>s>=4352&&s<=4607,Khmer:s=>s>=6016&&s<=6143,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Hiragana:s=>s>=12352&&s<=12447,Katakana:s=>s>=12448&&s<=12543,Kanbun:s=>s>=12688&&s<=12703,"CJK Strokes":s=>s>=12736&&s<=12783,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"CJK Unified Ideographs":s=>s>=19968&&s<=40959,"Hangul Syllables":s=>s>=44032&&s<=55215,"Private Use Area":s=>s>=57344&&s<=63743,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519};function lc(s){for(const t of s)if(cc(t.charCodeAt(0)))return!0;return!1}function nm(s){for(const t of s)if(!$d(t.charCodeAt(0)))return!1;return!0}function ju(s){const t=s.map(i=>{try{return new RegExp(`\\p{sc=${i}}`,"u").source}catch{return null}}).filter(i=>i);return new RegExp(t.join("|"),"u")}const Vd=ju(["Arab","Dupl","Mong","Ougr","Syrc"]);function $d(s){return!Vd.test(String.fromCodePoint(s))}const Fu=ju(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function cc(s){return!(s!==746&&s!==747&&(s<4352||!(Jt["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||Jt["CJK Compatibility"](s)||Jt["CJK Strokes"](s)||!(!Jt["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||Jt["Enclosed CJK Letters and Months"](s)||Jt["Ideographic Description Characters"](s)||Jt.Kanbun(s)||Jt.Katakana(s)&&s!==12540||!(!Jt["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!Jt["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||Jt["Vertical Forms"](s)||Jt["Yijing Hexagram Symbols"](s)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(s))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(s))||Fu.test(String.fromCodePoint(s)))))}function Wa(s){return!(cc(s)||function(t){return!!(Jt["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Jt["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Jt["Letterlike Symbols"](t)||Jt["Number Forms"](t)||Jt["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Jt["Control Pictures"](t)&&t!==9251||Jt["Optical Character Recognition"](t)||Jt["Enclosed Alphanumerics"](t)||Jt["Geometric Shapes"](t)||Jt["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Jt["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Jt["CJK Symbols and Punctuation"](t)||Jt.Katakana(t)||Jt["Private Use Area"](t)||Jt["CJK Compatibility Forms"](t)||Jt["Small Form Variants"](t)||Jt["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(s))}const im=ju(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function uc(s){return im.test(String.fromCodePoint(s))}function sm(s,t){return!(!t&&uc(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||Jt.Khmer(s))}function om(s){for(const t of s)if(uc(t.charCodeAt(0)))return!0;return!1}const bs=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(s){this.pluginStatus=s.pluginStatus,this.pluginURL=s.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(s){if(bs.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=s.applyArabicShaping,this.processBidirectionalText=s.processBidirectionalText,this.processStyledBidirectionalText=s.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(s,t){return c(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(s.pluginStatus!=="loading")return this.setState(s),s;const i=s.pluginURL,a=new Promise(m=>{this.loadScriptResolve=m});t(i);const h=new Promise(m=>setTimeout(()=>m(),this.TIMEOUT));if(yield Promise.race([a,h]),this.isParsed()){const m={pluginStatus:"loaded",pluginURL:i};return this.setState(m),m}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${i}`)})}};class Er{constructor(t,i){this.zoom=t,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.zoomHistory=i.zoomHistory,this.transition=i.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Lu,this.transition={})}isSupportedScript(t){return function(i,a){for(const h of i)if(!sm(h.charCodeAt(0),a))return!1;return!0}(t,bs.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,i=t-Math.floor(t),a=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:i+(1-i)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*i}}}class Xa{constructor(t,i){this.property=t,this.value=i,this.expression=function(a,h){if(Wl(a))return new Na(a,h);if(Oa(a)){const m=Su(a,h);if(m.result==="error")throw new Error(m.value.map(g=>`${g.key}: ${g.message}`).join(", "));return m.value}{let m=a;return h.type==="color"&&typeof a=="string"?m=Kt.parse(a):h.type!=="padding"||typeof a!="number"&&!Array.isArray(a)?h.type!=="numberArray"||typeof a!="number"&&!Array.isArray(a)?h.type!=="colorArray"||typeof a!="string"&&!Array.isArray(a)?h.type==="variableAnchorOffsetCollection"&&Array.isArray(a)?m=Wn.parse(a):h.type==="projectionDefinition"&&typeof a=="string"&&(m=ri.parse(a)):m=An.parse(a):m=Kr.parse(a):m=In.parse(a),{kind:"constant",evaluate:()=>m}}}(i===void 0?t.specification.default:i,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,i,a){return this.property.possiblyEvaluate(this,t,i,a)}}class Bu{constructor(t){this.property=t,this.value=new Xa(t,void 0)}transitioned(t,i){return new Zd(this.property,this.value,i,Xr({},t.transition,this.transition),t.now)}untransitioned(){return new Zd(this.property,this.value,null,{},0)}}class Ud{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return yr(this._values[t].value.value)}setValue(t,i){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Bu(this._values[t].property)),this._values[t].value=new Xa(this._values[t].property,i===null?void 0:yr(i))}getTransition(t){return yr(this._values[t].transition)}setTransition(t,i){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Bu(this._values[t].property)),this._values[t].transition=yr(i)||void 0}serialize(){const t={};for(const i of Object.keys(this._values)){const a=this.getValue(i);a!==void 0&&(t[i]=a);const h=this.getTransition(i);h!==void 0&&(t[`${i}-transition`]=h)}return t}transitioned(t,i){const a=new Gd(this._properties);for(const h of Object.keys(this._values))a._values[h]=this._values[h].transitioned(t,i._values[h]);return a}untransitioned(){const t=new Gd(this._properties);for(const i of Object.keys(this._values))t._values[i]=this._values[i].untransitioned();return t}}class Zd{constructor(t,i,a,h,m){this.property=t,this.value=i,this.begin=m+h.delay||0,this.end=this.begin+h.duration||0,t.specification.transition&&(h.delay||h.duration)&&(this.prior=a)}possiblyEvaluate(t,i,a){const h=t.now||0,m=this.value.possiblyEvaluate(t,i,a),g=this.prior;if(g){if(h>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(h<this.begin)return g.possiblyEvaluate(t,i,a);{const v=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(t,i,a),m,Xt(v))}}return m}}class Gd{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,i,a){const h=new hc(this._properties);for(const m of Object.keys(this._values))h._values[m]=this._values[m].possiblyEvaluate(t,i,a);return h}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class am{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return yr(this._values[t].value)}setValue(t,i){this._values[t]=new Xa(this._values[t].property,i===null?void 0:yr(i))}serialize(){const t={};for(const i of Object.keys(this._values)){const a=this.getValue(i);a!==void 0&&(t[i]=a)}return t}possiblyEvaluate(t,i,a){const h=new hc(this._properties);for(const m of Object.keys(this._values))h._values[m]=this._values[m].possiblyEvaluate(t,i,a);return h}}class Xn{constructor(t,i,a){this.property=t,this.value=i,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,i,a,h){return this.property.evaluate(this.value,this.parameters,t,i,a,h)}}class hc{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class _t{constructor(t){this.specification=t}possiblyEvaluate(t,i){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(i)}interpolate(t,i,a){const h=ns[this.specification.type];return h?h(t,i,a):t}}class It{constructor(t,i){this.specification=t,this.overrides=i}possiblyEvaluate(t,i,a,h){return new Xn(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(i,null,{},a,h)}:t.expression,i)}interpolate(t,i,a){if(t.value.kind!=="constant"||i.value.kind!=="constant")return t;if(t.value.value===void 0||i.value.value===void 0)return new Xn(this,{kind:"constant",value:void 0},t.parameters);const h=ns[this.specification.type];if(h){const m=h(t.value.value,i.value.value,a);return new Xn(this,{kind:"constant",value:m},t.parameters)}return t}evaluate(t,i,a,h,m,g){return t.kind==="constant"?t.value:t.evaluate(i,a,h,m,g)}}class Ka extends It{possiblyEvaluate(t,i,a,h){if(t.value===void 0)return new Xn(this,{kind:"constant",value:void 0},i);if(t.expression.kind==="constant"){const m=t.expression.evaluate(i,null,{},a,h),g=t.property.specification.type==="resolvedImage"&&typeof m!="string"?m.name:m,v=this._calculate(g,g,g,i);return new Xn(this,{kind:"constant",value:v},i)}if(t.expression.kind==="camera"){const m=this._calculate(t.expression.evaluate({zoom:i.zoom-1}),t.expression.evaluate({zoom:i.zoom}),t.expression.evaluate({zoom:i.zoom+1}),i);return new Xn(this,{kind:"constant",value:m},i)}return new Xn(this,t.expression,i)}evaluate(t,i,a,h,m,g){if(t.kind==="source"){const v=t.evaluate(i,a,h,m,g);return this._calculate(v,v,v,i)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(i.zoom)-1},a,h),t.evaluate({zoom:Math.floor(i.zoom)},a,h),t.evaluate({zoom:Math.floor(i.zoom)+1},a,h),i):t.value}_calculate(t,i,a,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:i}:{from:a,to:i}}interpolate(t){return t}}class Ou{constructor(t){this.specification=t}possiblyEvaluate(t,i,a,h){if(t.value!==void 0){if(t.expression.kind==="constant"){const m=t.expression.evaluate(i,null,{},a,h);return this._calculate(m,m,m,i)}return this._calculate(t.expression.evaluate(new Er(Math.floor(i.zoom-1),i)),t.expression.evaluate(new Er(Math.floor(i.zoom),i)),t.expression.evaluate(new Er(Math.floor(i.zoom+1),i)),i)}}_calculate(t,i,a,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:i}:{from:a,to:i}}interpolate(t){return t}}class Nu{constructor(t){this.specification=t}possiblyEvaluate(t,i,a,h){return!!t.expression.evaluate(i,null,{},a,h)}interpolate(){return!1}}class nn{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const i in t){const a=t[i];a.specification.overridable&&this.overridableProperties.push(i);const h=this.defaultPropertyValues[i]=new Xa(a,void 0),m=this.defaultTransitionablePropertyValues[i]=new Bu(a);this.defaultTransitioningPropertyValues[i]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=h.possiblyEvaluate({})}}}at("DataDrivenProperty",It),at("DataConstantProperty",_t),at("CrossFadedDataDrivenProperty",Ka),at("CrossFadedProperty",Ou),at("ColorRampProperty",Nu);const Vu="-transition";class Ti extends de{constructor(t,i){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),i.layout&&(this._unevaluatedLayout=new am(i.layout)),i.paint)){this._transitionablePaint=new Ud(i.paint);for(const a in t.paint)this.setPaintProperty(a,t.paint[a],{validate:!1});for(const a in t.layout)this.setLayoutProperty(a,t.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new hc(i.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,i,a={}){i!=null&&this._validate(sc,`layers.${this.id}.layout.${t}`,t,i,a)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,i):this.visibility=i)}getPaintProperty(t){return t.endsWith(Vu)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,i,a={}){if(i!=null&&this._validate(Ru,`layers.${this.id}.paint.${t}`,t,i,a))return!1;if(t.endsWith(Vu))return this._transitionablePaint.setTransition(t.slice(0,-11),i||void 0),!1;{const h=this._transitionablePaint._values[t],m=h.property.specification["property-type"]==="cross-faded-data-driven",g=h.value.isDataDriven(),v=h.value;this._transitionablePaint.setValue(t,i),this._handleSpecialPaintPropertyUpdate(t);const T=this._transitionablePaint._values[t].value;return T.isDataDriven()||g||m||this._handleOverridablePaintPropertyUpdate(t,v,T)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,i,a){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,i){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,i)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Yt(t,(i,a)=>!(i===void 0||a==="layout"&&!Object.keys(i).length||a==="paint"&&!Object.keys(i).length))}_validate(t,i,a,h,m={}){return(!m||m.validate!==!1)&&Du(this,t.call(Ho,{key:i,layerType:this.type,objectKey:a,value:h,styleSpec:q,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const i=this.paint.get(t);if(i instanceof Xn&&No(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}}const qd={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class _o{constructor(t,i){this._structArray=t,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Vr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,i){return t._trim(),i&&(t.isTransferred=!0,i.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const i=Object.create(this.prototype);return i.arrayBuffer=t.arrayBuffer,i.length=t.length,i.capacity=t.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Dr(s,t=1){let i=0,a=0;return{members:s.map(h=>{const m=qd[h.type].BYTES_PER_ELEMENT,g=i=Ko(i,Math.max(t,m)),v=h.components||1;return a=Math.max(a,m),i+=m*v,{name:h.name,type:h.type,components:v,offset:g}}),size:Ko(i,Math.max(a,t)),alignment:t}}function Ko(s,t){return Math.ceil(s/t)*t}class Ya extends Vr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i){const a=this.length;return this.resize(a+1),this.emplace(a,t,i)}emplace(t,i,a){const h=2*t;return this.int16[h+0]=i,this.int16[h+1]=a,t}}Ya.prototype.bytesPerElement=4,at("StructArrayLayout2i4",Ya);class Qa extends Vr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a){const h=this.length;return this.resize(h+1),this.emplace(h,t,i,a)}emplace(t,i,a,h){const m=3*t;return this.int16[m+0]=i,this.int16[m+1]=a,this.int16[m+2]=h,t}}Qa.prototype.bytesPerElement=6,at("StructArrayLayout3i6",Qa);class yo extends Vr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,h){const m=this.length;return this.resize(m+1),this.emplace(m,t,i,a,h)}emplace(t,i,a,h,m){const g=4*t;return this.int16[g+0]=i,this.int16[g+1]=a,this.int16[g+2]=h,this.int16[g+3]=m,t}}yo.prototype.bytesPerElement=8,at("StructArrayLayout4i8",yo);class $u extends Vr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,h,m,g){const v=this.length;return this.resize(v+1),this.emplace(v,t,i,a,h,m,g)}emplace(t,i,a,h,m,g,v){const T=6*t;return this.int16[T+0]=i,this.int16[T+1]=a,this.int16[T+2]=h,this.int16[T+3]=m,this.int16[T+4]=g,this.int16[T+5]=v,t}}$u.prototype.bytesPerElement=12,at("StructArrayLayout2i4i12",$u);class Uu extends Vr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,h,m,g){const v=this.length;return this.resize(v+1),this.emplace(v,t,i,a,h,m,g)}emplace(t,i,a,h,m,g,v){const T=4*t,C=8*t;return this.int16[T+0]=i,this.int16[T+1]=a,this.uint8[C+4]=h,this.uint8[C+5]=m,this.uint8[C+6]=g,this.uint8[C+7]=v,t}}Uu.prototype.bytesPerElement=8,at("StructArrayLayout2i4ub8",Uu);class Yo extends Vr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i){const a=this.length;return this.resize(a+1),this.emplace(a,t,i)}emplace(t,i,a){const h=2*t;return this.float32[h+0]=i,this.float32[h+1]=a,t}}Yo.prototype.bytesPerElement=8,at("StructArrayLayout2f8",Yo);class Zu extends Vr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,a,h,m,g,v,T,C,k){const I=this.length;return this.resize(I+1),this.emplace(I,t,i,a,h,m,g,v,T,C,k)}emplace(t,i,a,h,m,g,v,T,C,k,I){const D=10*t;return this.uint16[D+0]=i,this.uint16[D+1]=a,this.uint16[D+2]=h,this.uint16[D+3]=m,this.uint16[D+4]=g,this.uint16[D+5]=v,this.uint16[D+6]=T,this.uint16[D+7]=C,this.uint16[D+8]=k,this.uint16[D+9]=I,t}}Zu.prototype.bytesPerElement=20,at("StructArrayLayout10ui20",Zu);class p extends Vr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,a,h,m,g,v,T,C,k,I,D){const j=this.length;return this.resize(j+1),this.emplace(j,t,i,a,h,m,g,v,T,C,k,I,D)}emplace(t,i,a,h,m,g,v,T,C,k,I,D,j){const F=12*t;return this.int16[F+0]=i,this.int16[F+1]=a,this.int16[F+2]=h,this.int16[F+3]=m,this.uint16[F+4]=g,this.uint16[F+5]=v,this.uint16[F+6]=T,this.uint16[F+7]=C,this.int16[F+8]=k,this.int16[F+9]=I,this.int16[F+10]=D,this.int16[F+11]=j,t}}p.prototype.bytesPerElement=24,at("StructArrayLayout4i4ui4i24",p);class e extends Vr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a){const h=this.length;return this.resize(h+1),this.emplace(h,t,i,a)}emplace(t,i,a,h){const m=3*t;return this.float32[m+0]=i,this.float32[m+1]=a,this.float32[m+2]=h,t}}e.prototype.bytesPerElement=12,at("StructArrayLayout3f12",e);class n extends Vr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint32[1*t+0]=i,t}}n.prototype.bytesPerElement=4,at("StructArrayLayout1ul4",n);class l extends Vr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,a,h,m,g,v,T,C){const k=this.length;return this.resize(k+1),this.emplace(k,t,i,a,h,m,g,v,T,C)}emplace(t,i,a,h,m,g,v,T,C,k){const I=10*t,D=5*t;return this.int16[I+0]=i,this.int16[I+1]=a,this.int16[I+2]=h,this.int16[I+3]=m,this.int16[I+4]=g,this.int16[I+5]=v,this.uint32[D+3]=T,this.uint16[I+8]=C,this.uint16[I+9]=k,t}}l.prototype.bytesPerElement=20,at("StructArrayLayout6i1ul2ui20",l);class u extends Vr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,h,m,g){const v=this.length;return this.resize(v+1),this.emplace(v,t,i,a,h,m,g)}emplace(t,i,a,h,m,g,v){const T=6*t;return this.int16[T+0]=i,this.int16[T+1]=a,this.int16[T+2]=h,this.int16[T+3]=m,this.int16[T+4]=g,this.int16[T+5]=v,t}}u.prototype.bytesPerElement=12,at("StructArrayLayout2i2i2i12",u);class f extends Vr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,h,m){const g=this.length;return this.resize(g+1),this.emplace(g,t,i,a,h,m)}emplace(t,i,a,h,m,g){const v=4*t,T=8*t;return this.float32[v+0]=i,this.float32[v+1]=a,this.float32[v+2]=h,this.int16[T+6]=m,this.int16[T+7]=g,t}}f.prototype.bytesPerElement=16,at("StructArrayLayout2f1f2i16",f);class y extends Vr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,h,m,g){const v=this.length;return this.resize(v+1),this.emplace(v,t,i,a,h,m,g)}emplace(t,i,a,h,m,g,v){const T=16*t,C=4*t,k=8*t;return this.uint8[T+0]=i,this.uint8[T+1]=a,this.float32[C+1]=h,this.float32[C+2]=m,this.int16[k+6]=g,this.int16[k+7]=v,t}}y.prototype.bytesPerElement=16,at("StructArrayLayout2ub2f2i16",y);class w extends Vr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,a){const h=this.length;return this.resize(h+1),this.emplace(h,t,i,a)}emplace(t,i,a,h){const m=3*t;return this.uint16[m+0]=i,this.uint16[m+1]=a,this.uint16[m+2]=h,t}}w.prototype.bytesPerElement=6,at("StructArrayLayout3ui6",w);class S extends Vr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a,h,m,g,v,T,C,k,I,D,j,F,N,G,Y){const he=this.length;return this.resize(he+1),this.emplace(he,t,i,a,h,m,g,v,T,C,k,I,D,j,F,N,G,Y)}emplace(t,i,a,h,m,g,v,T,C,k,I,D,j,F,N,G,Y,he){const ee=24*t,L=12*t,Z=48*t;return this.int16[ee+0]=i,this.int16[ee+1]=a,this.uint16[ee+2]=h,this.uint16[ee+3]=m,this.uint32[L+2]=g,this.uint32[L+3]=v,this.uint32[L+4]=T,this.uint16[ee+10]=C,this.uint16[ee+11]=k,this.uint16[ee+12]=I,this.float32[L+7]=D,this.float32[L+8]=j,this.uint8[Z+36]=F,this.uint8[Z+37]=N,this.uint8[Z+38]=G,this.uint32[L+10]=Y,this.int16[ee+22]=he,t}}S.prototype.bytesPerElement=48,at("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",S);class M extends Vr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a,h,m,g,v,T,C,k,I,D,j,F,N,G,Y,he,ee,L,Z,ie,Pe,Ue,Me,De,Xe,Ge){const Ye=this.length;return this.resize(Ye+1),this.emplace(Ye,t,i,a,h,m,g,v,T,C,k,I,D,j,F,N,G,Y,he,ee,L,Z,ie,Pe,Ue,Me,De,Xe,Ge)}emplace(t,i,a,h,m,g,v,T,C,k,I,D,j,F,N,G,Y,he,ee,L,Z,ie,Pe,Ue,Me,De,Xe,Ge,Ye){const Ne=32*t,ut=16*t;return this.int16[Ne+0]=i,this.int16[Ne+1]=a,this.int16[Ne+2]=h,this.int16[Ne+3]=m,this.int16[Ne+4]=g,this.int16[Ne+5]=v,this.int16[Ne+6]=T,this.int16[Ne+7]=C,this.uint16[Ne+8]=k,this.uint16[Ne+9]=I,this.uint16[Ne+10]=D,this.uint16[Ne+11]=j,this.uint16[Ne+12]=F,this.uint16[Ne+13]=N,this.uint16[Ne+14]=G,this.uint16[Ne+15]=Y,this.uint16[Ne+16]=he,this.uint16[Ne+17]=ee,this.uint16[Ne+18]=L,this.uint16[Ne+19]=Z,this.uint16[Ne+20]=ie,this.uint16[Ne+21]=Pe,this.uint16[Ne+22]=Ue,this.uint32[ut+12]=Me,this.float32[ut+13]=De,this.float32[ut+14]=Xe,this.uint16[Ne+30]=Ge,this.uint16[Ne+31]=Ye,t}}M.prototype.bytesPerElement=64,at("StructArrayLayout8i15ui1ul2f2ui64",M);class E extends Vr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.float32[1*t+0]=i,t}}E.prototype.bytesPerElement=4,at("StructArrayLayout1f4",E);class A extends Vr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a){const h=this.length;return this.resize(h+1),this.emplace(h,t,i,a)}emplace(t,i,a,h){const m=3*t;return this.uint16[6*t+0]=i,this.float32[m+1]=a,this.float32[m+2]=h,t}}A.prototype.bytesPerElement=12,at("StructArrayLayout1ui2f12",A);class z extends Vr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,a){const h=this.length;return this.resize(h+1),this.emplace(h,t,i,a)}emplace(t,i,a,h){const m=4*t;return this.uint32[2*t+0]=i,this.uint16[m+2]=a,this.uint16[m+3]=h,t}}z.prototype.bytesPerElement=8,at("StructArrayLayout1ul2ui8",z);class B extends Vr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i){const a=this.length;return this.resize(a+1),this.emplace(a,t,i)}emplace(t,i,a){const h=2*t;return this.uint16[h+0]=i,this.uint16[h+1]=a,t}}B.prototype.bytesPerElement=4,at("StructArrayLayout2ui4",B);class O extends Vr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint16[1*t+0]=i,t}}O.prototype.bytesPerElement=2,at("StructArrayLayout1ui2",O);class X extends Vr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a,h){const m=this.length;return this.resize(m+1),this.emplace(m,t,i,a,h)}emplace(t,i,a,h,m){const g=4*t;return this.float32[g+0]=i,this.float32[g+1]=a,this.float32[g+2]=h,this.float32[g+3]=m,t}}X.prototype.bytesPerElement=16,at("StructArrayLayout4f16",X);class W extends _o{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new ce(this.anchorPointX,this.anchorPointY)}}W.prototype.size=20;class K extends l{get(t){return new W(this,t)}}at("CollisionBoxArray",K);class J extends _o{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}J.prototype.size=48;class oe extends S{get(t){return new J(this,t)}}at("PlacedSymbolArray",oe);class se extends _o{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}se.prototype.size=64;class ae extends M{get(t){return new se(this,t)}}at("SymbolInstanceArray",ae);class fe extends E{getoffsetX(t){return this.float32[1*t+0]}}at("GlyphOffsetArray",fe);class ue extends Qa{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}at("SymbolLineVertexArray",ue);class Se extends _o{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Se.prototype.size=12;class Fe extends A{get(t){return new Se(this,t)}}at("TextAnchorOffsetArray",Fe);class ke extends _o{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ke.prototype.size=8;class Ee extends z{get(t){return new ke(this,t)}}at("FeatureIndexArray",Ee);class ze extends Ya{}class nt extends Ya{}class et extends Ya{}class Ze extends $u{}class dt extends Uu{}class $t extends Yo{}class sr extends Zu{}class Lr extends p{}class wr extends e{}class jr extends n{}class Ir extends u{}class xr extends y{}class pr extends w{}class pn extends B{}const wn=Dr([{name:"a_pos",components:2,type:"Int16"}],4),{members:zn}=wn;class fr{constructor(t=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=t}prepareSegment(t,i,a,h){const m=this.segments[this.segments.length-1];return t>fr.MAX_VERTEX_ARRAY_LENGTH&&Sr(`Max vertices per segment is ${fr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${fr.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!m||m.vertexLength+t>fr.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==h?this.createNewSegment(i,a,h):m}createNewSegment(t,i,a){const h={vertexOffset:t.length,primitiveOffset:i.length,vertexLength:0,primitiveLength:0,vaos:{}};return a!==void 0&&(h.sortKey=a),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(h),h}getOrCreateLatestSegment(t,i,a){return this.prepareSegment(0,t,i,a)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const t of this.segments)for(const i in t.vaos)t.vaos[i].destroy()}static simpleSegment(t,i,a,h){return new fr([{vertexOffset:t,primitiveOffset:i,vertexLength:a,primitiveLength:h,vaos:{},sortKey:0}])}}function $s(s,t){return 256*(s=Tr(Math.floor(s),0,255))+Tr(Math.floor(t),0,255)}fr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,at("SegmentVector",fr);const as=Dr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Us,vo,Ja,Zs={exports:{}},xo={exports:{}},di={exports:{}},Gs=function(){if(Ja)return Zs.exports;Ja=1;var s=(Us||(Us=1,xo.exports=function(i,a){var h,m,g,v,T,C,k,I;for(m=i.length-(h=3&i.length),g=a,T=3432918353,C=461845907,I=0;I<m;)k=255&i.charCodeAt(I)|(255&i.charCodeAt(++I))<<8|(255&i.charCodeAt(++I))<<16|(255&i.charCodeAt(++I))<<24,++I,g=27492+(65535&(v=5*(65535&(g=(g^=k=(65535&(k=(k=(65535&k)*T+(((k>>>16)*T&65535)<<16)&4294967295)<<15|k>>>17))*C+(((k>>>16)*C&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(k=0,h){case 3:k^=(255&i.charCodeAt(I+2))<<16;case 2:k^=(255&i.charCodeAt(I+1))<<8;case 1:g^=k=(65535&(k=(k=(65535&(k^=255&i.charCodeAt(I)))*T+(((k>>>16)*T&65535)<<16)&4294967295)<<15|k>>>17))*C+(((k>>>16)*C&65535)<<16)&4294967295}return g^=i.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}),xo.exports),t=(vo||(vo=1,di.exports=function(i,a){for(var h,m=i.length,g=a^m,v=0;m>=4;)h=1540483477*(65535&(h=255&i.charCodeAt(v)|(255&i.charCodeAt(++v))<<8|(255&i.charCodeAt(++v))<<16|(255&i.charCodeAt(++v))<<24))+((1540483477*(h>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),m-=4,++v;switch(m){case 3:g^=(255&i.charCodeAt(v+2))<<16;case 2:g^=(255&i.charCodeAt(v+1))<<8;case 1:g=1540483477*(65535&(g^=255&i.charCodeAt(v)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}),di.exports);return Zs.exports=s,Zs.exports.murmur3=s,Zs.exports.murmur2=t,Zs.exports}(),ws=U(Gs);class qs{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,i,a,h){this.ids.push(sn(t)),this.positions.push(i,a,h)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const i=sn(t);let a=0,h=this.ids.length-1;for(;a<h;){const g=a+h>>1;this.ids[g]>=i?h=g:a=g+1}const m=[];for(;this.ids[a]===i;)m.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return m}static serialize(t,i){const a=new Float64Array(t.ids),h=new Uint32Array(t.positions);return on(a,h,0,a.length-1),i&&i.push(a.buffer,h.buffer),{ids:a,positions:h}}static deserialize(t){const i=new qs;return i.ids=t.ids,i.positions=t.positions,i.indexed=!0,i}}function sn(s){const t=+s;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:ws(String(s))}function on(s,t,i,a){for(;i<a;){const h=s[i+a>>1];let m=i-1,g=a+1;for(;;){do m++;while(s[m]<h);do g--;while(s[g]>h);if(m>=g)break;Kn(s,m,g),Kn(t,3*m,3*g),Kn(t,3*m+1,3*g+1),Kn(t,3*m+2,3*g+2)}g-i<a-g?(on(s,t,i,g),i=g+1):(on(s,t,g+1,a),a=g)}}function Kn(s,t,i){const a=s[t];s[t]=s[i],s[i]=a}at("FeaturePositionMap",qs);class Ar{constructor(t,i){this.gl=t.gl,this.location=i}}class dc extends Ar{constructor(t,i){super(t,i),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Hd extends Ar{constructor(t,i){super(t,i),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Wd extends Ar{constructor(t,i){super(t,i),this.current=Kt.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const lm=new Float32Array(16);function Gu(s){return[$s(255*s.r,255*s.g),$s(255*s.b,255*s.a)]}class el{constructor(t,i,a){this.value=t,this.uniformNames=i.map(h=>`u_${h}`),this.type=a}setUniform(t,i,a){t.set(a.constantOr(this.value))}getBinding(t,i,a){return this.type==="color"?new Wd(t,i):new dc(t,i)}}class Si{constructor(t,i){this.uniformNames=i.map(a=>`u_${a}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,i){this.pixelRatioFrom=i.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=i.tlbr,this.patternTo=t.tlbr}setUniform(t,i,a,h){const m=h==="u_pattern_to"?this.patternTo:h==="u_pattern_from"?this.patternFrom:h==="u_pixel_ratio_to"?this.pixelRatioTo:h==="u_pixel_ratio_from"?this.pixelRatioFrom:null;m&&t.set(m)}getBinding(t,i,a){return a.substr(0,9)==="u_pattern"?new Hd(t,i):new dc(t,i)}}class ls{constructor(t,i,a,h){this.expression=t,this.type=a,this.maxValue=0,this.paintVertexAttributes=i.map(m=>({name:`a_${m}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(t,i,a,h,m){const g=this.paintVertexArray.length,v=this.expression.evaluate(new Er(0),i,{},h,[],m);this.paintVertexArray.resize(t),this._setPaintValue(g,t,v)}updatePaintArray(t,i,a,h){const m=this.expression.evaluate({zoom:0},a,h);this._setPaintValue(t,i,m)}_setPaintValue(t,i,a){if(this.type==="color"){const h=Gu(a);for(let m=t;m<i;m++)this.paintVertexArray.emplace(m,h[0],h[1])}else{for(let h=t;h<i;h++)this.paintVertexArray.emplace(h,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Pi{constructor(t,i,a,h,m,g){this.expression=t,this.uniformNames=i.map(v=>`u_${v}_t`),this.type=a,this.useIntegerZoom=h,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=i.map(v=>({name:`a_${v}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(t,i,a,h,m){const g=this.expression.evaluate(new Er(this.zoom),i,{},h,[],m),v=this.expression.evaluate(new Er(this.zoom+1),i,{},h,[],m),T=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(T,t,g,v)}updatePaintArray(t,i,a,h){const m=this.expression.evaluate({zoom:this.zoom},a,h),g=this.expression.evaluate({zoom:this.zoom+1},a,h);this._setPaintValue(t,i,m,g)}_setPaintValue(t,i,a,h){if(this.type==="color"){const m=Gu(a),g=Gu(h);for(let v=t;v<i;v++)this.paintVertexArray.emplace(v,m[0],m[1],g[0],g[1])}else{for(let m=t;m<i;m++)this.paintVertexArray.emplace(m,a,h);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(h))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,i){const a=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,h=Tr(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);t.set(h)}getBinding(t,i,a){return new dc(t,i)}}class Ts{constructor(t,i,a,h,m,g){this.expression=t,this.type=i,this.useIntegerZoom=a,this.zoom=h,this.layerId=g,this.zoomInPaintVertexArray=new m,this.zoomOutPaintVertexArray=new m}populatePaintArray(t,i,a){const h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(h,t,i.patterns&&i.patterns[this.layerId],a)}updatePaintArray(t,i,a,h,m){this._setPaintValues(t,i,a.patterns&&a.patterns[this.layerId],m)}_setPaintValues(t,i,a,h){if(!h||!a)return;const{min:m,mid:g,max:v}=a,T=h[m],C=h[g],k=h[v];if(T&&C&&k)for(let I=t;I<i;I++)this.zoomInPaintVertexArray.emplace(I,C.tl[0],C.tl[1],C.br[0],C.br[1],T.tl[0],T.tl[1],T.br[0],T.br[1],C.pixelRatio,T.pixelRatio),this.zoomOutPaintVertexArray.emplace(I,C.tl[0],C.tl[1],C.br[0],C.br[1],k.tl[0],k.tl[1],k.br[0],k.br[1],C.pixelRatio,k.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,as.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,as.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class pc{constructor(t,i,a){this.binders={},this._buffers=[];const h=[];for(const m in t.paint._values){if(!a(m))continue;const g=t.paint.get(m);if(!(g instanceof Xn&&No(g.property.specification)))continue;const v=qu(m,t.type),T=g.value,C=g.property.specification.type,k=g.property.useIntegerZoom,I=g.property.specification["property-type"],D=I==="cross-faded"||I==="cross-faded-data-driven";if(T.kind==="constant")this.binders[m]=D?new Si(T.value,v):new el(T.value,v,C),h.push(`/u_${m}`);else if(T.kind==="source"||D){const j=Py(m,C,"source");this.binders[m]=D?new Ts(T,C,k,i,j,t.id):new ls(T,v,C,j),h.push(`/a_${m}`)}else{const j=Py(m,C,"composite");this.binders[m]=new Pi(T,v,C,k,i,j),h.push(`/z_${m}`)}}this.cacheKey=h.sort().join("")}getMaxValue(t){const i=this.binders[t];return i instanceof ls||i instanceof Pi?i.maxValue:0}populatePaintArrays(t,i,a,h,m){for(const g in this.binders){const v=this.binders[g];(v instanceof ls||v instanceof Pi||v instanceof Ts)&&v.populatePaintArray(t,i,a,h,m)}}setConstantPatternPositions(t,i){for(const a in this.binders){const h=this.binders[a];h instanceof Si&&h.setConstantPatternPositions(t,i)}}updatePaintArrays(t,i,a,h,m){let g=!1;for(const v in t){const T=i.getPositions(v);for(const C of T){const k=a.feature(C.index);for(const I in this.binders){const D=this.binders[I];if((D instanceof ls||D instanceof Pi||D instanceof Ts)&&D.expression.isStateDependent===!0){const j=h.paint.get(I);D.expression=j.value,D.updatePaintArray(C.start,C.end,k,t[v],m),g=!0}}}}return g}defines(){const t=[];for(const i in this.binders){const a=this.binders[i];(a instanceof el||a instanceof Si)&&t.push(...a.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return t}getBinderAttributes(){const t=[];for(const i in this.binders){const a=this.binders[i];if(a instanceof ls||a instanceof Pi)for(let h=0;h<a.paintVertexAttributes.length;h++)t.push(a.paintVertexAttributes[h].name);else if(a instanceof Ts)for(let h=0;h<as.members.length;h++)t.push(as.members[h].name)}return t}getBinderUniforms(){const t=[];for(const i in this.binders){const a=this.binders[i];if(a instanceof el||a instanceof Si||a instanceof Pi)for(const h of a.uniformNames)t.push(h)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,i){const a=[];for(const h in this.binders){const m=this.binders[h];if(m instanceof el||m instanceof Si||m instanceof Pi){for(const g of m.uniformNames)if(i[g]){const v=m.getBinding(t,i[g],g);a.push({name:g,property:h,binding:v})}}}return a}setUniforms(t,i,a,h){for(const{name:m,property:g,binding:v}of i)this.binders[g].setUniform(v,h,a.get(g),m)}updatePaintBuffers(t){this._buffers=[];for(const i in this.binders){const a=this.binders[i];if(t&&a instanceof Ts){const h=t.fromScale===2?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(a instanceof ls||a instanceof Pi)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(t){for(const i in this.binders){const a=this.binders[i];(a instanceof ls||a instanceof Pi||a instanceof Ts)&&a.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const i=this.binders[t];(i instanceof ls||i instanceof Pi||i instanceof Ts)&&i.destroy()}}}class Hs{constructor(t,i,a=()=>!0){this.programConfigurations={};for(const h of t)this.programConfigurations[h.id]=new pc(h,i,a);this.needsUpload=!1,this._featureMap=new qs,this._bufferOffset=0}populatePaintArrays(t,i,a,h,m,g){for(const v in this.programConfigurations)this.programConfigurations[v].populatePaintArrays(t,i,h,m,g);i.id!==void 0&&this._featureMap.add(i.id,a,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,i,a,h){for(const m of a)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(t,this._featureMap,i,m,h)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function qu(s,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[s]||[s.replace(`${t}-`,"").replace(/-/g,"_")]}function Py(s,t,i){const a={color:{source:Yo,composite:X},number:{source:E,composite:Yo}},h=function(m){return{"line-pattern":{source:sr,composite:sr},"fill-pattern":{source:sr,composite:sr},"fill-extrusion-pattern":{source:sr,composite:sr}}[m]}(s);return h&&h[i]||a[t][i]}at("ConstantBinder",el),at("CrossFadedConstantBinder",Si),at("SourceExpressionBinder",ls),at("CrossFadedCompositeBinder",Ts),at("CompositeExpressionBinder",Pi),at("ProgramConfiguration",pc,{omit:["_buffers"]}),at("ProgramConfigurationSet",Hs);const cm=Math.pow(2,14)-1,Cy=-cm-1;function tl(s){const t=qe/s.extent,i=s.loadGeometry();for(let a=0;a<i.length;a++){const h=i[a];for(let m=0;m<h.length;m++){const g=h[m],v=Math.round(g.x*t),T=Math.round(g.y*t);g.x=Tr(v,Cy,cm),g.y=Tr(T,Cy,cm),(v<g.x||v>g.x+1||T<g.y||T>g.y+1)&&Sr("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return i}function rl(s,t){return{type:s.type,id:s.id,properties:s.properties,geometry:t?tl(s):[]}}const My=-32768;function Cw(s,t,i,a,h){s.emplaceBack(My+8*t+a,My+8*i+h)}class um{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new nt,this.indexArray=new pr,this.segments=new fr,this.programConfigurations=new Hs(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,a){const h=this.layers[0],m=[];let g=null,v=!1,T=h.type==="heatmap";if(h.type==="circle"){const k=h;g=k.layout.get("circle-sort-key"),v=!g.isConstant(),T=T||k.paint.get("circle-pitch-alignment")==="map"}const C=T?i.subdivisionGranularity.circle:1;for(const{feature:k,id:I,index:D,sourceLayerIndex:j}of t){const F=this.layers[0]._featureFilter.needGeometry,N=rl(k,F);if(!this.layers[0]._featureFilter.filter(new Er(this.zoom),N,a))continue;const G=v?g.evaluate(N,{},a):void 0,Y={id:I,properties:k.properties,type:k.type,sourceLayerIndex:j,index:D,geometry:F?N.geometry:tl(k),patterns:{},sortKey:G};m.push(Y)}v&&m.sort((k,I)=>k.sortKey-I.sortKey);for(const k of m){const{geometry:I,index:D,sourceLayerIndex:j}=k,F=t[D].feature;this.addFeature(k,I,D,a,C),i.featureIndex.insert(F,I,D,j,this.index)}}update(t,i,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,zn),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,i,a,h,m=1){let g;switch(m){case 1:g=[0,7];break;case 3:g=[0,2,5,7];break;case 5:g=[0,1,3,4,6,7];break;case 7:g=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${m}; valid values are 1, 3, 5, 7.`)}const v=g.length;for(const T of i)for(const C of T){const k=C.x,I=C.y;if(k<0||k>=qe||I<0||I>=qe)continue;const D=this.segments.prepareSegment(v*v,this.layoutVertexArray,this.indexArray,t.sortKey),j=D.vertexLength;for(let F=0;F<v;F++)for(let N=0;N<v;N++)Cw(this.layoutVertexArray,k,I,g[N],g[F]);for(let F=0;F<v-1;F++)for(let N=0;N<v-1;N++){const G=j+F*v+N,Y=j+(F+1)*v+N;this.indexArray.emplaceBack(G,Y+1,G+1),this.indexArray.emplaceBack(G,Y,Y+1)}D.vertexLength+=v*v,D.primitiveLength+=(v-1)*(v-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,{},h)}}function ky(s,t){for(let i=0;i<s.length;i++)if(nl(t,s[i]))return!0;for(let i=0;i<t.length;i++)if(nl(s,t[i]))return!0;return!!hm(s,t)}function Mw(s,t,i){return!!nl(s,t)||!!dm(t,s,i)}function Ey(s,t){if(s.length===1)return Ay(t,s[0]);for(let i=0;i<t.length;i++){const a=t[i];for(let h=0;h<a.length;h++)if(nl(s,a[h]))return!0}for(let i=0;i<s.length;i++)if(Ay(t,s[i]))return!0;for(let i=0;i<t.length;i++)if(hm(s,t[i]))return!0;return!1}function kw(s,t,i){if(s.length>1){if(hm(s,t))return!0;for(let a=0;a<t.length;a++)if(dm(t[a],s,i))return!0}for(let a=0;a<s.length;a++)if(dm(s[a],t,i))return!0;return!1}function hm(s,t){if(s.length===0||t.length===0)return!1;for(let i=0;i<s.length-1;i++){const a=s[i],h=s[i+1];for(let m=0;m<t.length-1;m++)if(Ew(a,h,t[m],t[m+1]))return!0}return!1}function Ew(s,t,i,a){return mr(s,i,a)!==mr(t,i,a)&&mr(s,t,i)!==mr(s,t,a)}function dm(s,t,i){const a=i*i;if(t.length===1)return s.distSqr(t[0])<a;for(let h=1;h<t.length;h++)if(Iy(s,t[h-1],t[h])<a)return!0;return!1}function Iy(s,t,i){const a=t.distSqr(i);if(a===0)return s.distSqr(t);const h=((s.x-t.x)*(i.x-t.x)+(s.y-t.y)*(i.y-t.y))/a;return s.distSqr(h<0?t:h>1?i:i.sub(t)._mult(h)._add(t))}function Ay(s,t){for(let i=0;i<s.length;i++)if(nl(s[i],t))return!0;return!1}function nl(s,t){let i=!1;for(let a=0,h=s.length-1;a<s.length;h=a++){const m=s[a],g=s[h];m.y>t.y!=g.y>t.y&&t.x<(g.x-m.x)*(t.y-m.y)/(g.y-m.y)+m.x&&(i=!i)}return i}function Iw(s,t,i){const a=i[0],h=i[2];if(s.x<a.x&&t.x<a.x||s.x>h.x&&t.x>h.x||s.y<a.y&&t.y<a.y||s.y>h.y&&t.y>h.y)return!1;const m=mr(s,t,i[0]);return m!==mr(s,t,i[1])||m!==mr(s,t,i[2])||m!==mr(s,t,i[3])}function Hu(s,t,i){const a=t.paint.get(s).value;return a.kind==="constant"?a.value:i.programConfigurations.get(t.id).getMaxValue(s)}function Xd(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function Kd(s,t,i,a,h){if(!t[0]&&!t[1])return s;const m=ce.convert(t)._mult(h);i==="viewport"&&m._rotate(-a);const g=[];for(let v=0;v<s.length;v++)g.push(s[v].sub(m));return g}let zy,Ry;at("CircleBucket",um,{omit:["layers"]});var Aw={get paint(){return Ry=Ry||new nn({"circle-radius":new It(q.paint_circle["circle-radius"]),"circle-color":new It(q.paint_circle["circle-color"]),"circle-blur":new It(q.paint_circle["circle-blur"]),"circle-opacity":new It(q.paint_circle["circle-opacity"]),"circle-translate":new _t(q.paint_circle["circle-translate"]),"circle-translate-anchor":new _t(q.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new _t(q.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new _t(q.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new It(q.paint_circle["circle-stroke-width"]),"circle-stroke-color":new It(q.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new It(q.paint_circle["circle-stroke-opacity"])})},get layout(){return zy=zy||new nn({"circle-sort-key":new It(q.layout_circle["circle-sort-key"])})}};class zw extends Ti{constructor(t){super(t,Aw)}createBucket(t){return new um(t)}queryRadius(t){const i=t;return Hu("circle-radius",this,i)+Hu("circle-stroke-width",this,i)+Xd(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:t,feature:i,featureState:a,geometry:h,transform:m,pixelsToTileUnits:g,unwrappedTileID:v,getElevation:T}){const C=Kd(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-m.bearingInRadians,g),k=this.paint.get("circle-radius").evaluate(i,a)+this.paint.get("circle-stroke-width").evaluate(i,a),I=this.paint.get("circle-pitch-alignment")==="map",D=I?C:function(F,N,G,Y){return F.map(he=>Dy(he,N,G,Y))}(C,m,v,T),j=I?k*g:k;for(const F of h)for(const N of F){const G=I?N:Dy(N,m,v,T);let Y=j;const he=m.projectTileCoordinates(N.x,N.y,v,T).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Y*=he/m.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Y*=m.cameraToCenterDistance/he),Mw(D,G,Y))return!0}return!1}}function Dy(s,t,i,a){const h=t.projectTileCoordinates(s.x,s.y,i,a).point;return new ce((.5*h.x+.5)*t.width,(.5*-h.y+.5)*t.height)}class Ly extends um{}let jy;at("HeatmapBucket",Ly,{omit:["layers"]});var Rw={get paint(){return jy=jy||new nn({"heatmap-radius":new It(q.paint_heatmap["heatmap-radius"]),"heatmap-weight":new It(q.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new _t(q.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Nu(q.paint_heatmap["heatmap-color"]),"heatmap-opacity":new _t(q.paint_heatmap["heatmap-opacity"])})}};function pm(s,{width:t,height:i},a,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==t*i*a)throw new RangeError(`mismatched image size. expected: ${h.length} but got: ${t*i*a}`)}else h=new Uint8Array(t*i*a);return s.width=t,s.height=i,s.data=h,s}function Fy(s,{width:t,height:i},a){if(t===s.width&&i===s.height)return;const h=pm({},{width:t,height:i},a);fm(s,h,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,t),height:Math.min(s.height,i)},a),s.width=t,s.height=i,s.data=h.data}function fm(s,t,i,a,h,m){if(h.width===0||h.height===0)return t;if(h.width>s.width||h.height>s.height||i.x>s.width-h.width||i.y>s.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>t.width||h.height>t.height||a.x>t.width-h.width||a.y>t.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const g=s.data,v=t.data;if(g===v)throw new Error("srcData equals dstData, so image is already copied");for(let T=0;T<h.height;T++){const C=((i.y+T)*s.width+i.x)*m,k=((a.y+T)*t.width+a.x)*m;for(let I=0;I<h.width*m;I++)v[k+I]=g[C+I]}return t}class Wu{constructor(t,i){pm(this,t,1,i)}resize(t){Fy(this,t,1)}clone(){return new Wu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,a,h,m){fm(t,i,a,h,m,1)}}class Ni{constructor(t,i){pm(this,t,4,i)}resize(t){Fy(this,t,4)}replace(t,i){i?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Ni({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,a,h,m){fm(t,i,a,h,m,4)}}function By(s){const t={},i=s.resolution||256,a=s.clips?s.clips.length:1,h=s.image||new Ni({width:i,height:a});if(Math.log(i)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${i}`);const m=(g,v,T)=>{t[s.evaluationKey]=T;const C=s.expression.evaluate(t);h.data[g+v+0]=Math.floor(255*C.r/C.a),h.data[g+v+1]=Math.floor(255*C.g/C.a),h.data[g+v+2]=Math.floor(255*C.b/C.a),h.data[g+v+3]=Math.floor(255*C.a)};if(s.clips)for(let g=0,v=0;g<a;++g,v+=4*i)for(let T=0,C=0;T<i;T++,C+=4){const k=T/(i-1),{start:I,end:D}=s.clips[g];m(v,C,I*(1-k)+D*k)}else for(let g=0,v=0;g<i;g++,v+=4)m(0,v,g/(i-1));return h}at("AlphaImage",Wu),at("RGBAImage",Ni);const mm="big-fb";class Dw extends Ti{createBucket(t){return new Ly(t)}constructor(t){super(t,Rw),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=By({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(mm)&&this.heatmapFbos.delete(mm)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Oy;var Lw={get paint(){return Oy=Oy||new nn({"hillshade-illumination-direction":new _t(q.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new _t(q.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new _t(q.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new _t(q.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new _t(q.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new _t(q.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new _t(q.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new _t(q.paint_hillshade["hillshade-method"])})}};class jw extends Ti{constructor(t){super(t,Lw),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let t=this.paint.get("hillshade-illumination-direction").values,i=this.paint.get("hillshade-illumination-altitude").values,a=this.paint.get("hillshade-highlight-color").values,h=this.paint.get("hillshade-shadow-color").values;const m=Math.max(t.length,i.length,a.length,h.length);t=t.concat(Array(m-t.length).fill(t.at(-1))),i=i.concat(Array(m-i.length).fill(i.at(-1))),a=a.concat(Array(m-a.length).fill(a.at(-1))),h=h.concat(Array(m-h.length).fill(h.at(-1)));const g=i.map(js);return{directionRadians:t.map(js),altitudeRadians:g,shadowColor:h,highlightColor:a}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Fw=Dr([{name:"a_pos",components:2,type:"Int16"}],4),{members:Bw}=Fw;function gm(s,t,i){const a=i.patternDependencies;let h=!1;for(const m of t){const g=m.paint.get(`${s}-pattern`);g.isConstant()||(h=!0);const v=g.constantOr(null);v&&(h=!0,a[v.to]=!0,a[v.from]=!0)}return h}function _m(s,t,i,a,h){const m=h.patternDependencies;for(const g of t){const v=g.paint.get(`${s}-pattern`).value;if(v.kind!=="constant"){let T=v.evaluate({zoom:a-1},i,{},h.availableImages),C=v.evaluate({zoom:a},i,{},h.availableImages),k=v.evaluate({zoom:a+1},i,{},h.availableImages);T=T&&T.name?T.name:T,C=C&&C.name?C.name:C,k=k&&k.name?k.name:k,m[T]=!0,m[C]=!0,m[k]=!0,i.patterns[g.id]={min:T,mid:C,max:k}}}return i}function Ny(s,t,i,a,h){let m;if(h===function(g,v,T,C){let k=0;for(let I=v,D=T-C;I<T;I+=C)k+=(g[D]-g[I])*(g[I+1]+g[D+1]),D=I;return k}(s,t,i,a)>0)for(let g=t;g<i;g+=a)m=Zy(g/a|0,s[g],s[g+1],m);else for(let g=i-a;g>=t;g-=a)m=Zy(g/a|0,s[g],s[g+1],m);return m&&fc(m,m.next)&&(Qu(m),m=m.next),m}function il(s,t){if(!s)return s;t||(t=s);let i,a=s;do if(i=!1,a.steiner||!fc(a,a.next)&&Yr(a.prev,a,a.next)!==0)a=a.next;else{if(Qu(a),a=t=a.prev,a===a.next)break;i=!0}while(i||a!==t);return t}function Xu(s,t,i,a,h,m,g){if(!s)return;!g&&m&&function(T,C,k,I){let D=T;do D.z===0&&(D.z=ym(D.x,D.y,C,k,I)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==T);D.prevZ.nextZ=null,D.prevZ=null,function(j){let F,N=1;do{let G,Y=j;j=null;let he=null;for(F=0;Y;){F++;let ee=Y,L=0;for(let ie=0;ie<N&&(L++,ee=ee.nextZ,ee);ie++);let Z=N;for(;L>0||Z>0&&ee;)L!==0&&(Z===0||!ee||Y.z<=ee.z)?(G=Y,Y=Y.nextZ,L--):(G=ee,ee=ee.nextZ,Z--),he?he.nextZ=G:j=G,G.prevZ=he,he=G;Y=ee}he.nextZ=null,N*=2}while(F>1)}(D)}(s,a,h,m);let v=s;for(;s.prev!==s.next;){const T=s.prev,C=s.next;if(m?Nw(s,a,h,m):Ow(s))t.push(T.i,s.i,C.i),Qu(s),s=C.next,v=C.next;else if((s=C)===v){g?g===1?Xu(s=Vw(il(s),t),t,i,a,h,m,2):g===2&&$w(s,t,i,a,h,m):Xu(il(s),t,i,a,h,m,1);break}}}function Ow(s){const t=s.prev,i=s,a=s.next;if(Yr(t,i,a)>=0)return!1;const h=t.x,m=i.x,g=a.x,v=t.y,T=i.y,C=a.y,k=Math.min(h,m,g),I=Math.min(v,T,C),D=Math.max(h,m,g),j=Math.max(v,T,C);let F=a.next;for(;F!==t;){if(F.x>=k&&F.x<=D&&F.y>=I&&F.y<=j&&Ku(h,v,m,T,g,C,F.x,F.y)&&Yr(F.prev,F,F.next)>=0)return!1;F=F.next}return!0}function Nw(s,t,i,a){const h=s.prev,m=s,g=s.next;if(Yr(h,m,g)>=0)return!1;const v=h.x,T=m.x,C=g.x,k=h.y,I=m.y,D=g.y,j=Math.min(v,T,C),F=Math.min(k,I,D),N=Math.max(v,T,C),G=Math.max(k,I,D),Y=ym(j,F,t,i,a),he=ym(N,G,t,i,a);let ee=s.prevZ,L=s.nextZ;for(;ee&&ee.z>=Y&&L&&L.z<=he;){if(ee.x>=j&&ee.x<=N&&ee.y>=F&&ee.y<=G&&ee!==h&&ee!==g&&Ku(v,k,T,I,C,D,ee.x,ee.y)&&Yr(ee.prev,ee,ee.next)>=0||(ee=ee.prevZ,L.x>=j&&L.x<=N&&L.y>=F&&L.y<=G&&L!==h&&L!==g&&Ku(v,k,T,I,C,D,L.x,L.y)&&Yr(L.prev,L,L.next)>=0))return!1;L=L.nextZ}for(;ee&&ee.z>=Y;){if(ee.x>=j&&ee.x<=N&&ee.y>=F&&ee.y<=G&&ee!==h&&ee!==g&&Ku(v,k,T,I,C,D,ee.x,ee.y)&&Yr(ee.prev,ee,ee.next)>=0)return!1;ee=ee.prevZ}for(;L&&L.z<=he;){if(L.x>=j&&L.x<=N&&L.y>=F&&L.y<=G&&L!==h&&L!==g&&Ku(v,k,T,I,C,D,L.x,L.y)&&Yr(L.prev,L,L.next)>=0)return!1;L=L.nextZ}return!0}function Vw(s,t){let i=s;do{const a=i.prev,h=i.next.next;!fc(a,h)&&$y(a,i,i.next,h)&&Yu(a,h)&&Yu(h,a)&&(t.push(a.i,i.i,h.i),Qu(i),Qu(i.next),i=s=h),i=i.next}while(i!==s);return il(i)}function $w(s,t,i,a,h,m){let g=s;do{let v=g.next.next;for(;v!==g.prev;){if(g.i!==v.i&&Hw(g,v)){let T=Uy(g,v);return g=il(g,g.next),T=il(T,T.next),Xu(g,t,i,a,h,m,0),void Xu(T,t,i,a,h,m,0)}v=v.next}g=g.next}while(g!==s)}function Uw(s,t){let i=s.x-t.x;return i===0&&(i=s.y-t.y,i===0)&&(i=(s.next.y-s.y)/(s.next.x-s.x)-(t.next.y-t.y)/(t.next.x-t.x)),i}function Zw(s,t){const i=function(h,m){let g=m;const v=h.x,T=h.y;let C,k=-1/0;if(fc(h,g))return g;do{if(fc(h,g.next))return g.next;if(T<=g.y&&T>=g.next.y&&g.next.y!==g.y){const N=g.x+(T-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(N<=v&&N>k&&(k=N,C=g.x<g.next.x?g:g.next,N===v))return C}g=g.next}while(g!==m);if(!C)return null;const I=C,D=C.x,j=C.y;let F=1/0;g=C;do{if(v>=g.x&&g.x>=D&&v!==g.x&&Vy(T<j?v:k,T,D,j,T<j?k:v,T,g.x,g.y)){const N=Math.abs(T-g.y)/(v-g.x);Yu(g,h)&&(N<F||N===F&&(g.x>C.x||g.x===C.x&&Gw(C,g)))&&(C=g,F=N)}g=g.next}while(g!==I);return C}(s,t);if(!i)return t;const a=Uy(i,s);return il(a,a.next),il(i,i.next)}function Gw(s,t){return Yr(s.prev,s,t.prev)<0&&Yr(t.next,s,s.next)<0}function ym(s,t,i,a,h){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-i)*h|0)|s<<8))|s<<4))|s<<2))|s<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-a)*h|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function qw(s){let t=s,i=s;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==s);return i}function Vy(s,t,i,a,h,m,g,v){return(h-g)*(t-v)>=(s-g)*(m-v)&&(s-g)*(a-v)>=(i-g)*(t-v)&&(i-g)*(m-v)>=(h-g)*(a-v)}function Ku(s,t,i,a,h,m,g,v){return!(s===g&&t===v)&&Vy(s,t,i,a,h,m,g,v)}function Hw(s,t){return s.next.i!==t.i&&s.prev.i!==t.i&&!function(i,a){let h=i;do{if(h.i!==i.i&&h.next.i!==i.i&&h.i!==a.i&&h.next.i!==a.i&&$y(h,h.next,i,a))return!0;h=h.next}while(h!==i);return!1}(s,t)&&(Yu(s,t)&&Yu(t,s)&&function(i,a){let h=i,m=!1;const g=(i.x+a.x)/2,v=(i.y+a.y)/2;do h.y>v!=h.next.y>v&&h.next.y!==h.y&&g<(h.next.x-h.x)*(v-h.y)/(h.next.y-h.y)+h.x&&(m=!m),h=h.next;while(h!==i);return m}(s,t)&&(Yr(s.prev,s,t.prev)||Yr(s,t.prev,t))||fc(s,t)&&Yr(s.prev,s,s.next)>0&&Yr(t.prev,t,t.next)>0)}function Yr(s,t,i){return(t.y-s.y)*(i.x-t.x)-(t.x-s.x)*(i.y-t.y)}function fc(s,t){return s.x===t.x&&s.y===t.y}function $y(s,t,i,a){const h=Qd(Yr(s,t,i)),m=Qd(Yr(s,t,a)),g=Qd(Yr(i,a,s)),v=Qd(Yr(i,a,t));return h!==m&&g!==v||!(h!==0||!Yd(s,i,t))||!(m!==0||!Yd(s,a,t))||!(g!==0||!Yd(i,s,a))||!(v!==0||!Yd(i,t,a))}function Yd(s,t,i){return t.x<=Math.max(s.x,i.x)&&t.x>=Math.min(s.x,i.x)&&t.y<=Math.max(s.y,i.y)&&t.y>=Math.min(s.y,i.y)}function Qd(s){return s>0?1:s<0?-1:0}function Yu(s,t){return Yr(s.prev,s,s.next)<0?Yr(s,t,s.next)>=0&&Yr(s,s.prev,t)>=0:Yr(s,t,s.prev)<0||Yr(s,s.next,t)<0}function Uy(s,t){const i=vm(s.i,s.x,s.y),a=vm(t.i,t.x,t.y),h=s.next,m=t.prev;return s.next=t,t.prev=s,i.next=h,h.prev=i,a.next=i,i.prev=a,m.next=a,a.prev=m,a}function Zy(s,t,i,a){const h=vm(s,t,i);return a?(h.next=a.next,h.prev=a,a.next.prev=h,a.next=h):(h.prev=h,h.next=h),h}function Qu(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function vm(s,t,i){return{i:s,x:t,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class mc{constructor(t,i){if(i>t)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=t,this._minGranularity=i}getGranularityForZoomLevel(t){return Math.max(Math.floor(this._baseZoomGranularity/(1<<t)),this._minGranularity,1)}}class Jd{constructor(t){this.fill=t.fill,this.line=t.line,this.tile=t.tile,this.stencil=t.stencil,this.circle=t.circle}}Jd.noSubdivision=new Jd({fill:new mc(0,0),line:new mc(0,0),tile:new mc(0,0),stencil:new mc(0,0),circle:1}),at("SubdivisionGranularityExpression",mc),at("SubdivisionGranularitySetting",Jd);const gc=-32768,Ju=32767;class Ww{constructor(t,i){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=t,this._granularityCellSize=qe/t,this._canonical=i}_getKey(t,i){return(t+=32768)<<16|(i+=32768)<<0}_vertexToIndex(t,i){if(t<-32768||i<-32768||t>32767||i>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const a=0|Math.round(t),h=0|Math.round(i),m=this._getKey(a,h);if(this._vertexDictionary.has(m))return this._vertexDictionary.get(m);const g=this._vertexBuffer.length/2;return this._vertexDictionary.set(m,g),this._vertexBuffer.push(a,h),g}_subdivideTrianglesScanline(t){if(this._granularity<2)return function(h,m){const g=[];for(let v=0;v<m.length;v+=3){const T=m[v],C=m[v+1],k=m[v+2],I=h[2*T],D=h[2*T+1];(h[2*C]-I)*(h[2*k+1]-D)-(h[2*C+1]-D)*(h[2*k]-I)>0?(g.push(T),g.push(k),g.push(C)):(g.push(T),g.push(C),g.push(k))}return g}(this._vertexBuffer,t);const i=[],a=t.length;for(let h=0;h<a;h+=3){const m=[t[h+0],t[h+1],t[h+2]],g=[this._vertexBuffer[2*t[h+0]+0],this._vertexBuffer[2*t[h+0]+1],this._vertexBuffer[2*t[h+1]+0],this._vertexBuffer[2*t[h+1]+1],this._vertexBuffer[2*t[h+2]+0],this._vertexBuffer[2*t[h+2]+1]];let v=1/0,T=1/0,C=-1/0,k=-1/0;for(let N=0;N<3;N++){const G=g[2*N],Y=g[2*N+1];v=Math.min(v,G),C=Math.max(C,G),T=Math.min(T,Y),k=Math.max(k,Y)}if(v===C||T===k)continue;const I=Math.floor(v/this._granularityCellSize),D=Math.ceil(C/this._granularityCellSize),j=Math.floor(T/this._granularityCellSize),F=Math.ceil(k/this._granularityCellSize);if(I!==D||j!==F)for(let N=j;N<F;N++){const G=this._scanlineGenerateVertexRingForCellRow(N,g,m);Xw(this._vertexBuffer,G,i)}else i.push(...m)}return i}_scanlineGenerateVertexRingForCellRow(t,i,a){const h=t*this._granularityCellSize,m=h+this._granularityCellSize,g=[];for(let v=0;v<3;v++){const T=i[2*v],C=i[2*v+1],k=i[2*(v+1)%6],I=i[(2*(v+1)+1)%6],D=i[2*(v+2)%6],j=i[(2*(v+2)+1)%6],F=k-T,N=I-C,G=F===0,Y=N===0,he=(h-C)/N,ee=(m-C)/N,L=Math.min(he,ee),Z=Math.max(he,ee);if(!Y&&(L>=1||Z<=0)||Y&&(C<h||C>m)){I>=h&&I<=m&&g.push(a[(v+1)%3]);continue}!Y&&L>0&&g.push(this._vertexToIndex(T+F*L,C+N*L));const ie=T+F*Math.max(L,0),Pe=T+F*Math.min(Z,1);G||this._generateIntraEdgeVertices(g,T,C,k,I,ie,Pe),!Y&&Z<1&&g.push(this._vertexToIndex(T+F*Z,C+N*Z)),(Y||I>=h&&I<=m)&&g.push(a[(v+1)%3]),!Y&&(I<=h||I>=m)&&this._generateInterEdgeVertices(g,T,C,k,I,D,j,Pe,h,m)}return g}_generateIntraEdgeVertices(t,i,a,h,m,g,v){const T=h-i,C=m-a,k=C===0,I=k?Math.min(i,h):Math.min(g,v),D=k?Math.max(i,h):Math.max(g,v),j=Math.floor(I/this._granularityCellSize)+1,F=Math.ceil(D/this._granularityCellSize)-1;if(k?i<h:g<v)for(let N=j;N<=F;N++){const G=N*this._granularityCellSize;t.push(this._vertexToIndex(G,a+C*(G-i)/T))}else for(let N=F;N>=j;N--){const G=N*this._granularityCellSize;t.push(this._vertexToIndex(G,a+C*(G-i)/T))}}_generateInterEdgeVertices(t,i,a,h,m,g,v,T,C,k){const I=m-a,D=g-h,j=v-m,F=(C-m)/j,N=(k-m)/j,G=Math.min(F,N),Y=Math.max(F,N),he=h+D*G;let ee=Math.floor(Math.min(he,T)/this._granularityCellSize)+1,L=Math.ceil(Math.max(he,T)/this._granularityCellSize)-1,Z=T<he;const ie=j===0;if(ie&&(v===C||v===k))return;if(ie||G>=1||Y<=0){const Ue=a-v,Me=g+(i-g)*Math.min((C-v)/Ue,(k-v)/Ue);ee=Math.floor(Math.min(Me,T)/this._granularityCellSize)+1,L=Math.ceil(Math.max(Me,T)/this._granularityCellSize)-1,Z=T<Me}const Pe=I>0?k:C;if(Z)for(let Ue=ee;Ue<=L;Ue++)t.push(this._vertexToIndex(Ue*this._granularityCellSize,Pe));else for(let Ue=L;Ue>=ee;Ue--)t.push(this._vertexToIndex(Ue*this._granularityCellSize,Pe))}_generateOutline(t){const i=[];for(const a of t){const h=sl(a,this._granularity,!0),m=this._pointArrayToIndices(h),g=[];for(let v=1;v<m.length;v++)g.push(m[v-1]),g.push(m[v]);i.push(g)}return i}_handlePoles(t){let i=!1,a=!1;this._canonical&&(this._canonical.y===0&&(i=!0),this._canonical.y===(1<<this._canonical.z)-1&&(a=!0)),(i||a)&&this._fillPoles(t,i,a)}_ensureNoPoleVertices(){const t=this._vertexBuffer;for(let i=0;i<t.length;i+=2){const a=t[i+1];a===gc&&(t[i+1]=-32767),a===Ju&&(t[i+1]=32766)}}_generatePoleQuad(t,i,a,h,m,g){h>m!=(g===gc)?(t.push(i),t.push(a),t.push(this._vertexToIndex(h,g)),t.push(a),t.push(this._vertexToIndex(m,g)),t.push(this._vertexToIndex(h,g))):(t.push(a),t.push(i),t.push(this._vertexToIndex(h,g)),t.push(this._vertexToIndex(m,g)),t.push(a),t.push(this._vertexToIndex(h,g)))}_fillPoles(t,i,a){const h=this._vertexBuffer,m=qe,g=t.length;for(let v=2;v<g;v+=3){const T=t[v-2],C=t[v-1],k=t[v],I=h[2*T],D=h[2*T+1],j=h[2*C],F=h[2*C+1],N=h[2*k],G=h[2*k+1];i&&(D===0&&F===0&&this._generatePoleQuad(t,T,C,I,j,gc),F===0&&G===0&&this._generatePoleQuad(t,C,k,j,N,gc),G===0&&D===0&&this._generatePoleQuad(t,k,T,N,I,gc)),a&&(D===m&&F===m&&this._generatePoleQuad(t,T,C,I,j,Ju),F===m&&G===m&&this._generatePoleQuad(t,C,k,j,N,Ju),G===m&&D===m&&this._generatePoleQuad(t,k,T,N,I,Ju))}}_initializeVertices(t){for(let i=0;i<t.length;i+=2)this._vertexToIndex(t[i],t[i+1])}subdividePolygonInternal(t,i){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:a,holeIndices:h}=function(v){const T=[],C=[];for(const k of v)if(k.length!==0){k!==v[0]&&T.push(C.length/2);for(let I=0;I<k.length;I++)C.push(k[I].x),C.push(k[I].y)}return{flattened:C,holeIndices:T}}(t);let m;this._initializeVertices(a);try{const v=function(C,k,I=2){const D=k&&k.length,j=D?k[0]*I:C.length;let F=Ny(C,0,j,I,!0);const N=[];if(!F||F.next===F.prev)return N;let G,Y,he;if(D&&(F=function(ee,L,Z,ie){const Pe=[];for(let Ue=0,Me=L.length;Ue<Me;Ue++){const De=Ny(ee,L[Ue]*ie,Ue<Me-1?L[Ue+1]*ie:ee.length,ie,!1);De===De.next&&(De.steiner=!0),Pe.push(qw(De))}Pe.sort(Uw);for(let Ue=0;Ue<Pe.length;Ue++)Z=Zw(Pe[Ue],Z);return Z}(C,k,F,I)),C.length>80*I){G=1/0,Y=1/0;let ee=-1/0,L=-1/0;for(let Z=I;Z<j;Z+=I){const ie=C[Z],Pe=C[Z+1];ie<G&&(G=ie),Pe<Y&&(Y=Pe),ie>ee&&(ee=ie),Pe>L&&(L=Pe)}he=Math.max(ee-G,L-Y),he=he!==0?32767/he:0}return Xu(F,N,I,G,Y,he,0),N}(a,h),T=this._convertIndices(a,v);m=this._subdivideTrianglesScanline(T)}catch(v){console.error(v)}let g=[];return i&&(g=this._generateOutline(t)),this._ensureNoPoleVertices(),this._handlePoles(m),{verticesFlattened:this._vertexBuffer,indicesTriangles:m,indicesLineList:g}}_convertIndices(t,i){const a=[];for(let h=0;h<i.length;h++)a.push(this._vertexToIndex(t[2*i[h]],t[2*i[h]+1]));return a}_pointArrayToIndices(t){const i=[];for(let a=0;a<t.length;a++){const h=t[a];i.push(this._vertexToIndex(h.x,h.y))}return i}}function Gy(s,t,i,a=!0){return new Ww(i,t).subdividePolygonInternal(s,a)}function sl(s,t,i=!1){if(!s||s.length<1)return[];if(s.length<2)return[];const a=s[0],h=s[s.length-1],m=i&&(a.x!==h.x||a.y!==h.y);if(t<2)return m?[...s,s[0]]:[...s];const g=Math.floor(qe/t),v=[];v.push(new ce(s[0].x,s[0].y));const T=s.length,C=m?T:T-1;for(let k=0;k<C;k++){const I=s[k],D=k<T-1?s[k+1]:s[0],j=I.x,F=I.y,N=D.x,G=D.y,Y=j!==N,he=F!==G;if(!Y&&!he)continue;const ee=N-j,L=G-F,Z=Math.abs(ee),ie=Math.abs(L);let Pe=j,Ue=F;for(;;){const De=ee>0?(Math.floor(Pe/g)+1)*g:(Math.ceil(Pe/g)-1)*g,Xe=L>0?(Math.floor(Ue/g)+1)*g:(Math.ceil(Ue/g)-1)*g,Ge=Math.abs(Pe-De),Ye=Math.abs(Ue-Xe),Ne=Math.abs(Pe-N),ut=Math.abs(Ue-G),Pt=Y?Ge/Z:Number.POSITIVE_INFINITY,wt=he?Ye/ie:Number.POSITIVE_INFINITY;if((Ne<=Ge||!Y)&&(ut<=Ye||!he))break;if(Pt<wt&&Y||!he){Pe=De,Ue+=L*Pt;const pt=new ce(Pe,Math.round(Ue));v[v.length-1].x===pt.x&&v[v.length-1].y===pt.y||v.push(pt)}else{Pe+=ee*wt,Ue=Xe;const pt=new ce(Math.round(Pe),Ue);v[v.length-1].x===pt.x&&v[v.length-1].y===pt.y||v.push(pt)}}const Me=new ce(N,G);v[v.length-1].x===Me.x&&v[v.length-1].y===Me.y||v.push(Me)}return v}function Xw(s,t,i){if(t.length===0)throw new Error("Subdivision vertex ring is empty.");let a=0,h=s[2*t[0]];for(let T=1;T<t.length;T++){const C=s[2*t[T]];C<h&&(h=C,a=T)}const m=t.length;let g=a,v=(g+1)%m;for(;;){const T=g-1>=0?g-1:m-1,C=(v+1)%m,k=s[2*t[T]],I=s[2*t[C]],D=s[2*t[g]],j=s[2*t[g]+1],F=s[2*t[v]+1];let N=!1;if(k<I)N=!0;else if(k>I)N=!1;else{const G=F-j,Y=-(s[2*t[v]]-D),he=j<F?1:-1;((k-D)*G+(s[2*t[T]+1]-j)*Y)*he>((I-D)*G+(s[2*t[C]+1]-j)*Y)*he&&(N=!0)}if(N){const G=t[T],Y=t[g],he=t[v];G!==Y&&G!==he&&Y!==he&&i.push(he,Y,G),g--,g<0&&(g=m-1)}else{const G=t[C],Y=t[g],he=t[v];G!==Y&&G!==he&&Y!==he&&i.push(he,Y,G),v++,v>=m&&(v=0)}if(T===C)break}}function qy(s,t,i,a,h,m,g,v,T){const C=h.length/2,k=g&&v&&T;if(C<fr.MAX_VERTEX_ARRAY_LENGTH){const I=t.prepareSegment(C,i,a),D=I.vertexLength;for(let N=0;N<m.length;N+=3)a.emplaceBack(D+m[N],D+m[N+1],D+m[N+2]);let j,F;I.vertexLength+=C,I.primitiveLength+=m.length/3,k&&(F=g.prepareSegment(C,i,v),j=F.vertexLength,F.vertexLength+=C);for(let N=0;N<h.length;N+=2)s(h[N],h[N+1]);if(k)for(let N=0;N<T.length;N++){const G=T[N];for(let Y=1;Y<G.length;Y+=2)v.emplaceBack(j+G[Y-1],j+G[Y]);F.primitiveLength+=G.length/2}}else(function(I,D,j,F,N,G){const Y=[];for(let ie=0;ie<F.length/2;ie++)Y.push(-1);const he={count:0};let ee=0,L=I.getOrCreateLatestSegment(D,j),Z=L.vertexLength;for(let ie=2;ie<N.length;ie+=3){const Pe=N[ie-2],Ue=N[ie-1],Me=N[ie];let De=Y[Pe]<ee,Xe=Y[Ue]<ee,Ge=Y[Me]<ee;L.vertexLength+((De?1:0)+(Xe?1:0)+(Ge?1:0))>fr.MAX_VERTEX_ARRAY_LENGTH&&(L=I.createNewSegment(D,j),ee=he.count,De=!0,Xe=!0,Ge=!0,Z=0);const Ye=eh(Y,F,G,he,Pe,De,L),Ne=eh(Y,F,G,he,Ue,Xe,L),ut=eh(Y,F,G,he,Me,Ge,L);j.emplaceBack(Z+Ye-ee,Z+Ne-ee,Z+ut-ee),L.primitiveLength++}})(t,i,a,h,m,s),k&&function(I,D,j,F,N,G){const Y=[];for(let ie=0;ie<F.length/2;ie++)Y.push(-1);const he={count:0};let ee=0,L=I.getOrCreateLatestSegment(D,j),Z=L.vertexLength;for(let ie=0;ie<N.length;ie++){const Pe=N[ie];for(let Ue=1;Ue<N[ie].length;Ue+=2){const Me=Pe[Ue-1],De=Pe[Ue];let Xe=Y[Me]<ee,Ge=Y[De]<ee;L.vertexLength+((Xe?1:0)+(Ge?1:0))>fr.MAX_VERTEX_ARRAY_LENGTH&&(L=I.createNewSegment(D,j),ee=he.count,Xe=!0,Ge=!0,Z=0);const Ye=eh(Y,F,G,he,Me,Xe,L),Ne=eh(Y,F,G,he,De,Ge,L);j.emplaceBack(Z+Ye-ee,Z+Ne-ee),L.primitiveLength++}}}(g,i,v,h,T,s),t.forceNewSegmentOnNextPrepare(),g==null||g.forceNewSegmentOnNextPrepare()}function eh(s,t,i,a,h,m,g){if(m){const v=a.count;return i(t[2*h],t[2*h+1]),s[h]=a.count,a.count++,g.vertexLength++,v}return s[h]}class xm{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new et,this.indexArray=new pr,this.indexArray2=new pn,this.programConfigurations=new Hs(t.layers,t.zoom),this.segments=new fr,this.segments2=new fr,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,a){this.hasPattern=gm("fill",this.layers,i);const h=this.layers[0].layout.get("fill-sort-key"),m=!h.isConstant(),g=[];for(const{feature:v,id:T,index:C,sourceLayerIndex:k}of t){const I=this.layers[0]._featureFilter.needGeometry,D=rl(v,I);if(!this.layers[0]._featureFilter.filter(new Er(this.zoom),D,a))continue;const j=m?h.evaluate(D,{},a,i.availableImages):void 0,F={id:T,properties:v.properties,type:v.type,sourceLayerIndex:k,index:C,geometry:I?D.geometry:tl(v),patterns:{},sortKey:j};g.push(F)}m&&g.sort((v,T)=>v.sortKey-T.sortKey);for(const v of g){const{geometry:T,index:C,sourceLayerIndex:k}=v;if(this.hasPattern){const I=_m("fill",this.layers,v,this.zoom,i);this.patternFeatures.push(I)}else this.addFeature(v,T,C,a,{},i.subdivisionGranularity);i.featureIndex.insert(t[C].feature,T,C,k,this.index)}}update(t,i,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,a)}addFeatures(t,i,a){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,i,a,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Bw),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,i,a,h,m,g){for(const v of Bl(i,500)){const T=Gy(v,h,g.fill.getGranularityForZoomLevel(h.z)),C=this.layoutVertexArray;qy((k,I)=>{C.emplaceBack(k,I)},this.segments,this.layoutVertexArray,this.indexArray,T.verticesFlattened,T.indicesTriangles,this.segments2,this.indexArray2,T.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,m,h)}}let Hy,Wy;at("FillBucket",xm,{omit:["layers","patternFeatures"]});var Kw={get paint(){return Wy=Wy||new nn({"fill-antialias":new _t(q.paint_fill["fill-antialias"]),"fill-opacity":new It(q.paint_fill["fill-opacity"]),"fill-color":new It(q.paint_fill["fill-color"]),"fill-outline-color":new It(q.paint_fill["fill-outline-color"]),"fill-translate":new _t(q.paint_fill["fill-translate"]),"fill-translate-anchor":new _t(q.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ka(q.paint_fill["fill-pattern"])})},get layout(){return Hy=Hy||new nn({"fill-sort-key":new It(q.layout_fill["fill-sort-key"])})}};class Yw extends Ti{constructor(t){super(t,Kw)}recalculate(t,i){super.recalculate(t,i);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new xm(t)}queryRadius(){return Xd(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:t,geometry:i,transform:a,pixelsToTileUnits:h}){return Ey(Kd(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-a.bearingInRadians,h),i)}isTileClipped(){return!0}}const Qw=Dr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Jw=Dr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:e2}=Qw;var bm,Xy,wm,Ky,Tm,Yy,Qy,ep={};function Jy(){if(Xy)return bm;Xy=1;var s=ye();function t(h,m,g,v,T){this.properties={},this.extent=g,this.type=0,this._pbf=h,this._geometry=-1,this._keys=v,this._values=T,h.readFields(i,this,m)}function i(h,m,g){h==1?m.id=g.readVarint():h==2?function(v,T){for(var C=v.readVarint()+v.pos;v.pos<C;){var k=T._keys[v.readVarint()],I=T._values[v.readVarint()];T.properties[k]=I}}(g,m):h==3?m.type=g.readVarint():h==4&&(m._geometry=g.pos)}function a(h){for(var m,g,v=0,T=0,C=h.length,k=C-1;T<C;k=T++)v+=((g=h[k]).x-(m=h[T]).x)*(m.y+g.y);return v}return bm=t,t.types=["Unknown","Point","LineString","Polygon"],t.prototype.loadGeometry=function(){var h=this._pbf;h.pos=this._geometry;for(var m,g=h.readVarint()+h.pos,v=1,T=0,C=0,k=0,I=[];h.pos<g;){if(T<=0){var D=h.readVarint();v=7&D,T=D>>3}if(T--,v===1||v===2)C+=h.readSVarint(),k+=h.readSVarint(),v===1&&(m&&I.push(m),m=[]),m.push(new s(C,k));else{if(v!==7)throw new Error("unknown command "+v);m&&m.push(m[0].clone())}}return m&&I.push(m),I},t.prototype.bbox=function(){var h=this._pbf;h.pos=this._geometry;for(var m=h.readVarint()+h.pos,g=1,v=0,T=0,C=0,k=1/0,I=-1/0,D=1/0,j=-1/0;h.pos<m;){if(v<=0){var F=h.readVarint();g=7&F,v=F>>3}if(v--,g===1||g===2)(T+=h.readSVarint())<k&&(k=T),T>I&&(I=T),(C+=h.readSVarint())<D&&(D=C),C>j&&(j=C);else if(g!==7)throw new Error("unknown command "+g)}return[k,D,I,j]},t.prototype.toGeoJSON=function(h,m,g){var v,T,C=this.extent*Math.pow(2,g),k=this.extent*h,I=this.extent*m,D=this.loadGeometry(),j=t.types[this.type];function F(Y){for(var he=0;he<Y.length;he++){var ee=Y[he];Y[he]=[360*(ee.x+k)/C-180,360/Math.PI*Math.atan(Math.exp((180-360*(ee.y+I)/C)*Math.PI/180))-90]}}switch(this.type){case 1:var N=[];for(v=0;v<D.length;v++)N[v]=D[v][0];F(D=N);break;case 2:for(v=0;v<D.length;v++)F(D[v]);break;case 3:for(D=function(Y){var he=Y.length;if(he<=1)return[Y];for(var ee,L,Z=[],ie=0;ie<he;ie++){var Pe=a(Y[ie]);Pe!==0&&(L===void 0&&(L=Pe<0),L===Pe<0?(ee&&Z.push(ee),ee=[Y[ie]]):ee.push(Y[ie]))}return ee&&Z.push(ee),Z}(D),v=0;v<D.length;v++)for(T=0;T<D[v].length;T++)F(D[v][T])}D.length===1?D=D[0]:j="Multi"+j;var G={type:"Feature",geometry:{type:j,coordinates:D},properties:this.properties};return"id"in this&&(G.id=this.id),G},bm}function ev(){if(Ky)return wm;Ky=1;var s=Jy();function t(a,h){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(i,this,h),this.length=this._features.length}function i(a,h,m){a===15?h.version=m.readVarint():a===1?h.name=m.readString():a===5?h.extent=m.readVarint():a===2?h._features.push(m.pos):a===3?h._keys.push(m.readString()):a===4&&h._values.push(function(g){for(var v=null,T=g.readVarint()+g.pos;g.pos<T;){var C=g.readVarint()>>3;v=C===1?g.readString():C===2?g.readFloat():C===3?g.readDouble():C===4?g.readVarint64():C===5?g.readVarint():C===6?g.readSVarint():C===7?g.readBoolean():null}return v}(m))}return wm=t,t.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var h=this._pbf.readVarint()+this._pbf.pos;return new s(this._pbf,h,this.extent,this._keys,this._values)},wm}function tv(){return Qy||(Qy=1,ep.VectorTile=function(){if(Yy)return Tm;Yy=1;var s=ev();function t(i,a,h){if(i===3){var m=new s(h,h.readVarint()+h.pos);m.length&&(a[m.name]=m)}}return Tm=function(i,a){this.layers=i.readFields(t,{},a)},Tm}(),ep.VectorTileFeature=Jy(),ep.VectorTileLayer=ev()),ep}var th=U(tv());const t2=th.VectorTileFeature.types,Sm=Math.pow(2,13);function rh(s,t,i,a,h,m,g,v){s.emplaceBack(t,i,2*Math.floor(a*Sm)+g,h*Sm*2,m*Sm*2,Math.round(v))}class Pm{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Ze,this.centroidVertexArray=new ze,this.indexArray=new pr,this.programConfigurations=new Hs(t.layers,t.zoom),this.segments=new fr,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,a){this.features=[],this.hasPattern=gm("fill-extrusion",this.layers,i);for(const{feature:h,id:m,index:g,sourceLayerIndex:v}of t){const T=this.layers[0]._featureFilter.needGeometry,C=rl(h,T);if(!this.layers[0]._featureFilter.filter(new Er(this.zoom),C,a))continue;const k={id:m,sourceLayerIndex:v,index:g,geometry:T?C.geometry:tl(h),properties:h.properties,type:h.type,patterns:{}};this.hasPattern?this.features.push(_m("fill-extrusion",this.layers,k,this.zoom,i)):this.addFeature(k,k.geometry,g,a,{},i.subdivisionGranularity),i.featureIndex.insert(h,k.geometry,g,v,this.index,!0)}}addFeatures(t,i,a){for(const h of this.features){const{geometry:m}=h;this.addFeature(h,m,h.index,i,a,t.subdivisionGranularity)}}update(t,i,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,e2),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Jw.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,i,a,h,m,g){for(const v of Bl(i,500)){const T={x:0,y:0,sampleCount:0},C=this.layoutVertexArray.length;this.processPolygon(T,h,t,v,g);const k=this.layoutVertexArray.length-C,I=Math.floor(T.x/T.sampleCount),D=Math.floor(T.y/T.sampleCount);for(let j=0;j<k;j++)this.centroidVertexArray.emplaceBack(I,D)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,m,h)}processPolygon(t,i,a,h,m){if(h.length<1||rv(h[0]))return;for(const I of h)I.length!==0&&r2(t,I);const g={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},v=m.fill.getGranularityForZoomLevel(i.z),T=t2[a.type]==="Polygon";for(const I of h){if(I.length===0||rv(I))continue;const D=sl(I,v,T);this._generateSideFaces(D,g)}if(!T)return;const C=Gy(h,i,v,!1),k=this.layoutVertexArray;qy((I,D)=>{rh(k,I,D,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,C.verticesFlattened,C.indicesTriangles)}_generateSideFaces(t,i){let a=0;for(let h=1;h<t.length;h++){const m=t[h],g=t[h-1];if(n2(m,g))continue;i.segment.vertexLength+4>fr.MAX_VERTEX_ARRAY_LENGTH&&(i.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const v=m.sub(g)._perp()._unit(),T=g.dist(m);a+T>32768&&(a=0),rh(this.layoutVertexArray,m.x,m.y,v.x,v.y,0,0,a),rh(this.layoutVertexArray,m.x,m.y,v.x,v.y,0,1,a),a+=T,rh(this.layoutVertexArray,g.x,g.y,v.x,v.y,0,0,a),rh(this.layoutVertexArray,g.x,g.y,v.x,v.y,0,1,a);const C=i.segment.vertexLength;this.indexArray.emplaceBack(C,C+2,C+1),this.indexArray.emplaceBack(C+1,C+2,C+3),i.segment.vertexLength+=4,i.segment.primitiveLength+=2}}}function r2(s,t){for(let i=0;i<t.length;i++){const a=t[i];i===t.length-1&&t[0].x===a.x&&t[0].y===a.y||(s.x+=a.x,s.y+=a.y,s.sampleCount++)}}function n2(s,t){return s.x===t.x&&(s.x<0||s.x>qe)||s.y===t.y&&(s.y<0||s.y>qe)}function rv(s){return s.every(t=>t.x<0)||s.every(t=>t.x>qe)||s.every(t=>t.y<0)||s.every(t=>t.y>qe)}let nv;at("FillExtrusionBucket",Pm,{omit:["layers","features"]});var i2={get paint(){return nv=nv||new nn({"fill-extrusion-opacity":new _t(q["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new It(q["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new _t(q["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new _t(q["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ka(q["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new It(q["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new It(q["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new _t(q["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class s2 extends Ti{constructor(t){super(t,i2)}createBucket(t){return new Pm(t)}queryRadius(){return Xd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:t,feature:i,featureState:a,geometry:h,transform:m,pixelsToTileUnits:g,pixelPosMatrix:v}){const T=Kd(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-m.bearingInRadians,g),C=this.paint.get("fill-extrusion-height").evaluate(i,a),k=this.paint.get("fill-extrusion-base").evaluate(i,a),I=function(j,F,N){const G=[];for(const Y of j){const he=[Y.x,Y.y,0,1];Wt(he,he,F),G.push(new ce(he[0]/he[3],he[1]/he[3]))}return G}(T,v),D=function(j,F,N,G){const Y=[],he=[],ee=G[8]*F,L=G[9]*F,Z=G[10]*F,ie=G[11]*F,Pe=G[8]*N,Ue=G[9]*N,Me=G[10]*N,De=G[11]*N;for(const Xe of j){const Ge=[],Ye=[];for(const Ne of Xe){const ut=Ne.x,Pt=Ne.y,wt=G[0]*ut+G[4]*Pt+G[12],pt=G[1]*ut+G[5]*Pt+G[13],rr=G[2]*ut+G[6]*Pt+G[14],$r=G[3]*ut+G[7]*Pt+G[15],mn=rr+Z,$n=$r+ie,$i=wt+Pe,fi=pt+Ue,Rn=rr+Me,Fr=$r+De,Tn=new ce((wt+ee)/$n,(pt+L)/$n);Tn.z=mn/$n,Ge.push(Tn);const Dn=new ce($i/Fr,fi/Fr);Dn.z=Rn/Fr,Ye.push(Dn)}Y.push(Ge),he.push(Ye)}return[Y,he]}(h,k,C,v);return function(j,F,N){let G=1/0;Ey(N,F)&&(G=iv(N,F[0]));for(let Y=0;Y<F.length;Y++){const he=F[Y],ee=j[Y];for(let L=0;L<he.length-1;L++){const Z=he[L],ie=[Z,he[L+1],ee[L+1],ee[L],Z];ky(N,ie)&&(G=Math.min(G,iv(N,ie)))}}return G!==1/0&&G}(D[0],D[1],I)}}function nh(s,t){return s.x*t.x+s.y*t.y}function iv(s,t){if(s.length===1){let i=0;const a=t[i++];let h;for(;!h||a.equals(h);)if(h=t[i++],!h)return 1/0;for(;i<t.length;i++){const m=t[i],g=s[0],v=h.sub(a),T=m.sub(a),C=g.sub(a),k=nh(v,v),I=nh(v,T),D=nh(T,T),j=nh(C,v),F=nh(C,T),N=k*D-I*I,G=(D*j-I*F)/N,Y=(k*F-I*j)/N,he=a.z*(1-G-Y)+h.z*G+m.z*Y;if(isFinite(he))return he}return 1/0}{let i=1/0;for(const a of t)i=Math.min(i,a.z);return i}}const o2=Dr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:a2}=o2,l2=Dr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:c2}=l2,u2=th.VectorTileFeature.types,h2=Math.cos(Math.PI/180*37.5),sv=Math.pow(2,14)/.5;class Cm{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new dt,this.layoutVertexArray2=new $t,this.indexArray=new pr,this.programConfigurations=new Hs(t.layers,t.zoom),this.segments=new fr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,a){this.hasPattern=gm("line",this.layers,i);const h=this.layers[0].layout.get("line-sort-key"),m=!h.isConstant(),g=[];for(const{feature:v,id:T,index:C,sourceLayerIndex:k}of t){const I=this.layers[0]._featureFilter.needGeometry,D=rl(v,I);if(!this.layers[0]._featureFilter.filter(new Er(this.zoom),D,a))continue;const j=m?h.evaluate(D,{},a):void 0,F={id:T,properties:v.properties,type:v.type,sourceLayerIndex:k,index:C,geometry:I?D.geometry:tl(v),patterns:{},sortKey:j};g.push(F)}m&&g.sort((v,T)=>v.sortKey-T.sortKey);for(const v of g){const{geometry:T,index:C,sourceLayerIndex:k}=v;if(this.hasPattern){const I=_m("line",this.layers,v,this.zoom,i);this.patternFeatures.push(I)}else this.addFeature(v,T,C,a,{},i.subdivisionGranularity);i.featureIndex.insert(t[C].feature,T,C,k,this.index)}}update(t,i,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,a)}addFeatures(t,i,a){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,i,a,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,c2)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,a2),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,i,a,h,m,g){const v=this.layers[0].layout,T=v.get("line-join").evaluate(t,{}),C=v.get("line-cap"),k=v.get("line-miter-limit"),I=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const D of i)this.addLine(D,t,T,C,k,I,h,g);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,m,h)}addLine(t,i,a,h,m,g,v,T){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,t=sl(t,v?T.line.getGranularityForZoomLevel(v.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ee=0;ee<t.length-1;ee++)this.totalDistance+=t[ee].dist(t[ee+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const C=u2[i.type]==="Polygon";let k=t.length;for(;k>=2&&t[k-1].equals(t[k-2]);)k--;let I=0;for(;I<k-1&&t[I].equals(t[I+1]);)I++;if(k<(C?3:2))return;a==="bevel"&&(m=1.05);const D=this.overscaling<=16?15*qe/(512*this.overscaling):0,j=this.segments.prepareSegment(10*k,this.layoutVertexArray,this.indexArray);let F,N,G,Y,he;this.e1=this.e2=-1,C&&(F=t[k-2],he=t[I].sub(F)._unit()._perp());for(let ee=I;ee<k;ee++){if(G=ee===k-1?C?t[I+1]:void 0:t[ee+1],G&&t[ee].equals(G))continue;he&&(Y=he),F&&(N=F),F=t[ee],he=G?G.sub(F)._unit()._perp():Y,Y=Y||he;let L=Y.add(he);L.x===0&&L.y===0||L._unit();const Z=Y.x*he.x+Y.y*he.y,ie=L.x*he.x+L.y*he.y,Pe=ie!==0?1/ie:1/0,Ue=2*Math.sqrt(2-2*ie),Me=ie<h2&&N&&G,De=Y.x*he.y-Y.y*he.x>0;if(Me&&ee>I){const Ye=F.dist(N);if(Ye>2*D){const Ne=F.sub(F.sub(N)._mult(D/Ye)._round());this.updateDistance(N,Ne),this.addCurrentVertex(Ne,Y,0,0,j),N=Ne}}const Xe=N&&G;let Ge=Xe?a:C?"butt":h;if(Xe&&Ge==="round"&&(Pe<g?Ge="miter":Pe<=2&&(Ge="fakeround")),Ge==="miter"&&Pe>m&&(Ge="bevel"),Ge==="bevel"&&(Pe>2&&(Ge="flipbevel"),Pe<m&&(Ge="miter")),N&&this.updateDistance(N,F),Ge==="miter")L._mult(Pe),this.addCurrentVertex(F,L,0,0,j);else if(Ge==="flipbevel"){if(Pe>100)L=he.mult(-1);else{const Ye=Pe*Y.add(he).mag()/Y.sub(he).mag();L._perp()._mult(Ye*(De?-1:1))}this.addCurrentVertex(F,L,0,0,j),this.addCurrentVertex(F,L.mult(-1),0,0,j)}else if(Ge==="bevel"||Ge==="fakeround"){const Ye=-Math.sqrt(Pe*Pe-1),Ne=De?Ye:0,ut=De?0:Ye;if(N&&this.addCurrentVertex(F,Y,Ne,ut,j),Ge==="fakeround"){const Pt=Math.round(180*Ue/Math.PI/20);for(let wt=1;wt<Pt;wt++){let pt=wt/Pt;if(pt!==.5){const $r=pt-.5;pt+=pt*$r*(pt-1)*((1.0904+Z*(Z*(3.55645-1.43519*Z)-3.2452))*$r*$r+(.848013+Z*(.215638*Z-1.06021)))}const rr=he.sub(Y)._mult(pt)._add(Y)._unit()._mult(De?-1:1);this.addHalfVertex(F,rr.x,rr.y,!1,De,0,j)}}G&&this.addCurrentVertex(F,he,-Ne,-ut,j)}else if(Ge==="butt")this.addCurrentVertex(F,L,0,0,j);else if(Ge==="square"){const Ye=N?1:-1;this.addCurrentVertex(F,L,Ye,Ye,j)}else Ge==="round"&&(N&&(this.addCurrentVertex(F,Y,0,0,j),this.addCurrentVertex(F,Y,1,1,j,!0)),G&&(this.addCurrentVertex(F,he,-1,-1,j,!0),this.addCurrentVertex(F,he,0,0,j)));if(Me&&ee<k-1){const Ye=F.dist(G);if(Ye>2*D){const Ne=F.add(G.sub(F)._mult(D/Ye)._round());this.updateDistance(F,Ne),this.addCurrentVertex(Ne,he,0,0,j),F=Ne}}}}addCurrentVertex(t,i,a,h,m,g=!1){const v=i.y*h-i.x,T=-i.y-i.x*h;this.addHalfVertex(t,i.x+i.y*a,i.y-i.x*a,g,!1,a,m),this.addHalfVertex(t,v,T,g,!0,-h,m),this.distance>sv/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,i,a,h,m,g))}addHalfVertex({x:t,y:i},a,h,m,g,v,T){const C=.5*(this.lineClips?this.scaledDistance*(sv-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(m?1:0),(i<<1)+(g?1:0),Math.round(63*a)+128,Math.round(63*h)+128,1+(v===0?0:v<0?-1:1)|(63&C)<<2,C>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const k=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,k,this.e2),T.primitiveLength++),g?this.e2=k:this.e1=k}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,i){this.distance+=t.dist(i),this.updateScaledDistance()}}let ov,av;at("LineBucket",Cm,{omit:["layers","patternFeatures"]});var lv={get paint(){return av=av||new nn({"line-opacity":new It(q.paint_line["line-opacity"]),"line-color":new It(q.paint_line["line-color"]),"line-translate":new _t(q.paint_line["line-translate"]),"line-translate-anchor":new _t(q.paint_line["line-translate-anchor"]),"line-width":new It(q.paint_line["line-width"]),"line-gap-width":new It(q.paint_line["line-gap-width"]),"line-offset":new It(q.paint_line["line-offset"]),"line-blur":new It(q.paint_line["line-blur"]),"line-dasharray":new Ou(q.paint_line["line-dasharray"]),"line-pattern":new Ka(q.paint_line["line-pattern"]),"line-gradient":new Nu(q.paint_line["line-gradient"])})},get layout(){return ov=ov||new nn({"line-cap":new _t(q.layout_line["line-cap"]),"line-join":new It(q.layout_line["line-join"]),"line-miter-limit":new _t(q.layout_line["line-miter-limit"]),"line-round-limit":new _t(q.layout_line["line-round-limit"]),"line-sort-key":new It(q.layout_line["line-sort-key"])})}};class d2 extends It{possiblyEvaluate(t,i){return i=new Er(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,zoomHistory:i.zoomHistory,transition:i.transition}),super.possiblyEvaluate(t,i)}evaluate(t,i,a,h){return i=Xr({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(t,i,a,h)}}let tp;class p2 extends Ti{constructor(t){super(t,lv),this.gradientVersion=0,tp||(tp=new d2(lv.paint.properties["line-width"].specification),tp.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const i=this.gradientExpression();this.stepInterpolant=!!function(a){return a._styleExpression!==void 0}(i)&&i._styleExpression.expression instanceof Os,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,i){super.recalculate(t,i),this.paint._values["line-floorwidth"]=tp.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Cm(t)}queryRadius(t){const i=t,a=cv(Hu("line-width",this,i),Hu("line-gap-width",this,i)),h=Hu("line-offset",this,i);return a/2+Math.abs(h)+Xd(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:t,feature:i,featureState:a,geometry:h,transform:m,pixelsToTileUnits:g}){const v=Kd(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-m.bearingInRadians,g),T=g/2*cv(this.paint.get("line-width").evaluate(i,a),this.paint.get("line-gap-width").evaluate(i,a)),C=this.paint.get("line-offset").evaluate(i,a);return C&&(h=function(k,I){const D=[];for(let j=0;j<k.length;j++){const F=k[j],N=[];for(let G=0;G<F.length;G++){const Y=F[G-1],he=F[G],ee=F[G+1],L=G===0?new ce(0,0):he.sub(Y)._unit()._perp(),Z=G===F.length-1?new ce(0,0):ee.sub(he)._unit()._perp(),ie=L._add(Z)._unit(),Pe=ie.x*Z.x+ie.y*Z.y;Pe!==0&&ie._mult(1/Pe),N.push(ie._mult(I)._add(he))}D.push(N)}return D}(h,C*g)),function(k,I,D){for(let j=0;j<I.length;j++){const F=I[j];if(k.length>=3){for(let N=0;N<F.length;N++)if(nl(k,F[N]))return!0}if(kw(k,F,D))return!0}return!1}(v,h,T)}isTileClipped(){return!0}}function cv(s,t){return t>0?t+2*s:s}const f2=Dr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),m2=Dr([{name:"a_projected_pos",components:3,type:"Float32"}],4);Dr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const g2=Dr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Dr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const uv=Dr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),_2=Dr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function y2(s,t,i){return s.sections.forEach(a=>{a.text=function(h,m,g){const v=m.layout.get("text-transform").evaluate(g,{});return v==="uppercase"?h=h.toLocaleUpperCase():v==="lowercase"&&(h=h.toLocaleLowerCase()),bs.applyArabicShaping&&(h=bs.applyArabicShaping(h)),h}(a.text,t,i)}),s}Dr([{name:"triangle",components:3,type:"Uint16"}]),Dr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Dr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Dr([{type:"Float32",name:"offsetX"}]),Dr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Dr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const ih={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var hv,Mm,dv,fn=24,km={};function v2(){return hv||(hv=1,km.read=function(s,t,i,a,h){var m,g,v=8*h-a-1,T=(1<<v)-1,C=T>>1,k=-7,I=i?h-1:0,D=i?-1:1,j=s[t+I];for(I+=D,m=j&(1<<-k)-1,j>>=-k,k+=v;k>0;m=256*m+s[t+I],I+=D,k-=8);for(g=m&(1<<-k)-1,m>>=-k,k+=a;k>0;g=256*g+s[t+I],I+=D,k-=8);if(m===0)m=1-C;else{if(m===T)return g?NaN:1/0*(j?-1:1);g+=Math.pow(2,a),m-=C}return(j?-1:1)*g*Math.pow(2,m-a)},km.write=function(s,t,i,a,h,m){var g,v,T,C=8*m-h-1,k=(1<<C)-1,I=k>>1,D=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,j=a?0:m-1,F=a?1:-1,N=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(v=isNaN(t)?1:0,g=k):(g=Math.floor(Math.log(t)/Math.LN2),t*(T=Math.pow(2,-g))<1&&(g--,T*=2),(t+=g+I>=1?D/T:D*Math.pow(2,1-I))*T>=2&&(g++,T/=2),g+I>=k?(v=0,g=k):g+I>=1?(v=(t*T-1)*Math.pow(2,h),g+=I):(v=t*Math.pow(2,I-1)*Math.pow(2,h),g=0));h>=8;s[i+j]=255&v,j+=F,v/=256,h-=8);for(g=g<<h|v,C+=h;C>0;s[i+j]=255&g,j+=F,g/=256,C-=8);s[i+j-F]|=128*N}),km}function pv(){if(dv)return Mm;dv=1,Mm=t;var s=v2();function t(L){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(L)?L:new Uint8Array(L||0),this.pos=0,this.type=0,this.length=this.buf.length}t.Varint=0,t.Fixed64=1,t.Bytes=2,t.Fixed32=5;var i=4294967296,a=1/i,h=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function m(L){return L.type===t.Bytes?L.readVarint()+L.pos:L.pos+1}function g(L,Z,ie){return ie?4294967296*Z+(L>>>0):4294967296*(Z>>>0)+(L>>>0)}function v(L,Z,ie){var Pe=Z<=16383?1:Z<=2097151?2:Z<=268435455?3:Math.floor(Math.log(Z)/(7*Math.LN2));ie.realloc(Pe);for(var Ue=ie.pos-1;Ue>=L;Ue--)ie.buf[Ue+Pe]=ie.buf[Ue]}function T(L,Z){for(var ie=0;ie<L.length;ie++)Z.writeVarint(L[ie])}function C(L,Z){for(var ie=0;ie<L.length;ie++)Z.writeSVarint(L[ie])}function k(L,Z){for(var ie=0;ie<L.length;ie++)Z.writeFloat(L[ie])}function I(L,Z){for(var ie=0;ie<L.length;ie++)Z.writeDouble(L[ie])}function D(L,Z){for(var ie=0;ie<L.length;ie++)Z.writeBoolean(L[ie])}function j(L,Z){for(var ie=0;ie<L.length;ie++)Z.writeFixed32(L[ie])}function F(L,Z){for(var ie=0;ie<L.length;ie++)Z.writeSFixed32(L[ie])}function N(L,Z){for(var ie=0;ie<L.length;ie++)Z.writeFixed64(L[ie])}function G(L,Z){for(var ie=0;ie<L.length;ie++)Z.writeSFixed64(L[ie])}function Y(L,Z){return(L[Z]|L[Z+1]<<8|L[Z+2]<<16)+16777216*L[Z+3]}function he(L,Z,ie){L[ie]=Z,L[ie+1]=Z>>>8,L[ie+2]=Z>>>16,L[ie+3]=Z>>>24}function ee(L,Z){return(L[Z]|L[Z+1]<<8|L[Z+2]<<16)+(L[Z+3]<<24)}return t.prototype={destroy:function(){this.buf=null},readFields:function(L,Z,ie){for(ie=ie||this.length;this.pos<ie;){var Pe=this.readVarint(),Ue=Pe>>3,Me=this.pos;this.type=7&Pe,L(Ue,Z,this),this.pos===Me&&this.skip(Pe)}return Z},readMessage:function(L,Z){return this.readFields(L,Z,this.readVarint()+this.pos)},readFixed32:function(){var L=Y(this.buf,this.pos);return this.pos+=4,L},readSFixed32:function(){var L=ee(this.buf,this.pos);return this.pos+=4,L},readFixed64:function(){var L=Y(this.buf,this.pos)+Y(this.buf,this.pos+4)*i;return this.pos+=8,L},readSFixed64:function(){var L=Y(this.buf,this.pos)+ee(this.buf,this.pos+4)*i;return this.pos+=8,L},readFloat:function(){var L=s.read(this.buf,this.pos,!0,23,4);return this.pos+=4,L},readDouble:function(){var L=s.read(this.buf,this.pos,!0,52,8);return this.pos+=8,L},readVarint:function(L){var Z,ie,Pe=this.buf;return Z=127&(ie=Pe[this.pos++]),ie<128?Z:(Z|=(127&(ie=Pe[this.pos++]))<<7,ie<128?Z:(Z|=(127&(ie=Pe[this.pos++]))<<14,ie<128?Z:(Z|=(127&(ie=Pe[this.pos++]))<<21,ie<128?Z:function(Ue,Me,De){var Xe,Ge,Ye=De.buf;if(Xe=(112&(Ge=Ye[De.pos++]))>>4,Ge<128||(Xe|=(127&(Ge=Ye[De.pos++]))<<3,Ge<128)||(Xe|=(127&(Ge=Ye[De.pos++]))<<10,Ge<128)||(Xe|=(127&(Ge=Ye[De.pos++]))<<17,Ge<128)||(Xe|=(127&(Ge=Ye[De.pos++]))<<24,Ge<128)||(Xe|=(1&(Ge=Ye[De.pos++]))<<31,Ge<128))return g(Ue,Xe,Me);throw new Error("Expected varint not more than 10 bytes")}(Z|=(15&(ie=Pe[this.pos]))<<28,L,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var L=this.readVarint();return L%2==1?(L+1)/-2:L/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var L=this.readVarint()+this.pos,Z=this.pos;return this.pos=L,L-Z>=12&&h?function(ie,Pe,Ue){return h.decode(ie.subarray(Pe,Ue))}(this.buf,Z,L):function(ie,Pe,Ue){for(var Me="",De=Pe;De<Ue;){var Xe,Ge,Ye,Ne=ie[De],ut=null,Pt=Ne>239?4:Ne>223?3:Ne>191?2:1;if(De+Pt>Ue)break;Pt===1?Ne<128&&(ut=Ne):Pt===2?(192&(Xe=ie[De+1]))==128&&(ut=(31&Ne)<<6|63&Xe)<=127&&(ut=null):Pt===3?(Ge=ie[De+2],(192&(Xe=ie[De+1]))==128&&(192&Ge)==128&&((ut=(15&Ne)<<12|(63&Xe)<<6|63&Ge)<=2047||ut>=55296&&ut<=57343)&&(ut=null)):Pt===4&&(Ge=ie[De+2],Ye=ie[De+3],(192&(Xe=ie[De+1]))==128&&(192&Ge)==128&&(192&Ye)==128&&((ut=(15&Ne)<<18|(63&Xe)<<12|(63&Ge)<<6|63&Ye)<=65535||ut>=1114112)&&(ut=null)),ut===null?(ut=65533,Pt=1):ut>65535&&(ut-=65536,Me+=String.fromCharCode(ut>>>10&1023|55296),ut=56320|1023&ut),Me+=String.fromCharCode(ut),De+=Pt}return Me}(this.buf,Z,L)},readBytes:function(){var L=this.readVarint()+this.pos,Z=this.buf.subarray(this.pos,L);return this.pos=L,Z},readPackedVarint:function(L,Z){if(this.type!==t.Bytes)return L.push(this.readVarint(Z));var ie=m(this);for(L=L||[];this.pos<ie;)L.push(this.readVarint(Z));return L},readPackedSVarint:function(L){if(this.type!==t.Bytes)return L.push(this.readSVarint());var Z=m(this);for(L=L||[];this.pos<Z;)L.push(this.readSVarint());return L},readPackedBoolean:function(L){if(this.type!==t.Bytes)return L.push(this.readBoolean());var Z=m(this);for(L=L||[];this.pos<Z;)L.push(this.readBoolean());return L},readPackedFloat:function(L){if(this.type!==t.Bytes)return L.push(this.readFloat());var Z=m(this);for(L=L||[];this.pos<Z;)L.push(this.readFloat());return L},readPackedDouble:function(L){if(this.type!==t.Bytes)return L.push(this.readDouble());var Z=m(this);for(L=L||[];this.pos<Z;)L.push(this.readDouble());return L},readPackedFixed32:function(L){if(this.type!==t.Bytes)return L.push(this.readFixed32());var Z=m(this);for(L=L||[];this.pos<Z;)L.push(this.readFixed32());return L},readPackedSFixed32:function(L){if(this.type!==t.Bytes)return L.push(this.readSFixed32());var Z=m(this);for(L=L||[];this.pos<Z;)L.push(this.readSFixed32());return L},readPackedFixed64:function(L){if(this.type!==t.Bytes)return L.push(this.readFixed64());var Z=m(this);for(L=L||[];this.pos<Z;)L.push(this.readFixed64());return L},readPackedSFixed64:function(L){if(this.type!==t.Bytes)return L.push(this.readSFixed64());var Z=m(this);for(L=L||[];this.pos<Z;)L.push(this.readSFixed64());return L},skip:function(L){var Z=7&L;if(Z===t.Varint)for(;this.buf[this.pos++]>127;);else if(Z===t.Bytes)this.pos=this.readVarint()+this.pos;else if(Z===t.Fixed32)this.pos+=4;else{if(Z!==t.Fixed64)throw new Error("Unimplemented type: "+Z);this.pos+=8}},writeTag:function(L,Z){this.writeVarint(L<<3|Z)},realloc:function(L){for(var Z=this.length||16;Z<this.pos+L;)Z*=2;if(Z!==this.length){var ie=new Uint8Array(Z);ie.set(this.buf),this.buf=ie,this.length=Z}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(L){this.realloc(4),he(this.buf,L,this.pos),this.pos+=4},writeSFixed32:function(L){this.realloc(4),he(this.buf,L,this.pos),this.pos+=4},writeFixed64:function(L){this.realloc(8),he(this.buf,-1&L,this.pos),he(this.buf,Math.floor(L*a),this.pos+4),this.pos+=8},writeSFixed64:function(L){this.realloc(8),he(this.buf,-1&L,this.pos),he(this.buf,Math.floor(L*a),this.pos+4),this.pos+=8},writeVarint:function(L){(L=+L||0)>268435455||L<0?function(Z,ie){var Pe,Ue;if(Z>=0?(Pe=Z%4294967296|0,Ue=Z/4294967296|0):(Ue=~(-Z/4294967296),4294967295^(Pe=~(-Z%4294967296))?Pe=Pe+1|0:(Pe=0,Ue=Ue+1|0)),Z>=18446744073709552e3||Z<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");ie.realloc(10),function(Me,De,Xe){Xe.buf[Xe.pos++]=127&Me|128,Me>>>=7,Xe.buf[Xe.pos++]=127&Me|128,Me>>>=7,Xe.buf[Xe.pos++]=127&Me|128,Me>>>=7,Xe.buf[Xe.pos++]=127&Me|128,Xe.buf[Xe.pos]=127&(Me>>>=7)}(Pe,0,ie),function(Me,De){var Xe=(7&Me)<<4;De.buf[De.pos++]|=Xe|((Me>>>=3)?128:0),Me&&(De.buf[De.pos++]=127&Me|((Me>>>=7)?128:0),Me&&(De.buf[De.pos++]=127&Me|((Me>>>=7)?128:0),Me&&(De.buf[De.pos++]=127&Me|((Me>>>=7)?128:0),Me&&(De.buf[De.pos++]=127&Me|((Me>>>=7)?128:0),Me&&(De.buf[De.pos++]=127&Me)))))}(Ue,ie)}(L,this):(this.realloc(4),this.buf[this.pos++]=127&L|(L>127?128:0),L<=127||(this.buf[this.pos++]=127&(L>>>=7)|(L>127?128:0),L<=127||(this.buf[this.pos++]=127&(L>>>=7)|(L>127?128:0),L<=127||(this.buf[this.pos++]=L>>>7&127))))},writeSVarint:function(L){this.writeVarint(L<0?2*-L-1:2*L)},writeBoolean:function(L){this.writeVarint(!!L)},writeString:function(L){L=String(L),this.realloc(4*L.length),this.pos++;var Z=this.pos;this.pos=function(Pe,Ue,Me){for(var De,Xe,Ge=0;Ge<Ue.length;Ge++){if((De=Ue.charCodeAt(Ge))>55295&&De<57344){if(!Xe){De>56319||Ge+1===Ue.length?(Pe[Me++]=239,Pe[Me++]=191,Pe[Me++]=189):Xe=De;continue}if(De<56320){Pe[Me++]=239,Pe[Me++]=191,Pe[Me++]=189,Xe=De;continue}De=Xe-55296<<10|De-56320|65536,Xe=null}else Xe&&(Pe[Me++]=239,Pe[Me++]=191,Pe[Me++]=189,Xe=null);De<128?Pe[Me++]=De:(De<2048?Pe[Me++]=De>>6|192:(De<65536?Pe[Me++]=De>>12|224:(Pe[Me++]=De>>18|240,Pe[Me++]=De>>12&63|128),Pe[Me++]=De>>6&63|128),Pe[Me++]=63&De|128)}return Me}(this.buf,L,this.pos);var ie=this.pos-Z;ie>=128&&v(Z,ie,this),this.pos=Z-1,this.writeVarint(ie),this.pos+=ie},writeFloat:function(L){this.realloc(4),s.write(this.buf,L,this.pos,!0,23,4),this.pos+=4},writeDouble:function(L){this.realloc(8),s.write(this.buf,L,this.pos,!0,52,8),this.pos+=8},writeBytes:function(L){var Z=L.length;this.writeVarint(Z),this.realloc(Z);for(var ie=0;ie<Z;ie++)this.buf[this.pos++]=L[ie]},writeRawMessage:function(L,Z){this.pos++;var ie=this.pos;L(Z,this);var Pe=this.pos-ie;Pe>=128&&v(ie,Pe,this),this.pos=ie-1,this.writeVarint(Pe),this.pos+=Pe},writeMessage:function(L,Z,ie){this.writeTag(L,t.Bytes),this.writeRawMessage(Z,ie)},writePackedVarint:function(L,Z){Z.length&&this.writeMessage(L,T,Z)},writePackedSVarint:function(L,Z){Z.length&&this.writeMessage(L,C,Z)},writePackedBoolean:function(L,Z){Z.length&&this.writeMessage(L,D,Z)},writePackedFloat:function(L,Z){Z.length&&this.writeMessage(L,k,Z)},writePackedDouble:function(L,Z){Z.length&&this.writeMessage(L,I,Z)},writePackedFixed32:function(L,Z){Z.length&&this.writeMessage(L,j,Z)},writePackedSFixed32:function(L,Z){Z.length&&this.writeMessage(L,F,Z)},writePackedFixed64:function(L,Z){Z.length&&this.writeMessage(L,N,Z)},writePackedSFixed64:function(L,Z){Z.length&&this.writeMessage(L,G,Z)},writeBytesField:function(L,Z){this.writeTag(L,t.Bytes),this.writeBytes(Z)},writeFixed32Field:function(L,Z){this.writeTag(L,t.Fixed32),this.writeFixed32(Z)},writeSFixed32Field:function(L,Z){this.writeTag(L,t.Fixed32),this.writeSFixed32(Z)},writeFixed64Field:function(L,Z){this.writeTag(L,t.Fixed64),this.writeFixed64(Z)},writeSFixed64Field:function(L,Z){this.writeTag(L,t.Fixed64),this.writeSFixed64(Z)},writeVarintField:function(L,Z){this.writeTag(L,t.Varint),this.writeVarint(Z)},writeSVarintField:function(L,Z){this.writeTag(L,t.Varint),this.writeSVarint(Z)},writeStringField:function(L,Z){this.writeTag(L,t.Bytes),this.writeString(Z)},writeFloatField:function(L,Z){this.writeTag(L,t.Fixed32),this.writeFloat(Z)},writeDoubleField:function(L,Z){this.writeTag(L,t.Fixed64),this.writeDouble(Z)},writeBooleanField:function(L,Z){this.writeVarintField(L,!!Z)}},Mm}var Em=U(pv());const Im=3;function x2(s,t,i){s===1&&i.readMessage(b2,t)}function b2(s,t,i){if(s===3){const{id:a,bitmap:h,width:m,height:g,left:v,top:T,advance:C}=i.readMessage(w2,{});t.push({id:a,bitmap:new Wu({width:m+2*Im,height:g+2*Im},h),metrics:{width:m,height:g,left:v,top:T,advance:C}})}}function w2(s,t,i){s===1?t.id=i.readVarint():s===2?t.bitmap=i.readBytes():s===3?t.width=i.readVarint():s===4?t.height=i.readVarint():s===5?t.left=i.readSVarint():s===6?t.top=i.readSVarint():s===7&&(t.advance=i.readVarint())}const T2=Im;function fv(s){let t=0,i=0;for(const g of s)t+=g.w*g.h,i=Math.max(i,g.w);s.sort((g,v)=>v.h-g.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),i),h:1/0}];let h=0,m=0;for(const g of s)for(let v=a.length-1;v>=0;v--){const T=a[v];if(!(g.w>T.w||g.h>T.h)){if(g.x=T.x,g.y=T.y,m=Math.max(m,g.y+g.h),h=Math.max(h,g.x+g.w),g.w===T.w&&g.h===T.h){const C=a.pop();v<a.length&&(a[v]=C)}else g.h===T.h?(T.x+=g.w,T.w-=g.w):g.w===T.w?(T.y+=g.h,T.h-=g.h):(a.push({x:T.x+g.w,y:T.y,w:T.w-g.w,h:g.h}),T.y+=g.h,T.h-=g.h);break}}return{w:h,h:m,fill:t/(h*m)||0}}const pi=1;class Am{constructor(t,{pixelRatio:i,version:a,stretchX:h,stretchY:m,content:g,textFitWidth:v,textFitHeight:T}){this.paddedRect=t,this.pixelRatio=i,this.stretchX=h,this.stretchY=m,this.content=g,this.version=a,this.textFitWidth=v,this.textFitHeight=T}get tl(){return[this.paddedRect.x+pi,this.paddedRect.y+pi]}get br(){return[this.paddedRect.x+this.paddedRect.w-pi,this.paddedRect.y+this.paddedRect.h-pi]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*pi)/this.pixelRatio,(this.paddedRect.h-2*pi)/this.pixelRatio]}}class mv{constructor(t,i){const a={},h={};this.haveRenderCallbacks=[];const m=[];this.addImages(t,a,m),this.addImages(i,h,m);const{w:g,h:v}=fv(m),T=new Ni({width:g||1,height:v||1});for(const C in t){const k=t[C],I=a[C].paddedRect;Ni.copy(k.data,T,{x:0,y:0},{x:I.x+pi,y:I.y+pi},k.data)}for(const C in i){const k=i[C],I=h[C].paddedRect,D=I.x+pi,j=I.y+pi,F=k.data.width,N=k.data.height;Ni.copy(k.data,T,{x:0,y:0},{x:D,y:j},k.data),Ni.copy(k.data,T,{x:0,y:N-1},{x:D,y:j-1},{width:F,height:1}),Ni.copy(k.data,T,{x:0,y:0},{x:D,y:j+N},{width:F,height:1}),Ni.copy(k.data,T,{x:F-1,y:0},{x:D-1,y:j},{width:1,height:N}),Ni.copy(k.data,T,{x:0,y:0},{x:D+F,y:j},{width:1,height:N})}this.image=T,this.iconPositions=a,this.patternPositions=h}addImages(t,i,a){for(const h in t){const m=t[h],g={x:0,y:0,w:m.data.width+2*pi,h:m.data.height+2*pi};a.push(g),i[h]=new Am(g,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(t,i){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in t.updatedImages)this.patchUpdatedImage(this.iconPositions[a],t.getImage(a),i),this.patchUpdatedImage(this.patternPositions[a],t.getImage(a),i)}patchUpdatedImage(t,i,a){if(!t||!i||t.version===i.version)return;t.version=i.version;const[h,m]=t.tl;a.update(i.data,void 0,{x:h,y:m})}}var Qo;at("ImagePosition",Am),at("ImageAtlas",mv),b.al=void 0,(Qo=b.al||(b.al={}))[Qo.none=0]="none",Qo[Qo.horizontal=1]="horizontal",Qo[Qo.vertical=2]="vertical",Qo[Qo.horizontalOnly=3]="horizontalOnly";const rp=-17;class sh{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(t,i,a){const h=new sh;return h.scale=t||1,h.fontStack=i,h.verticalAlign=a||"bottom",h}static forImage(t,i){const a=new sh;return a.imageName=t,a.verticalAlign=i||"bottom",a}}class _c{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,i){const a=new _c;for(let h=0;h<t.sections.length;h++){const m=t.sections[h];m.image?a.addImageSection(m):a.addTextSection(m,i)}return a}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let i="";for(let a=0;a<t.length;a++){const h=t.charCodeAt(a+1)||null,m=t.charCodeAt(a-1)||null;i+=h&&Wa(h)&&!ih[t[a+1]]||m&&Wa(m)&&!ih[t[a-1]]||!ih[t[a]]?t[a]:ih[t[a]]}return i}(this.text)}trim(){let t=0;for(let a=0;a<this.text.length&&ip[this.text.charCodeAt(a)];a++)t++;let i=this.text.length;for(let a=this.text.length-1;a>=0&&a>=t&&ip[this.text.charCodeAt(a)];a--)i--;this.text=this.text.substring(t,i),this.sectionIndex=this.sectionIndex.slice(t,i)}substring(t,i){const a=new _c;return a.text=this.text.substring(t,i),a.sectionIndex=this.sectionIndex.slice(t,i),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,i)=>Math.max(t,this.sections[i].scale),0)}getMaxImageSize(t){let i=0,a=0;for(let h=0;h<this.length();h++){const m=this.getSection(h);if(m.imageName){const g=t[m.imageName];if(!g)continue;const v=g.displaySize;i=Math.max(i,v[0]),a=Math.max(a,v[1])}}return{maxImageWidth:i,maxImageHeight:a}}addTextSection(t,i){this.text+=t.text,this.sections.push(sh.forText(t.scale,t.fontStack||i,t.verticalAlign));const a=this.sections.length-1;for(let h=0;h<t.text.length;++h)this.sectionIndex.push(a)}addImageSection(t){const i=t.image?t.image.name:"";if(i.length===0)return void Sr("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(sh.forImage(i,t.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):Sr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function np(s,t,i,a,h,m,g,v,T,C,k,I,D,j,F){const N=_c.fromFeature(s,h);let G;I===b.al.vertical&&N.verticalizePunctuation();const{processBidirectionalText:Y,processStyledBidirectionalText:he}=bs;if(Y&&N.sections.length===1){G=[];const Z=Y(N.toString(),zm(N,C,m,t,a,j));for(const ie of Z){const Pe=new _c;Pe.text=ie,Pe.sections=N.sections;for(let Ue=0;Ue<ie.length;Ue++)Pe.sectionIndex.push(0);G.push(Pe)}}else if(he){G=[];const Z=he(N.text,N.sectionIndex,zm(N,C,m,t,a,j));for(const ie of Z){const Pe=new _c;Pe.text=ie[0],Pe.sectionIndex=ie[1],Pe.sections=N.sections,G.push(Pe)}}else G=function(Z,ie){const Pe=[],Ue=Z.text;let Me=0;for(const De of ie)Pe.push(Z.substring(Me,De)),Me=De;return Me<Ue.length&&Pe.push(Z.substring(Me,Ue.length)),Pe}(N,zm(N,C,m,t,a,j));const ee=[],L={positionedLines:ee,text:N.toString(),top:k[1],bottom:k[1],left:k[0],right:k[0],writingMode:I,iconsInText:!1,verticalizable:!1};return function(Z,ie,Pe,Ue,Me,De,Xe,Ge,Ye,Ne,ut,Pt){let wt=0,pt=0,rr=0,$r=0;const mn=Ge==="right"?1:Ge==="left"?0:.5,$n=fn/Pt;let $i=0;for(const Fr of Me){Fr.trim();const Tn=Fr.getMaxScale(),Dn={positionedGlyphs:[],lineOffset:0};Z.positionedLines[$i]=Dn;const Ln=Dn.positionedGlyphs;let ni=0;if(!Fr.length()){pt+=De,++$i;continue}const Ui=M2(Ue,Fr,$n);for(let mi=0;mi<Fr.length();mi++){const gn=Fr.getSection(mi),Pn=Fr.getSectionIndex(mi),Cn=Fr.getCharCode(mi),an=k2(Ye,ut,Cn);let zr;if(gn.imageName){if(Z.iconsInText=!0,gn.scale=gn.scale*$n,zr=I2(gn,an,Tn,Ui,Ue),!zr)continue;ni=Math.max(ni,zr.imageOffset)}else if(zr=E2(gn,Cn,an,Ui,ie,Pe),!zr)continue;const{rect:Ss,metrics:bc,baselineOffset:Ps}=zr;Ln.push({glyph:Cn,imageName:gn.imageName,x:wt,y:pt+Ps+rp,vertical:an,scale:gn.scale,fontStack:gn.fontStack,sectionIndex:Pn,metrics:bc,rect:Ss}),an?(Z.verticalizable=!0,wt+=(gn.imageName?bc.advance:fn)*gn.scale+Ne):wt+=bc.advance*gn.scale+Ne}Ln.length!==0&&(rr=Math.max(wt-Ne,rr),A2(Ln,0,Ln.length-1,mn)),wt=0,Dn.lineOffset=Math.max(ni,(Tn-1)*fn);const Sn=De*Tn+ni;pt+=Sn,$r=Math.max(Sn,$r),++$i}const{horizontalAlign:fi,verticalAlign:Rn}=Rm(Xe);(function(Fr,Tn,Dn,Ln,ni,Ui,Sn,mi,gn){const Pn=(Tn-Dn)*ni;let Cn=0;Cn=Ui!==Sn?-mi*Ln-rp:-Ln*gn*Sn+.5*Sn;for(const an of Fr)for(const zr of an.positionedGlyphs)zr.x+=Pn,zr.y+=Cn})(Z.positionedLines,mn,fi,Rn,rr,$r,De,pt,Me.length),Z.top+=-Rn*pt,Z.bottom=Z.top+pt,Z.left+=-fi*rr,Z.right=Z.left+rr}(L,t,i,a,G,g,v,T,I,C,D,F),!function(Z){for(const ie of Z)if(ie.positionedGlyphs.length!==0)return!1;return!0}(ee)&&L}const ip={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},S2={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},P2={40:!0};function gv(s,t,i,a,h,m){if(t.imageName){const g=a[t.imageName];return g?g.displaySize[0]*t.scale*fn/m+h:0}{const g=i[t.fontStack],v=g&&g[s];return v?v.metrics.advance*t.scale+h:0}}function _v(s,t,i,a){const h=Math.pow(s-t,2);return a?s<t?h/2:2*h:h+Math.abs(i)*i}function C2(s,t,i){let a=0;return s===10&&(a-=1e4),i&&(a+=150),s!==40&&s!==65288||(a+=50),t!==41&&t!==65289||(a+=50),a}function yv(s,t,i,a,h,m){let g=null,v=_v(t,i,h,m);for(const T of a){const C=_v(t-T.x,i,h,m)+T.badness;C<=v&&(g=T,v=C)}return{index:s,x:t,priorBreak:g,badness:v}}function vv(s){return s?vv(s.priorBreak).concat(s.index):[]}function zm(s,t,i,a,h,m){if(!s)return[];const g=[],v=function(I,D,j,F,N,G){let Y=0;for(let he=0;he<I.length();he++){const ee=I.getSection(he);Y+=gv(I.getCharCode(he),ee,F,N,D,G)}return Y/Math.max(1,Math.ceil(Y/j))}(s,t,i,a,h,m),T=s.text.indexOf("")>=0;let C=0;for(let I=0;I<s.length();I++){const D=s.getSection(I),j=s.getCharCode(I);if(ip[j]||(C+=gv(j,D,a,h,t,m)),I<s.length()-1){const F=!((k=j)<11904)&&(!!Jt["CJK Compatibility Forms"](k)||!!Jt["CJK Compatibility"](k)||!!Jt["CJK Strokes"](k)||!!Jt["CJK Symbols and Punctuation"](k)||!!Jt["Enclosed CJK Letters and Months"](k)||!!Jt["Halfwidth and Fullwidth Forms"](k)||!!Jt["Ideographic Description Characters"](k)||!!Jt["Vertical Forms"](k)||Fu.test(String.fromCodePoint(k)));(S2[j]||F||D.imageName||I!==s.length()-2&&P2[s.getCharCode(I+1)])&&g.push(yv(I+1,C,v,g,C2(j,s.getCharCode(I+1),F&&T),!1))}}var k;return vv(yv(s.length(),C,v,g,0,!0))}function Rm(s){let t=.5,i=.5;switch(s){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:t,verticalAlign:i}}function M2(s,t,i){const a=t.getMaxScale()*fn,{maxImageWidth:h,maxImageHeight:m}=t.getMaxImageSize(s),g=Math.max(a,m*i);return{verticalLineContentWidth:Math.max(a,h*i),horizontalLineContentHeight:g}}function xv(s){switch(s){case"top":return 0;case"center":return .5;default:return 1}}function k2(s,t,i){return!(s===b.al.horizontal||!t&&!cc(i)||t&&(ip[i]||(a=i,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(a)))));var a}function E2(s,t,i,a,h,m){const g=m[s.fontStack],v=function(C,k,I,D){if(C&&C.rect)return C;const j=k[I.fontStack],F=j&&j[D];return F?{rect:null,metrics:F.metrics}:null}(g&&g[t],h,s,t);if(v===null)return null;let T;if(i)T=a.verticalLineContentWidth-s.scale*fn;else{const C=xv(s.verticalAlign);T=(a.horizontalLineContentHeight-s.scale*fn)*C}return{rect:v.rect,metrics:v.metrics,baselineOffset:T}}function I2(s,t,i,a,h){const m=h[s.imageName];if(!m)return null;const g=m.paddedRect,v=m.displaySize,T={width:v[0],height:v[1],left:pi,top:-3,advance:t?v[1]:v[0]};let C;if(t)C=a.verticalLineContentWidth-v[1]*s.scale;else{const k=xv(s.verticalAlign);C=(a.horizontalLineContentHeight-v[1]*s.scale)*k}return{rect:g,metrics:T,baselineOffset:C,imageOffset:(t?v[0]:v[1])*s.scale-fn*i}}function A2(s,t,i,a){if(a===0)return;const h=s[i],m=(s[i].x+h.metrics.advance*h.scale)*a;for(let g=t;g<=i;g++)s[g].x-=m}function z2(s,t,i){const{horizontalAlign:a,verticalAlign:h}=Rm(i),m=t[0]-s.displaySize[0]*a,g=t[1]-s.displaySize[1]*h;return{image:s,top:g,bottom:g+s.displaySize[1],left:m,right:m+s.displaySize[0]}}function bv(s){var t,i;let a=s.left,h=s.top,m=s.right-a,g=s.bottom-h;const v=(t=s.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",T=(i=s.image.textFitHeight)!==null&&i!==void 0?i:"stretchOrShrink",C=(s.image.content[2]-s.image.content[0])/(s.image.content[3]-s.image.content[1]);if(T==="proportional"){if(v==="stretchOnly"&&m/g<C||v==="proportional"){const k=Math.ceil(g*C);a*=k/m,m=k}}else if(v==="proportional"&&T==="stretchOnly"&&C!==0&&m/g>C){const k=Math.ceil(m/C);h*=k/g,g=k}return{x1:a,y1:h,x2:a+m,y2:h+g}}function wv(s,t,i,a,h,m){const g=s.image;let v;if(g.content){const G=g.content,Y=g.pixelRatio||1;v=[G[0]/Y,G[1]/Y,g.displaySize[0]-G[2]/Y,g.displaySize[1]-G[3]/Y]}const T=t.left*m,C=t.right*m;let k,I,D,j;i==="width"||i==="both"?(j=h[0]+T-a[3],I=h[0]+C+a[1]):(j=h[0]+(T+C-g.displaySize[0])/2,I=j+g.displaySize[0]);const F=t.top*m,N=t.bottom*m;return i==="height"||i==="both"?(k=h[1]+F-a[0],D=h[1]+N+a[2]):(k=h[1]+(F+N-g.displaySize[1])/2,D=k+g.displaySize[1]),{image:g,top:k,right:I,bottom:D,left:j,collisionPadding:v}}const oh=255,Ws=128,Jo=oh*Ws;function Tv(s,t){const{expression:i}=t;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new Er(s+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:h}=i;let m=0;for(;m<a.length&&a[m]<=s;)m++;m=Math.max(0,m-1);let g=m;for(;g<a.length&&a[g]<s+1;)g++;g=Math.min(a.length-1,g);const v=a[m],T=a[g];return i.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:T,interpolationType:h}:{kind:"camera",minZoom:v,maxZoom:T,minSize:i.evaluate(new Er(v)),maxSize:i.evaluate(new Er(T)),interpolationType:h}}}function Dm(s,t,i){let a="never";const h=s.get(t);return h?a=h:s.get(i)&&(a="always"),a}const R2=th.VectorTileFeature.types,D2=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function sp(s,t,i,a,h,m,g,v,T,C,k,I,D){const j=v?Math.min(Jo,Math.round(v[0])):0,F=v?Math.min(Jo,Math.round(v[1])):0;s.emplaceBack(t,i,Math.round(32*a),Math.round(32*h),m,g,(j<<1)+(T?1:0),F,16*C,16*k,256*I,256*D)}function Lm(s,t,i){s.emplaceBack(t.x,t.y,i),s.emplaceBack(t.x,t.y,i),s.emplaceBack(t.x,t.y,i),s.emplaceBack(t.x,t.y,i)}function L2(s){for(const t of s.sections)if(om(t.text))return!0;return!1}class jm{constructor(t){this.layoutVertexArray=new Lr,this.indexArray=new pr,this.programConfigurations=t,this.segments=new fr,this.dynamicLayoutVertexArray=new wr,this.opacityVertexArray=new jr,this.hasVisibleVertices=!1,this.placedSymbolArray=new oe}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,i,a,h){this.isEmpty()||(a&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,f2.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,m2.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,D2,!0),this.opacityVertexBuffer.itemSize=1),(a||h)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}at("SymbolBuffers",jm);class Fm{constructor(t,i,a){this.layoutVertexArray=new t,this.layoutAttributes=i,this.indexArray=new a,this.segments=new fr,this.collisionVertexArray=new xr}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,g2.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}at("CollisionBuffers",Fm);class yc{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(g=>g.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Tv(this.zoom,i["text-size"]),this.iconSizeData=Tv(this.zoom,i["icon-size"]);const a=this.layers[0].layout,h=a.get("symbol-sort-key"),m=a.get("symbol-z-order");this.canOverlap=Dm(a,"text-overlap","text-allow-overlap")!=="never"||Dm(a,"icon-overlap","icon-allow-overlap")!=="never"||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&!h.isConstant(),this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,a.get("symbol-placement")==="point"&&(this.writingModes=a.get("text-writing-mode").map(g=>b.al[g])),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=t.sourceID}createArrays(){this.text=new jm(new Hs(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new jm(new Hs(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new fe,this.lineVertexArray=new ue,this.symbolInstances=new ae,this.textAnchorOffsets=new Fe}calculateGlyphDependencies(t,i,a,h,m){for(let g=0;g<t.length;g++)if(i[t.charCodeAt(g)]=!0,(a||h)&&m){const v=ih[t.charAt(g)];v&&(i[v.charCodeAt(0)]=!0)}}populate(t,i,a){const h=this.layers[0],m=h.layout,g=m.get("text-font"),v=m.get("text-field"),T=m.get("icon-image"),C=(v.value.kind!=="constant"||v.value.value instanceof ti&&!v.value.value.isEmpty()||v.value.value.toString().length>0)&&(g.value.kind!=="constant"||g.value.value.length>0),k=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,I=m.get("symbol-sort-key");if(this.features=[],!C&&!k)return;const D=i.iconDependencies,j=i.glyphDependencies,F=i.availableImages,N=new Er(this.zoom);for(const{feature:G,id:Y,index:he,sourceLayerIndex:ee}of t){const L=h._featureFilter.needGeometry,Z=rl(G,L);if(!h._featureFilter.filter(N,Z,a))continue;let ie,Pe;if(L||(Z.geometry=tl(G)),C){const Me=h.getValueAndResolveTokens("text-field",Z,a,F),De=ti.factory(Me),Xe=this.hasRTLText=this.hasRTLText||L2(De);(!Xe||bs.getRTLTextPluginStatus()==="unavailable"||Xe&&bs.isParsed())&&(ie=y2(De,h,Z))}if(k){const Me=h.getValueAndResolveTokens("icon-image",Z,a,F);Pe=Me instanceof ui?Me:ui.fromString(Me)}if(!ie&&!Pe)continue;const Ue=this.sortFeaturesByKey?I.evaluate(Z,{},a):void 0;if(this.features.push({id:Y,text:ie,icon:Pe,index:he,sourceLayerIndex:ee,geometry:Z.geometry,properties:G.properties,type:R2[G.type],sortKey:Ue}),Pe&&(D[Pe.name]=!0),ie){const Me=g.evaluate(Z,{},a).join(","),De=m.get("text-rotation-alignment")!=="viewport"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(b.al.vertical)>=0;for(const Xe of ie.sections)if(Xe.image)D[Xe.image.name]=!0;else{const Ge=lc(ie.toString()),Ye=Xe.fontStack||Me,Ne=j[Ye]=j[Ye]||{};this.calculateGlyphDependencies(Xe.text,Ne,De,this.allowVerticalPlacement,Ge)}}}m.get("symbol-placement")==="line"&&(this.features=function(G){const Y={},he={},ee=[];let L=0;function Z(Me){ee.push(G[Me]),L++}function ie(Me,De,Xe){const Ge=he[Me];return delete he[Me],he[De]=Ge,ee[Ge].geometry[0].pop(),ee[Ge].geometry[0]=ee[Ge].geometry[0].concat(Xe[0]),Ge}function Pe(Me,De,Xe){const Ge=Y[De];return delete Y[De],Y[Me]=Ge,ee[Ge].geometry[0].shift(),ee[Ge].geometry[0]=Xe[0].concat(ee[Ge].geometry[0]),Ge}function Ue(Me,De,Xe){const Ge=Xe?De[0][De[0].length-1]:De[0][0];return`${Me}:${Ge.x}:${Ge.y}`}for(let Me=0;Me<G.length;Me++){const De=G[Me],Xe=De.geometry,Ge=De.text?De.text.toString():null;if(!Ge){Z(Me);continue}const Ye=Ue(Ge,Xe),Ne=Ue(Ge,Xe,!0);if(Ye in he&&Ne in Y&&he[Ye]!==Y[Ne]){const ut=Pe(Ye,Ne,Xe),Pt=ie(Ye,Ne,ee[ut].geometry);delete Y[Ye],delete he[Ne],he[Ue(Ge,ee[Pt].geometry,!0)]=Pt,ee[ut].geometry=null}else Ye in he?ie(Ye,Ne,Xe):Ne in Y?Pe(Ye,Ne,Xe):(Z(Me),Y[Ye]=L-1,he[Ne]=L-1)}return ee.filter(Me=>Me.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((G,Y)=>G.sortKey-Y.sortKey)}update(t,i,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,i,this.layers,a),this.icon.programConfigurations.updatePaintArrays(t,i,this.layers,a))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,i){const a=this.lineVertexArray.length;if(t.segment!==void 0){let h=t.dist(i[t.segment+1]),m=t.dist(i[t.segment]);const g={};for(let v=t.segment+1;v<i.length;v++)g[v]={x:i[v].x,y:i[v].y,tileUnitDistanceFromAnchor:h},v<i.length-1&&(h+=i[v+1].dist(i[v]));for(let v=t.segment||0;v>=0;v--)g[v]={x:i[v].x,y:i[v].y,tileUnitDistanceFromAnchor:m},v>0&&(m+=i[v-1].dist(i[v]));for(let v=0;v<i.length;v++){const T=g[v];this.lineVertexArray.emplaceBack(T.x,T.y,T.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(t,i,a,h,m,g,v,T,C,k,I,D){const j=t.indexArray,F=t.layoutVertexArray,N=t.segments.prepareSegment(4*i.length,F,j,this.canOverlap?g.sortKey:void 0),G=this.glyphOffsetArray.length,Y=N.vertexLength,he=this.allowVerticalPlacement&&v===b.al.vertical?Math.PI/2:0,ee=g.text&&g.text.sections;for(let L=0;L<i.length;L++){const{tl:Z,tr:ie,bl:Pe,br:Ue,tex:Me,pixelOffsetTL:De,pixelOffsetBR:Xe,minFontScaleX:Ge,minFontScaleY:Ye,glyphOffset:Ne,isSDF:ut,sectionIndex:Pt}=i[L],wt=N.vertexLength,pt=Ne[1];sp(F,T.x,T.y,Z.x,pt+Z.y,Me.x,Me.y,a,ut,De.x,De.y,Ge,Ye),sp(F,T.x,T.y,ie.x,pt+ie.y,Me.x+Me.w,Me.y,a,ut,Xe.x,De.y,Ge,Ye),sp(F,T.x,T.y,Pe.x,pt+Pe.y,Me.x,Me.y+Me.h,a,ut,De.x,Xe.y,Ge,Ye),sp(F,T.x,T.y,Ue.x,pt+Ue.y,Me.x+Me.w,Me.y+Me.h,a,ut,Xe.x,Xe.y,Ge,Ye),Lm(t.dynamicLayoutVertexArray,T,he),j.emplaceBack(wt,wt+2,wt+1),j.emplaceBack(wt+1,wt+2,wt+3),N.vertexLength+=4,N.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ne[0]),L!==i.length-1&&Pt===i[L+1].sectionIndex||t.programConfigurations.populatePaintArrays(F.length,g,g.index,{},D,ee&&ee[Pt])}t.placedSymbolArray.emplaceBack(T.x,T.y,G,this.glyphOffsetArray.length-G,Y,C,k,T.segment,a?a[0]:0,a?a[1]:0,h[0],h[1],v,0,!1,0,I)}_addCollisionDebugVertex(t,i,a,h,m,g){return i.emplaceBack(0,0),t.emplaceBack(a.x,a.y,h,m,Math.round(g.x),Math.round(g.y))}addCollisionDebugVertices(t,i,a,h,m,g,v){const T=m.segments.prepareSegment(4,m.layoutVertexArray,m.indexArray),C=T.vertexLength,k=m.layoutVertexArray,I=m.collisionVertexArray,D=v.anchorX,j=v.anchorY;this._addCollisionDebugVertex(k,I,g,D,j,new ce(t,i)),this._addCollisionDebugVertex(k,I,g,D,j,new ce(a,i)),this._addCollisionDebugVertex(k,I,g,D,j,new ce(a,h)),this._addCollisionDebugVertex(k,I,g,D,j,new ce(t,h)),T.vertexLength+=4;const F=m.indexArray;F.emplaceBack(C,C+1),F.emplaceBack(C+1,C+2),F.emplaceBack(C+2,C+3),F.emplaceBack(C+3,C),T.primitiveLength+=4}addDebugCollisionBoxes(t,i,a,h){for(let m=t;m<i;m++){const g=this.collisionBoxArray.get(m);this.addCollisionDebugVertices(g.x1,g.y1,g.x2,g.y2,h?this.textCollisionBox:this.iconCollisionBox,g.anchorPoint,a)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Fm(Ir,uv.members,pn),this.iconCollisionBox=new Fm(Ir,uv.members,pn);for(let t=0;t<this.symbolInstances.length;t++){const i=this.symbolInstances.get(t);this.addDebugCollisionBoxes(i.textBoxStartIndex,i.textBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.iconBoxStartIndex,i.iconBoxEndIndex,i,!1),this.addDebugCollisionBoxes(i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex,i,!1)}}_deserializeCollisionBoxesForSymbol(t,i,a,h,m,g,v,T,C){const k={};for(let I=i;I<a;I++){const D=t.get(I);k.textBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},k.textFeatureIndex=D.featureIndex;break}for(let I=h;I<m;I++){const D=t.get(I);k.verticalTextBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},k.verticalTextFeatureIndex=D.featureIndex;break}for(let I=g;I<v;I++){const D=t.get(I);k.iconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},k.iconFeatureIndex=D.featureIndex;break}for(let I=T;I<C;I++){const D=t.get(I);k.verticalIconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},k.verticalIconFeatureIndex=D.featureIndex;break}return k}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const a=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,i){const a=t.placedSymbolArray.get(i),h=a.vertexStartIndex+4*a.numGlyphs;for(let m=a.vertexStartIndex;m<h;m+=4)t.indexArray.emplaceBack(m,m+2,m+1),t.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(t),a=Math.cos(t),h=[],m=[],g=[];for(let v=0;v<this.symbolInstances.length;++v){g.push(v);const T=this.symbolInstances.get(v);h.push(0|Math.round(i*T.anchorX+a*T.anchorY)),m.push(T.featureIndex)}return g.sort((v,T)=>h[v]-h[T]||m[T]-m[v]),g}addToSortKeyRanges(t,i){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===i?a.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const a=this.symbolInstances.get(i);this.featureSortOrder.push(a.featureIndex),[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((h,m,g)=>{h>=0&&g.indexOf(h)===m&&this.addIndicesForPlacedSymbol(this.text,h)}),a.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,a.verticalPlacedTextSymbolIndex),a.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.placedIconSymbolIndex),a.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Sv,Pv;at("SymbolBucket",yc,{omit:["layers","collisionBoxArray","features","compareText"]}),yc.MAX_GLYPHS=65535,yc.addDynamicAttributes=Lm;var Bm={get paint(){return Pv=Pv||new nn({"icon-opacity":new It(q.paint_symbol["icon-opacity"]),"icon-color":new It(q.paint_symbol["icon-color"]),"icon-halo-color":new It(q.paint_symbol["icon-halo-color"]),"icon-halo-width":new It(q.paint_symbol["icon-halo-width"]),"icon-halo-blur":new It(q.paint_symbol["icon-halo-blur"]),"icon-translate":new _t(q.paint_symbol["icon-translate"]),"icon-translate-anchor":new _t(q.paint_symbol["icon-translate-anchor"]),"text-opacity":new It(q.paint_symbol["text-opacity"]),"text-color":new It(q.paint_symbol["text-color"],{runtimeType:Pr,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new It(q.paint_symbol["text-halo-color"]),"text-halo-width":new It(q.paint_symbol["text-halo-width"]),"text-halo-blur":new It(q.paint_symbol["text-halo-blur"]),"text-translate":new _t(q.paint_symbol["text-translate"]),"text-translate-anchor":new _t(q.paint_symbol["text-translate-anchor"])})},get layout(){return Sv=Sv||new nn({"symbol-placement":new _t(q.layout_symbol["symbol-placement"]),"symbol-spacing":new _t(q.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new _t(q.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new It(q.layout_symbol["symbol-sort-key"]),"symbol-z-order":new _t(q.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new _t(q.layout_symbol["icon-allow-overlap"]),"icon-overlap":new _t(q.layout_symbol["icon-overlap"]),"icon-ignore-placement":new _t(q.layout_symbol["icon-ignore-placement"]),"icon-optional":new _t(q.layout_symbol["icon-optional"]),"icon-rotation-alignment":new _t(q.layout_symbol["icon-rotation-alignment"]),"icon-size":new It(q.layout_symbol["icon-size"]),"icon-text-fit":new _t(q.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new _t(q.layout_symbol["icon-text-fit-padding"]),"icon-image":new It(q.layout_symbol["icon-image"]),"icon-rotate":new It(q.layout_symbol["icon-rotate"]),"icon-padding":new It(q.layout_symbol["icon-padding"]),"icon-keep-upright":new _t(q.layout_symbol["icon-keep-upright"]),"icon-offset":new It(q.layout_symbol["icon-offset"]),"icon-anchor":new It(q.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new _t(q.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new _t(q.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new _t(q.layout_symbol["text-rotation-alignment"]),"text-field":new It(q.layout_symbol["text-field"]),"text-font":new It(q.layout_symbol["text-font"]),"text-size":new It(q.layout_symbol["text-size"]),"text-max-width":new It(q.layout_symbol["text-max-width"]),"text-line-height":new _t(q.layout_symbol["text-line-height"]),"text-letter-spacing":new It(q.layout_symbol["text-letter-spacing"]),"text-justify":new It(q.layout_symbol["text-justify"]),"text-radial-offset":new It(q.layout_symbol["text-radial-offset"]),"text-variable-anchor":new _t(q.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new It(q.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new It(q.layout_symbol["text-anchor"]),"text-max-angle":new _t(q.layout_symbol["text-max-angle"]),"text-writing-mode":new _t(q.layout_symbol["text-writing-mode"]),"text-rotate":new It(q.layout_symbol["text-rotate"]),"text-padding":new _t(q.layout_symbol["text-padding"]),"text-keep-upright":new _t(q.layout_symbol["text-keep-upright"]),"text-transform":new It(q.layout_symbol["text-transform"]),"text-offset":new It(q.layout_symbol["text-offset"]),"text-allow-overlap":new _t(q.layout_symbol["text-allow-overlap"]),"text-overlap":new _t(q.layout_symbol["text-overlap"]),"text-ignore-placement":new _t(q.layout_symbol["text-ignore-placement"]),"text-optional":new _t(q.layout_symbol["text-optional"])})}};class Cv{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:Mt,this.defaultValue=t}evaluate(t){if(t.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(t.formattedSection))return i.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}at("FormatSectionOverride",Cv,{omit:["defaultValue"]});class op extends Ti{constructor(t){super(t,Bm)}recalculate(t,i){if(super.recalculate(t,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const a=this.layout.get("text-writing-mode");if(a){const h=[];for(const m of a)h.indexOf(m)<0&&h.push(m);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,i,a,h){const m=this.layout.get(t).evaluate(i,{},a,h),g=this._unevaluatedLayout._values[t];return g.isDataDriven()||Oa(g.value)||!m?m:function(v,T){return T.replace(/{([^{}]+)}/g,(C,k)=>v&&k in v?String(v[k]):"")}(i.properties,m)}createBucket(t){return new yc(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of Bm.paint.overridableProperties){if(!op.hasPaintOverride(this.layout,t))continue;const i=this.paint.get(t),a=new Cv(i),h=new Kl(a,i.property.specification);let m=null;m=i.value.kind==="constant"||i.value.kind==="source"?new Tu("source",h):new Ql("composite",h,i.value.zoomStops),this.paint._values[t]=new Xn(i.property,m,i.parameters)}}_handleOverridablePaintPropertyUpdate(t,i,a){return!(!this.layout||i.isDataDriven()||a.isDataDriven())&&op.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,i){const a=t.get("text-field"),h=Bm.paint.properties[i];let m=!1;const g=v=>{for(const T of v)if(h.overrides&&h.overrides.hasOverride(T))return void(m=!0)};if(a.value.kind==="constant"&&a.value.value instanceof ti)g(a.value.value.sections);else if(a.value.kind==="source"){const v=C=>{m||(C instanceof jt&&Nr(C.value)===so?g(C.value.sections):C instanceof Dl?g(C.sections):C.eachChild(v))},T=a.value;T._styleExpression&&v(T._styleExpression.expression)}return m}}let Mv;var j2={get paint(){return Mv=Mv||new nn({"background-color":new _t(q.paint_background["background-color"]),"background-pattern":new Ou(q.paint_background["background-pattern"]),"background-opacity":new _t(q.paint_background["background-opacity"])})}};class F2 extends Ti{constructor(t){super(t,j2)}}let kv;var B2={get paint(){return kv=kv||new nn({"raster-opacity":new _t(q.paint_raster["raster-opacity"]),"raster-hue-rotate":new _t(q.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new _t(q.paint_raster["raster-brightness-min"]),"raster-brightness-max":new _t(q.paint_raster["raster-brightness-max"]),"raster-saturation":new _t(q.paint_raster["raster-saturation"]),"raster-contrast":new _t(q.paint_raster["raster-contrast"]),"raster-resampling":new _t(q.paint_raster["raster-resampling"]),"raster-fade-duration":new _t(q.paint_raster["raster-fade-duration"])})}};class O2 extends Ti{constructor(t){super(t,B2)}}class N2 extends Ti{constructor(t){super(t,{}),this.onAdd=i=>{this.implementation.onAdd&&this.implementation.onAdd(i,i.painter.context.gl)},this.onRemove=i=>{this.implementation.onRemove&&this.implementation.onRemove(i,i.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class V2{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const $2={once:!0},Om=63710088e-1;class ea{constructor(t,i){if(isNaN(t)||isNaN(i))throw new Error(`Invalid LngLat object: (${t}, ${i})`);if(this.lng=+t,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ea(cn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const i=Math.PI/180,a=this.lat*i,h=t.lat*i,m=Math.sin(a)*Math.sin(h)+Math.cos(a)*Math.cos(h)*Math.cos((t.lng-this.lng)*i);return Om*Math.acos(Math.min(m,1))}static convert(t){if(t instanceof ea)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new ea(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new ea(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Ev=2*Math.PI*Om;function Iv(s){return Ev*Math.cos(s*Math.PI/180)}function Av(s){return(180+s)/360}function zv(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function Rv(s,t){return s/Iv(t)}function Nm(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function Dv(s,t){return s*Iv(Nm(t))}class ah{constructor(t,i,a=0){this.x=+t,this.y=+i,this.z=+a}static fromLngLat(t,i=0){const a=ea.convert(t);return new ah(Av(a.lng),zv(a.lat),Rv(i,a.lat))}toLngLat(){return new ea(360*this.x-180,Nm(this.y))}toAltitude(){return Dv(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Ev*(t=Nm(this.y),1/Math.cos(t*Math.PI/180));var t}}function Lv(s,t,i){var a=2*Math.PI*6378137/256/Math.pow(2,i);return[s*a-2*Math.PI*6378137/2,t*a-2*Math.PI*6378137/2]}class Vm{constructor(t,i,a){if(!function(h,m,g){return!(h<0||h>25||g<0||g>=Math.pow(2,h)||m<0||m>=Math.pow(2,h))}(t,i,a))throw new Error(`x=${i}, y=${a}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=i,this.y=a,this.key=vc(0,t,t,i,a)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,i,a){const h=(g=this.y,v=this.z,T=Lv(256*(m=this.x),256*(g=Math.pow(2,v)-g-1),v),C=Lv(256*(m+1),256*(g+1),v),T[0]+","+T[1]+","+C[0]+","+C[1]);var m,g,v,T,C;const k=function(I,D,j){let F,N="";for(let G=I;G>0;G--)F=1<<G-1,N+=(D&F?1:0)+(j&F?2:0);return N}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,i>1?"@2x":"").replace(/{quadkey}/g,k).replace(/{bbox-epsg-3857}/g,h)}isChildOf(t){const i=this.z-t.z;return i>0&&t.x===this.x>>i&&t.y===this.y>>i}getTilePoint(t){const i=Math.pow(2,this.z);return new ce((t.x*i-this.x)*qe,(t.y*i-this.y)*qe)}toString(){return`${this.z}/${this.x}/${this.y}`}}class jv{constructor(t,i){this.wrap=t,this.canonical=i,this.key=vc(t,i.z,i.z,i.x,i.y)}}class Vi{constructor(t,i,a,h,m){if(this.terrainRttPosMatrix32f=null,t<a)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${a}`);this.overscaledZ=t,this.wrap=i,this.canonical=new Vm(a,+h,+m),this.key=vc(i,t,a,h,m)}clone(){return new Vi(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const i=this.canonical.z-t;return t>this.canonical.z?new Vi(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Vi(t,this.wrap,t,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(t,i){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const a=this.canonical.z-t;return t>this.canonical.z?vc(this.wrap*+i,t,this.canonical.z,this.canonical.x,this.canonical.y):vc(this.wrap*+i,t,t,this.canonical.x>>a,this.canonical.y>>a)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const i=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>i&&t.canonical.y===this.canonical.y>>i}children(t){if(this.overscaledZ>=t)return[new Vi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,a=2*this.canonical.x,h=2*this.canonical.y;return[new Vi(i,this.wrap,i,a,h),new Vi(i,this.wrap,i,a+1,h),new Vi(i,this.wrap,i,a,h+1),new Vi(i,this.wrap,i,a+1,h+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Vi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Vi(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new jv(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new ah(t.x-this.wrap,t.y))}}function vc(s,t,i,a,h){(s*=2)<0&&(s=-1*s-1);const m=1<<i;return(m*m*s+m*h+a).toString(36)+i.toString(36)+t.toString(36)}at("CanonicalTileID",Vm),at("OverscaledTileID",Vi,{omit:["terrainRttPosMatrix32f"]});class Fv{constructor(t,i,a,h=1,m=1,g=1,v=0){if(this.uid=t,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(a&&!["mapbox","terrarium","custom"].includes(a))return void Sr(`"${a}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=i.height;const T=this.dim=i.height-2;switch(this.data=new Uint32Array(i.data.buffer),a){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=h,this.greenFactor=m,this.blueFactor=g,this.baseShift=v;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let C=0;C<T;C++)this.data[this._idx(-1,C)]=this.data[this._idx(0,C)],this.data[this._idx(T,C)]=this.data[this._idx(T-1,C)],this.data[this._idx(C,-1)]=this.data[this._idx(C,0)],this.data[this._idx(C,T)]=this.data[this._idx(C,T-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(T,-1)]=this.data[this._idx(T-1,0)],this.data[this._idx(-1,T)]=this.data[this._idx(0,T-1)],this.data[this._idx(T,T)]=this.data[this._idx(T-1,T-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let C=0;C<T;C++)for(let k=0;k<T;k++){const I=this.get(C,k);I>this.max&&(this.max=I),I<this.min&&(this.min=I)}}get(t,i){const a=new Uint8Array(this.data.buffer),h=4*this._idx(t,i);return this.unpack(a[h],a[h+1],a[h+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,i){if(t<-1||t>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(t+1)}unpack(t,i,a){return t*this.redFactor+i*this.greenFactor+a*this.blueFactor-this.baseShift}getPixels(){return new Ni({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,i,a){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let h=i*this.dim,m=i*this.dim+this.dim,g=a*this.dim,v=a*this.dim+this.dim;switch(i){case-1:h=m-1;break;case 1:m=h+1}switch(a){case-1:g=v-1;break;case 1:v=g+1}const T=-i*this.dim,C=-a*this.dim;for(let k=g;k<v;k++)for(let I=h;I<m;I++)this.data[this._idx(I,k)]=t.data[this._idx(I+T,k+C)]}}at("DEMData",Fv);class Bv{constructor(t){this._stringToNumber={},this._numberToString=[];for(let i=0;i<t.length;i++){const a=t[i];this._stringToNumber[a]=i,this._numberToString[i]=a}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class Ov{constructor(t,i,a,h,m){this.type="Feature",this._vectorTileFeature=t,t._z=i,t._x=a,t._y=h,this.properties=t.properties,this.id=m}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const i in this)i!=="_geometry"&&i!=="_vectorTileFeature"&&(t[i]=this[i]);return t}}class Nv{constructor(t,i){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Wo(qe,16,0),this.grid3D=new Wo(qe,16,0),this.featureIndexArray=new Ee,this.promoteId=i}insert(t,i,a,h,m,g){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,h,m);const T=g?this.grid3D:this.grid;for(let C=0;C<i.length;C++){const k=i[C],I=[1/0,1/0,-1/0,-1/0];for(let D=0;D<k.length;D++){const j=k[D];I[0]=Math.min(I[0],j.x),I[1]=Math.min(I[1],j.y),I[2]=Math.max(I[2],j.x),I[3]=Math.max(I[3],j.y)}I[0]<qe&&I[1]<qe&&I[2]>=0&&I[3]>=0&&T.insert(v,I[0],I[1],I[2],I[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new th.VectorTile(new Em(this.rawTileData)).layers,this.sourceLayerCoder=new Bv(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,i,a,h){this.loadVTLayers();const m=t.params,g=qe/t.tileSize/t.scale,v=Ua(m.filter),T=t.queryGeometry,C=t.queryPadding*g,k=$v(T),I=this.grid.query(k.minX-C,k.minY-C,k.maxX+C,k.maxY+C),D=$v(t.cameraQueryGeometry),j=this.grid3D.query(D.minX-C,D.minY-C,D.maxX+C,D.maxY+C,(G,Y,he,ee)=>function(L,Z,ie,Pe,Ue){for(const De of L)if(Z<=De.x&&ie<=De.y&&Pe>=De.x&&Ue>=De.y)return!0;const Me=[new ce(Z,ie),new ce(Z,Ue),new ce(Pe,Ue),new ce(Pe,ie)];if(L.length>2){for(const De of Me)if(nl(L,De))return!0}for(let De=0;De<L.length-1;De++)if(Iw(L[De],L[De+1],Me))return!0;return!1}(t.cameraQueryGeometry,G-C,Y-C,he+C,ee+C));for(const G of j)I.push(G);I.sort(U2);const F={};let N;for(let G=0;G<I.length;G++){const Y=I[G];if(Y===N)continue;N=Y;const he=this.featureIndexArray.get(Y);let ee=null;this.loadMatchingFeature(F,he.bucketIndex,he.sourceLayerIndex,he.featureIndex,v,m.layers,m.availableImages,i,a,h,(L,Z,ie)=>(ee||(ee=tl(L)),Z.queryIntersectsFeature({queryGeometry:T,feature:L,featureState:ie,geometry:ee,zoom:this.z,transform:t.transform,pixelsToTileUnits:g,pixelPosMatrix:t.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:t.getElevation})))}return F}loadMatchingFeature(t,i,a,h,m,g,v,T,C,k,I){const D=this.bucketLayerIDs[i];if(g&&!D.some(G=>g.has(G)))return;const j=this.sourceLayerCoder.decode(a),F=this.vtLayers[j].feature(h);if(m.needGeometry){const G=rl(F,!0);if(!m.filter(new Er(this.tileID.overscaledZ),G,this.tileID.canonical))return}else if(!m.filter(new Er(this.tileID.overscaledZ),F))return;const N=this.getId(F,j);for(let G=0;G<D.length;G++){const Y=D[G];if(g&&!g.has(Y))continue;const he=T[Y];if(!he)continue;let ee={};N&&k&&(ee=k.getState(he.sourceLayer||"_geojsonTileLayer",N));const L=Xr({},C[Y]);L.paint=Vv(L.paint,he.paint,F,ee,v),L.layout=Vv(L.layout,he.layout,F,ee,v);const Z=!I||I(F,he,ee);if(!Z)continue;const ie=new Ov(F,this.z,this.x,this.y,N);ie.layer=L;let Pe=t[Y];Pe===void 0&&(Pe=t[Y]=[]),Pe.push({featureIndex:h,feature:ie,intersectionZ:Z})}}lookupSymbolFeatures(t,i,a,h,m,g,v,T){const C={};this.loadVTLayers();const k=Ua(m);for(const I of t)this.loadMatchingFeature(C,a,h,I,k,g,v,T,i);return C}hasLayer(t){for(const i of this.bucketLayerIDs)for(const a of i)if(t===a)return!0;return!1}getId(t,i){var a;let h=t.id;return this.promoteId&&(h=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[i]],typeof h=="boolean"&&(h=Number(h)),h===void 0&&(!((a=t.properties)===null||a===void 0)&&a.cluster)&&this.promoteId&&(h=Number(t.properties.cluster_id))),h}}function Vv(s,t,i,a,h){return Ut(s,(m,g)=>{const v=t instanceof hc?t.get(g):null;return v&&v.evaluate?v.evaluate(i,a,h):v})}function $v(s){let t=1/0,i=1/0,a=-1/0,h=-1/0;for(const m of s)t=Math.min(t,m.x),i=Math.min(i,m.y),a=Math.max(a,m.x),h=Math.max(h,m.y);return{minX:t,minY:i,maxX:a,maxY:h}}function U2(s,t){return t-s}function Uv(s,t,i,a,h){const m=[];for(let g=0;g<s.length;g++){const v=s[g];let T;for(let C=0;C<v.length-1;C++){let k=v[C],I=v[C+1];k.x<t&&I.x<t||(k.x<t?k=new ce(t,k.y+(t-k.x)/(I.x-k.x)*(I.y-k.y))._round():I.x<t&&(I=new ce(t,k.y+(t-k.x)/(I.x-k.x)*(I.y-k.y))._round()),k.y<i&&I.y<i||(k.y<i?k=new ce(k.x+(i-k.y)/(I.y-k.y)*(I.x-k.x),i)._round():I.y<i&&(I=new ce(k.x+(i-k.y)/(I.y-k.y)*(I.x-k.x),i)._round()),k.x>=a&&I.x>=a||(k.x>=a?k=new ce(a,k.y+(a-k.x)/(I.x-k.x)*(I.y-k.y))._round():I.x>=a&&(I=new ce(a,k.y+(a-k.x)/(I.x-k.x)*(I.y-k.y))._round()),k.y>=h&&I.y>=h||(k.y>=h?k=new ce(k.x+(h-k.y)/(I.y-k.y)*(I.x-k.x),h)._round():I.y>=h&&(I=new ce(k.x+(h-k.y)/(I.y-k.y)*(I.x-k.x),h)._round()),T&&k.equals(T[T.length-1])||(T=[k],m.push(T)),T.push(I)))))}}return m}at("FeatureIndex",Nv,{omit:["rawTileData","sourceLayerCoder"]});class ta extends ce{constructor(t,i,a,h){super(t,i),this.angle=a,h!==void 0&&(this.segment=h)}clone(){return new ta(this.x,this.y,this.angle,this.segment)}}function Zv(s,t,i,a,h){if(t.segment===void 0||i===0)return!0;let m=t,g=t.segment+1,v=0;for(;v>-i/2;){if(g--,g<0)return!1;v-=s[g].dist(m),m=s[g]}v+=s[g].dist(s[g+1]),g++;const T=[];let C=0;for(;v<i/2;){const k=s[g],I=s[g+1];if(!I)return!1;let D=s[g-1].angleTo(k)-k.angleTo(I);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:v,angleDelta:D}),C+=D;v-T[0].distance>a;)C-=T.shift().angleDelta;if(C>h)return!1;g++,v+=k.dist(I)}return!0}function Gv(s){let t=0;for(let i=0;i<s.length-1;i++)t+=s[i].dist(s[i+1]);return t}function qv(s,t,i){return s?.6*t*i:0}function Hv(s,t){return Math.max(s?s.right-s.left:0,t?t.right-t.left:0)}function Z2(s,t,i,a,h,m){const g=qv(i,h,m),v=Hv(i,a)*m;let T=0;const C=Gv(s)/2;for(let k=0;k<s.length-1;k++){const I=s[k],D=s[k+1],j=I.dist(D);if(T+j>C){const F=(C-T)/j,N=ns.number(I.x,D.x,F),G=ns.number(I.y,D.y,F),Y=new ta(N,G,D.angleTo(I),k);return Y._round(),!g||Zv(s,Y,v,g,t)?Y:void 0}T+=j}}function G2(s,t,i,a,h,m,g,v,T){const C=qv(a,m,g),k=Hv(a,h),I=k*g,D=s[0].x===0||s[0].x===T||s[0].y===0||s[0].y===T;return t-I<t/4&&(t=I+t/4),Wv(s,D?t/2*v%t:(k/2+2*m)*g*v%t,t,C,i,I,D,!1,T)}function Wv(s,t,i,a,h,m,g,v,T){const C=m/2,k=Gv(s);let I=0,D=t-i,j=[];for(let F=0;F<s.length-1;F++){const N=s[F],G=s[F+1],Y=N.dist(G),he=G.angleTo(N);for(;D+i<I+Y;){D+=i;const ee=(D-I)/Y,L=ns.number(N.x,G.x,ee),Z=ns.number(N.y,G.y,ee);if(L>=0&&L<T&&Z>=0&&Z<T&&D-C>=0&&D+C<=k){const ie=new ta(L,Z,he,F);ie._round(),a&&!Zv(s,ie,m,a,h)||j.push(ie)}}I+=Y}return v||j.length||g||(j=Wv(s,I/2,i,a,h,m,g,!0,T)),j}at("Anchor",ta);const lh=pi;function Xv(s,t,i,a){const h=[],m=s.image,g=m.pixelRatio,v=m.paddedRect.w-2*lh,T=m.paddedRect.h-2*lh;let C={x1:s.left,y1:s.top,x2:s.right,y2:s.bottom};const k=m.stretchX||[[0,v]],I=m.stretchY||[[0,T]],D=(Ne,ut)=>Ne+ut[1]-ut[0],j=k.reduce(D,0),F=I.reduce(D,0),N=v-j,G=T-F;let Y=0,he=j,ee=0,L=F,Z=0,ie=N,Pe=0,Ue=G;if(m.content&&a){const Ne=m.content,ut=Ne[2]-Ne[0],Pt=Ne[3]-Ne[1];(m.textFitWidth||m.textFitHeight)&&(C=bv(s)),Y=ap(k,0,Ne[0]),ee=ap(I,0,Ne[1]),he=ap(k,Ne[0],Ne[2]),L=ap(I,Ne[1],Ne[3]),Z=Ne[0]-Y,Pe=Ne[1]-ee,ie=ut-he,Ue=Pt-L}const Me=C.x1,De=C.y1,Xe=C.x2-Me,Ge=C.y2-De,Ye=(Ne,ut,Pt,wt)=>{const pt=lp(Ne.stretch-Y,he,Xe,Me),rr=cp(Ne.fixed-Z,ie,Ne.stretch,j),$r=lp(ut.stretch-ee,L,Ge,De),mn=cp(ut.fixed-Pe,Ue,ut.stretch,F),$n=lp(Pt.stretch-Y,he,Xe,Me),$i=cp(Pt.fixed-Z,ie,Pt.stretch,j),fi=lp(wt.stretch-ee,L,Ge,De),Rn=cp(wt.fixed-Pe,Ue,wt.stretch,F),Fr=new ce(pt,$r),Tn=new ce($n,$r),Dn=new ce($n,fi),Ln=new ce(pt,fi),ni=new ce(rr/g,mn/g),Ui=new ce($i/g,Rn/g),Sn=t*Math.PI/180;if(Sn){const Pn=Math.sin(Sn),Cn=Math.cos(Sn),an=[Cn,-Pn,Pn,Cn];Fr._matMult(an),Tn._matMult(an),Ln._matMult(an),Dn._matMult(an)}const mi=Ne.stretch+Ne.fixed,gn=ut.stretch+ut.fixed;return{tl:Fr,tr:Tn,bl:Ln,br:Dn,tex:{x:m.paddedRect.x+lh+mi,y:m.paddedRect.y+lh+gn,w:Pt.stretch+Pt.fixed-mi,h:wt.stretch+wt.fixed-gn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ni,pixelOffsetBR:Ui,minFontScaleX:ie/g/Xe,minFontScaleY:Ue/g/Ge,isSDF:i}};if(a&&(m.stretchX||m.stretchY)){const Ne=Kv(k,N,j),ut=Kv(I,G,F);for(let Pt=0;Pt<Ne.length-1;Pt++){const wt=Ne[Pt],pt=Ne[Pt+1];for(let rr=0;rr<ut.length-1;rr++)h.push(Ye(wt,ut[rr],pt,ut[rr+1]))}}else h.push(Ye({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:T+1}));return h}function ap(s,t,i){let a=0;for(const h of s)a+=Math.max(t,Math.min(i,h[1]))-Math.max(t,Math.min(i,h[0]));return a}function Kv(s,t,i){const a=[{fixed:-1,stretch:0}];for(const[h,m]of s){const g=a[a.length-1];a.push({fixed:h-g.stretch,stretch:g.stretch}),a.push({fixed:h-g.stretch,stretch:g.stretch+(m-h)})}return a.push({fixed:t+lh,stretch:i}),a}function lp(s,t,i,a){return s/t*i+a}function cp(s,t,i,a){return s-t*i/a}class up{constructor(t,i,a,h,m,g,v,T,C,k){var I;if(this.boxStartIndex=t.length,C){let D=g.top,j=g.bottom;const F=g.collisionPadding;F&&(D-=F[1],j+=F[3]);let N=j-D;N>0&&(N=Math.max(10,N),this.circleDiameter=N)}else{const D=!((I=g.image)===null||I===void 0)&&I.content&&(g.image.textFitWidth||g.image.textFitHeight)?bv(g):{x1:g.left,y1:g.top,x2:g.right,y2:g.bottom};D.y1=D.y1*v-T[0],D.y2=D.y2*v+T[2],D.x1=D.x1*v-T[3],D.x2=D.x2*v+T[1];const j=g.collisionPadding;if(j&&(D.x1-=j[0]*v,D.y1-=j[1]*v,D.x2+=j[2]*v,D.y2+=j[3]*v),k){const F=new ce(D.x1,D.y1),N=new ce(D.x2,D.y1),G=new ce(D.x1,D.y2),Y=new ce(D.x2,D.y2),he=k*Math.PI/180;F._rotate(he),N._rotate(he),G._rotate(he),Y._rotate(he),D.x1=Math.min(F.x,N.x,G.x,Y.x),D.x2=Math.max(F.x,N.x,G.x,Y.x),D.y1=Math.min(F.y,N.y,G.y,Y.y),D.y2=Math.max(F.y,N.y,G.y,Y.y)}t.emplaceBack(i.x,i.y,D.x1,D.y1,D.x2,D.y2,a,h,m)}this.boxEndIndex=t.length}}class q2{constructor(t=[],i=(a,h)=>a<h?-1:a>h?1:0){if(this.data=t,this.length=this.data.length,this.compare=i,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:i,compare:a}=this,h=i[t];for(;t>0;){const m=t-1>>1,g=i[m];if(a(h,g)>=0)break;i[t]=g,t=m}i[t]=h}_down(t){const{data:i,compare:a}=this,h=this.length>>1,m=i[t];for(;t<h;){let g=1+(t<<1);const v=g+1;if(v<this.length&&a(i[v],i[g])<0&&(g=v),a(i[g],m)>=0)break;i[t]=i[g],t=g}i[t]=m}}function H2(s,t=1,i=!1){let a=1/0,h=1/0,m=-1/0,g=-1/0;const v=s[0];for(let j=0;j<v.length;j++){const F=v[j];(!j||F.x<a)&&(a=F.x),(!j||F.y<h)&&(h=F.y),(!j||F.x>m)&&(m=F.x),(!j||F.y>g)&&(g=F.y)}const T=Math.min(m-a,g-h);let C=T/2;const k=new q2([],W2);if(T===0)return new ce(a,h);for(let j=a;j<m;j+=T)for(let F=h;F<g;F+=T)k.push(new xc(j+C,F+C,C,s));let I=function(j){let F=0,N=0,G=0;const Y=j[0];for(let he=0,ee=Y.length,L=ee-1;he<ee;L=he++){const Z=Y[he],ie=Y[L],Pe=Z.x*ie.y-ie.x*Z.y;N+=(Z.x+ie.x)*Pe,G+=(Z.y+ie.y)*Pe,F+=3*Pe}return new xc(N/F,G/F,0,j)}(s),D=k.length;for(;k.length;){const j=k.pop();(j.d>I.d||!I.d)&&(I=j,i&&console.log("found best %d after %d probes",Math.round(1e4*j.d)/1e4,D)),j.max-I.d<=t||(C=j.h/2,k.push(new xc(j.p.x-C,j.p.y-C,C,s)),k.push(new xc(j.p.x+C,j.p.y-C,C,s)),k.push(new xc(j.p.x-C,j.p.y+C,C,s)),k.push(new xc(j.p.x+C,j.p.y+C,C,s)),D+=4)}return i&&(console.log(`num probes: ${D}`),console.log(`best distance: ${I.d}`)),I.p}function W2(s,t){return t.max-s.max}function xc(s,t,i,a){this.p=new ce(s,t),this.h=i,this.d=function(h,m){let g=!1,v=1/0;for(let T=0;T<m.length;T++){const C=m[T];for(let k=0,I=C.length,D=I-1;k<I;D=k++){const j=C[k],F=C[D];j.y>h.y!=F.y>h.y&&h.x<(F.x-j.x)*(h.y-j.y)/(F.y-j.y)+j.x&&(g=!g),v=Math.min(v,Iy(h,j,F))}}return(g?1:-1)*Math.sqrt(v)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}var Vn;b.aB=void 0,(Vn=b.aB||(b.aB={}))[Vn.center=1]="center",Vn[Vn.left=2]="left",Vn[Vn.right=3]="right",Vn[Vn.top=4]="top",Vn[Vn.bottom=5]="bottom",Vn[Vn["top-left"]=6]="top-left",Vn[Vn["top-right"]=7]="top-right",Vn[Vn["bottom-left"]=8]="bottom-left",Vn[Vn["bottom-right"]=9]="bottom-right";const ra=7,$m=Number.POSITIVE_INFINITY;function Yv(s,t){return t[1]!==$m?function(i,a,h){let m=0,g=0;switch(a=Math.abs(a),h=Math.abs(h),i){case"top-right":case"top-left":case"top":g=h-ra;break;case"bottom-right":case"bottom-left":case"bottom":g=-h+ra}switch(i){case"top-right":case"bottom-right":case"right":m=-a;break;case"top-left":case"bottom-left":case"left":m=a}return[m,g]}(s,t[0],t[1]):function(i,a){let h=0,m=0;a<0&&(a=0);const g=a/Math.SQRT2;switch(i){case"top-right":case"top-left":m=g-ra;break;case"bottom-right":case"bottom-left":m=-g+ra;break;case"bottom":m=-a+ra;break;case"top":m=a-ra}switch(i){case"top-right":case"bottom-right":h=-g;break;case"top-left":case"bottom-left":h=g;break;case"left":h=a;break;case"right":h=-a}return[h,m]}(s,t[0])}function Qv(s,t,i){var a;const h=s.layout,m=(a=h.get("text-variable-anchor-offset"))===null||a===void 0?void 0:a.evaluate(t,{},i);if(m){const v=m.values,T=[];for(let C=0;C<v.length;C+=2){const k=T[C]=v[C],I=v[C+1].map(D=>D*fn);k.startsWith("top")?I[1]-=ra:k.startsWith("bottom")&&(I[1]+=ra),T[C+1]=I}return new Wn(T)}const g=h.get("text-variable-anchor");if(g){let v;v=s._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[h.get("text-radial-offset").evaluate(t,{},i)*fn,$m]:h.get("text-offset").evaluate(t,{},i).map(C=>C*fn);const T=[];for(const C of g)T.push(C,Yv(C,v));return new Wn(T)}return null}function Um(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function X2(s,t,i,a,h,m,g,v,T,C,k,I){let D=m.textMaxSize.evaluate(t,{});D===void 0&&(D=g);const j=s.layers[0].layout,F=j.get("icon-offset").evaluate(t,{},k),N=ex(i.horizontal),G=g/24,Y=s.tilePixelRatio*G,he=s.tilePixelRatio*D/24,ee=s.tilePixelRatio*v,L=s.tilePixelRatio*j.get("symbol-spacing"),Z=j.get("text-padding")*s.tilePixelRatio,ie=function(Pt,wt,pt,rr=1){const $r=Pt.get("icon-padding").evaluate(wt,{},pt),mn=$r&&$r.values;return[mn[0]*rr,mn[1]*rr,mn[2]*rr,mn[3]*rr]}(j,t,k,s.tilePixelRatio),Pe=j.get("text-max-angle")/180*Math.PI,Ue=j.get("text-rotation-alignment")!=="viewport"&&j.get("symbol-placement")!=="point",Me=j.get("icon-rotation-alignment")==="map"&&j.get("symbol-placement")!=="point",De=j.get("symbol-placement"),Xe=L/2,Ge=j.get("icon-text-fit");let Ye;a&&Ge!=="none"&&(s.allowVerticalPlacement&&i.vertical&&(Ye=wv(a,i.vertical,Ge,j.get("icon-text-fit-padding"),F,G)),N&&(a=wv(a,N,Ge,j.get("icon-text-fit-padding"),F,G)));const Ne=k?I.line.getGranularityForZoomLevel(k.z):1,ut=(Pt,wt)=>{wt.x<0||wt.x>=qe||wt.y<0||wt.y>=qe||function(pt,rr,$r,mn,$n,$i,fi,Rn,Fr,Tn,Dn,Ln,ni,Ui,Sn,mi,gn,Pn,Cn,an,zr,Ss,bc,Ps,Q2){const wc=pt.addToLineVertexArray(rr,$r);let ol,Tc,Sc,Pc,ix=0,sx=0,ox=0,ax=0,Ym=-1,Qm=-1;const bo={};let lx=ws("");if(pt.allowVerticalPlacement&&mn.vertical){const Yn=Rn.layout.get("text-rotate").evaluate(zr,{},Ps)+90;Sc=new up(Fr,rr,Tn,Dn,Ln,mn.vertical,ni,Ui,Sn,Yn),fi&&(Pc=new up(Fr,rr,Tn,Dn,Ln,fi,gn,Pn,Sn,Yn))}if($n){const Yn=Rn.layout.get("icon-rotate").evaluate(zr,{}),Zi=Rn.layout.get("icon-text-fit")!=="none",al=Xv($n,Yn,bc,Zi),Ms=fi?Xv(fi,Yn,bc,Zi):void 0;Tc=new up(Fr,rr,Tn,Dn,Ln,$n,gn,Pn,!1,Yn),ix=4*al.length;const ll=pt.iconSizeData;let Xs=null;ll.kind==="source"?(Xs=[Ws*Rn.layout.get("icon-size").evaluate(zr,{})],Xs[0]>Jo&&Sr(`${pt.layerIds[0]}: Value for "icon-size" is >= ${oh}. Reduce your "icon-size".`)):ll.kind==="composite"&&(Xs=[Ws*Ss.compositeIconSizes[0].evaluate(zr,{},Ps),Ws*Ss.compositeIconSizes[1].evaluate(zr,{},Ps)],(Xs[0]>Jo||Xs[1]>Jo)&&Sr(`${pt.layerIds[0]}: Value for "icon-size" is >= ${oh}. Reduce your "icon-size".`)),pt.addSymbols(pt.icon,al,Xs,an,Cn,zr,b.al.none,rr,wc.lineStartIndex,wc.lineLength,-1,Ps),Ym=pt.icon.placedSymbolArray.length-1,Ms&&(sx=4*Ms.length,pt.addSymbols(pt.icon,Ms,Xs,an,Cn,zr,b.al.vertical,rr,wc.lineStartIndex,wc.lineLength,-1,Ps),Qm=pt.icon.placedSymbolArray.length-1)}const cx=Object.keys(mn.horizontal);for(const Yn of cx){const Zi=mn.horizontal[Yn];if(!ol){lx=ws(Zi.text);const Ms=Rn.layout.get("text-rotate").evaluate(zr,{},Ps);ol=new up(Fr,rr,Tn,Dn,Ln,Zi,ni,Ui,Sn,Ms)}const al=Zi.positionedLines.length===1;if(ox+=Jv(pt,rr,Zi,$i,Rn,Sn,zr,mi,wc,mn.vertical?b.al.horizontal:b.al.horizontalOnly,al?cx:[Yn],bo,Ym,Ss,Ps),al)break}mn.vertical&&(ax+=Jv(pt,rr,mn.vertical,$i,Rn,Sn,zr,mi,wc,b.al.vertical,["vertical"],bo,Qm,Ss,Ps));const J2=ol?ol.boxStartIndex:pt.collisionBoxArray.length,eT=ol?ol.boxEndIndex:pt.collisionBoxArray.length,tT=Sc?Sc.boxStartIndex:pt.collisionBoxArray.length,rT=Sc?Sc.boxEndIndex:pt.collisionBoxArray.length,nT=Tc?Tc.boxStartIndex:pt.collisionBoxArray.length,iT=Tc?Tc.boxEndIndex:pt.collisionBoxArray.length,sT=Pc?Pc.boxStartIndex:pt.collisionBoxArray.length,oT=Pc?Pc.boxEndIndex:pt.collisionBoxArray.length;let Cs=-1;const dp=(Yn,Zi)=>Yn&&Yn.circleDiameter?Math.max(Yn.circleDiameter,Zi):Zi;Cs=dp(ol,Cs),Cs=dp(Sc,Cs),Cs=dp(Tc,Cs),Cs=dp(Pc,Cs);const ux=Cs>-1?1:0;ux&&(Cs*=Q2/fn),pt.glyphOffsetArray.length>=yc.MAX_GLYPHS&&Sr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),zr.sortKey!==void 0&&pt.addToSortKeyRanges(pt.symbolInstances.length,zr.sortKey);const aT=Qv(Rn,zr,Ps),[lT,cT]=function(Yn,Zi){const al=Yn.length,Ms=Zi==null?void 0:Zi.values;if((Ms==null?void 0:Ms.length)>0)for(let ll=0;ll<Ms.length;ll+=2){const Xs=Ms[ll+1];Yn.emplaceBack(b.aB[Ms[ll]],Xs[0],Xs[1])}return[al,Yn.length]}(pt.textAnchorOffsets,aT);pt.symbolInstances.emplaceBack(rr.x,rr.y,bo.right>=0?bo.right:-1,bo.center>=0?bo.center:-1,bo.left>=0?bo.left:-1,bo.vertical||-1,Ym,Qm,lx,J2,eT,tT,rT,nT,iT,sT,oT,Tn,ox,ax,ix,sx,ux,0,ni,Cs,lT,cT)}(s,wt,Pt,i,a,h,Ye,s.layers[0],s.collisionBoxArray,t.index,t.sourceLayerIndex,s.index,Y,[Z,Z,Z,Z],Ue,T,ee,ie,Me,F,t,m,C,k,g)};if(De==="line")for(const Pt of Uv(t.geometry,0,0,qe,qe)){const wt=sl(Pt,Ne),pt=G2(wt,L,Pe,i.vertical||N,a,24,he,s.overscaling,qe);for(const rr of pt)N&&K2(s,N.text,Xe,rr)||ut(wt,rr)}else if(De==="line-center"){for(const Pt of t.geometry)if(Pt.length>1){const wt=sl(Pt,Ne),pt=Z2(wt,Pe,i.vertical||N,a,24,he);pt&&ut(wt,pt)}}else if(t.type==="Polygon")for(const Pt of Bl(t.geometry,0)){const wt=H2(Pt,16);ut(sl(Pt[0],Ne,!0),new ta(wt.x,wt.y,0))}else if(t.type==="LineString")for(const Pt of t.geometry){const wt=sl(Pt,Ne);ut(wt,new ta(wt[0].x,wt[0].y,0))}else if(t.type==="Point")for(const Pt of t.geometry)for(const wt of Pt)ut([wt],new ta(wt.x,wt.y,0))}function Jv(s,t,i,a,h,m,g,v,T,C,k,I,D,j,F){const N=function(he,ee,L,Z,ie,Pe,Ue,Me){const De=Z.layout.get("text-rotate").evaluate(Pe,{})*Math.PI/180,Xe=[];for(const Ge of ee.positionedLines)for(const Ye of Ge.positionedGlyphs){if(!Ye.rect)continue;const Ne=Ye.rect||{};let ut=T2+1,Pt=!0,wt=1,pt=0;const rr=(ie||Me)&&Ye.vertical,$r=Ye.metrics.advance*Ye.scale/2;if(Me&&ee.verticalizable&&(pt=Ge.lineOffset/2-(Ye.imageName?-(fn-Ye.metrics.width*Ye.scale)/2:(Ye.scale-1)*fn)),Ye.imageName){const Pn=Ue[Ye.imageName];Pt=Pn.sdf,wt=Pn.pixelRatio,ut=pi/wt}const mn=ie?[Ye.x+$r,Ye.y]:[0,0];let $n=ie?[0,0]:[Ye.x+$r+L[0],Ye.y+L[1]-pt],$i=[0,0];rr&&($i=$n,$n=[0,0]);const fi=Ye.metrics.isDoubleResolution?2:1,Rn=(Ye.metrics.left-ut)*Ye.scale-$r+$n[0],Fr=(-Ye.metrics.top-ut)*Ye.scale+$n[1],Tn=Rn+Ne.w/fi*Ye.scale/wt,Dn=Fr+Ne.h/fi*Ye.scale/wt,Ln=new ce(Rn,Fr),ni=new ce(Tn,Fr),Ui=new ce(Rn,Dn),Sn=new ce(Tn,Dn);if(rr){const Pn=new ce(-$r,$r-rp),Cn=-Math.PI/2,an=fn/2-$r,zr=new ce(5-rp-an,-(Ye.imageName?an:0)),Ss=new ce(...$i);Ln._rotateAround(Cn,Pn)._add(zr)._add(Ss),ni._rotateAround(Cn,Pn)._add(zr)._add(Ss),Ui._rotateAround(Cn,Pn)._add(zr)._add(Ss),Sn._rotateAround(Cn,Pn)._add(zr)._add(Ss)}if(De){const Pn=Math.sin(De),Cn=Math.cos(De),an=[Cn,-Pn,Pn,Cn];Ln._matMult(an),ni._matMult(an),Ui._matMult(an),Sn._matMult(an)}const mi=new ce(0,0),gn=new ce(0,0);Xe.push({tl:Ln,tr:ni,bl:Ui,br:Sn,tex:Ne,writingMode:ee.writingMode,glyphOffset:mn,sectionIndex:Ye.sectionIndex,isSDF:Pt,pixelOffsetTL:mi,pixelOffsetBR:gn,minFontScaleX:0,minFontScaleY:0})}return Xe}(0,i,v,h,m,g,a,s.allowVerticalPlacement),G=s.textSizeData;let Y=null;G.kind==="source"?(Y=[Ws*h.layout.get("text-size").evaluate(g,{})],Y[0]>Jo&&Sr(`${s.layerIds[0]}: Value for "text-size" is >= ${oh}. Reduce your "text-size".`)):G.kind==="composite"&&(Y=[Ws*j.compositeTextSizes[0].evaluate(g,{},F),Ws*j.compositeTextSizes[1].evaluate(g,{},F)],(Y[0]>Jo||Y[1]>Jo)&&Sr(`${s.layerIds[0]}: Value for "text-size" is >= ${oh}. Reduce your "text-size".`)),s.addSymbols(s.text,N,Y,v,m,g,C,t,T.lineStartIndex,T.lineLength,D,F);for(const he of k)I[he]=s.text.placedSymbolArray.length-1;return 4*N.length}function ex(s){for(const t in s)return s[t];return null}function K2(s,t,i,a){const h=s.compareText;if(t in h){const m=h[t];for(let g=m.length-1;g>=0;g--)if(a.dist(m[g])<i)return!0}else h[t]=[];return h[t].push(a),!1}const tx=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Zm{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,a]=new Uint8Array(t,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=a>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const m=tx[15&a];if(!m)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(t,2,1),[v]=new Uint32Array(t,4,1);return new Zm(v,g,m,t)}constructor(t,i=64,a=Float64Array,h){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=a,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const m=tx.indexOf(this.ArrayType),g=2*t*this.ArrayType.BYTES_PER_ELEMENT,v=t*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-v%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${a}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+v+T,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+g+v+T),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+v+T,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=t)}add(t,i){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=t,this.coords[this._pos++]=i,a}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Gm(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,i,a,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:g,nodeSize:v}=this,T=[0,m.length-1,0],C=[];for(;T.length;){const k=T.pop()||0,I=T.pop()||0,D=T.pop()||0;if(I-D<=v){for(let G=D;G<=I;G++){const Y=g[2*G],he=g[2*G+1];Y>=t&&Y<=a&&he>=i&&he<=h&&C.push(m[G])}continue}const j=D+I>>1,F=g[2*j],N=g[2*j+1];F>=t&&F<=a&&N>=i&&N<=h&&C.push(m[j]),(k===0?t<=F:i<=N)&&(T.push(D),T.push(j-1),T.push(1-k)),(k===0?a>=F:h>=N)&&(T.push(j+1),T.push(I),T.push(1-k))}return C}within(t,i,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:m,nodeSize:g}=this,v=[0,h.length-1,0],T=[],C=a*a;for(;v.length;){const k=v.pop()||0,I=v.pop()||0,D=v.pop()||0;if(I-D<=g){for(let G=D;G<=I;G++)nx(m[2*G],m[2*G+1],t,i)<=C&&T.push(h[G]);continue}const j=D+I>>1,F=m[2*j],N=m[2*j+1];nx(F,N,t,i)<=C&&T.push(h[j]),(k===0?t-a<=F:i-a<=N)&&(v.push(D),v.push(j-1),v.push(1-k)),(k===0?t+a>=F:i+a>=N)&&(v.push(j+1),v.push(I),v.push(1-k))}return T}}function Gm(s,t,i,a,h,m){if(h-a<=i)return;const g=a+h>>1;rx(s,t,g,a,h,m),Gm(s,t,i,a,g-1,1-m),Gm(s,t,i,g+1,h,1-m)}function rx(s,t,i,a,h,m){for(;h>a;){if(h-a>600){const C=h-a+1,k=i-a+1,I=Math.log(C),D=.5*Math.exp(2*I/3),j=.5*Math.sqrt(I*D*(C-D)/C)*(k-C/2<0?-1:1);rx(s,t,i,Math.max(a,Math.floor(i-k*D/C+j)),Math.min(h,Math.floor(i+(C-k)*D/C+j)),m)}const g=t[2*i+m];let v=a,T=h;for(ch(s,t,a,i),t[2*h+m]>g&&ch(s,t,a,h);v<T;){for(ch(s,t,v,T),v++,T--;t[2*v+m]<g;)v++;for(;t[2*T+m]>g;)T--}t[2*a+m]===g?ch(s,t,a,T):(T++,ch(s,t,T,h)),T<=i&&(a=T+1),i<=T&&(h=T-1)}}function ch(s,t,i,a){qm(s,i,a),qm(t,2*i,2*a),qm(t,2*i+1,2*a+1)}function qm(s,t,i){const a=s[t];s[t]=s[i],s[i]=a}function nx(s,t,i,a){const h=s-i,m=t-a;return h*h+m*m}var Hm;b.co=void 0,(Hm=b.co||(b.co={})).create="create",Hm.load="load",Hm.fullLoad="fullLoad";let hp=null,uh=[];const Wm=1e3/60,Xm="loadTime",Km="fullLoadTime",Y2={mark(s){performance.mark(s)},frame(s){const t=s;hp!=null&&uh.push(t-hp),hp=t},clearMetrics(){hp=null,uh=[],performance.clearMeasures(Xm),performance.clearMeasures(Km);for(const s in b.co)performance.clearMarks(b.co[s])},getPerformanceMetrics(){performance.measure(Xm,b.co.create,b.co.load),performance.measure(Km,b.co.create,b.co.fullLoad);const s=performance.getEntriesByName(Xm)[0].duration,t=performance.getEntriesByName(Km)[0].duration,i=uh.length,a=1/(uh.reduce((m,g)=>m+g,0)/i/1e3),h=uh.filter(m=>m>Wm).reduce((m,g)=>m+(g-Wm)/Wm,0);return{loadTime:s,fullLoadTime:t,fps:a,percentDroppedFrames:h/(i+h)*100,totalFrames:i}}};b.$=ah,b.A=Je,b.B=ns,b.C=Er,b.D=_t,b.E=de,b.F=rm,b.G=function(s){if(Qi==null){const t=s.navigator?s.navigator.userAgent:null;Qi=!!s.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Qi},b.H=class{constructor(s,t){this.target=s,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new V2(()=>this.process()),this.subscription=Ji(this.target,"message",i=>this.receive(i),!1),this.globalScope=nr(self)?s:window}registerMessageHandler(s,t){this.messageHandlers[s]=t}sendAsync(s,t){return new Promise((i,a)=>{const h=Math.round(1e18*Math.random()).toString(36).substring(0,10),m=t?Ji(t.signal,"abort",()=>{m==null||m.unsubscribe(),delete this.resolveRejects[h];const T={id:h,type:"<cancel>",origin:location.origin,targetMapId:s.targetMapId,sourceMapId:this.mapId};this.target.postMessage(T)},$2):null;this.resolveRejects[h]={resolve:T=>{m==null||m.unsubscribe(),i(T)},reject:T=>{m==null||m.unsubscribe(),a(T)}};const g=[],v=Object.assign(Object.assign({},s),{id:h,sourceMapId:this.mapId,origin:location.origin,data:Xo(s.data,g)});this.target.postMessage(v,{transfer:g})})}receive(s){const t=s.data,i=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[i];const a=this.abortControllers[i];return delete this.abortControllers[i],void(a&&a.abort())}if(nr(self)||t.mustQueue)return this.tasks[i]=t,this.taskQueue.push(i),void this.invoker.trigger();this.processTask(i,t)}}process(){if(this.taskQueue.length===0)return;const s=this.taskQueue.shift(),t=this.tasks[s];delete this.tasks[s],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(s,t)}processTask(s,t){return c(this,void 0,void 0,function*(){if(t.type==="<response>"){const h=this.resolveRejects[s];return delete this.resolveRejects[s],h?void(t.error?h.reject(Ha(t.error)):h.resolve(Ha(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(s,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const i=Ha(t.data),a=new AbortController;this.abortControllers[s]=a;try{const h=yield this.messageHandlers[t.type](t.sourceMapId,i,a);this.completeTask(s,null,h)}catch(h){this.completeTask(s,h)}})}completeTask(s,t,i){const a=[];delete this.abortControllers[s];const h={id:s,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?Xo(t):null,data:Xo(i,a)};this.target.postMessage(h,{transfer:a})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},b.I=Am,b.J=ms,b.K=function(){var s=new Je(16);return Je!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},b.L=function(s,t,i){var a,h,m,g,v,T,C,k,I,D,j,F,N=i[0],G=i[1],Y=i[2];return t===s?(s[12]=t[0]*N+t[4]*G+t[8]*Y+t[12],s[13]=t[1]*N+t[5]*G+t[9]*Y+t[13],s[14]=t[2]*N+t[6]*G+t[10]*Y+t[14],s[15]=t[3]*N+t[7]*G+t[11]*Y+t[15]):(h=t[1],m=t[2],g=t[3],v=t[4],T=t[5],C=t[6],k=t[7],I=t[8],D=t[9],j=t[10],F=t[11],s[0]=a=t[0],s[1]=h,s[2]=m,s[3]=g,s[4]=v,s[5]=T,s[6]=C,s[7]=k,s[8]=I,s[9]=D,s[10]=j,s[11]=F,s[12]=a*N+v*G+I*Y+t[12],s[13]=h*N+T*G+D*Y+t[13],s[14]=m*N+C*G+j*Y+t[14],s[15]=g*N+k*G+F*Y+t[15]),s},b.M=function(s,t,i){var a=i[0],h=i[1],m=i[2];return s[0]=t[0]*a,s[1]=t[1]*a,s[2]=t[2]*a,s[3]=t[3]*a,s[4]=t[4]*h,s[5]=t[5]*h,s[6]=t[6]*h,s[7]=t[7]*h,s[8]=t[8]*m,s[9]=t[9]*m,s[10]=t[10]*m,s[11]=t[11]*m,s[12]=t[12],s[13]=t[13],s[14]=t[14],s[15]=t[15],s},b.N=function(s,t,i){var a=t[0],h=t[1],m=t[2],g=t[3],v=t[4],T=t[5],C=t[6],k=t[7],I=t[8],D=t[9],j=t[10],F=t[11],N=t[12],G=t[13],Y=t[14],he=t[15],ee=i[0],L=i[1],Z=i[2],ie=i[3];return s[0]=ee*a+L*v+Z*I+ie*N,s[1]=ee*h+L*T+Z*D+ie*G,s[2]=ee*m+L*C+Z*j+ie*Y,s[3]=ee*g+L*k+Z*F+ie*he,s[4]=(ee=i[4])*a+(L=i[5])*v+(Z=i[6])*I+(ie=i[7])*N,s[5]=ee*h+L*T+Z*D+ie*G,s[6]=ee*m+L*C+Z*j+ie*Y,s[7]=ee*g+L*k+Z*F+ie*he,s[8]=(ee=i[8])*a+(L=i[9])*v+(Z=i[10])*I+(ie=i[11])*N,s[9]=ee*h+L*T+Z*D+ie*G,s[10]=ee*m+L*C+Z*j+ie*Y,s[11]=ee*g+L*k+Z*F+ie*he,s[12]=(ee=i[12])*a+(L=i[13])*v+(Z=i[14])*I+(ie=i[15])*N,s[13]=ee*h+L*T+Z*D+ie*G,s[14]=ee*m+L*C+Z*j+ie*Y,s[15]=ee*g+L*k+Z*F+ie*he,s},b.O=function(s,t){const i={};for(let a=0;a<t.length;a++){const h=t[a];h in s&&(i[h]=s[h])}return i},b.P=ce,b.Q=ea,b.R=Ni,b.S=zv,b.T=Ud,b.U=Av,b.V=ve,b.W=Be,b.X=ci,b.Y=Vi,b.Z=qe,b._=c,b.a=Gn,b.a$=function(s,t,i){var a=Math.sin(i),h=Math.cos(i),m=t[4],g=t[5],v=t[6],T=t[7],C=t[8],k=t[9],I=t[10],D=t[11];return t!==s&&(s[0]=t[0],s[1]=t[1],s[2]=t[2],s[3]=t[3],s[12]=t[12],s[13]=t[13],s[14]=t[14],s[15]=t[15]),s[4]=m*h+C*a,s[5]=g*h+k*a,s[6]=v*h+I*a,s[7]=T*h+D*a,s[8]=C*h-m*a,s[9]=k*h-g*a,s[10]=I*h-v*a,s[11]=D*h-T*a,s},b.a0=25,b.a1=Vm,b.a2=s=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(i=>{t.onloadstart=()=>{i(t)};for(const a of s){const h=window.document.createElement("source");ge(a)||(t.crossOrigin="Anonymous"),h.src=a,t.appendChild(h)}})},b.a3=Ie,b.a4=function(){return Ae++},b.a5=K,b.a6=yc,b.a7=Ua,b.a8=rl,b.a9=Ov,b.aA=function(s,t,i,a,h=!1){if(!i[0]&&!i[1])return[0,0];const m=h?a==="map"?-s.bearingInRadians:0:a==="viewport"?s.bearingInRadians:0;if(m){const g=Math.sin(m),v=Math.cos(m);i=[i[0]*v-i[1]*g,i[0]*g+i[1]*v]}return[h?i[0]:ft(t,i[0],s.zoom),h?i[1]:ft(t,i[1],s.zoom)]},b.aC=Dm,b.aD=Um,b.aE=Rm,b.aF=Zm,b.aG=Dr,b.aH=Jd,b.aI=ze,b.aJ=fr,b.aK=pr,b.aL=cn,b.aM=es,b.aN=Dv,b.aO=function(s,t,i){return s[0]=t[0]*i,s[1]=t[1]*i,s[2]=t[2]*i,s},b.aP=function(s,t,i){return s[0]=t[0]+i[0],s[1]=t[1]+i[1],s[2]=t[2]+i[2],s},b.aQ=function(s){var t=new Je(3);return t[0]=s[0],t[1]=s[1],t[2]=s[2],t},b.aR=function(s,t,i){return s[0]=t[0]*i[0],s[1]=t[1]*i[1],s[2]=t[2]*i[2],s[3]=t[3]*i[3],s},b.aS=function(s,t,i){return s[0]=t[0]-i[0],s[1]=t[1]-i[1],s[2]=t[2]-i[2],s},b.aT=function(s,t){var i=t[0],a=t[1],h=t[2],m=i*i+a*a+h*h;return m>0&&(m=1/Math.sqrt(m)),s[0]=t[0]*m,s[1]=t[1]*m,s[2]=t[2]*m,s},b.aU=function(s,t,i){var a=t[0],h=t[1],m=t[2],g=i[0],v=i[1],T=i[2];return s[0]=h*T-m*v,s[1]=m*g-a*T,s[2]=a*v-h*g,s},b.aV=function(s,t){return s[0]*t[0]+s[1]*t[1]+s[2]*t[2]},b.aW=jv,b.aX=vc,b.aY=function(s,t,i,a,h){var m,g=1/Math.tan(t/2);return s[0]=g/i,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=g,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,h!=null&&h!==1/0?(s[10]=(h+a)*(m=1/(a-h)),s[14]=2*h*a*m):(s[10]=-1,s[14]=-2*a),s},b.aZ=function(s){var t=new Je(16);return t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],t[4]=s[4],t[5]=s[5],t[6]=s[6],t[7]=s[7],t[8]=s[8],t[9]=s[9],t[10]=s[10],t[11]=s[11],t[12]=s[12],t[13]=s[13],t[14]=s[14],t[15]=s[15],t},b.a_=function(s,t,i){var a=Math.sin(i),h=Math.cos(i),m=t[0],g=t[1],v=t[2],T=t[3],C=t[4],k=t[5],I=t[6],D=t[7];return t!==s&&(s[8]=t[8],s[9]=t[9],s[10]=t[10],s[11]=t[11],s[12]=t[12],s[13]=t[13],s[14]=t[14],s[15]=t[15]),s[0]=m*h+C*a,s[1]=g*h+k*a,s[2]=v*h+I*a,s[3]=T*h+D*a,s[4]=C*h-m*a,s[5]=k*h-g*a,s[6]=I*h-v*a,s[7]=D*h-T*a,s},b.aa=function(s){const t={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,a,h,m)=>{const g=h||m;return t[a]=!g||g.toLowerCase(),""}),t["max-age"]){const i=parseInt(t["max-age"],10);isNaN(i)?delete t["max-age"]:t["max-age"]=i}return t},b.ab=js,b.ac=function(s){return Math.pow(2,s)},b.ad=rt,b.ae=Tr,b.af=85.051129,b.ag=Rv,b.ah=function(s){return Math.log(s)/Math.LN2},b.ai=function(s){var t=s[0],i=s[1];return t*t+i*i},b.aj=function(s,t){const i=[];for(const a in s)a in t||i.push(a);return i},b.ak=function(s,t){let i=0,a=0;if(s.kind==="constant")a=s.layoutSize;else if(s.kind!=="source"){const{interpolationType:h,minZoom:m,maxZoom:g}=s,v=h?Tr(On.interpolationFactor(h,t,m,g),0,1):0;s.kind==="camera"?a=ns.number(s.minSize,s.maxSize,v):i=v}return{uSizeT:i,uSize:a}},b.am=function(s,{uSize:t,uSizeT:i},{lowerSize:a,upperSize:h}){return s.kind==="source"?a/Ws:s.kind==="composite"?ns.number(a/Ws,h/Ws,i):t},b.an=function(s,t){var i=t[0],a=t[1],h=t[2],m=t[3],g=t[4],v=t[5],T=t[6],C=t[7],k=t[8],I=t[9],D=t[10],j=t[11],F=t[12],N=t[13],G=t[14],Y=t[15],he=i*v-a*g,ee=i*T-h*g,L=i*C-m*g,Z=a*T-h*v,ie=a*C-m*v,Pe=h*C-m*T,Ue=k*N-I*F,Me=k*G-D*F,De=k*Y-j*F,Xe=I*G-D*N,Ge=I*Y-j*N,Ye=D*Y-j*G,Ne=he*Ye-ee*Ge+L*Xe+Z*De-ie*Me+Pe*Ue;return Ne?(s[0]=(v*Ye-T*Ge+C*Xe)*(Ne=1/Ne),s[1]=(h*Ge-a*Ye-m*Xe)*Ne,s[2]=(N*Pe-G*ie+Y*Z)*Ne,s[3]=(D*ie-I*Pe-j*Z)*Ne,s[4]=(T*De-g*Ye-C*Me)*Ne,s[5]=(i*Ye-h*De+m*Me)*Ne,s[6]=(G*L-F*Pe-Y*ee)*Ne,s[7]=(k*Pe-D*L+j*ee)*Ne,s[8]=(g*Ge-v*De+C*Ue)*Ne,s[9]=(a*De-i*Ge-m*Ue)*Ne,s[10]=(F*ie-N*L+Y*he)*Ne,s[11]=(I*L-k*ie-j*he)*Ne,s[12]=(v*Me-g*Xe-T*Ue)*Ne,s[13]=(i*Xe-a*Me+h*Ue)*Ne,s[14]=(N*ee-F*Z-G*he)*Ne,s[15]=(k*Z-I*ee+D*he)*Ne,s):null},b.ao=dr,b.ap=function(s){return Math.hypot(s[0],s[1])},b.aq=function(s){return s[0]=0,s[1]=0,s},b.ar=function(s,t,i){return s[0]=t[0]*i,s[1]=t[1]*i,s},b.as=Lm,b.at=Wt,b.au=function(s,t,i,a){const h=t.y-s.y,m=t.x-s.x,g=a.y-i.y,v=a.x-i.x,T=g*m-v*h;if(T===0)return null;const C=(v*(s.y-i.y)-g*(s.x-i.x))/T;return new ce(s.x+C*m,s.y+C*h)},b.av=Uv,b.aw=ky,b.ax=function(s){let t=1/0,i=1/0,a=-1/0,h=-1/0;for(const m of s)t=Math.min(t,m.x),i=Math.min(i,m.y),a=Math.max(a,m.x),h=Math.max(h,m.y);return[t,i,a,h]},b.ay=fn,b.az=ft,b.b=rn,b.b$=class extends O{},b.b0=function(){const s=new Float32Array(16);return rt(s),s},b.b1=function(){const s=new Float64Array(16);return rt(s),s},b.b2=function(){return new Float64Array(16)},b.b3=function(s,t,i){const a=new Float64Array(4);return function(h,m,g,v){var T=.5*Math.PI/180;m*=T,g*=T,v*=T;var C=Math.sin(m),k=Math.cos(m),I=Math.sin(g),D=Math.cos(g),j=Math.sin(v),F=Math.cos(v);h[0]=C*D*F-k*I*j,h[1]=k*I*F+C*D*j,h[2]=k*D*j-C*I*F,h[3]=k*D*F+C*I*j}(a,s,t-90,i),a},b.b4=function(s,t,i,a){var h,m,g,v,T,C=t[0],k=t[1],I=t[2],D=t[3],j=i[0],F=i[1],N=i[2],G=i[3];return(m=C*j+k*F+I*N+D*G)<0&&(m=-m,j=-j,F=-F,N=-N,G=-G),1-m>We?(h=Math.acos(m),g=Math.sin(h),v=Math.sin((1-a)*h)/g,T=Math.sin(a*h)/g):(v=1-a,T=a),s[0]=v*C+T*j,s[1]=v*k+T*F,s[2]=v*I+T*N,s[3]=v*D+T*G,s},b.b5=function(s){const t=new Float64Array(9);var i,a,h,m,g,v,T,C,k,I,D,j,F,N,G,Y,he,ee;I=(h=(a=s)[0])*(T=h+h),D=(m=a[1])*T,F=(g=a[2])*T,N=g*(C=m+m),Y=(v=a[3])*T,he=v*C,ee=v*(k=g+g),(i=t)[0]=1-(j=m*C)-(G=g*k),i[3]=D-ee,i[6]=F+he,i[1]=D+ee,i[4]=1-I-G,i[7]=N-Y,i[2]=F-he,i[5]=N+Y,i[8]=1-I-j;const L=es(-Math.asin(Tr(t[2],-1,1)));let Z,ie;return Math.hypot(t[5],t[8])<.001?(Z=0,ie=-es(Math.atan2(t[3],t[4]))):(Z=es(t[5]===0&&t[8]===0?0:Math.atan2(t[5],t[8])),ie=es(t[1]===0&&t[0]===0?0:Math.atan2(t[1],t[0]))),{roll:Z,pitch:L+90,bearing:ie}},b.b6=function(s,t){return s.roll==t.roll&&s.pitch==t.pitch&&s.bearing==t.bearing},b.b7=Kt,b.b8=dc,b.b9=gc,b.bA=function(s){if(s.type==="custom")return new N2(s);switch(s.type){case"background":return new F2(s);case"circle":return new zw(s);case"fill":return new Yw(s);case"fill-extrusion":return new s2(s);case"heatmap":return new Dw(s);case"hillshade":return new jw(s);case"line":return new p2(s);case"raster":return new O2(s);case"symbol":return new op(s)}},b.bB=yr,b.bC=function(s,t){if(!s)return[{command:"setStyle",args:[t]}];let i=[];try{if(!be(s.version,t.version))return[{command:"setStyle",args:[t]}];be(s.center,t.center)||i.push({command:"setCenter",args:[t.center]}),be(s.state,t.state)||i.push({command:"setGlobalState",args:[t.state]}),be(s.centerAltitude,t.centerAltitude)||i.push({command:"setCenterAltitude",args:[t.centerAltitude]}),be(s.zoom,t.zoom)||i.push({command:"setZoom",args:[t.zoom]}),be(s.bearing,t.bearing)||i.push({command:"setBearing",args:[t.bearing]}),be(s.pitch,t.pitch)||i.push({command:"setPitch",args:[t.pitch]}),be(s.roll,t.roll)||i.push({command:"setRoll",args:[t.roll]}),be(s.sprite,t.sprite)||i.push({command:"setSprite",args:[t.sprite]}),be(s.glyphs,t.glyphs)||i.push({command:"setGlyphs",args:[t.glyphs]}),be(s.transition,t.transition)||i.push({command:"setTransition",args:[t.transition]}),be(s.light,t.light)||i.push({command:"setLight",args:[t.light]}),be(s.terrain,t.terrain)||i.push({command:"setTerrain",args:[t.terrain]}),be(s.sky,t.sky)||i.push({command:"setSky",args:[t.sky]}),be(s.projection,t.projection)||i.push({command:"setProjection",args:[t.projection]});const a={},h=[];(function(g,v,T,C){let k;for(k in v=v||{},g=g||{})Object.prototype.hasOwnProperty.call(g,k)&&(Object.prototype.hasOwnProperty.call(v,k)||$e(k,T,C));for(k in v)Object.prototype.hasOwnProperty.call(v,k)&&(Object.prototype.hasOwnProperty.call(g,k)?be(g[k],v[k])||(g[k].type==="geojson"&&v[k].type==="geojson"&&ot(g,v,k)?Ce(T,{command:"setGeoJSONSourceData",args:[k,v[k].data]}):tt(k,v,T,C)):xe(k,v,T))})(s.sources,t.sources,h,a);const m=[];s.layers&&s.layers.forEach(g=>{"source"in g&&a[g.source]?i.push({command:"removeLayer",args:[g.id]}):m.push(g)}),i=i.concat(h),function(g,v,T){v=v||[];const C=(g=g||[]).map(Lt),k=v.map(Lt),I=g.reduce(Tt,{}),D=v.reduce(Tt,{}),j=C.slice(),F=Object.create(null);let N,G,Y,he,ee;for(let L=0,Z=0;L<C.length;L++)N=C[L],Object.prototype.hasOwnProperty.call(D,N)?Z++:(Ce(T,{command:"removeLayer",args:[N]}),j.splice(j.indexOf(N,Z),1));for(let L=0,Z=0;L<k.length;L++)N=k[k.length-1-L],j[j.length-1-L]!==N&&(Object.prototype.hasOwnProperty.call(I,N)?(Ce(T,{command:"removeLayer",args:[N]}),j.splice(j.lastIndexOf(N,j.length-Z),1)):Z++,he=j[j.length-L],Ce(T,{command:"addLayer",args:[D[N],he]}),j.splice(j.length-L,0,N),F[N]=!0);for(let L=0;L<k.length;L++)if(N=k[L],G=I[N],Y=D[N],!F[N]&&!be(G,Y))if(be(G.source,Y.source)&&be(G["source-layer"],Y["source-layer"])&&be(G.type,Y.type)){for(ee in xt(G.layout,Y.layout,T,N,null,"setLayoutProperty"),xt(G.paint,Y.paint,T,N,null,"setPaintProperty"),be(G.filter,Y.filter)||Ce(T,{command:"setFilter",args:[N,Y.filter]}),be(G.minzoom,Y.minzoom)&&be(G.maxzoom,Y.maxzoom)||Ce(T,{command:"setLayerZoomRange",args:[N,Y.minzoom,Y.maxzoom]}),G)Object.prototype.hasOwnProperty.call(G,ee)&&ee!=="layout"&&ee!=="paint"&&ee!=="filter"&&ee!=="metadata"&&ee!=="minzoom"&&ee!=="maxzoom"&&(ee.indexOf("paint.")===0?xt(G[ee],Y[ee],T,N,ee.slice(6),"setPaintProperty"):be(G[ee],Y[ee])||Ce(T,{command:"setLayerProperty",args:[N,ee,Y[ee]]}));for(ee in Y)Object.prototype.hasOwnProperty.call(Y,ee)&&!Object.prototype.hasOwnProperty.call(G,ee)&&ee!=="layout"&&ee!=="paint"&&ee!=="filter"&&ee!=="metadata"&&ee!=="minzoom"&&ee!=="maxzoom"&&(ee.indexOf("paint.")===0?xt(G[ee],Y[ee],T,N,ee.slice(6),"setPaintProperty"):be(G[ee],Y[ee])||Ce(T,{command:"setLayerProperty",args:[N,ee,Y[ee]]}))}else Ce(T,{command:"removeLayer",args:[N]}),he=j[j.lastIndexOf(N)+1],Ce(T,{command:"addLayer",args:[Y,he]})}(m,t.layers,i)}catch(a){console.warn("Unable to compute style diff:",a),i=[{command:"setStyle",args:[t]}]}return i},b.bD=function(s){const t=[],i=s.id;return i===void 0&&t.push({message:`layers.${i}: missing required property "id"`}),s.render===void 0&&t.push({message:`layers.${i}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&t.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),t},b.bE=function s(t,i){if(Array.isArray(t)){if(!Array.isArray(i)||t.length!==i.length)return!1;for(let a=0;a<t.length;a++)if(!s(t[a],i[a]))return!1;return!0}if(typeof t=="object"&&t!==null&&i!==null){if(typeof i!="object"||Object.keys(t).length!==Object.keys(i).length)return!1;for(const a in t)if(!s(t[a],i[a]))return!1;return!0}return t===i},b.bF=Ut,b.bG=Yt,b.bH=class extends Ar{constructor(s,t){super(s,t),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}},b.bI=Wd,b.bJ=class extends Ar{constructor(s,t){super(s,t),this.current=lm}set(s){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let t=1;t<16;t++)if(s[t]!==this.current[t]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}},b.bK=Hd,b.bL=class extends Ar{constructor(s,t){super(s,t),this.current=[0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2]))}},b.bM=class extends Ar{constructor(s,t){super(s,t),this.current=[0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1]))}},b.bN=st,b.bO=function(s,t){var i=Math.sin(t),a=Math.cos(t);return s[0]=a,s[1]=i,s[2]=0,s[3]=-i,s[4]=a,s[5]=0,s[6]=0,s[7]=0,s[8]=1,s},b.bP=function(s,t,i){var a=t[0],h=t[1],m=t[2];return s[0]=a*i[0]+h*i[3]+m*i[6],s[1]=a*i[1]+h*i[4]+m*i[7],s[2]=a*i[2]+h*i[5]+m*i[8],s},b.bQ=function(s,t,i,a,h,m,g){var v=1/(t-i),T=1/(a-h),C=1/(m-g);return s[0]=-2*v,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*T,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*C,s[11]=0,s[12]=(t+i)*v,s[13]=(h+a)*T,s[14]=(g+m)*C,s[15]=1,s},b.bR=class extends Ar{constructor(s,t){super(s,t),this.current=new Array}set(s){if(s!=this.current){this.current=s;const t=new Float32Array(4*s.length);for(let i=0;i<s.length;i++)t[4*i]=s[i].r,t[4*i+1]=s[i].g,t[4*i+2]=s[i].b,t[4*i+3]=s[i].a;this.gl.uniform4fv(this.location,t)}}},b.bS=class extends Ar{constructor(s,t){super(s,t),this.current=new Array}set(s){if(s!=this.current){this.current=s;const t=new Float32Array(s);this.gl.uniform1fv(this.location,t)}}},b.bT=class extends f{},b.bU=_2,b.bV=class extends w{},b.bW=mm,b.bX=function(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))},b.bY=By,b.bZ=function(s,t,i){var a=t[0],h=t[1],m=t[2],g=i[3]*a+i[7]*h+i[11]*m+i[15];return s[0]=(i[0]*a+i[4]*h+i[8]*m+i[12])/(g=g||1),s[1]=(i[1]*a+i[5]*h+i[9]*m+i[13])/g,s[2]=(i[2]*a+i[6]*h+i[10]*m+i[14])/g,s},b.b_=class extends yo{},b.ba=Ju,b.bb=mc,b.bc=Gt,b.bd=Xt,b.be=ri,b.bf=function(s,t,i,a,h){return Gt(a,h,Tr((s-t)/(i-t),0,1))},b.bg=bt,b.bh=function(){return new Float64Array(3)},b.bi=function(s,t,i,a){return s[0]=t[0]+i[0]*a,s[1]=t[1]+i[1]*a,s[2]=t[2]+i[2]*a,s},b.bj=_r,b.bk=function(){return new Float64Array(4)},b.bl=function(s,t,i,a){var h=[],m=[];return h[0]=t[0]-i[0],h[1]=t[1]-i[1],h[2]=t[2]-i[2],m[0]=h[0]*Math.cos(a)-h[1]*Math.sin(a),m[1]=h[0]*Math.sin(a)+h[1]*Math.cos(a),m[2]=h[2],s[0]=m[0]+i[0],s[1]=m[1]+i[1],s[2]=m[2]+i[2],s},b.bm=function(s,t,i,a){var h=[],m=[];return h[0]=t[0]-i[0],h[1]=t[1]-i[1],h[2]=t[2]-i[2],m[0]=h[0],m[1]=h[1]*Math.cos(a)-h[2]*Math.sin(a),m[2]=h[1]*Math.sin(a)+h[2]*Math.cos(a),s[0]=m[0]+i[0],s[1]=m[1]+i[1],s[2]=m[2]+i[2],s},b.bn=function(s,t,i,a){var h=[],m=[];return h[0]=t[0]-i[0],h[1]=t[1]-i[1],h[2]=t[2]-i[2],m[0]=h[2]*Math.sin(a)+h[0]*Math.cos(a),m[1]=h[1],m[2]=h[2]*Math.cos(a)-h[0]*Math.sin(a),s[0]=m[0]+i[0],s[1]=m[1]+i[1],s[2]=m[2]+i[2],s},b.bo=zt,b.bp=function(s,t,i){var a=Math.sin(i),h=Math.cos(i),m=t[0],g=t[1],v=t[2],T=t[3],C=t[8],k=t[9],I=t[10],D=t[11];return t!==s&&(s[4]=t[4],s[5]=t[5],s[6]=t[6],s[7]=t[7],s[12]=t[12],s[13]=t[13],s[14]=t[14],s[15]=t[15]),s[0]=m*h-C*a,s[1]=g*h-k*a,s[2]=v*h-I*a,s[3]=T*h-D*a,s[8]=m*a+C*h,s[9]=g*a+k*h,s[10]=v*a+I*h,s[11]=T*a+D*h,s},b.bq=function(s,t){const i=bt(s,360),a=bt(t,360),h=a-i,m=a>i?h-360:h+360;return Math.abs(h)<Math.abs(m)?h:m},b.br=function(s){return s[0]=0,s[1]=0,s[2]=0,s},b.bs=function(s,t,i,a){const h=Math.sqrt(s*s+t*t),m=Math.sqrt(i*i+a*a);s/=h,t/=h,i/=m,a/=m;const g=Math.acos(s*i+t*a);return-t*i+s*a>0?g:-g},b.bt=function(s,t){return s[0]*t[0]+s[1]*t[1]+s[2]*t[2]+s[3]},b.bu=Om,b.bv=function(s,t){const i=bt(s,2*Math.PI),a=bt(t,2*Math.PI);return Math.min(Math.abs(i-a),Math.abs(i-a+2*Math.PI),Math.abs(i-a-2*Math.PI))},b.bw=function(){const s={},t=q.$version;for(const i in q.$root){const a=q.$root[i];if(a.required){let h=null;h=i==="version"?t:a.type==="array"?[]:{},h!=null&&(s[i]=h)}}return s},b.bx=Lu,b.by=En,b.bz=function(s){s=s.slice();const t=Object.create(null);for(let i=0;i<s.length;i++)t[s[i].id]=s[i];for(let i=0;i<s.length;i++)"ref"in s[i]&&(s[i]=_e(s[i],t[s[i].ref]));return s},b.c=ts,b.c0=function(s,t){return s[0]===t[0]&&s[1]===t[1]&&s[2]===t[2]&&s[3]===t[3]&&s[4]===t[4]&&s[5]===t[5]&&s[6]===t[6]&&s[7]===t[7]&&s[8]===t[8]&&s[9]===t[9]&&s[10]===t[10]&&s[11]===t[11]&&s[12]===t[12]&&s[13]===t[13]&&s[14]===t[14]&&s[15]===t[15]},b.c1=function(s,t){var i=s[0],a=s[1],h=s[2],m=s[3],g=s[4],v=s[5],T=s[6],C=s[7],k=s[8],I=s[9],D=s[10],j=s[11],F=s[12],N=s[13],G=s[14],Y=s[15],he=t[0],ee=t[1],L=t[2],Z=t[3],ie=t[4],Pe=t[5],Ue=t[6],Me=t[7],De=t[8],Xe=t[9],Ge=t[10],Ye=t[11],Ne=t[12],ut=t[13],Pt=t[14],wt=t[15];return Math.abs(i-he)<=We*Math.max(1,Math.abs(i),Math.abs(he))&&Math.abs(a-ee)<=We*Math.max(1,Math.abs(a),Math.abs(ee))&&Math.abs(h-L)<=We*Math.max(1,Math.abs(h),Math.abs(L))&&Math.abs(m-Z)<=We*Math.max(1,Math.abs(m),Math.abs(Z))&&Math.abs(g-ie)<=We*Math.max(1,Math.abs(g),Math.abs(ie))&&Math.abs(v-Pe)<=We*Math.max(1,Math.abs(v),Math.abs(Pe))&&Math.abs(T-Ue)<=We*Math.max(1,Math.abs(T),Math.abs(Ue))&&Math.abs(C-Me)<=We*Math.max(1,Math.abs(C),Math.abs(Me))&&Math.abs(k-De)<=We*Math.max(1,Math.abs(k),Math.abs(De))&&Math.abs(I-Xe)<=We*Math.max(1,Math.abs(I),Math.abs(Xe))&&Math.abs(D-Ge)<=We*Math.max(1,Math.abs(D),Math.abs(Ge))&&Math.abs(j-Ye)<=We*Math.max(1,Math.abs(j),Math.abs(Ye))&&Math.abs(F-Ne)<=We*Math.max(1,Math.abs(F),Math.abs(Ne))&&Math.abs(N-ut)<=We*Math.max(1,Math.abs(N),Math.abs(ut))&&Math.abs(G-Pt)<=We*Math.max(1,Math.abs(G),Math.abs(Pt))&&Math.abs(Y-wt)<=We*Math.max(1,Math.abs(Y),Math.abs(wt))},b.c2=function(s,t){return s[0]=t[0],s[1]=t[1],s[2]=t[2],s[3]=t[3],s[4]=t[4],s[5]=t[5],s[6]=t[6],s[7]=t[7],s[8]=t[8],s[9]=t[9],s[10]=t[10],s[11]=t[11],s[12]=t[12],s[13]=t[13],s[14]=t[14],s[15]=t[15],s},b.c3=s=>s.type==="symbol",b.c4=s=>s.type==="circle",b.c5=s=>s.type==="heatmap",b.c6=s=>s.type==="line",b.c7=s=>s.type==="fill",b.c8=s=>s.type==="fill-extrusion",b.c9=s=>s.type==="hillshade",b.cA=xm,b.cB=Pm,b.cC=th,b.cD=Em,b.cE=class{constructor(s){this._marks={start:[s.url,"start"].join("#"),end:[s.url,"end"].join("#"),measure:s.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let s=performance.getEntriesByName(this._marks.measure);return s.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),s=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),s}},b.cF=function(s,t,i,a,h){return c(this,void 0,void 0,function*(){if(Be())try{return yield ci(s,t,i,a,h)}catch{}return function(m,g,v,T,C){const k=m.width,I=m.height;un&&kn||(un=new OffscreenCanvas(k,I),kn=un.getContext("2d",{willReadFrequently:!0})),un.width=k,un.height=I,kn.drawImage(m,0,0,k,I);const D=kn.getImageData(g,v,T,C);return kn.clearRect(0,0,k,I),D.data}(s,t,i,a,h)})},b.cG=Fv,b.cH=U,b.cI=ye,b.cJ=tv,b.cK=pv,b.cL=Yl,b.cM=bs,b.ca=s=>s.type==="raster",b.cb=s=>s.type==="background",b.cc=s=>s.type==="custom",b.cd=yn,b.ce=function(s,t,i){const a=Gr(t.x-i.x,t.y-i.y),h=Gr(s.x-i.x,s.y-i.y);var m,g;return es(Math.atan2(a[0]*h[1]-a[1]*h[0],(m=a)[0]*(g=h)[0]+m[1]*g[1]))},b.cf=br,b.cg=function(s,t){return no[t]&&(s instanceof MouseEvent||s instanceof WheelEvent)},b.ch=function(s,t){return ro[t]&&"touches"in s},b.ci=function(s){return ro[s]||no[s]},b.cj=function(s,t,i){var a=t[0],h=t[1];return s[0]=i[0]*a+i[4]*h+i[12],s[1]=i[1]*a+i[5]*h+i[13],s},b.ck=function(s,t){const{x:i,y:a}=ah.fromLngLat(t);return!(s<0||s>25||a<0||a>=1||i<0||i>=1)},b.cl=function(s,t){return s[0]=t[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=t[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=t[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},b.cm=class extends Qa{},b.cn=Y2,b.cp=function(s){return s.message===io},b.cq=qn,b.cr=function(s,t){Gn.REGISTERED_PROTOCOLS[s]=t},b.cs=function(s){delete Gn.REGISTERED_PROTOCOLS[s]},b.ct=function(s,t){const i={};for(let h=0;h<s.length;h++){const m=t&&t[s[h].id]||zd(s[h]);t&&(t[s[h].id]=m);let g=i[m];g||(g=i[m]=[]),g.push(s[h])}const a=[];for(const h in i)a.push(i[h]);return a},b.cu=at,b.cv=Bv,b.cw=Nv,b.cx=mv,b.cy=function(s){s.bucket.createArrays(),s.bucket.tilePixelRatio=qe/(512*s.bucket.overscaling),s.bucket.compareText={},s.bucket.iconsNeedLinear=!1;const t=s.bucket.layers[0],i=t.layout,a=t._unevaluatedLayout._values,h={layoutIconSize:a["icon-size"].possiblyEvaluate(new Er(s.bucket.zoom+1),s.canonical),layoutTextSize:a["text-size"].possiblyEvaluate(new Er(s.bucket.zoom+1),s.canonical),textMaxSize:a["text-size"].possiblyEvaluate(new Er(18))};if(s.bucket.textSizeData.kind==="composite"){const{minZoom:C,maxZoom:k}=s.bucket.textSizeData;h.compositeTextSizes=[a["text-size"].possiblyEvaluate(new Er(C),s.canonical),a["text-size"].possiblyEvaluate(new Er(k),s.canonical)]}if(s.bucket.iconSizeData.kind==="composite"){const{minZoom:C,maxZoom:k}=s.bucket.iconSizeData;h.compositeIconSizes=[a["icon-size"].possiblyEvaluate(new Er(C),s.canonical),a["icon-size"].possiblyEvaluate(new Er(k),s.canonical)]}const m=i.get("text-line-height")*fn,g=i.get("text-rotation-alignment")!=="viewport"&&i.get("symbol-placement")!=="point",v=i.get("text-keep-upright"),T=i.get("text-size");for(const C of s.bucket.features){const k=i.get("text-font").evaluate(C,{},s.canonical).join(","),I=T.evaluate(C,{},s.canonical),D=h.layoutTextSize.evaluate(C,{},s.canonical),j=h.layoutIconSize.evaluate(C,{},s.canonical),F={horizontal:{},vertical:void 0},N=C.text;let G,Y=[0,0];if(N){const L=N.toString(),Z=i.get("text-letter-spacing").evaluate(C,{},s.canonical)*fn,ie=nm(L)?Z:0,Pe=i.get("text-anchor").evaluate(C,{},s.canonical),Ue=Qv(t,C,s.canonical);if(!Ue){const Ge=i.get("text-radial-offset").evaluate(C,{},s.canonical);Y=Ge?Yv(Pe,[Ge*fn,$m]):i.get("text-offset").evaluate(C,{},s.canonical).map(Ye=>Ye*fn)}let Me=g?"center":i.get("text-justify").evaluate(C,{},s.canonical);const De=i.get("symbol-placement")==="point"?i.get("text-max-width").evaluate(C,{},s.canonical)*fn:1/0,Xe=()=>{s.bucket.allowVerticalPlacement&&lc(L)&&(F.vertical=np(N,s.glyphMap,s.glyphPositions,s.imagePositions,k,De,m,Pe,"left",ie,Y,b.al.vertical,!0,D,I))};if(!g&&Ue){const Ge=new Set;if(Me==="auto")for(let Ne=0;Ne<Ue.values.length;Ne+=2)Ge.add(Um(Ue.values[Ne]));else Ge.add(Me);let Ye=!1;for(const Ne of Ge)if(!F.horizontal[Ne])if(Ye)F.horizontal[Ne]=F.horizontal[0];else{const ut=np(N,s.glyphMap,s.glyphPositions,s.imagePositions,k,De,m,"center",Ne,ie,Y,b.al.horizontal,!1,D,I);ut&&(F.horizontal[Ne]=ut,Ye=ut.positionedLines.length===1)}Xe()}else{Me==="auto"&&(Me=Um(Pe));const Ge=np(N,s.glyphMap,s.glyphPositions,s.imagePositions,k,De,m,Pe,Me,ie,Y,b.al.horizontal,!1,D,I);Ge&&(F.horizontal[Me]=Ge),Xe(),lc(L)&&g&&v&&(F.vertical=np(N,s.glyphMap,s.glyphPositions,s.imagePositions,k,De,m,Pe,Me,ie,Y,b.al.vertical,!1,D,I))}}let he=!1;if(C.icon&&C.icon.name){const L=s.imageMap[C.icon.name];L&&(G=z2(s.imagePositions[C.icon.name],i.get("icon-offset").evaluate(C,{},s.canonical),i.get("icon-anchor").evaluate(C,{},s.canonical)),he=!!L.sdf,s.bucket.sdfIcons===void 0?s.bucket.sdfIcons=he:s.bucket.sdfIcons!==he&&Sr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(L.pixelRatio!==s.bucket.pixelRatio||i.get("icon-rotate").constantOr(1)!==0)&&(s.bucket.iconsNeedLinear=!0))}const ee=ex(F.horizontal)||F.vertical;s.bucket.iconsInText=!!ee&&ee.iconsInText,(ee||G)&&X2(s.bucket,C,F,G,s.imageMap,h,D,j,Y,he,s.canonical,s.subdivisionGranularity)}s.showCollisionBoxes&&s.bucket.generateCollisionDebugBuffers()},b.cz=Cm,b.d=ge,b.e=Xr,b.f=s=>c(void 0,void 0,void 0,function*(){if(s.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(s)],{type:"image/png"});try{return createImageBitmap(t)}catch(i){throw new Error(`Could not load image because of ${i.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),b.g=Li,b.h=s=>new Promise((t,i)=>{const a=new Image;a.onload=()=>{t(a),URL.revokeObjectURL(a.src),a.onload=null,window.requestAnimationFrame(()=>{a.src=Di})},a.onerror=()=>i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const h=new Blob([new Uint8Array(s)],{type:"image/png"});a.src=s.byteLength?URL.createObjectURL(h):Di}),b.i=nr,b.j=(s,t)=>xi(Xr(s,{type:"json"}),t),b.k=te,b.l=H,b.m=xi,b.n=(s,t)=>xi(Xr(s,{type:"arrayBuffer"}),t),b.o=function(s){return new Em(s).readFields(x2,[])},b.p=fv,b.q=Wu,b.r=nn,b.s=Ji,b.t=ic,b.u=Jt,b.v=q,b.w=Sr,b.x=Du,b.y=Ho,b.z=function([s,t,i]){return t+=90,t*=Math.PI/180,i*=Math.PI/180,{x:s*Math.cos(t)*Math.sin(i),y:s*Math.sin(t)*Math.sin(i),z:s*Math.cos(i)}}}),x("worker",["./shared"],function(b){class c{constructor(V){this.keyCache={},V&&this.replace(V)}replace(V){this._layerConfigs={},this._layers={},this.update(V,[])}update(V,$){for(const te of V){this._layerConfigs[te.id]=te;const de=this._layers[te.id]=b.bA(te);de._featureFilter=b.a7(de.filter),this.keyCache[te.id]&&delete this.keyCache[te.id]}for(const te of $)delete this.keyCache[te],delete this._layerConfigs[te],delete this._layers[te];this.familiesBySource={};const H=b.ct(Object.values(this._layerConfigs),this.keyCache);for(const te of H){const de=te.map(xe=>this._layers[xe.id]),q=de[0];if(q.visibility==="none")continue;const Te=q.source||"";let _e=this.familiesBySource[Te];_e||(_e=this.familiesBySource[Te]={});const be=q.sourceLayer||"_geojsonTileLayer";let Ce=_e[be];Ce||(Ce=_e[be]=[]),Ce.push(de)}}}class U{constructor(V){const $={},H=[];for(const Te in V){const _e=V[Te],be=$[Te]={};for(const Ce in _e){const xe=_e[+Ce];if(!xe||xe.bitmap.width===0||xe.bitmap.height===0)continue;const $e={x:0,y:0,w:xe.bitmap.width+2,h:xe.bitmap.height+2};H.push($e),be[Ce]={rect:$e,metrics:xe.metrics}}}const{w:te,h:de}=b.p(H),q=new b.q({width:te||1,height:de||1});for(const Te in V){const _e=V[Te];for(const be in _e){const Ce=_e[+be];if(!Ce||Ce.bitmap.width===0||Ce.bitmap.height===0)continue;const xe=$[Te][be].rect;b.q.copy(Ce.bitmap,q,{x:0,y:0},{x:xe.x+1,y:xe.y+1},Ce.bitmap)}}this.image=q,this.positions=$}}b.cu("GlyphAtlas",U);class Q{constructor(V){this.tileID=new b.Y(V.tileID.overscaledZ,V.tileID.wrap,V.tileID.canonical.z,V.tileID.canonical.x,V.tileID.canonical.y),this.uid=V.uid,this.zoom=V.zoom,this.pixelRatio=V.pixelRatio,this.tileSize=V.tileSize,this.source=V.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=V.showCollisionBoxes,this.collectResourceTiming=!!V.collectResourceTiming,this.returnDependencies=!!V.returnDependencies,this.promoteId=V.promoteId,this.inFlightDependencies=[]}parse(V,$,H,te,de){return b._(this,void 0,void 0,function*(){this.status="parsing",this.data=V,this.collisionBoxArray=new b.a5;const q=new b.cv(Object.keys(V.layers).sort()),Te=new b.cw(this.tileID,this.promoteId);Te.bucketLayerIDs=[];const _e={},be={featureIndex:Te,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:H,subdivisionGranularity:de},Ce=$.familiesBySource[this.source];for(const Mt in Ce){const Ve=V.layers[Mt];if(!Ve)continue;Ve.version===1&&b.w(`Vector tile source "${this.source}" layer "${Mt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const St=q.encode(Mt),kt=[];for(let Pr=0;Pr<Ve.length;Pr++){const Rr=Ve.feature(Pr),hn=Te.getId(Rr,Mt);kt.push({feature:Rr,id:hn,index:Pr,sourceLayerIndex:St})}for(const Pr of Ce[Mt]){const Rr=Pr[0];Rr.source!==this.source&&b.w(`layer.source = ${Rr.source} does not equal this.source = ${this.source}`),Rr.minzoom&&this.zoom<Math.floor(Rr.minzoom)||Rr.maxzoom&&this.zoom>=Rr.maxzoom||Rr.visibility!=="none"&&(ne(Pr,this.zoom,H),(_e[Rr.id]=Rr.createBucket({index:Te.bucketLayerIDs.length,layers:Pr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:St,sourceID:this.source})).populate(kt,be,this.tileID.canonical),Te.bucketLayerIDs.push(Pr.map(hn=>hn.id)))}}const xe=b.bF(be.glyphDependencies,Mt=>Object.keys(Mt).map(Number));this.inFlightDependencies.forEach(Mt=>Mt==null?void 0:Mt.abort()),this.inFlightDependencies=[];let $e=Promise.resolve({});if(Object.keys(xe).length){const Mt=new AbortController;this.inFlightDependencies.push(Mt),$e=te.sendAsync({type:"GG",data:{stacks:xe,source:this.source,tileID:this.tileID,type:"glyphs"}},Mt)}const tt=Object.keys(be.iconDependencies);let ot=Promise.resolve({});if(tt.length){const Mt=new AbortController;this.inFlightDependencies.push(Mt),ot=te.sendAsync({type:"GI",data:{icons:tt,source:this.source,tileID:this.tileID,type:"icons"}},Mt)}const xt=Object.keys(be.patternDependencies);let Lt=Promise.resolve({});if(xt.length){const Mt=new AbortController;this.inFlightDependencies.push(Mt),Lt=te.sendAsync({type:"GI",data:{icons:xt,source:this.source,tileID:this.tileID,type:"patterns"}},Mt)}const[Tt,Ie,or]=yield Promise.all([$e,ot,Lt]),qt=new U(Tt),tr=new b.cx(Ie,or);for(const Mt in _e){const Ve=_e[Mt];Ve instanceof b.a6?(ne(Ve.layers,this.zoom,H),b.cy({bucket:Ve,glyphMap:Tt,glyphPositions:qt.positions,imageMap:Ie,imagePositions:tr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:be.subdivisionGranularity})):Ve.hasPattern&&(Ve instanceof b.cz||Ve instanceof b.cA||Ve instanceof b.cB)&&(ne(Ve.layers,this.zoom,H),Ve.addFeatures(be,this.tileID.canonical,tr.patternPositions))}return this.status="done",{buckets:Object.values(_e).filter(Mt=>!Mt.isEmpty()),featureIndex:Te,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:qt.image,imageAtlas:tr,glyphMap:this.returnDependencies?Tt:null,iconMap:this.returnDependencies?Ie:null,glyphPositions:this.returnDependencies?qt.positions:null}})}}function ne(ge,V,$){const H=new b.C(V);for(const te of ge)te.recalculate(H,$)}class ye{constructor(V,$,H){this.actor=V,this.layerIndex=$,this.availableImages=H,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(V,$){return b._(this,void 0,void 0,function*(){const H=yield b.n(V.request,$);try{return{vectorTile:new b.cC.VectorTile(new b.cD(H.data)),rawData:H.data,cacheControl:H.cacheControl,expires:H.expires}}catch(te){const de=new Uint8Array(H.data);let q=`Unable to parse the tile at ${V.request.url}, `;throw q+=de[0]===31&&de[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${te.message}`,new Error(q)}})}loadTile(V){return b._(this,void 0,void 0,function*(){const $=V.uid,H=!!(V&&V.request&&V.request.collectResourceTiming)&&new b.cE(V.request),te=new Q(V);this.loading[$]=te;const de=new AbortController;te.abort=de;try{const q=yield this.loadVectorTile(V,de);if(delete this.loading[$],!q)return null;const Te=q.rawData,_e={};q.expires&&(_e.expires=q.expires),q.cacheControl&&(_e.cacheControl=q.cacheControl);const be={};if(H){const xe=H.finish();xe&&(be.resourceTiming=JSON.parse(JSON.stringify(xe)))}te.vectorTile=q.vectorTile;const Ce=te.parse(q.vectorTile,this.layerIndex,this.availableImages,this.actor,V.subdivisionGranularity);this.loaded[$]=te,this.fetching[$]={rawTileData:Te,cacheControl:_e,resourceTiming:be};try{const xe=yield Ce;return b.e({rawTileData:Te.slice(0)},xe,_e,be)}finally{delete this.fetching[$]}}catch(q){throw delete this.loading[$],te.status="done",this.loaded[$]=te,q}})}reloadTile(V){return b._(this,void 0,void 0,function*(){const $=V.uid;if(!this.loaded||!this.loaded[$])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const H=this.loaded[$];if(H.showCollisionBoxes=V.showCollisionBoxes,H.status==="parsing"){const te=yield H.parse(H.vectorTile,this.layerIndex,this.availableImages,this.actor,V.subdivisionGranularity);let de;if(this.fetching[$]){const{rawTileData:q,cacheControl:Te,resourceTiming:_e}=this.fetching[$];delete this.fetching[$],de=b.e({rawTileData:q.slice(0)},te,Te,_e)}else de=te;return de}if(H.status==="done"&&H.vectorTile)return H.parse(H.vectorTile,this.layerIndex,this.availableImages,this.actor,V.subdivisionGranularity)})}abortTile(V){return b._(this,void 0,void 0,function*(){const $=this.loading,H=V.uid;$&&$[H]&&$[H].abort&&($[H].abort.abort(),delete $[H])})}removeTile(V){return b._(this,void 0,void 0,function*(){this.loaded&&this.loaded[V.uid]&&delete this.loaded[V.uid]})}}class me{constructor(){this.loaded={}}loadTile(V){return b._(this,void 0,void 0,function*(){const{uid:$,encoding:H,rawImageData:te,redFactor:de,greenFactor:q,blueFactor:Te,baseShift:_e}=V,be=te.width+2,Ce=te.height+2,xe=b.b(te)?new b.R({width:be,height:Ce},yield b.cF(te,-1,-1,be,Ce)):te,$e=new b.cG($,xe,H,de,q,Te,_e);return this.loaded=this.loaded||{},this.loaded[$]=$e,$e})}removeTile(V){const $=this.loaded,H=V.uid;$&&$[H]&&delete $[H]}}var re,ce,Le=function(){if(ce)return re;function ge($,H){if($.length!==0){V($[0],H);for(var te=1;te<$.length;te++)V($[te],!H)}}function V($,H){for(var te=0,de=0,q=0,Te=$.length,_e=Te-1;q<Te;_e=q++){var be=($[q][0]-$[_e][0])*($[_e][1]+$[q][1]),Ce=te+be;de+=Math.abs(te)>=Math.abs(be)?te-Ce+be:be-Ce+te,te=Ce}te+de>=0!=!!H&&$.reverse()}return ce=1,re=function $(H,te){var de,q=H&&H.type;if(q==="FeatureCollection")for(de=0;de<H.features.length;de++)$(H.features[de],te);else if(q==="GeometryCollection")for(de=0;de<H.geometries.length;de++)$(H.geometries[de],te);else if(q==="Feature")$(H.geometry,te);else if(q==="Polygon")ge(H.coordinates,te);else if(q==="MultiPolygon")for(de=0;de<H.coordinates.length;de++)ge(H.coordinates[de],te);return H}}(),Qe=b.cH(Le);const pe=b.cC.VectorTileFeature.prototype.toGeoJSON;class le{constructor(V){this._feature=V,this.extent=b.Z,this.type=V.type,this.properties=V.tags,"id"in V&&!isNaN(V.id)&&(this.id=parseInt(V.id,10))}loadGeometry(){if(this._feature.type===1){const V=[];for(const $ of this._feature.geometry)V.push([new b.P($[0],$[1])]);return V}{const V=[];for(const $ of this._feature.geometry){const H=[];for(const te of $)H.push(new b.P(te[0],te[1]));V.push(H)}return V}}toGeoJSON(V,$,H){return pe.call(this,V,$,H)}}class ve{constructor(V){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=b.Z,this.length=V.length,this._features=V}feature(V){return new le(this._features[V])}}var Be,We,Je,st={exports:{}},rt=function(){if(Je)return st.exports;Je=1;var ge=b.cK(),V=function(){if(We)return Be;We=1;var Ce=b.cI(),xe=b.cJ().VectorTileFeature;function $e(ot,xt){this.options=xt||{},this.features=ot,this.length=ot.length}function tt(ot,xt){this.id=typeof ot.id=="number"?ot.id:void 0,this.type=ot.type,this.rawGeometry=ot.type===1?[ot.geometry]:ot.geometry,this.properties=ot.tags,this.extent=xt||4096}return Be=$e,$e.prototype.feature=function(ot){return new tt(this.features[ot],this.options.extent)},tt.prototype.loadGeometry=function(){var ot=this.rawGeometry;this.geometry=[];for(var xt=0;xt<ot.length;xt++){for(var Lt=ot[xt],Tt=[],Ie=0;Ie<Lt.length;Ie++)Tt.push(new Ce(Lt[Ie][0],Lt[Ie][1]));this.geometry.push(Tt)}return this.geometry},tt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ot=this.geometry,xt=1/0,Lt=-1/0,Tt=1/0,Ie=-1/0,or=0;or<ot.length;or++)for(var qt=ot[or],tr=0;tr<qt.length;tr++){var Mt=qt[tr];xt=Math.min(xt,Mt.x),Lt=Math.max(Lt,Mt.x),Tt=Math.min(Tt,Mt.y),Ie=Math.max(Ie,Mt.y)}return[xt,Tt,Lt,Ie]},tt.prototype.toGeoJSON=xe.prototype.toGeoJSON,Be}();function $(Ce){var xe=new ge;return function($e,tt){for(var ot in $e.layers)tt.writeMessage(3,H,$e.layers[ot])}(Ce,xe),xe.finish()}function H(Ce,xe){var $e;xe.writeVarintField(15,Ce.version||1),xe.writeStringField(1,Ce.name||""),xe.writeVarintField(5,Ce.extent||4096);var tt={keys:[],values:[],keycache:{},valuecache:{}};for($e=0;$e<Ce.length;$e++)tt.feature=Ce.feature($e),xe.writeMessage(2,te,tt);var ot=tt.keys;for($e=0;$e<ot.length;$e++)xe.writeStringField(3,ot[$e]);var xt=tt.values;for($e=0;$e<xt.length;$e++)xe.writeMessage(4,be,xt[$e])}function te(Ce,xe){var $e=Ce.feature;$e.id!==void 0&&xe.writeVarintField(1,$e.id),xe.writeMessage(2,de,Ce),xe.writeVarintField(3,$e.type),xe.writeMessage(4,_e,$e)}function de(Ce,xe){var $e=Ce.feature,tt=Ce.keys,ot=Ce.values,xt=Ce.keycache,Lt=Ce.valuecache;for(var Tt in $e.properties){var Ie=$e.properties[Tt],or=xt[Tt];if(Ie!==null){or===void 0&&(tt.push(Tt),xt[Tt]=or=tt.length-1),xe.writeVarint(or);var qt=typeof Ie;qt!=="string"&&qt!=="boolean"&&qt!=="number"&&(Ie=JSON.stringify(Ie));var tr=qt+":"+Ie,Mt=Lt[tr];Mt===void 0&&(ot.push(Ie),Lt[tr]=Mt=ot.length-1),xe.writeVarint(Mt)}}}function q(Ce,xe){return(xe<<3)+(7&Ce)}function Te(Ce){return Ce<<1^Ce>>31}function _e(Ce,xe){for(var $e=Ce.loadGeometry(),tt=Ce.type,ot=0,xt=0,Lt=$e.length,Tt=0;Tt<Lt;Tt++){var Ie=$e[Tt],or=1;tt===1&&(or=Ie.length),xe.writeVarint(q(1,or));for(var qt=tt===3?Ie.length-1:Ie.length,tr=0;tr<qt;tr++){tr===1&&tt!==1&&xe.writeVarint(q(2,qt-1));var Mt=Ie[tr].x-ot,Ve=Ie[tr].y-xt;xe.writeVarint(Te(Mt)),xe.writeVarint(Te(Ve)),ot+=Mt,xt+=Ve}tt===3&&xe.writeVarint(q(7,1))}}function be(Ce,xe){var $e=typeof Ce;$e==="string"?xe.writeStringField(1,Ce):$e==="boolean"?xe.writeBooleanField(7,Ce):$e==="number"&&(Ce%1!=0?xe.writeDoubleField(3,Ce):Ce<0?xe.writeSVarintField(6,Ce):xe.writeVarintField(5,Ce))}return st.exports=$,st.exports.fromVectorTileJs=$,st.exports.fromGeojsonVt=function(Ce,xe){xe=xe||{};var $e={};for(var tt in Ce)$e[tt]=new V(Ce[tt].features,xe),$e[tt].name=tt,$e[tt].version=xe.version,$e[tt].extent=xe.extent;return $({layers:$e})},st.exports.GeoJSONWrapper=V,st.exports}(),Zt=b.cH(rt);const zt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ge=>ge},ur=Math.fround||(hr=new Float32Array(1),ge=>(hr[0]=+ge,hr[0]));var hr;const _r=3,Wt=5,tn=6;class dr{constructor(V){this.options=Object.assign(Object.create(zt),V),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(V){const{log:$,minZoom:H,maxZoom:te}=this.options;$&&console.time("total time");const de=`prepare ${V.length} points`;$&&console.time(de),this.points=V;const q=[];for(let _e=0;_e<V.length;_e++){const be=V[_e];if(!be.geometry)continue;const[Ce,xe]=be.geometry.coordinates,$e=ur(ft(Ce)),tt=ur(bt(xe));q.push($e,tt,1/0,_e,-1,1),this.options.reduce&&q.push(0)}let Te=this.trees[te+1]=this._createTree(q);$&&console.timeEnd(de);for(let _e=te;_e>=H;_e--){const be=+Date.now();Te=this.trees[_e]=this._createTree(this._cluster(Te,_e)),$&&console.log("z%d: %d clusters in %dms",_e,Te.numItems,+Date.now()-be)}return $&&console.timeEnd("total time"),this}getClusters(V,$){let H=((V[0]+180)%360+360)%360-180;const te=Math.max(-90,Math.min(90,V[1]));let de=V[2]===180?180:((V[2]+180)%360+360)%360-180;const q=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)H=-180,de=180;else if(H>de){const xe=this.getClusters([H,te,180,q],$),$e=this.getClusters([-180,te,de,q],$);return xe.concat($e)}const Te=this.trees[this._limitZoom($)],_e=Te.range(ft(H),bt(q),ft(de),bt(te)),be=Te.data,Ce=[];for(const xe of _e){const $e=this.stride*xe;Ce.push(be[$e+Wt]>1?Gr(be,$e,this.clusterProps):this.points[be[$e+_r]])}return Ce}getChildren(V){const $=this._getOriginId(V),H=this._getOriginZoom(V),te="No cluster with the specified id.",de=this.trees[H];if(!de)throw new Error(te);const q=de.data;if($*this.stride>=q.length)throw new Error(te);const Te=this.options.radius/(this.options.extent*Math.pow(2,H-1)),_e=de.within(q[$*this.stride],q[$*this.stride+1],Te),be=[];for(const Ce of _e){const xe=Ce*this.stride;q[xe+4]===V&&be.push(q[xe+Wt]>1?Gr(q,xe,this.clusterProps):this.points[q[xe+_r]])}if(be.length===0)throw new Error(te);return be}getLeaves(V,$,H){const te=[];return this._appendLeaves(te,V,$=$||10,H=H||0,0),te}getTile(V,$,H){const te=this.trees[this._limitZoom(V)],de=Math.pow(2,V),{extent:q,radius:Te}=this.options,_e=Te/q,be=(H-_e)/de,Ce=(H+1+_e)/de,xe={features:[]};return this._addTileFeatures(te.range(($-_e)/de,be,($+1+_e)/de,Ce),te.data,$,H,de,xe),$===0&&this._addTileFeatures(te.range(1-_e/de,be,1,Ce),te.data,de,H,de,xe),$===de-1&&this._addTileFeatures(te.range(0,be,_e/de,Ce),te.data,-1,H,de,xe),xe.features.length?xe:null}getClusterExpansionZoom(V){let $=this._getOriginZoom(V)-1;for(;$<=this.options.maxZoom;){const H=this.getChildren(V);if($++,H.length!==1)break;V=H[0].properties.cluster_id}return $}_appendLeaves(V,$,H,te,de){const q=this.getChildren($);for(const Te of q){const _e=Te.properties;if(_e&&_e.cluster?de+_e.point_count<=te?de+=_e.point_count:de=this._appendLeaves(V,_e.cluster_id,H,te,de):de<te?de++:V.push(Te),V.length===H)break}return de}_createTree(V){const $=new b.aF(V.length/this.stride|0,this.options.nodeSize,Float32Array);for(let H=0;H<V.length;H+=this.stride)$.add(V[H],V[H+1]);return $.finish(),$.data=V,$}_addTileFeatures(V,$,H,te,de,q){for(const Te of V){const _e=Te*this.stride,be=$[_e+Wt]>1;let Ce,xe,$e;if(be)Ce=qe($,_e,this.clusterProps),xe=$[_e],$e=$[_e+1];else{const xt=this.points[$[_e+_r]];Ce=xt.properties;const[Lt,Tt]=xt.geometry.coordinates;xe=ft(Lt),$e=bt(Tt)}const tt={type:1,geometry:[[Math.round(this.options.extent*(xe*de-H)),Math.round(this.options.extent*($e*de-te))]],tags:Ce};let ot;ot=be||this.options.generateId?$[_e+_r]:this.points[$[_e+_r]].id,ot!==void 0&&(tt.id=ot),q.features.push(tt)}}_limitZoom(V){return Math.max(this.options.minZoom,Math.min(Math.floor(+V),this.options.maxZoom+1))}_cluster(V,$){const{radius:H,extent:te,reduce:de,minPoints:q}=this.options,Te=H/(te*Math.pow(2,$)),_e=V.data,be=[],Ce=this.stride;for(let xe=0;xe<_e.length;xe+=Ce){if(_e[xe+2]<=$)continue;_e[xe+2]=$;const $e=_e[xe],tt=_e[xe+1],ot=V.within(_e[xe],_e[xe+1],Te),xt=_e[xe+Wt];let Lt=xt;for(const Tt of ot){const Ie=Tt*Ce;_e[Ie+2]>$&&(Lt+=_e[Ie+Wt])}if(Lt>xt&&Lt>=q){let Tt,Ie=$e*xt,or=tt*xt,qt=-1;const tr=((xe/Ce|0)<<5)+($+1)+this.points.length;for(const Mt of ot){const Ve=Mt*Ce;if(_e[Ve+2]<=$)continue;_e[Ve+2]=$;const St=_e[Ve+Wt];Ie+=_e[Ve]*St,or+=_e[Ve+1]*St,_e[Ve+4]=tr,de&&(Tt||(Tt=this._map(_e,xe,!0),qt=this.clusterProps.length,this.clusterProps.push(Tt)),de(Tt,this._map(_e,Ve)))}_e[xe+4]=tr,be.push(Ie/Lt,or/Lt,1/0,tr,-1,Lt),de&&be.push(qt)}else{for(let Tt=0;Tt<Ce;Tt++)be.push(_e[xe+Tt]);if(Lt>1)for(const Tt of ot){const Ie=Tt*Ce;if(!(_e[Ie+2]<=$)){_e[Ie+2]=$;for(let or=0;or<Ce;or++)be.push(_e[Ie+or])}}}}return be}_getOriginId(V){return V-this.points.length>>5}_getOriginZoom(V){return(V-this.points.length)%32}_map(V,$,H){if(V[$+Wt]>1){const q=this.clusterProps[V[$+tn]];return H?Object.assign({},q):q}const te=this.points[V[$+_r]].properties,de=this.options.map(te);return H&&de===te?Object.assign({},de):de}}function Gr(ge,V,$){return{type:"Feature",id:ge[V+_r],properties:qe(ge,V,$),geometry:{type:"Point",coordinates:[(H=ge[V],360*(H-.5)),Gt(ge[V+1])]}};var H}function qe(ge,V,$){const H=ge[V+Wt],te=H>=1e4?`${Math.round(H/1e3)}k`:H>=1e3?Math.round(H/100)/10+"k":H,de=ge[V+tn],q=de===-1?{}:Object.assign({},$[de]);return Object.assign(q,{cluster:!0,cluster_id:ge[V+_r],point_count:H,point_count_abbreviated:te})}function ft(ge){return ge/360+.5}function bt(ge){const V=Math.sin(ge*Math.PI/180),$=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return $<0?0:$>1?1:$}function Gt(ge){const V=(180-360*ge)*Math.PI/180;return 360*Math.atan(Math.exp(V))/Math.PI-90}function Xt(ge,V,$,H){let te=H;const de=V+($-V>>1);let q,Te=$-V;const _e=ge[V],be=ge[V+1],Ce=ge[$],xe=ge[$+1];for(let $e=V+3;$e<$;$e+=3){const tt=yn(ge[$e],ge[$e+1],_e,be,Ce,xe);if(tt>te)q=$e,te=tt;else if(tt===te){const ot=Math.abs($e-de);ot<Te&&(q=$e,Te=ot)}}te>H&&(q-V>3&&Xt(ge,V,q,H),ge[q+2]=te,$-q>3&&Xt(ge,q,$,H))}function yn(ge,V,$,H,te,de){let q=te-$,Te=de-H;if(q!==0||Te!==0){const _e=((ge-$)*q+(V-H)*Te)/(q*q+Te*Te);_e>1?($=te,H=de):_e>0&&($+=q*_e,H+=Te*_e)}return q=ge-$,Te=V-H,q*q+Te*Te}function br(ge,V,$,H){const te={id:ge??null,type:V,geometry:$,tags:H,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(V==="Point"||V==="MultiPoint"||V==="LineString")Tr(te,$);else if(V==="Polygon")Tr(te,$[0]);else if(V==="MultiLineString")for(const de of $)Tr(te,de);else if(V==="MultiPolygon")for(const de of $)Tr(te,de[0]);return te}function Tr(ge,V){for(let $=0;$<V.length;$+=3)ge.minX=Math.min(ge.minX,V[$]),ge.minY=Math.min(ge.minY,V[$+1]),ge.maxX=Math.max(ge.maxX,V[$]),ge.maxY=Math.max(ge.maxY,V[$+1])}function cn(ge,V,$,H){if(!V.geometry)return;const te=V.geometry.coordinates;if(te&&te.length===0)return;const de=V.geometry.type,q=Math.pow($.tolerance/((1<<$.maxZoom)*$.extent),2);let Te=[],_e=V.id;if($.promoteId?_e=V.properties[$.promoteId]:$.generateId&&(_e=H||0),de==="Point")Xr(te,Te);else if(de==="MultiPoint")for(const be of te)Xr(be,Te);else if(de==="LineString")Ae(te,Te,q,!1);else if(de==="MultiLineString"){if($.lineMetrics){for(const be of te)Te=[],Ae(be,Te,q,!1),ge.push(br(_e,"LineString",Te,V.properties));return}Ut(te,Te,q,!1)}else if(de==="Polygon")Ut(te,Te,q,!0);else{if(de!=="MultiPolygon"){if(de==="GeometryCollection"){for(const be of V.geometry.geometries)cn(ge,{id:_e,geometry:be,properties:V.properties},$,H);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const be of te){const Ce=[];Ut(be,Ce,q,!0),Te.push(Ce)}}ge.push(br(_e,de,Te,V.properties))}function Xr(ge,V){V.push(Yt(ge[0]),yr(ge[1]),0)}function Ae(ge,V,$,H){let te,de,q=0;for(let _e=0;_e<ge.length;_e++){const be=Yt(ge[_e][0]),Ce=yr(ge[_e][1]);V.push(be,Ce,0),_e>0&&(q+=H?(te*Ce-be*de)/2:Math.sqrt(Math.pow(be-te,2)+Math.pow(Ce-de,2))),te=be,de=Ce}const Te=V.length-3;V[2]=1,Xt(V,0,Te,$),V[Te+2]=1,V.size=Math.abs(q),V.start=0,V.end=V.size}function Ut(ge,V,$,H){for(let te=0;te<ge.length;te++){const de=[];Ae(ge[te],de,$,H),V.push(de)}}function Yt(ge){return ge/360+.5}function yr(ge){const V=Math.sin(ge*Math.PI/180),$=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return $<0?0:$>1?1:$}function qr(ge,V,$,H,te,de,q,Te){if(H/=V,de>=($/=V)&&q<H)return ge;if(q<$||de>=H)return null;const _e=[];for(const be of ge){const Ce=be.geometry;let xe=be.type;const $e=te===0?be.minX:be.minY,tt=te===0?be.maxX:be.maxY;if($e>=$&&tt<H){_e.push(be);continue}if(tt<$||$e>=H)continue;let ot=[];if(xe==="Point"||xe==="MultiPoint")Sr(Ce,ot,$,H,te);else if(xe==="LineString")mr(Ce,ot,$,H,te,!1,Te.lineMetrics);else if(xe==="MultiLineString")Qi(Ce,ot,$,H,te,!1);else if(xe==="Polygon")Qi(Ce,ot,$,H,te,!0);else if(xe==="MultiPolygon")for(const xt of Ce){const Lt=[];Qi(xt,Lt,$,H,te,!0),Lt.length&&ot.push(Lt)}if(ot.length){if(Te.lineMetrics&&xe==="LineString"){for(const xt of ot)_e.push(br(be.id,xe,xt,be.tags));continue}xe!=="LineString"&&xe!=="MultiLineString"||(ot.length===1?(xe="LineString",ot=ot[0]):xe="MultiLineString"),xe!=="Point"&&xe!=="MultiPoint"||(xe=ot.length===3?"Point":"MultiPoint"),_e.push(br(be.id,xe,ot,be.tags))}}return _e.length?_e:null}function Sr(ge,V,$,H,te){for(let de=0;de<ge.length;de+=3){const q=ge[de+te];q>=$&&q<=H&&rn(V,ge[de],ge[de+1],ge[de+2])}}function mr(ge,V,$,H,te,de,q){let Te=nr(ge);const _e=te===0?Di:ci;let be,Ce,xe=ge.start;for(let Lt=0;Lt<ge.length-3;Lt+=3){const Tt=ge[Lt],Ie=ge[Lt+1],or=ge[Lt+2],qt=ge[Lt+3],tr=ge[Lt+4],Mt=te===0?Tt:Ie,Ve=te===0?qt:tr;let St=!1;q&&(be=Math.sqrt(Math.pow(Tt-qt,2)+Math.pow(Ie-tr,2))),Mt<$?Ve>$&&(Ce=_e(Te,Tt,Ie,qt,tr,$),q&&(Te.start=xe+be*Ce)):Mt>H?Ve<H&&(Ce=_e(Te,Tt,Ie,qt,tr,H),q&&(Te.start=xe+be*Ce)):rn(Te,Tt,Ie,or),Ve<$&&Mt>=$&&(Ce=_e(Te,Tt,Ie,qt,tr,$),St=!0),Ve>H&&Mt<=H&&(Ce=_e(Te,Tt,Ie,qt,tr,H),St=!0),!de&&St&&(q&&(Te.end=xe+be*Ce),V.push(Te),Te=nr(ge)),q&&(xe+=be)}let $e=ge.length-3;const tt=ge[$e],ot=ge[$e+1],xt=te===0?tt:ot;xt>=$&&xt<=H&&rn(Te,tt,ot,ge[$e+2]),$e=Te.length-3,de&&$e>=3&&(Te[$e]!==Te[0]||Te[$e+1]!==Te[1])&&rn(Te,Te[0],Te[1],Te[2]),Te.length&&V.push(Te)}function nr(ge){const V=[];return V.size=ge.size,V.start=ge.start,V.end=ge.end,V}function Qi(ge,V,$,H,te,de){for(const q of ge)mr(q,V,$,H,te,de,!1)}function rn(ge,V,$,H){ge.push(V,$,H)}function Di(ge,V,$,H,te,de){const q=(de-V)/(H-V);return rn(ge,de,$+(te-$)*q,1),q}function ci(ge,V,$,H,te,de){const q=(de-$)/(te-$);return rn(ge,V+(H-V)*q,de,1),q}function un(ge,V){const $=[];for(let H=0;H<ge.length;H++){const te=ge[H],de=te.type;let q;if(de==="Point"||de==="MultiPoint"||de==="LineString")q=kn(te.geometry,V);else if(de==="MultiLineString"||de==="Polygon"){q=[];for(const Te of te.geometry)q.push(kn(Te,V))}else if(de==="MultiPolygon"){q=[];for(const Te of te.geometry){const _e=[];for(const be of Te)_e.push(kn(be,V));q.push(_e)}}$.push(br(te.id,de,q,te.tags))}return $}function kn(ge,V){const $=[];$.size=ge.size,ge.start!==void 0&&($.start=ge.start,$.end=ge.end);for(let H=0;H<ge.length;H+=3)$.push(ge[H]+V,ge[H+1],ge[H+2]);return $}function Ji(ge,V){if(ge.transformed)return ge;const $=1<<ge.z,H=ge.x,te=ge.y;for(const de of ge.features){const q=de.geometry,Te=de.type;if(de.geometry=[],Te===1)for(let _e=0;_e<q.length;_e+=2)de.geometry.push(js(q[_e],q[_e+1],V,$,H,te));else for(let _e=0;_e<q.length;_e++){const be=[];for(let Ce=0;Ce<q[_e].length;Ce+=2)be.push(js(q[_e][Ce],q[_e][Ce+1],V,$,H,te));de.geometry.push(be)}}return ge.transformed=!0,ge}function js(ge,V,$,H,te,de){return[Math.round($*(ge*H-te)),Math.round($*(V*H-de))]}function es(ge,V,$,H,te){const de=V===te.maxZoom?0:te.tolerance/((1<<V)*te.extent),q={features:[],numPoints:0,numSimplified:0,numFeatures:ge.length,source:null,x:$,y:H,z:V,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Te of ge)ro(q,Te,de,te);return q}function ro(ge,V,$,H){const te=V.geometry,de=V.type,q=[];if(ge.minX=Math.min(ge.minX,V.minX),ge.minY=Math.min(ge.minY,V.minY),ge.maxX=Math.max(ge.maxX,V.maxX),ge.maxY=Math.max(ge.maxY,V.maxY),de==="Point"||de==="MultiPoint")for(let Te=0;Te<te.length;Te+=3)q.push(te[Te],te[Te+1]),ge.numPoints++,ge.numSimplified++;else if(de==="LineString")no(q,te,ge,$,!1,!1);else if(de==="MultiLineString"||de==="Polygon")for(let Te=0;Te<te.length;Te++)no(q,te[Te],ge,$,de==="Polygon",Te===0);else if(de==="MultiPolygon")for(let Te=0;Te<te.length;Te++){const _e=te[Te];for(let be=0;be<_e.length;be++)no(q,_e[be],ge,$,!0,be===0)}if(q.length){let Te=V.tags||null;if(de==="LineString"&&H.lineMetrics){Te={};for(const be in V.tags)Te[be]=V.tags[be];Te.mapbox_clip_start=te.start/te.size,Te.mapbox_clip_end=te.end/te.size}const _e={geometry:q,type:de==="Polygon"||de==="MultiPolygon"?3:de==="LineString"||de==="MultiLineString"?2:1,tags:Te};V.id!==null&&(_e.id=V.id),ge.features.push(_e)}}function no(ge,V,$,H,te,de){const q=H*H;if(H>0&&V.size<(te?q:H))return void($.numPoints+=V.length/3);const Te=[];for(let _e=0;_e<V.length;_e+=3)(H===0||V[_e+2]>q)&&($.numSimplified++,Te.push(V[_e],V[_e+1])),$.numPoints++;te&&function(_e,be){let Ce=0;for(let xe=0,$e=_e.length,tt=$e-2;xe<$e;tt=xe,xe+=2)Ce+=(_e[xe]-_e[tt])*(_e[xe+1]+_e[tt+1]);if(Ce>0===be)for(let xe=0,$e=_e.length;xe<$e/2;xe+=2){const tt=_e[xe],ot=_e[xe+1];_e[xe]=_e[$e-2-xe],_e[xe+1]=_e[$e-1-xe],_e[$e-2-xe]=tt,_e[$e-1-xe]=ot}}(Te,de),ge.push(Te)}const io={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ts{constructor(V,$){const H=($=this.options=function(de,q){for(const Te in q)de[Te]=q[Te];return de}(Object.create(io),$)).debug;if(H&&console.time("preprocess data"),$.maxZoom<0||$.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if($.promoteId&&$.generateId)throw new Error("promoteId and generateId cannot be used together.");let te=function(de,q){const Te=[];if(de.type==="FeatureCollection")for(let _e=0;_e<de.features.length;_e++)cn(Te,de.features[_e],q,_e);else cn(Te,de.type==="Feature"?de:{geometry:de},q);return Te}(V,$);this.tiles={},this.tileCoords=[],H&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",$.indexMaxZoom,$.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),te=function(de,q){const Te=q.buffer/q.extent;let _e=de;const be=qr(de,1,-1-Te,Te,0,-1,2,q),Ce=qr(de,1,1-Te,2+Te,0,-1,2,q);return(be||Ce)&&(_e=qr(de,1,-Te,1+Te,0,-1,2,q)||[],be&&(_e=un(be,1).concat(_e)),Ce&&(_e=_e.concat(un(Ce,-1)))),_e}(te,$),te.length&&this.splitTile(te,0,0,0),H&&(te.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(V,$,H,te,de,q,Te){const _e=[V,$,H,te],be=this.options,Ce=be.debug;for(;_e.length;){te=_e.pop(),H=_e.pop(),$=_e.pop(),V=_e.pop();const xe=1<<$,$e=Gn($,H,te);let tt=this.tiles[$e];if(!tt&&(Ce>1&&console.time("creation"),tt=this.tiles[$e]=es(V,$,H,te,be),this.tileCoords.push({z:$,x:H,y:te}),Ce)){Ce>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",$,H,te,tt.numFeatures,tt.numPoints,tt.numSimplified),console.timeEnd("creation"));const St=`z${$}`;this.stats[St]=(this.stats[St]||0)+1,this.total++}if(tt.source=V,de==null){if($===be.indexMaxZoom||tt.numPoints<=be.indexMaxPoints)continue}else{if($===be.maxZoom||$===de)continue;if(de!=null){const St=de-$;if(H!==q>>St||te!==Te>>St)continue}}if(tt.source=null,V.length===0)continue;Ce>1&&console.time("clipping");const ot=.5*be.buffer/be.extent,xt=.5-ot,Lt=.5+ot,Tt=1+ot;let Ie=null,or=null,qt=null,tr=null,Mt=qr(V,xe,H-ot,H+Lt,0,tt.minX,tt.maxX,be),Ve=qr(V,xe,H+xt,H+Tt,0,tt.minX,tt.maxX,be);V=null,Mt&&(Ie=qr(Mt,xe,te-ot,te+Lt,1,tt.minY,tt.maxY,be),or=qr(Mt,xe,te+xt,te+Tt,1,tt.minY,tt.maxY,be),Mt=null),Ve&&(qt=qr(Ve,xe,te-ot,te+Lt,1,tt.minY,tt.maxY,be),tr=qr(Ve,xe,te+xt,te+Tt,1,tt.minY,tt.maxY,be),Ve=null),Ce>1&&console.timeEnd("clipping"),_e.push(Ie||[],$+1,2*H,2*te),_e.push(or||[],$+1,2*H,2*te+1),_e.push(qt||[],$+1,2*H+1,2*te),_e.push(tr||[],$+1,2*H+1,2*te+1)}}getTile(V,$,H){V=+V,$=+$,H=+H;const te=this.options,{extent:de,debug:q}=te;if(V<0||V>24)return null;const Te=1<<V,_e=Gn(V,$=$+Te&Te-1,H);if(this.tiles[_e])return Ji(this.tiles[_e],de);q>1&&console.log("drilling down to z%d-%d-%d",V,$,H);let be,Ce=V,xe=$,$e=H;for(;!be&&Ce>0;)Ce--,xe>>=1,$e>>=1,be=this.tiles[Gn(Ce,xe,$e)];return be&&be.source?(q>1&&(console.log("found parent tile z%d-%d-%d",Ce,xe,$e),console.time("drilling down")),this.splitTile(be.source,Ce,xe,$e,V,$,H),q>1&&console.timeEnd("drilling down"),this.tiles[_e]?Ji(this.tiles[_e],de):null):null}}function Gn(ge,V,$){return 32*((1<<ge)*$+V)+ge}function Li(ge,V){return V?ge.properties[V]:ge.id}function ms(ge,V){if(ge==null)return!0;if(ge.type==="Feature")return Li(ge,V)!=null;if(ge.type==="FeatureCollection"){const $=new Set;for(const H of ge.features){const te=Li(H,V);if(te==null||$.has(te))return!1;$.add(te)}return!0}return!1}function qn(ge,V){const $=new Map;if(ge!=null)if(ge.type==="Feature")$.set(Li(ge,V),ge);else for(const H of ge.features)$.set(Li(H,V),H);return $}class En extends ye{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(V,$){return b._(this,void 0,void 0,function*(){const H=V.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const te=this._geoJSONIndex.getTile(H.z,H.x,H.y);if(!te)return null;const de=new ve(te.features);let q=Zt(de);return q.byteOffset===0&&q.byteLength===q.buffer.byteLength||(q=new Uint8Array(q)),{vectorTile:de,rawData:q.buffer}})}loadData(V){return b._(this,void 0,void 0,function*(){var $;($=this._pendingRequest)===null||$===void 0||$.abort();const H=!!(V&&V.request&&V.request.collectResourceTiming)&&new b.cE(V.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(V,this._pendingRequest),this._geoJSONIndex=V.cluster?new dr(function({superclusterOptions:q,clusterProperties:Te}){if(!Te||!q)return q;const _e={},be={},Ce={accumulated:null,zoom:0},xe={properties:null},$e=Object.keys(Te);for(const tt of $e){const[ot,xt]=Te[tt],Lt=b.cL(xt),Tt=b.cL(typeof ot=="string"?[ot,["accumulated"],["get",tt]]:ot);_e[tt]=Lt.value,be[tt]=Tt.value}return q.map=tt=>{xe.properties=tt;const ot={};for(const xt of $e)ot[xt]=_e[xt].evaluate(Ce,xe);return ot},q.reduce=(tt,ot)=>{xe.properties=ot;for(const xt of $e)Ce.accumulated=tt[xt],tt[xt]=be[xt].evaluate(Ce,xe)},q}(V)).load((yield this._pendingData).features):(te=yield this._pendingData,new ts(te,V.geojsonVtOptions)),this.loaded={};const de={};if(H){const q=H.finish();q&&(de.resourceTiming={},de.resourceTiming[V.source]=JSON.parse(JSON.stringify(q)))}return de}catch(de){if(delete this._pendingRequest,b.cp(de))return{abandoned:!0};throw de}var te})}getData(){return b._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(V){const $=this.loaded;return $&&$[V.uid]?super.reloadTile(V):this.loadTile(V)}loadAndProcessGeoJSON(V,$){return b._(this,void 0,void 0,function*(){let H=yield this.loadGeoJSON(V,$);if(delete this._pendingRequest,typeof H!="object")throw new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`);if(Qe(H,!0),V.filter){const te=b.cL(V.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(te.result==="error")throw new Error(te.value.map(q=>`${q.key}: ${q.message}`).join(", "));H={type:"FeatureCollection",features:H.features.filter(q=>te.value.evaluate({zoom:0},q))}}return H})}loadGeoJSON(V,$){return b._(this,void 0,void 0,function*(){const{promoteId:H}=V;if(V.request){const te=yield b.j(V.request,$);return this._dataUpdateable=ms(te.data,H)?qn(te.data,H):void 0,te.data}if(typeof V.data=="string")try{const te=JSON.parse(V.data);return this._dataUpdateable=ms(te,H)?qn(te,H):void 0,te}catch{throw new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`)}if(!V.dataDiff)throw new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${V.source}`);return function(te,de,q){var Te,_e,be,Ce;if(de.removeAll&&te.clear(),de.remove)for(const xe of de.remove)te.delete(xe);if(de.add)for(const xe of de.add){const $e=Li(xe,q);$e!=null&&te.set($e,xe)}if(de.update)for(const xe of de.update){let $e=te.get(xe.id);if($e==null)continue;const tt=!xe.removeAllProperties&&(((Te=xe.removeProperties)===null||Te===void 0?void 0:Te.length)>0||((_e=xe.addOrUpdateProperties)===null||_e===void 0?void 0:_e.length)>0);if((xe.newGeometry||xe.removeAllProperties||tt)&&($e=Object.assign({},$e),te.set(xe.id,$e),tt&&($e.properties=Object.assign({},$e.properties))),xe.newGeometry&&($e.geometry=xe.newGeometry),xe.removeAllProperties)$e.properties={};else if(((be=xe.removeProperties)===null||be===void 0?void 0:be.length)>0)for(const ot of xe.removeProperties)Object.prototype.hasOwnProperty.call($e.properties,ot)&&delete $e.properties[ot];if(((Ce=xe.addOrUpdateProperties)===null||Ce===void 0?void 0:Ce.length)>0)for(const{key:ot,value:xt}of xe.addOrUpdateProperties)$e.properties[ot]=xt}}(this._dataUpdateable,V.dataDiff,H),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(V){return b._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(V){return this._geoJSONIndex.getClusterExpansionZoom(V.clusterId)}getClusterChildren(V){return this._geoJSONIndex.getChildren(V.clusterId)}getClusterLeaves(V){return this._geoJSONIndex.getLeaves(V.clusterId,V.limit,V.offset)}}class xi{constructor(V){this.self=V,this.actor=new b.H(V),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=($,H)=>{if(this.externalWorkerSourceTypes[$])throw new Error(`Worker source with name "${$}" already registered.`);this.externalWorkerSourceTypes[$]=H},this.self.addProtocol=b.cr,this.self.removeProtocol=b.cs,this.self.registerRTLTextPlugin=$=>{b.cM.setMethods($)},this.actor.registerMessageHandler("LDT",($,H)=>this._getDEMWorkerSource($,H.source).loadTile(H)),this.actor.registerMessageHandler("RDT",($,H)=>b._(this,void 0,void 0,function*(){this._getDEMWorkerSource($,H.source).removeTile(H)})),this.actor.registerMessageHandler("GCEZ",($,H)=>b._(this,void 0,void 0,function*(){return this._getWorkerSource($,H.type,H.source).getClusterExpansionZoom(H)})),this.actor.registerMessageHandler("GCC",($,H)=>b._(this,void 0,void 0,function*(){return this._getWorkerSource($,H.type,H.source).getClusterChildren(H)})),this.actor.registerMessageHandler("GCL",($,H)=>b._(this,void 0,void 0,function*(){return this._getWorkerSource($,H.type,H.source).getClusterLeaves(H)})),this.actor.registerMessageHandler("LD",($,H)=>this._getWorkerSource($,H.type,H.source).loadData(H)),this.actor.registerMessageHandler("GD",($,H)=>this._getWorkerSource($,H.type,H.source).getData()),this.actor.registerMessageHandler("LT",($,H)=>this._getWorkerSource($,H.type,H.source).loadTile(H)),this.actor.registerMessageHandler("RT",($,H)=>this._getWorkerSource($,H.type,H.source).reloadTile(H)),this.actor.registerMessageHandler("AT",($,H)=>this._getWorkerSource($,H.type,H.source).abortTile(H)),this.actor.registerMessageHandler("RMT",($,H)=>this._getWorkerSource($,H.type,H.source).removeTile(H)),this.actor.registerMessageHandler("RS",($,H)=>b._(this,void 0,void 0,function*(){if(!this.workerSources[$]||!this.workerSources[$][H.type]||!this.workerSources[$][H.type][H.source])return;const te=this.workerSources[$][H.type][H.source];delete this.workerSources[$][H.type][H.source],te.removeSource!==void 0&&te.removeSource(H)})),this.actor.registerMessageHandler("RM",$=>b._(this,void 0,void 0,function*(){delete this.layerIndexes[$],delete this.availableImages[$],delete this.workerSources[$],delete this.demWorkerSources[$]})),this.actor.registerMessageHandler("SR",($,H)=>b._(this,void 0,void 0,function*(){this.referrer=H})),this.actor.registerMessageHandler("SRPS",($,H)=>this._syncRTLPluginState($,H)),this.actor.registerMessageHandler("IS",($,H)=>b._(this,void 0,void 0,function*(){this.self.importScripts(H)})),this.actor.registerMessageHandler("SI",($,H)=>this._setImages($,H)),this.actor.registerMessageHandler("UL",($,H)=>b._(this,void 0,void 0,function*(){this._getLayerIndex($).update(H.layers,H.removedIds)})),this.actor.registerMessageHandler("SL",($,H)=>b._(this,void 0,void 0,function*(){this._getLayerIndex($).replace(H)}))}_setImages(V,$){return b._(this,void 0,void 0,function*(){this.availableImages[V]=$;for(const H in this.workerSources[V]){const te=this.workerSources[V][H];for(const de in te)te[de].availableImages=$}})}_syncRTLPluginState(V,$){return b._(this,void 0,void 0,function*(){return yield b.cM.syncState($,this.self.importScripts)})}_getAvailableImages(V){let $=this.availableImages[V];return $||($=[]),$}_getLayerIndex(V){let $=this.layerIndexes[V];return $||($=this.layerIndexes[V]=new c),$}_getWorkerSource(V,$,H){if(this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][$]||(this.workerSources[V][$]={}),!this.workerSources[V][$][H]){const te={sendAsync:(de,q)=>(de.targetMapId=V,this.actor.sendAsync(de,q))};switch($){case"vector":this.workerSources[V][$][H]=new ye(te,this._getLayerIndex(V),this._getAvailableImages(V));break;case"geojson":this.workerSources[V][$][H]=new En(te,this._getLayerIndex(V),this._getAvailableImages(V));break;default:this.workerSources[V][$][H]=new this.externalWorkerSourceTypes[$](te,this._getLayerIndex(V),this._getAvailableImages(V))}}return this.workerSources[V][$][H]}_getDEMWorkerSource(V,$){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][$]||(this.demWorkerSources[V][$]=new me),this.demWorkerSources[V][$]}}return b.i(self)&&(self.worker=new xi(self)),xi}),x("index",["exports","./shared"],function(b,c){var U="2.0.1";function Q(){var p=new c.A(4);return c.A!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p}let ne,ye;const me={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(p,e,n){const l=requestAnimationFrame(f=>{u(),e(f)}),{unsubscribe:u}=c.s(p.signal,"abort",()=>{u(),cancelAnimationFrame(l),n(c.c())},!1)},frameAsync(p){return new Promise((e,n)=>{this.frame(p,e,n)})},getImageData(p,e=0){return this.getImageCanvasContext(p).getImageData(-e,-e,p.width+2*e,p.height+2*e)},getImageCanvasContext(p){const e=window.document.createElement("canvas"),n=e.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return e.width=p.width,e.height=p.height,n.drawImage(p,0,0,p.width,p.height),n},resolveURL:p=>(ne||(ne=document.createElement("a")),ne.href=p,ne.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(ye==null&&(ye=matchMedia("(prefers-reduced-motion: reduce)")),ye.matches)}};class re{static testProp(e){if(!re.docStyle)return e[0];for(let n=0;n<e.length;n++)if(e[n]in re.docStyle)return e[n];return e[0]}static create(e,n,l){const u=window.document.createElement(e);return n!==void 0&&(u.className=n),l&&l.appendChild(u),u}static createNS(e,n){return window.document.createElementNS(e,n)}static disableDrag(){re.docStyle&&re.selectProp&&(re.userSelect=re.docStyle[re.selectProp],re.docStyle[re.selectProp]="none")}static enableDrag(){re.docStyle&&re.selectProp&&(re.docStyle[re.selectProp]=re.userSelect)}static setTransform(e,n){e.style[re.transformProp]=n}static addEventListener(e,n,l,u={}){e.addEventListener(n,l,"passive"in u?u:u.capture)}static removeEventListener(e,n,l,u={}){e.removeEventListener(n,l,"passive"in u?u:u.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",re.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",re.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",re.suppressClickInternal,!0)},0)}static getScale(e){const n=e.getBoundingClientRect();return{x:n.width/e.offsetWidth||1,y:n.height/e.offsetHeight||1,boundingClientRect:n}}static getPoint(e,n,l){const u=n.boundingClientRect;return new c.P((l.clientX-u.left)/n.x-e.clientLeft,(l.clientY-u.top)/n.y-e.clientTop)}static mousePos(e,n){const l=re.getScale(e);return re.getPoint(e,l,n)}static touchPos(e,n){const l=[],u=re.getScale(e);for(let f=0;f<n.length;f++)l.push(re.getPoint(e,u,n[f]));return l}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){const n=new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),l=n.querySelectorAll("script");for(const u of l)u.remove();return re.clean(n),n.innerHTML}static isPossiblyDangerous(e,n){const l=n.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!l.includes("javascript:")&&!l.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){const n=e.children;for(const l of n)re.removeAttributes(l),re.clean(l)}static removeAttributes(e){for(const{name:n,value:l}of e.attributes)re.isPossiblyDangerous(n,l)&&e.removeAttribute(n)}}re.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,re.selectProp=re.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),re.transformProp=re.testProp(["transform","WebkitTransform"]);const ce={supported:!1,testSupport:function(p){!pe&&Qe&&(le?ve(p):Le=p)}};let Le,Qe,pe=!1,le=!1;function ve(p){const e=p.createTexture();p.bindTexture(p.TEXTURE_2D,e);try{if(p.texImage2D(p.TEXTURE_2D,0,p.RGBA,p.RGBA,p.UNSIGNED_BYTE,Qe),p.isContextLost())return;ce.supported=!0}catch{}p.deleteTexture(e),pe=!0}var Be;typeof document<"u"&&(Qe=document.createElement("img"),Qe.onload=()=>{Le&&ve(Le),Le=null,le=!0},Qe.onerror=()=>{pe=!0,Le=null},Qe.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(p){let e,n,l,u;p.resetRequestQueue=()=>{e=[],n=0,l=0,u={}},p.addThrottleControl=S=>{const M=l++;return u[M]=S,M},p.removeThrottleControl=S=>{delete u[S],y()},p.getImage=(S,M,E=!0)=>new Promise((A,z)=>{ce.supported&&(S.headers||(S.headers={}),S.headers.accept="image/webp,*/*"),c.e(S,{type:"image"}),e.push({abortController:M,requestParameters:S,supportImageRefresh:E,state:"queued",onError:B=>{z(B)},onSuccess:B=>{A(B)}}),y()});const f=S=>c._(this,void 0,void 0,function*(){S.state="running";const{requestParameters:M,supportImageRefresh:E,onError:A,onSuccess:z,abortController:B}=S,O=E===!1&&!c.i(self)&&!c.g(M.url)&&(!M.headers||Object.keys(M.headers).reduce((K,J)=>K&&J==="accept",!0));n++;const X=O?w(M,B):c.m(M,B);try{const K=yield X;delete S.abortController,S.state="completed",K.data instanceof HTMLImageElement||c.b(K.data)?z(K):K.data&&z({data:yield(W=K.data,typeof createImageBitmap=="function"?c.f(W):c.h(W)),cacheControl:K.cacheControl,expires:K.expires})}catch(K){delete S.abortController,A(K)}finally{n--,y()}var W}),y=()=>{const S=(()=>{for(const M of Object.keys(u))if(u[M]())return!0;return!1})()?c.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:c.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let M=n;M<S&&e.length>0;M++){const E=e.shift();E.abortController.signal.aborted?M--:f(E)}},w=(S,M)=>new Promise((E,A)=>{const z=new Image,B=S.url,O=S.credentials;O&&O==="include"?z.crossOrigin="use-credentials":(O&&O==="same-origin"||!c.d(B))&&(z.crossOrigin="anonymous"),M.signal.addEventListener("abort",()=>{z.src="",A(c.c())}),z.fetchPriority="high",z.onload=()=>{z.onerror=z.onload=null,E({data:z})},z.onerror=()=>{z.onerror=z.onload=null,M.signal.aborted||A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},z.src=B})}(Be||(Be={})),Be.resetRequestQueue();class We{constructor(e){this._transformRequestFn=e}transformRequest(e,n){return this._transformRequestFn&&this._transformRequestFn(e,n)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function Je(p){const e=[];if(typeof p=="string")e.push({id:"default",url:p});else if(p&&p.length>0){const n=[];for(const{id:l,url:u}of p){const f=`${l}${u}`;n.indexOf(f)===-1&&(n.push(f),e.push({id:l,url:u}))}}return e}function st(p,e,n){try{const l=new URL(p);return l.pathname+=`${e}${n}`,l.toString()}catch{throw new Error(`Invalid sprite URL "${p}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}class rt{constructor(e,n,l,u){this.context=e,this.format=l,this.texture=e.gl.createTexture(),this.update(n,u)}update(e,n,l){const{width:u,height:f}=e,y=!(this.size&&this.size[0]===u&&this.size[1]===f||l),{context:w}=this,{gl:S}=w;if(this.useMipmap=!!(n&&n.useMipmap),S.bindTexture(S.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===S.RGBA&&(!n||n.premultiply!==!1)),y)this.size=[u,f],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||c.b(e)?S.texImage2D(S.TEXTURE_2D,0,this.format,this.format,S.UNSIGNED_BYTE,e):S.texImage2D(S.TEXTURE_2D,0,this.format,u,f,0,this.format,S.UNSIGNED_BYTE,e.data);else{const{x:M,y:E}=l||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||c.b(e)?S.texSubImage2D(S.TEXTURE_2D,0,M,E,S.RGBA,S.UNSIGNED_BYTE,e):S.texSubImage2D(S.TEXTURE_2D,0,M,E,u,f,S.RGBA,S.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&S.generateMipmap(S.TEXTURE_2D),w.pixelStoreUnpackFlipY.setDefault(),w.pixelStoreUnpack.setDefault(),w.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(e,n,l){const{context:u}=this,{gl:f}=u;f.bindTexture(f.TEXTURE_2D,this.texture),l!==f.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=f.LINEAR),e!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,l||e),this.filter=e),n!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,n),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function Zt(p){const{userImage:e}=p;return!!(e&&e.render&&e.render())&&(p.data.replace(new Uint8Array(e.data.buffer)),!0)}class zt extends c.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:n,promiseResolve:l}of this.requestors)l(this._getImagesForIds(n));this.requestors=[]}}getImage(e){const n=this.images[e];if(n&&!n.data&&n.spriteData){const l=n.spriteData;n.data=new c.R({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),n.spriteData=null}return n}addImage(e,n){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,n)&&(this.images[e]=n)}_validate(e,n){let l=!0;const u=n.data||n.spriteData;return this._validateStretch(n.stretchX,u&&u.width)||(this.fire(new c.k(new Error(`Image "${e}" has invalid "stretchX" value`))),l=!1),this._validateStretch(n.stretchY,u&&u.height)||(this.fire(new c.k(new Error(`Image "${e}" has invalid "stretchY" value`))),l=!1),this._validateContent(n.content,n)||(this.fire(new c.k(new Error(`Image "${e}" has invalid "content" value`))),l=!1),l}_validateStretch(e,n){if(!e)return!0;let l=0;for(const u of e){if(u[0]<l||u[1]<u[0]||n<u[1])return!1;l=u[1]}return!0}_validateContent(e,n){if(!e)return!0;if(e.length!==4)return!1;const l=n.spriteData,u=l&&l.width||n.data.width,f=l&&l.height||n.data.height;return!(e[0]<0||u<e[0]||e[1]<0||f<e[1]||e[2]<0||u<e[2]||e[3]<0||f<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,n,l=!0){const u=this.getImage(e);if(l&&(u.data.width!==n.data.width||u.data.height!==n.data.height))throw new Error(`size mismatch between old image (${u.data.width}x${u.data.height}) and new image (${n.data.width}x${n.data.height}).`);n.version=u.version+1,this.images[e]=n,this.updatedImages[e]=!0}removeImage(e){const n=this.images[e];delete this.images[e],delete this.patterns[e],n.userImage&&n.userImage.onRemove&&n.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((n,l)=>{let u=!0;if(!this.isLoaded())for(const f of e)this.images[f]||(u=!1);this.isLoaded()||u?n(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:n})})}_getImagesForIds(e){const n={};for(const l of e){let u=this.getImage(l);u||(this.fire(new c.l("styleimagemissing",{id:l})),u=this.getImage(l)),u?n[l]={data:u.data.clone(),pixelRatio:u.pixelRatio,sdf:u.sdf,version:u.version,stretchX:u.stretchX,stretchY:u.stretchY,content:u.content,textFitWidth:u.textFitWidth,textFitHeight:u.textFitHeight,hasRenderCallback:!!(u.userImage&&u.userImage.render)}:c.w(`Image "${l}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return n}getPixelSize(){const{width:e,height:n}=this.atlasImage;return{width:e,height:n}}getPattern(e){const n=this.patterns[e],l=this.getImage(e);if(!l)return null;if(n&&n.position.version===l.version)return n.position;if(n)n.position.version=l.version;else{const u={w:l.data.width+2,h:l.data.height+2,x:0,y:0},f=new c.I(u,l);this.patterns[e]={bin:u,position:f}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const n=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new rt(e,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const f in this.patterns)e.push(this.patterns[f].bin);const{w:n,h:l}=c.p(e),u=this.atlasImage;u.resize({width:n||1,height:l||1});for(const f in this.patterns){const{bin:y}=this.patterns[f],w=y.x+1,S=y.y+1,M=this.getImage(f).data,E=M.width,A=M.height;c.R.copy(M,u,{x:0,y:0},{x:w,y:S},{width:E,height:A}),c.R.copy(M,u,{x:0,y:A-1},{x:w,y:S-1},{width:E,height:1}),c.R.copy(M,u,{x:0,y:0},{x:w,y:S+A},{width:E,height:1}),c.R.copy(M,u,{x:E-1,y:0},{x:w-1,y:S},{width:1,height:A}),c.R.copy(M,u,{x:0,y:0},{x:w+E,y:S},{width:1,height:A})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const n of e){if(this.callbackDispatchedThisFrame[n])continue;this.callbackDispatchedThisFrame[n]=!0;const l=this.getImage(n);l||c.w(`Image with ID: "${n}" was not found`),Zt(l)&&this.updateImage(n,l)}}}const ur=1e20;function hr(p,e,n,l,u,f,y,w,S){for(let M=e;M<e+l;M++)_r(p,n*f+M,f,u,y,w,S);for(let M=n;M<n+u;M++)_r(p,M*f+e,1,l,y,w,S)}function _r(p,e,n,l,u,f,y){f[0]=0,y[0]=-1e20,y[1]=ur,u[0]=p[e];for(let w=1,S=0,M=0;w<l;w++){u[w]=p[e+w*n];const E=w*w;do{const A=f[S];M=(u[w]-u[A]+E-A*A)/(w-A)/2}while(M<=y[S]&&--S>-1);S++,f[S]=w,y[S]=M,y[S+1]=ur}for(let w=0,S=0;w<l;w++){for(;y[S+1]<w;)S++;const M=f[S],E=w-M;p[e+w*n]=u[M]+E*E}}class Wt{constructor(e,n){this.requestManager=e,this.localIdeographFontFamily=n,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return c._(this,void 0,void 0,function*(){const n=[];for(const f in e)for(const y of e[f])n.push(this._getAndCacheGlyphsPromise(f,y));const l=yield Promise.all(n),u={};for(const{stack:f,id:y,glyph:w}of l)u[f]||(u[f]={}),u[f][y]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics};return u})}_getAndCacheGlyphsPromise(e,n){return c._(this,void 0,void 0,function*(){let l=this.entries[e];l||(l=this.entries[e]={glyphs:{},requests:{},ranges:{}});let u=l.glyphs[n];if(u!==void 0)return{stack:e,id:n,glyph:u};if(u=this._tinySDF(l,e,n),u)return l.glyphs[n]=u,{stack:e,id:n,glyph:u};const f=Math.floor(n/256);if(256*f>65535)throw new Error("glyphs > 65535 not supported");if(l.ranges[f])return{stack:e,id:n,glyph:u};if(!this.url)throw new Error("glyphsUrl is not set");if(!l.requests[f]){const w=Wt.loadGlyphRange(e,f,this.url,this.requestManager);l.requests[f]=w}const y=yield l.requests[f];for(const w in y)this._doesCharSupportLocalGlyph(+w)||(l.glyphs[+w]=y[+w]);return l.ranges[f]=!0,{stack:e,id:n,glyph:y[n]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))||c.u["CJK Unified Ideographs"](e)||c.u["Hangul Syllables"](e)||c.u.Hiragana(e)||c.u.Katakana(e)||c.u["CJK Symbols and Punctuation"](e)||c.u["Halfwidth and Fullwidth Forms"](e))}_tinySDF(e,n,l){const u=this.localIdeographFontFamily;if(!u||!this._doesCharSupportLocalGlyph(l))return;let f=e.tinySDF;if(!f){let w="400";/bold/i.test(n)?w="900":/medium/i.test(n)?w="500":/light/i.test(n)&&(w="200"),f=e.tinySDF=new Wt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:u,fontWeight:w})}const y=f.draw(String.fromCharCode(l));return{id:l,bitmap:new c.q({width:y.width||60,height:y.height||60},y.data),metrics:{width:y.glyphWidth/2||24,height:y.glyphHeight/2||24,left:y.glyphLeft/2+.5||0,top:y.glyphTop/2-27.5||-8,advance:y.glyphAdvance/2||24,isDoubleResolution:!0}}}}Wt.loadGlyphRange=function(p,e,n,l){return c._(this,void 0,void 0,function*(){const u=256*e,f=u+255,y=l.transformRequest(n.replace("{fontstack}",p).replace("{range}",`${u}-${f}`),"Glyphs"),w=yield c.n(y,new AbortController);if(!w||!w.data)throw new Error(`Could not load glyph range. range: ${e}, ${u}-${f}`);const S={};for(const M of c.o(w.data))S[M.id]=M;return S})},Wt.TinySDF=class{constructor({fontSize:p=24,buffer:e=3,radius:n=8,cutoff:l=.25,fontFamily:u="sans-serif",fontWeight:f="normal",fontStyle:y="normal"}={}){this.buffer=e,this.cutoff=l,this.radius=n;const w=this.size=p+4*e,S=this._createCanvas(w),M=this.ctx=S.getContext("2d",{willReadFrequently:!0});M.font=`${y} ${f} ${p}px ${u}`,M.textBaseline="alphabetic",M.textAlign="left",M.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(p){const e=document.createElement("canvas");return e.width=e.height=p,e}draw(p){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:l,actualBoundingBoxLeft:u,actualBoundingBoxRight:f}=this.ctx.measureText(p),y=Math.ceil(n),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-u))),S=Math.min(this.size-this.buffer,y+Math.ceil(l)),M=w+2*this.buffer,E=S+2*this.buffer,A=Math.max(M*E,0),z=new Uint8ClampedArray(A),B={data:z,width:M,height:E,glyphWidth:w,glyphHeight:S,glyphTop:y,glyphLeft:0,glyphAdvance:e};if(w===0||S===0)return B;const{ctx:O,buffer:X,gridInner:W,gridOuter:K}=this;O.clearRect(X,X,w,S),O.fillText(p,X,X+y);const J=O.getImageData(X,X,w,S);K.fill(ur,0,A),W.fill(0,0,A);for(let oe=0;oe<S;oe++)for(let se=0;se<w;se++){const ae=J.data[4*(oe*w+se)+3]/255;if(ae===0)continue;const fe=(oe+X)*M+se+X;if(ae===1)K[fe]=0,W[fe]=ur;else{const ue=.5-ae;K[fe]=ue>0?ue*ue:0,W[fe]=ue<0?ue*ue:0}}hr(K,0,0,M,E,M,this.f,this.v,this.z),hr(W,X,X,w,S,M,this.f,this.v,this.z);for(let oe=0;oe<A;oe++){const se=Math.sqrt(K[oe])-Math.sqrt(W[oe]);z[oe]=Math.round(255-255*(se/this.radius+this.cutoff))}return B}};class tn{constructor(){this.specification=c.v.light.position}possiblyEvaluate(e,n){return c.z(e.expression.evaluate(n))}interpolate(e,n,l){return{x:c.B.number(e.x,n.x,l),y:c.B.number(e.y,n.y,l),z:c.B.number(e.z,n.z,l)}}}let dr;class Gr extends c.E{constructor(e){super(),dr=dr||new c.r({anchor:new c.D(c.v.light.anchor),position:new tn,color:new c.D(c.v.light.color),intensity:new c.D(c.v.light.intensity)}),this._transitionable=new c.T(dr),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,n={}){if(!this._validate(c.t,e,n))for(const l in e){const u=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),u):this._transitionable.setValue(l,u)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,l){return(!l||l.validate!==!1)&&c.x(this,e.call(c.y,{value:n,style:{glyphs:!0,sprite:!0},styleSpec:c.v}))}}const qe=new c.r({"sky-color":new c.D(c.v.sky["sky-color"]),"horizon-color":new c.D(c.v.sky["horizon-color"]),"fog-color":new c.D(c.v.sky["fog-color"]),"fog-ground-blend":new c.D(c.v.sky["fog-ground-blend"]),"horizon-fog-blend":new c.D(c.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new c.D(c.v.sky["sky-horizon-blend"]),"atmosphere-blend":new c.D(c.v.sky["atmosphere-blend"])});class ft extends c.E{constructor(e){super(),this._transitionable=new c.T(qe),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.C(0))}setSky(e,n={}){if(!this._validate(c.F,e,n)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const l in e){const u=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),u):this._transitionable.setValue(l,u)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,l={}){return(l==null?void 0:l.validate)!==!1&&c.x(this,e.call(c.y,c.e({value:n,style:{glyphs:!0,sprite:!0},styleSpec:c.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class bt{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,n){const l=e.join(",")+String(n);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(e,n)),this.dashEntry[l]}getDashRanges(e,n,l){const u=[];let f=e.length%2==1?-e[e.length-1]*l:0,y=e[0]*l,w=!0;u.push({left:f,right:y,isDash:w,zeroLength:e[0]===0});let S=e[0];for(let M=1;M<e.length;M++){w=!w;const E=e[M];f=S*l,S+=E,y=S*l,u.push({left:f,right:y,isDash:w,zeroLength:E===0})}return u}addRoundDash(e,n,l){const u=n/2;for(let f=-l;f<=l;f++){const y=this.width*(this.nextRow+l+f);let w=0,S=e[w];for(let M=0;M<this.width;M++){M/S.right>1&&(S=e[++w]);const E=Math.abs(M-S.left),A=Math.abs(M-S.right),z=Math.min(E,A);let B;const O=f/l*(u+1);if(S.isDash){const X=u-Math.abs(O);B=Math.sqrt(z*z+X*X)}else B=u-Math.sqrt(z*z+O*O);this.data[y+M]=Math.max(0,Math.min(255,B+128))}}}addRegularDash(e){for(let w=e.length-1;w>=0;--w){const S=e[w],M=e[w+1];S.zeroLength?e.splice(w,1):M&&M.isDash===S.isDash&&(M.left=S.left,e.splice(w,1))}const n=e[0],l=e[e.length-1];n.isDash===l.isDash&&(n.left=l.left-this.width,l.right=n.right+this.width);const u=this.width*this.nextRow;let f=0,y=e[f];for(let w=0;w<this.width;w++){w/y.right>1&&(y=e[++f]);const S=Math.abs(w-y.left),M=Math.abs(w-y.right),E=Math.min(S,M);this.data[u+w]=Math.max(0,Math.min(255,(y.isDash?E:-E)+128))}}addDash(e,n){const l=n?7:0,u=2*l+1;if(this.nextRow+u>this.height)return c.w("LineAtlas out of space"),null;let f=0;for(let w=0;w<e.length;w++)f+=e[w];if(f!==0){const w=this.width/f,S=this.getDashRanges(e,this.width,w);n?this.addRoundDash(S,w,l):this.addRegularDash(S)}const y={y:(this.nextRow+l+.5)/this.height,height:2*l/this.height,width:f};return this.nextRow+=u,this.dirty=!0,y}bind(e){const n=e.gl;this.texture?(n.bindTexture(n.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,n.texSubImage2D(n.TEXTURE_2D,0,0,0,this.width,this.height,n.ALPHA,n.UNSIGNED_BYTE,this.data))):(this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.ALPHA,this.width,this.height,0,n.ALPHA,n.UNSIGNED_BYTE,this.data))}}const Gt="trackasia_preloaded_worker_pool";class Xt{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Xt.workerCount;)this.workers.push(new Worker(c.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Gt]}numActive(){return Object.keys(this.active).length}}const yn=Math.floor(me.hardwareConcurrency/2);let br,Tr;function cn(){return br||(br=new Xt),br}Xt.workerCount=c.G(globalThis)?Math.max(Math.min(yn,3),1):1;class Xr{constructor(e,n){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=n;const l=this.workerPool.acquire(n);for(let u=0;u<l.length;u++){const f=new c.H(l[u],n);f.name=`Worker ${u}`,this.actors.push(f)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,n){const l=[];for(const u of this.actors)l.push(u.sendAsync({type:e,data:n}));return Promise.all(l)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(n=>{n.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,n){for(const l of this.actors)l.registerMessageHandler(e,n)}}function Ae(){return Tr||(Tr=new Xr(cn(),c.J),Tr.registerMessageHandler("GR",(p,e,n)=>c.m(e,n))),Tr}function Ut(p,e){const n=c.K();return c.L(n,n,[1,1,0]),c.M(n,n,[.5*p.width,.5*p.height,1]),p.calculatePosMatrix?c.N(n,n,p.calculatePosMatrix(e.toUnwrapped())):n}function Yt(p,e,n,l,u,f,y){var w;const S=function(z,B,O){if(z)for(const X of z){const W=B[X];if(W&&W.source===O&&W.type==="fill-extrusion")return!0}else for(const X in B){const W=B[X];if(W.source===O&&W.type==="fill-extrusion")return!0}return!1}((w=u==null?void 0:u.layers)!==null&&w!==void 0?w:null,e,p.id),M=f.maxPitchScaleFactor(),E=p.tilesIn(l,M,S);E.sort(yr);const A=[];for(const z of E)A.push({wrappedTileID:z.tileID.wrapped().key,queryResults:z.tile.queryRenderedFeatures(e,n,p._state,z.queryGeometry,z.cameraQueryGeometry,z.scale,u,f,M,Ut(p.transform,z.tileID),y?(B,O)=>y(z.tileID,B,O):void 0)});return function(z,B){for(const O in z)for(const X of z[O])qr(X,B);return z}(function(z){const B={},O={};for(const X of z){const W=X.queryResults,K=X.wrappedTileID,J=O[K]=O[K]||{};for(const oe in W){const se=W[oe],ae=J[oe]=J[oe]||{},fe=B[oe]=B[oe]||[];for(const ue of se)ae[ue.featureIndex]||(ae[ue.featureIndex]=!0,fe.push(ue))}}return B}(A),p)}function yr(p,e){const n=p.tileID,l=e.tileID;return n.overscaledZ-l.overscaledZ||n.canonical.y-l.canonical.y||n.wrap-l.wrap||n.canonical.x-l.canonical.x}function qr(p,e){const n=p.feature,l=e.getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=l}function Sr(p,e,n){return c._(this,void 0,void 0,function*(){let l=p;if(p.url?l=(yield c.j(e.transformRequest(p.url,"Source"),n)).data:yield me.frameAsync(n),!l)return null;const u=c.O(c.e(l,p),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in l&&l.vector_layers&&(u.vectorLayerIds=l.vector_layers.map(f=>f.id)),u})}class mr{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof c.Q?new c.Q(e.lng,e.lat):c.Q.convert(e),this}setSouthWest(e){return this._sw=e instanceof c.Q?new c.Q(e.lng,e.lat):c.Q.convert(e),this}extend(e){const n=this._sw,l=this._ne;let u,f;if(e instanceof c.Q)u=e,f=e;else{if(!(e instanceof mr))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(mr.convert(e)):this.extend(c.Q.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(c.Q.convert(e)):this;if(u=e._sw,f=e._ne,!u||!f)return this}return n||l?(n.lng=Math.min(u.lng,n.lng),n.lat=Math.min(u.lat,n.lat),l.lng=Math.max(f.lng,l.lng),l.lat=Math.max(f.lat,l.lat)):(this._sw=new c.Q(u.lng,u.lat),this._ne=new c.Q(f.lng,f.lat)),this}getCenter(){return new c.Q((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c.Q(this.getWest(),this.getNorth())}getSouthEast(){return new c.Q(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:l}=c.Q.convert(e);let u=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&u}static convert(e){return e instanceof mr?e:e&&new mr(e)}static fromLngLat(e,n=0){const l=360*n/40075017,u=l/Math.cos(Math.PI/180*e.lat);return new mr(new c.Q(e.lng-u,e.lat-l),new c.Q(e.lng+u,e.lat+l))}adjustAntiMeridian(){const e=new c.Q(this._sw.lng,this._sw.lat),n=new c.Q(this._ne.lng,this._ne.lat);return new mr(e,e.lng>n.lng?new c.Q(n.lng+360,n.lat):n)}}class nr{constructor(e,n,l){this.bounds=mr.convert(this.validateBounds(e)),this.minzoom=n||0,this.maxzoom=l||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const n=Math.pow(2,e.z),l=Math.floor(c.U(this.bounds.getWest())*n),u=Math.floor(c.S(this.bounds.getNorth())*n),f=Math.ceil(c.U(this.bounds.getEast())*n),y=Math.ceil(c.S(this.bounds.getSouth())*n);return e.x>=l&&e.x<f&&e.y>=u&&e.y<y}}class Qi extends c.E{constructor(e,n,l,u){if(super(),this.id=e,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.e(this,c.O(n,["url","scheme","tileSize","promoteId"])),this._options=c.e({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(u)}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Sr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(c.e(this,e),e.bounds&&(this.tileBounds=new nr(e.bounds,this.minzoom,this.maxzoom)),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.l("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new c.k(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return c.e({},this._options)}loadTile(e){return c._(this,void 0,void 0,function*(){const n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l={request:this.map._requestManager.transformRequest(n,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};l.request.collectResourceTiming=this._collectResourceTiming;let u="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((f,y)=>{e.reloadPromise={resolve:f,reject:y}})}else e.actor=this.dispatcher.getActor(),u="LT";e.abortController=new AbortController;try{const f=yield e.actor.sendAsync({type:u,data:l},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,f)}catch(f){if(delete e.abortController,e.aborted)return;if(f&&f.status!==404)throw f;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,n){if(n&&n.resourceTiming&&(e.resourceTiming=n.resourceTiming),n&&this.map._refreshExpiredTiles&&e.setExpiryData(n),e.loadVectorData(n,this.map.painter),e.reloadPromise){const l=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(l.resolve).catch(l.reject)}}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class rn extends c.E{constructor(e,n,l,u){super(),this.id=e,this.dispatcher=l,this.setEventedParent(u),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.e({type:"raster"},n),c.e(this,c.O(n,["url","scheme","tileSize"]))}load(){return c._(this,arguments,void 0,function*(e=!1){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const n=yield Sr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,n&&(c.e(this,n),n.bounds&&(this.tileBounds=new nr(n.bounds,this.minzoom,this.maxzoom)),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(n){this._tileJSONRequest=null,this.fire(new c.k(n))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return c.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return c._(this,void 0,void 0,function*(){const n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const l=yield Be.getImage(this.map._requestManager.transformRequest(n,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(l&&l.data){this.map._refreshExpiredTiles&&(l.cacheControl||l.expires)&&e.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const u=this.map.painter.context,f=u.gl,y=l.data;e.texture=this.map.painter.getTileTexture(y.width),e.texture?e.texture.update(y,{useMipmap:!0}):(e.texture=new rt(u,y,f.RGBA,{useMipmap:!0}),e.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE,f.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(l){if(delete e.abortController,e.aborted)e.state="unloaded";else if(l)throw e.state="errored",l}})}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class Di extends rn{constructor(e,n,l,u){super(e,n,l,u),this.type="raster-dem",this.maxzoom=22,this._options=c.e({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox",this.redFactor=n.redFactor,this.greenFactor=n.greenFactor,this.blueFactor=n.blueFactor,this.baseShift=n.baseShift}loadTile(e){return c._(this,void 0,void 0,function*(){const n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l=this.map._requestManager.transformRequest(n,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const u=yield Be.getImage(l,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(u&&u.data){const f=u.data;this.map._refreshExpiredTiles&&(u.cacheControl||u.expires)&&e.setExpiryData({cacheControl:u.cacheControl,expires:u.expires});const y=c.b(f)&&c.V()?f:yield this.readImageNow(f),w={type:this.type,uid:e.uid,source:this.id,rawImageData:y,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const S=yield e.actor.sendAsync({type:"LDT",data:w});e.dem=S,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(u){if(delete e.abortController,e.aborted)e.state="unloaded";else if(u)throw e.state="errored",u}})}readImageNow(e){return c._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&c.W()){const n=e.width+2,l=e.height+2;try{return new c.R({width:n,height:l},yield c.X(e,-1,-1,n,l))}catch{}}return me.getImageData(e,1)})}_getNeighboringTiles(e){const n=e.canonical,l=Math.pow(2,n.z),u=(n.x-1+l)%l,f=n.x===0?e.wrap-1:e.wrap,y=(n.x+1+l)%l,w=n.x+1===l?e.wrap+1:e.wrap,S={};return S[new c.Y(e.overscaledZ,f,n.z,u,n.y).key]={backfilled:!1},S[new c.Y(e.overscaledZ,w,n.z,y,n.y).key]={backfilled:!1},n.y>0&&(S[new c.Y(e.overscaledZ,f,n.z,u,n.y-1).key]={backfilled:!1},S[new c.Y(e.overscaledZ,e.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},S[new c.Y(e.overscaledZ,w,n.z,y,n.y-1).key]={backfilled:!1}),n.y+1<l&&(S[new c.Y(e.overscaledZ,f,n.z,u,n.y+1).key]={backfilled:!1},S[new c.Y(e.overscaledZ,e.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},S[new c.Y(e.overscaledZ,w,n.z,y,n.y+1).key]={backfilled:!1}),S}unloadTile(e){return c._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class ci extends c.E{constructor(e,n,l,u){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=l.getActor(),this.setEventedParent(u),this._data=n.data,this._options=c.e({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId,n.clusterMaxZoom!==void 0&&this.maxzoom<=n.clusterMaxZoom&&c.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${n.clusterMaxZoom}".`),this.workerOptions=c.e({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(n.buffer!==void 0?n.buffer:128),tolerance:this._pixelsToTileUnits(n.tolerance!==void 0?n.tolerance:.375),extent:c.Z,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:c.Z,radius:this._pixelsToTileUnits(n.clusterRadius||50),log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(e){return e*(c.Z/this.tileSize)}load(){return c._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return c._(this,void 0,void 0,function*(){const e=c.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}getCoordinatesFromGeometry(e){return e.type==="GeometryCollection"?e.geometries.map(n=>n.coordinates).flat(1/0):e.coordinates.flat(1/0)}getBounds(){return c._(this,void 0,void 0,function*(){const e=new mr,n=yield this.getData();let l;switch(n.type){case"FeatureCollection":l=n.features.map(u=>this.getCoordinatesFromGeometry(u.geometry)).flat(1/0);break;case"Feature":l=this.getCoordinatesFromGeometry(n.geometry);break;default:l=this.getCoordinatesFromGeometry(n)}if(l.length==0)return e;for(let u=0;u<l.length-1;u+=2)e.extend([l[u],l[u+1]]);return e})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,n,l){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:n,offset:l}})}_updateWorkerData(e){return c._(this,void 0,void 0,function*(){const n=c.e({type:this.type},this.workerOptions);e?n.dataDiff=e:typeof this._data=="string"?(n.request=this.map._requestManager.transformRequest(me.resolveURL(this._data),"Source"),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new c.l("dataloading",{dataType:"source"}));try{const l=yield this.actor.sendAsync({type:"LD",data:n});if(this._pendingLoads--,this._removed||l.abandoned)return void this.fire(new c.l("dataabort",{dataType:"source"}));let u=null;l.resourceTiming&&l.resourceTiming[this.id]&&(u=l.resourceTiming[this.id].slice(0));const f={dataType:"source"};this._collectResourceTiming&&u&&u.length>0&&c.e(f,{resourceTiming:u}),this.fire(new c.l("data",Object.assign(Object.assign({},f),{sourceDataType:"metadata"}))),this.fire(new c.l("data",Object.assign(Object.assign({},f),{sourceDataType:"content"})))}catch(l){if(this._pendingLoads--,this._removed)return void this.fire(new c.l("dataabort",{dataType:"source"}));this.fire(new c.k(l))}})}loaded(){return this._pendingLoads===0}loadTile(e){return c._(this,void 0,void 0,function*(){const n=e.actor?"RT":"LT";e.actor=this.actor;const l={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};e.abortController=new AbortController;const u=yield this.actor.sendAsync({type:n,data:l},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(u,this.map.painter,n==="RT")})}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return c.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class un extends c.E{constructor(e,n,l,u){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=l,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(u),this.options=n}load(e){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const n=yield Be.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,n&&n.data&&(this.image=n.data,e&&(this.coordinates=e),this._finishLoading())}catch(n){this._request=null,this._loaded=!0,this.fire(new c.k(n))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const n=e.map(c.$.fromLngLat);var l;return this.tileID=function(u){let f=1/0,y=1/0,w=-1/0,S=-1/0;for(const z of u)f=Math.min(f,z.x),y=Math.min(y,z.y),w=Math.max(w,z.x),S=Math.max(S,z.y);const M=Math.max(w-f,S-y),E=Math.max(0,Math.floor(-Math.log(M)/Math.LN2)),A=Math.pow(2,E);return new c.a1(E,Math.floor((f+w)/2*A),Math.floor((y+S)/2*A))}(n),this.terrainTileRanges=this._getOverlappingTileRanges(n),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=n.map(u=>this.tileID.getTilePoint(u)._round()),this.flippedWindingOrder=((l=this.tileCoords)[1].x-l[0].x)*(l[2].y-l[0].y)-(l[1].y-l[0].y)*(l[2].x-l[0].x)<0,this.fire(new c.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,n=e.gl;this.texture||(this.texture=new rt(e,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let l=!1;for(const u in this.tiles){const f=this.tiles[u];f.state!=="loaded"&&(f.state="loaded",f.texture=this.texture,l=!0)}l&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return c._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(e){let n=1/0,l=1/0,u=-1/0,f=-1/0;for(const w of e)n=Math.min(n,w.x),l=Math.min(l,w.y),u=Math.max(u,w.x),f=Math.max(f,w.y);const y={};for(let w=0;w<=c.a0;w++){const S=Math.pow(2,w),M=Math.floor(n*S),E=Math.floor(l*S),A=Math.floor(u*S),z=Math.floor(f*S);y[w]={minTileX:M,minTileY:E,maxTileX:A,maxTileY:z}}return y}}class kn extends un{constructor(e,n,l,u){super(e,n,l,u),this.roundZoom=!0,this.type="video",this.options=n}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const n of e.urls)this.urls.push(this.map._requestManager.transformRequest(n,"Source").url);try{const n=yield c.a2(this.urls);if(this._loaded=!0,!n)return;this.video=n,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(n){this.fire(new c.k(n))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const n=this.video.seekable;e<n.start(0)||e>n.end(0)?this.fire(new c.k(new c.a3(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,n=e.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new rt(e,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let l=!1;for(const u in this.tiles){const f=this.tiles[u];f.state!=="loaded"&&(f.state="loaded",f.texture=this.texture,l=!0)}l&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Ji extends un{constructor(e,n,l,u){super(e,n,l,u),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(f=>!Array.isArray(f)||f.length!==2||f.some(y=>typeof y!="number"))||this.fire(new c.k(new c.a3(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.k(new c.a3(`sources.${e}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new c.k(new c.a3(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new c.k(new c.a3(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.k(new c.a3(`sources.${e}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){return c._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context,l=n.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new rt(n,this.canvas,l.RGBA,{premultiply:!0});let u=!1;for(const f in this.tiles){const y=this.tiles[f];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,u=!0)}u&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const js={},es=p=>{switch(p){case"geojson":return ci;case"image":return un;case"raster":return rn;case"raster-dem":return Di;case"vector":return Qi;case"video":return kn;case"canvas":return Ji}return js[p]},ro="RTLPluginLoaded";class no extends c.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Ae()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(n=>{throw this.status="error",n})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return c._(this,arguments,void 0,function*(n,l=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=me.resolveURL(n),!this.url)throw new Error(`requested url ${n} is invalid`);if(this.status==="unavailable"){if(!l)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return c._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new c.l(ro))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let io=null;function ts(){return io||(io=new no),io}class Gn{constructor(e,n){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=c.a4(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const n=e+this.timeAdded;n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,n,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(u,f){const y={};if(!f)return y;for(const w of u){const S=w.layerIds.map(M=>f.getLayer(M)).filter(Boolean);if(S.length!==0){w.layers=S,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(M=>S.filter(E=>E.id===M)[0]));for(const M of S)y[M.id]=w}}return y}(e.buckets,n==null?void 0:n.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const f=this.buckets[u];if(f instanceof c.a6){if(this.hasSymbolBuckets=!0,!l)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const f=this.buckets[u];if(f instanceof c.a6&&f.hasRTLText){this.hasRTLText=!0,ts().lazyLoad();break}}this.queryPadding=0;for(const u in this.buckets){const f=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(u).queryRadius(f))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new c.a5}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const l in this.buckets){const u=this.buckets[l];u.uploadPending()&&u.upload(e)}const n=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new rt(e,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new rt(e,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,n,l,u,f,y,w,S,M,E,A){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:u,cameraQueryGeometry:f,scale:y,tileSize:this.tileSize,pixelPosMatrix:E,transform:S,params:w,queryPadding:this.queryPadding*M,getElevation:A},e,n,l):{}}querySourceFeatures(e,n){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const u=l.loadVTLayers(),f=n&&n.sourceLayer?n.sourceLayer:"",y=u._geojsonTileLayer||u[f];if(!y)return;const w=c.a7(n&&n.filter),{z:S,x:M,y:E}=this.tileID.canonical,A={z:S,x:M,y:E};for(let z=0;z<y.length;z++){const B=y.feature(z);if(w.needGeometry){const W=c.a8(B,!0);if(!w.filter(new c.C(this.tileID.overscaledZ),W,this.tileID.canonical))continue}else if(!w.filter(new c.C(this.tileID.overscaledZ),B))continue;const O=l.getId(B,f),X=new c.a9(B,S,M,E,O);X.tile=A,e.push(X)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const n=this.expirationTime;if(e.cacheControl){const l=c.aa(e.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const l=Date.now();let u=!1;if(this.expirationTime>l)u=!1;else if(n)if(this.expirationTime<n)u=!0;else{const f=this.expirationTime-n;f?this.expirationTime=l+Math.max(f,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const u in this.buckets){if(!n.style.hasLayer(u))continue;const f=this.buckets[u],y=f.layers[0].sourceLayer||"_geojsonTileLayer",w=l[y],S=e[y];if(!w||!S||Object.keys(S).length===0)continue;f.update(S,w,this.imageAtlas&&this.imageAtlas.patternPositions||{});const M=n&&n.style&&n.style.getLayer(u);M&&(this.queryPadding=Math.max(this.queryPadding,M.queryRadius(f)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<me.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=me.now()+e}setDependencies(e,n){const l={};for(const u of n)l[u]=!0;this.dependencies[e]=l}hasDependency(e,n){for(const l of e){const u=this.dependencies[l];if(u){for(const f of n)if(u[f])return!0}}return!1}}class Li{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(const e in this.data)for(const n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,l){const u=e.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);const f={value:n,timeout:void 0};if(l!==void 0&&(f.timeout=setTimeout(()=>{this.remove(e,f)},l)),this.data[u].push(f),this.order.push(u),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){const n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;const l=e.wrapped().key,u=n===void 0?0:this.data[l].indexOf(n),f=this.data[l][u];return this.data[l].splice(u,1),f.timeout&&clearTimeout(f.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(f.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){const n=[];for(const l in this.data)for(const u of this.data[l])e(u.value)||n.push(u);for(const l of n)this.remove(l.value.tileID,l)}}class ms{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,l){const u=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},c.e(this.stateChanges[e][u],l),this.deletedStates[e]===null){this.deletedStates[e]={};for(const f in this.state[e])f!==u&&(this.deletedStates[e][f]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][u]===null){this.deletedStates[e][u]={};for(const f in this.state[e][u])l[f]||(this.deletedStates[e][u][f]=null)}else for(const f in l)this.deletedStates[e]&&this.deletedStates[e][u]&&this.deletedStates[e][u][f]===null&&delete this.deletedStates[e][u][f]}removeFeatureState(e,n,l){if(this.deletedStates[e]===null)return;const u=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},l&&n!==void 0)this.deletedStates[e][u]!==null&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][l]=null);else if(n!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][u])for(l in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][l]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,n){const l=String(n),u=c.e({},(this.state[e]||{})[l],(this.stateChanges[e]||{})[l]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const f=this.deletedStates[e][n];if(f===null)return{};for(const y in f)delete u[y]}return u}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){const l={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const f={};for(const y in this.stateChanges[u])this.state[u][y]||(this.state[u][y]={}),c.e(this.state[u][y],this.stateChanges[u][y]),f[y]=this.state[u][y];l[u]=f}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const f={};if(this.deletedStates[u]===null)for(const y in this.state[u])f[y]={},this.state[u][y]={};else for(const y in this.deletedStates[u]){if(this.deletedStates[u][y]===null)this.state[u][y]={};else for(const w of Object.keys(this.deletedStates[u][y]))delete this.state[u][y][w];f[y]=this.state[u][y]}l[u]=l[u]||{},c.e(l[u],f)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(const u in e)e[u].setFeatureState(l,n)}}const qn=89.25;function En(p,e){const n=c.ae(e.lat,-85.051129,c.af);return new c.P(c.U(e.lng)*p,c.S(n)*p)}function xi(p,e){return new c.$(e.x/p,e.y/p).toLngLat()}function ge(p){return p.cameraToCenterDistance*Math.min(.85*Math.tan(c.ab(90-p.pitch)),Math.tan(c.ab(qn-p.pitch)))}function V(p,e){const n=p.canonical,l=e/c.ac(n.z),u=n.x+Math.pow(2,n.z)*p.wrap,f=c.ad(new Float64Array(16));return c.L(f,f,[u*l,n.y*l,0]),c.M(f,f,[l/c.Z,l/c.Z,1]),f}function $(p,e,n,l,u){const f=c.$.fromLngLat(p,e),y=u*c.ag(1,p.lat),w=y*Math.cos(c.ab(n)),S=Math.sqrt(y*y-w*w),M=S*Math.sin(c.ab(-l)),E=S*Math.cos(c.ab(-l));return new c.$(f.x+M,f.y+E,f.z+w)}function H(p,e,n){const l=e.intersectsFrustum(p);if(!n)return l;const u=e.intersectsPlane(n);return l===0||u===0?0:l===2&&u===2?2:1}function te(p,e,n){let l=0;const u=(n-e)/10;for(let f=0;f<10;f++)l+=u*Math.pow(Math.cos(e+(f+.5)/10*(n-e)),p);return l}function de(p,e){return function(n,l,u,f,y){const w=2*((p-1)/c.ah(Math.cos(c.ab(qn-y))/Math.cos(c.ab(qn)))-1),S=Math.acos(u/f),M=2*te(w-1,0,c.ab(y/2)),E=Math.min(c.ab(qn),S+c.ab(y/2)),A=te(w-1,Math.min(E,S-c.ab(y/2)),E),z=Math.atan(l/u),B=Math.hypot(l,u);let O=n;return O+=c.ah(f/B/Math.max(.5,Math.cos(c.ab(y/2)))),O+=w*c.ah(Math.cos(z))/2,O-=c.ah(Math.max(1,A/M/e))/2,O}}const q=de(9.314,3);function Te(p,e){const n=(e.roundZoom?Math.round:Math.floor)(p.zoom+c.ah(p.tileSize/e.tileSize));return Math.max(0,n)}function _e(p,e){const n=p.getCameraFrustum(),l=p.getClippingPlane(),u=p.screenPointToMercatorCoordinate(p.getCameraPoint()),f=c.$.fromLngLat(p.center,p.elevation);u.z=f.z+Math.cos(p.pitchInRadians)*p.cameraToCenterDistance/p.worldSize;const y=p.getCoveringTilesDetailsProvider(),w=y.allowVariableZoom(p,e),S=Te(p,e),M=e.minzoom||0,E=e.maxzoom!==void 0?e.maxzoom:p.maxZoom,A=Math.min(Math.max(0,S),E),z=Math.pow(2,A),B=[z*u.x,z*u.y,0],O=[z*f.x,z*f.y,0],X=Math.hypot(f.x-u.x,f.y-u.y),W=Math.abs(f.z-u.z),K=Math.hypot(X,W),J=ae=>({zoom:0,x:0,y:0,wrap:ae,fullyVisible:!1}),oe=[],se=[];if(p.renderWorldCopies&&y.allowWorldCopies())for(let ae=1;ae<=3;ae++)oe.push(J(-ae)),oe.push(J(ae));for(oe.push(J(0));oe.length>0;){const ae=oe.pop(),fe=ae.x,ue=ae.y;let Se=ae.fullyVisible;const Fe={x:fe,y:ue,z:ae.zoom},ke=y.getTileAABB(Fe,ae.wrap,p.elevation,e);if(!Se){const et=H(n,ke,l);if(et===0)continue;Se=et===2}const Ee=y.distanceToTile2d(u.x,u.y,Fe,ke);let ze=S;w&&(ze=(e.calculateTileZoom||q)(p.zoom+c.ah(p.tileSize/e.tileSize),Ee,W,K,p.fov)),ze=(e.roundZoom?Math.round:Math.floor)(ze),ze=Math.max(0,ze);const nt=Math.min(ze,E);if(ae.wrap=y.getWrap(f,Fe,ae.wrap),ae.zoom>=nt){if(ae.zoom<M)continue;const et=A-ae.zoom,Ze=B[0]-.5-(fe<<et),dt=B[1]-.5-(ue<<et),$t=e.reparseOverscaled?Math.max(ae.zoom,ze):ae.zoom;se.push({tileID:new c.Y(ae.zoom===E?$t:ae.zoom,ae.wrap,ae.zoom,fe,ue),distanceSq:c.ai([O[0]-.5-fe,O[1]-.5-ue]),tileDistanceToCamera:Math.sqrt(Ze*Ze+dt*dt)})}else for(let et=0;et<4;et++)oe.push({zoom:ae.zoom+1,x:(fe<<1)+et%2,y:(ue<<1)+(et>>1),wrap:ae.wrap,fullyVisible:Se})}return se.sort((ae,fe)=>ae.distanceSq-fe.distanceSq).map(ae=>ae.tileID)}class be extends c.E{constructor(e,n,l){super(),this.id=e,this.dispatcher=l,this.on("data",u=>this._dataHandler(u)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((u,f,y,w)=>{const S=new(es(f.type))(u,f,y,w);if(S.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${S.id}`);return S})(e,n,l,this),this._tiles={},this._cache=new Li(0,u=>this._unloadTile(u)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ms,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const n=this._tiles[e];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,n,l){return c._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,n,l)}catch(u){e.state="errored",u.status!==404?this._source.fire(new c.k(u,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new c.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const l=this._tiles[n];l.upload(e),l.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(Ce).map(e=>e.key)}getRenderableIds(e){const n=[];for(const l in this._tiles)this._isIdRenderable(l,e)&&n.push(this._tiles[l]);return e?n.sort((l,u)=>{const f=l.tileID,y=u.tileID,w=new c.P(f.canonical.x,f.canonical.y)._rotate(-this.transform.bearingInRadians),S=new c.P(y.canonical.x,y.canonical.y)._rotate(-this.transform.bearingInRadians);return f.overscaledZ-y.overscaledZ||S.y-w.y||S.x-w.x}).map(l=>l.tileID.key):n.map(l=>l.tileID).sort(Ce).map(l=>l.key)}hasRenderableParent(e){const n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())}reload(e){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)(e||this._tiles[n].state!=="errored")&&this._reloadTile(n,"reloading")}}_reloadTile(e,n){return c._(this,void 0,void 0,function*(){const l=this._tiles[e];l&&(l.state!=="loading"&&(l.state=n),yield this._loadTile(l,e,n))})}_tileLoaded(e,n,l){e.timeAdded=me.now(),l==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new c.l("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const n=this.getRenderableIds();for(let u=0;u<n.length;u++){const f=n[u];if(e.neighboringTiles&&e.neighboringTiles[f]){const y=this.getTileByID(f);l(e,y),l(y,e)}}function l(u,f){u.needsHillshadePrepare=!0,u.needsTerrainPrepare=!0;let y=f.tileID.canonical.x-u.tileID.canonical.x;const w=f.tileID.canonical.y-u.tileID.canonical.y,S=Math.pow(2,u.tileID.canonical.z),M=f.tileID.key;y===0&&w===0||Math.abs(w)>1||(Math.abs(y)>1&&(Math.abs(y+S)===1?y+=S:Math.abs(y-S)===1&&(y-=S)),f.dem&&u.dem&&(u.dem.backfillBorder(f.dem,y,w),u.neighboringTiles&&u.neighboringTiles[M]&&(u.neighboringTiles[M].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,l,u){for(const f in this._tiles){let y=this._tiles[f];if(u[f]||!y.hasData()||y.tileID.overscaledZ<=n||y.tileID.overscaledZ>l)continue;let w=y.tileID;for(;y&&y.tileID.overscaledZ>n+1;){const M=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[M.key],y&&y.hasData()&&(w=M)}let S=w;for(;S.overscaledZ>n;)if(S=S.scaledTo(S.overscaledZ-1),e[S.key]||e[S.canonical.key]){u[w.key]=w;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){const l=this._loadedParentTiles[e.key];return l&&l.tileID.overscaledZ>=n?l:null}for(let l=e.overscaledZ-1;l>=n;l--){const u=e.scaledTo(l),f=this._getLoadedTile(u);if(f)return f}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const n=Math.ceil(e.width/this._source.tileSize)+1,l=Math.ceil(e.height/this._source.tileSize)+1,u=Math.floor(n*l*(this._maxTileCacheZoomLevels===null?c.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),f=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,u):u;this._cache.setMaxSize(f)}handleWrapJump(e){const n=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,n){const l={};for(const u in this._tiles){const f=this._tiles[u];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+n),l[f.tileID.key]=f}this._tiles=l;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(u,this._tiles[u])}}_updateCoveredAndRetainedTiles(e,n,l,u,f,y){const w={},S={},M=Object.keys(e),E=me.now();for(const A of M){const z=e[A],B=this._tiles[A];if(!B||B.fadeEndTime!==0&&B.fadeEndTime<=E)continue;const O=this.findLoadedParent(z,n),X=this.findLoadedSibling(z),W=O||X||null;W&&(this._addTile(W.tileID),w[W.tileID.key]=W.tileID),S[A]=z}this._retainLoadedChildren(S,u,l,e);for(const A in w)e[A]||(this._coveredTiles[A]=!0,e[A]=w[A]);if(y){const A={},z={};for(const B of f)this._tiles[B.key].hasData()?A[B.key]=B:z[B.key]=B;for(const B in z){const O=z[B].children(this._source.maxzoom);this._tiles[O[0].key]&&this._tiles[O[1].key]&&this._tiles[O[2].key]&&this._tiles[O[3].key]&&(A[O[0].key]=e[O[0].key]=O[0],A[O[1].key]=e[O[1].key]=O[1],A[O[2].key]=e[O[2].key]=O[2],A[O[3].key]=e[O[3].key]=O[3],delete z[B])}for(const B in z){const O=z[B],X=this.findLoadedParent(O,this._source.minzoom),W=this.findLoadedSibling(O),K=X||W||null;if(K){A[K.tileID.key]=e[K.tileID.key]=K.tileID;for(const J in A)A[J].isChildOf(K.tileID)&&delete A[J]}}for(const B in this._tiles)A[B]||(this._coveredTiles[B]=!0)}}update(e,n){if(!this._sourceLoaded||this._paused)return;let l;this.transform=e,this.terrain=n,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(E=>new c.Y(E.canonical.z,E.wrap,E.canonical.z,E.canonical.x,E.canonical.y)):(l=_e(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:n,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(l=l.filter(E=>this._source.hasTile(E)))):l=[];const u=Te(e,this._source),f=Math.max(u-be.maxOverzooming,this._source.minzoom),y=Math.max(u+be.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const E={};for(const A of l)if(A.canonical.z>this._source.minzoom){const z=A.scaledTo(A.canonical.z-1);E[z.key]=z;const B=A.scaledTo(Math.max(this._source.minzoom,Math.min(A.canonical.z,5)));E[B.key]=B}l=l.concat(Object.values(E))}const w=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,w&&this.fire(new c.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const S=this._updateRetainedTiles(l,u);xe(this._source.type)&&this._updateCoveredAndRetainedTiles(S,f,y,u,l,n);for(const E in S)this._tiles[E].clearFadeHold();const M=c.aj(this._tiles,S);for(const E of M){const A=this._tiles[E];A.hasSymbolBuckets&&!A.holdingForFade()?A.setHoldDuration(this.map._fadeDuration):A.hasSymbolBuckets&&!A.symbolFadeFinished()||this._removeTile(E)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,n){var l;const u={},f={},y=Math.max(n-be.maxOverzooming,this._source.minzoom),w=Math.max(n+be.maxUnderzooming,this._source.minzoom),S={};for(const M of e){const E=this._addTile(M);u[M.key]=M,E.hasData()||n<this._source.maxzoom&&(S[M.key]=M)}this._retainLoadedChildren(S,n,w,u);for(const M of e){let E=this._tiles[M.key];if(E.hasData())continue;if(n+1>this._source.maxzoom){const z=M.children(this._source.maxzoom)[0],B=this.getTile(z);if(B&&B.hasData()){u[z.key]=z;continue}}else{const z=M.children(this._source.maxzoom);if(u[z[0].key]&&u[z[1].key]&&u[z[2].key]&&u[z[3].key])continue}let A=E.wasRequested();for(let z=M.overscaledZ-1;z>=y;--z){const B=M.scaledTo(z);if(f[B.key])break;if(f[B.key]=!0,E=this.getTile(B),!E&&A&&(E=this._addTile(B)),E){const O=E.hasData();if((O||!(!((l=this.map)===null||l===void 0)&&l.cancelPendingTileRequestsWhileZooming)||A)&&(u[B.key]=B),A=E.wasRequested(),O)break}}}return u}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const n=[];let l,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){l=this._loadedParentTiles[u.key];break}n.push(u.key);const f=u.scaledTo(u.overscaledZ-1);if(l=this._getLoadedTile(f),l)break;u=f}for(const f of n)this._loadedParentTiles[f]=l}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const n=this._tiles[e].tileID,l=this._getLoadedTile(n);this._loadedSiblingTiles[n.key]=l}}_addTile(e){let n=this._tiles[e.key];if(n)return n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));const l=n;return n||(n=new Gn(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(n,e.key,n.state)),n.uses++,this._tiles[e.key]=n,l||this._source.fire(new c.l("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const l=n.getExpiryTimeout();l&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},l))}refreshTiles(e){for(const n in this._tiles)this._isIdRenderable(n)&&e.some(l=>l.equals(this._tiles[n].tileID.canonical))&&this._reloadTile(n,"expired")}_removeTile(e){const n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}_dataHandler(e){const n=e.sourceDataType;e.dataType==="source"&&n==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&n==="content"&&(this.reload(e.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,n,l){const u=[],f=this.transform;if(!f)return u;const y=l?f.getCameraQueryGeometry(e):e,w=e.map(O=>f.screenPointToMercatorCoordinate(O,this.terrain)),S=y.map(O=>f.screenPointToMercatorCoordinate(O,this.terrain)),M=this.getIds();let E=1/0,A=1/0,z=-1/0,B=-1/0;for(const O of S)E=Math.min(E,O.x),A=Math.min(A,O.y),z=Math.max(z,O.x),B=Math.max(B,O.y);for(let O=0;O<M.length;O++){const X=this._tiles[M[O]];if(X.holdingForFade())continue;const W=f.getCoveringTilesDetailsProvider().allowWorldCopies()?X.tileID:X.tileID.unwrapTo(0),K=Math.pow(2,f.zoom-X.tileID.overscaledZ),J=n*X.queryPadding*c.Z/X.tileSize/K,oe=[W.getTilePoint(new c.$(E,A)),W.getTilePoint(new c.$(z,B))];if(oe[0].x-J<c.Z&&oe[0].y-J<c.Z&&oe[1].x+J>=0&&oe[1].y+J>=0){const se=w.map(fe=>W.getTilePoint(fe)),ae=S.map(fe=>W.getTilePoint(fe));u.push({tile:X,tileID:W,queryGeometry:se,cameraQueryGeometry:ae,scale:K})}}return u}getVisibleCoordinates(e){const n=this.getRenderableIds(e).map(l=>this._tiles[l].tileID);return this.transform&&this.transform.populateCache(n),n}hasTransition(){if(this._source.hasTransition())return!0;if(xe(this._source.type)){const e=me.now();for(const n in this._tiles)if(this._tiles[n].fadeEndTime>=e)return!0}return!1}setFeatureState(e,n,l){this._state.updateState(e=e||"_geojsonTileLayer",n,l)}removeFeatureState(e,n,l){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,l)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,l){const u=this._tiles[e];u&&u.setDependencies(n,l)}reloadTilesForDependencies(e,n){for(const l in this._tiles)this._tiles[l].hasDependency(e,n)&&this._reloadTile(l,"reloading");this._cache.filter(l=>!l.hasDependency(e,n))}}function Ce(p,e){const n=Math.abs(2*p.wrap)-+(p.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return p.overscaledZ-e.overscaledZ||l-n||e.canonical.y-p.canonical.y||e.canonical.x-p.canonical.x}function xe(p){return p==="raster"||p==="image"||p==="video"}be.maxOverzooming=10,be.maxUnderzooming=3;class $e{constructor(e,n){this.reset(e,n)}reset(e,n){this.points=e||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=c.ae(e,0,1);let n=1,l=this._distances[n];const u=e*this.paddedLength+this.padding;for(;l<u&&n<this._distances.length;)l=this._distances[++n];const f=n-1,y=this._distances[f],w=l-y,S=w>0?(u-y)/w:0;return this.points[f].mult(1-S).add(this.points[n].mult(S))}}function tt(p,e){let n=!0;return p==="always"||p!=="never"&&e!=="never"||(n=!1),n}class ot{constructor(e,n,l){const u=this.boxCells=[],f=this.circleCells=[];this.xCellCount=Math.ceil(e/l),this.yCellCount=Math.ceil(n/l);for(let y=0;y<this.xCellCount*this.yCellCount;y++)u.push([]),f.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=n,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,n,l,u,f){this._forEachCell(n,l,u,f,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(n),this.bboxes.push(l),this.bboxes.push(u),this.bboxes.push(f)}insertCircle(e,n,l,u){this._forEachCell(n-u,l-u,n+u,l+u,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(n),this.circles.push(l),this.circles.push(u)}_insertBoxCell(e,n,l,u,f,y){this.boxCells[f].push(y)}_insertCircleCell(e,n,l,u,f,y){this.circleCells[f].push(y)}_query(e,n,l,u,f,y,w){if(l<0||e>this.width||u<0||n>this.height)return[];const S=[];if(e<=0&&n<=0&&this.width<=l&&this.height<=u){if(f)return[{key:null,x1:e,y1:n,x2:l,y2:u}];for(let M=0;M<this.boxKeys.length;M++)S.push({key:this.boxKeys[M],x1:this.bboxes[4*M],y1:this.bboxes[4*M+1],x2:this.bboxes[4*M+2],y2:this.bboxes[4*M+3]});for(let M=0;M<this.circleKeys.length;M++){const E=this.circles[3*M],A=this.circles[3*M+1],z=this.circles[3*M+2];S.push({key:this.circleKeys[M],x1:E-z,y1:A-z,x2:E+z,y2:A+z})}}else this._forEachCell(e,n,l,u,this._queryCell,S,{hitTest:f,overlapMode:y,seenUids:{box:{},circle:{}}},w);return S}query(e,n,l,u){return this._query(e,n,l,u,!1,null)}hitTest(e,n,l,u,f,y){return this._query(e,n,l,u,!0,f,y).length>0}hitTestCircle(e,n,l,u,f){const y=e-l,w=e+l,S=n-l,M=n+l;if(w<0||y>this.width||M<0||S>this.height)return!1;const E=[];return this._forEachCell(y,S,w,M,this._queryCellCircle,E,{hitTest:!0,overlapMode:u,circle:{x:e,y:n,radius:l},seenUids:{box:{},circle:{}}},f),E.length>0}_queryCell(e,n,l,u,f,y,w,S){const{seenUids:M,hitTest:E,overlapMode:A}=w,z=this.boxCells[f];if(z!==null){const O=this.bboxes;for(const X of z)if(!M.box[X]){M.box[X]=!0;const W=4*X,K=this.boxKeys[X];if(e<=O[W+2]&&n<=O[W+3]&&l>=O[W+0]&&u>=O[W+1]&&(!S||S(K))&&(!E||!tt(A,K.overlapMode))&&(y.push({key:K,x1:O[W],y1:O[W+1],x2:O[W+2],y2:O[W+3]}),E))return!0}}const B=this.circleCells[f];if(B!==null){const O=this.circles;for(const X of B)if(!M.circle[X]){M.circle[X]=!0;const W=3*X,K=this.circleKeys[X];if(this._circleAndRectCollide(O[W],O[W+1],O[W+2],e,n,l,u)&&(!S||S(K))&&(!E||!tt(A,K.overlapMode))){const J=O[W],oe=O[W+1],se=O[W+2];if(y.push({key:K,x1:J-se,y1:oe-se,x2:J+se,y2:oe+se}),E)return!0}}}return!1}_queryCellCircle(e,n,l,u,f,y,w,S){const{circle:M,seenUids:E,overlapMode:A}=w,z=this.boxCells[f];if(z!==null){const O=this.bboxes;for(const X of z)if(!E.box[X]){E.box[X]=!0;const W=4*X,K=this.boxKeys[X];if(this._circleAndRectCollide(M.x,M.y,M.radius,O[W+0],O[W+1],O[W+2],O[W+3])&&(!S||S(K))&&!tt(A,K.overlapMode))return y.push(!0),!0}}const B=this.circleCells[f];if(B!==null){const O=this.circles;for(const X of B)if(!E.circle[X]){E.circle[X]=!0;const W=3*X,K=this.circleKeys[X];if(this._circlesCollide(O[W],O[W+1],O[W+2],M.x,M.y,M.radius)&&(!S||S(K))&&!tt(A,K.overlapMode))return y.push(!0),!0}}}_forEachCell(e,n,l,u,f,y,w,S){const M=this._convertToXCellCoord(e),E=this._convertToYCellCoord(n),A=this._convertToXCellCoord(l),z=this._convertToYCellCoord(u);for(let B=M;B<=A;B++)for(let O=E;O<=z;O++)if(f.call(this,e,n,l,u,this.xCellCount*O+B,y,w,S))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,n,l,u,f,y){const w=u-e,S=f-n,M=l+y;return M*M>w*w+S*S}_circleAndRectCollide(e,n,l,u,f,y,w){const S=(y-u)/2,M=Math.abs(e-(u+S));if(M>S+l)return!1;const E=(w-f)/2,A=Math.abs(n-(f+E));if(A>E+l)return!1;if(M<=S||A<=E)return!0;const z=M-S,B=A-E;return z*z+B*B<=l*l}}function xt(p,e,n){const l=c.K();if(!p){const{vecSouth:A,vecEast:z}=Tt(e),B=Q();B[0]=z[0],B[1]=z[1],B[2]=A[0],B[3]=A[1],u=B,(E=(y=(f=B)[0])*(M=f[3])-(S=f[2])*(w=f[1]))&&(u[0]=M*(E=1/E),u[1]=-w*E,u[2]=-S*E,u[3]=y*E),l[0]=B[0],l[1]=B[1],l[4]=B[2],l[5]=B[3]}var u,f,y,w,S,M,E;return c.M(l,l,[1/n,1/n,1]),l}function Lt(p,e,n,l){if(p){const u=c.K();if(!e){const{vecSouth:f,vecEast:y}=Tt(n);u[0]=y[0],u[1]=y[1],u[4]=f[0],u[5]=f[1]}return c.M(u,u,[l,l,1]),u}return n.pixelsToClipSpaceMatrix}function Tt(p){const e=Math.cos(p.rollInRadians),n=Math.sin(p.rollInRadians),l=Math.cos(p.pitchInRadians),u=Math.cos(p.bearingInRadians),f=Math.sin(p.bearingInRadians),y=c.ao();y[0]=-u*l*n-f*e,y[1]=-f*l*n+u*e;const w=c.ap(y);w<1e-9?c.aq(y):c.ar(y,y,1/w);const S=c.ao();S[0]=u*l*e-f*n,S[1]=f*l*e+u*n;const M=c.ap(S);return M<1e-9?c.aq(S):c.ar(S,S,1/M),{vecEast:S,vecSouth:y}}function Ie(p,e,n,l){let u;l?(u=[p,e,l(p,e),1],c.at(u,u,n)):(u=[p,e,0,1],_s(u,u,n));const f=u[3];return{point:new c.P(u[0]/f,u[1]/f),signedDistanceFromCamera:f,isOccluded:!1}}function or(p,e){return .5+p/e*.5}function qt(p,e){return p.x>=-e[0]&&p.x<=e[0]&&p.y>=-e[1]&&p.y<=e[1]}function tr(p,e,n,l,u,f,y,w,S,M,E,A,z){const B=n?p.textSizeData:p.iconSizeData,O=c.ak(B,e.transform.zoom),X=[256/e.width*2+1,256/e.height*2+1],W=n?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;W.clear();const K=p.lineVertexArray,J=n?p.text.placedSymbolArray:p.icon.placedSymbolArray,oe=e.transform.width/e.transform.height;let se=!1;for(let ae=0;ae<J.length;ae++){const fe=J.get(ae);if(fe.hidden||fe.writingMode===c.al.vertical&&!se){ji(fe.numGlyphs,W);continue}se=!1;const ue=new c.P(fe.anchorX,fe.anchorY),Se={getElevation:z,pitchedLabelPlaneMatrix:l,lineVertexArray:K,pitchWithMap:f,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:e.transform,tileAnchorPoint:ue,unwrappedTileID:S,width:M,height:E,translation:A},Fe=Ft(fe.anchorX,fe.anchorY,Se);if(!qt(Fe.point,X)){ji(fe.numGlyphs,W);continue}const ke=or(e.transform.cameraToCenterDistance,Fe.signedDistanceFromCamera),Ee=c.am(B,O,fe),ze=f?Ee*e.transform.getPitchedTextCorrection(fe.anchorX,fe.anchorY,S)/ke:Ee*ke,nt=St({projectionContext:Se,pitchedLabelPlaneMatrixInverse:u,symbol:fe,fontSize:ze,flip:!1,keepUpright:y,glyphOffsetArray:p.glyphOffsetArray,dynamicLayoutVertexArray:W,aspectRatio:oe,rotateToLine:w});se=nt.useVertical,(nt.notEnoughRoom||se||nt.needsFlipping&&St({projectionContext:Se,pitchedLabelPlaneMatrixInverse:u,symbol:fe,fontSize:ze,flip:!0,keepUpright:y,glyphOffsetArray:p.glyphOffsetArray,dynamicLayoutVertexArray:W,aspectRatio:oe,rotateToLine:w}).notEnoughRoom)&&ji(fe.numGlyphs,W)}n?p.text.dynamicLayoutVertexBuffer.updateData(W):p.icon.dynamicLayoutVertexBuffer.updateData(W)}function Mt(p,e,n,l,u,f,y,w){const S=f.glyphStartIndex+f.numGlyphs,M=f.lineStartIndex,E=f.lineStartIndex+f.lineLength,A=e.getoffsetX(f.glyphStartIndex),z=e.getoffsetX(S-1),B=gs(p*A,n,l,u,f.segment,M,E,w,y);if(!B)return null;const O=gs(p*z,n,l,u,f.segment,M,E,w,y);return O?w.projectionCache.anyProjectionOccluded?null:{first:B,last:O}:null}function Ve(p,e,n,l){return p===c.al.horizontal&&Math.abs(n.y-e.y)>Math.abs(n.x-e.x)*l?{useVertical:!0}:(p===c.al.vertical?e.y<n.y:e.x>n.x)?{needsFlipping:!0}:null}function St(p){const{projectionContext:e,pitchedLabelPlaneMatrixInverse:n,symbol:l,fontSize:u,flip:f,keepUpright:y,glyphOffsetArray:w,dynamicLayoutVertexArray:S,aspectRatio:M,rotateToLine:E}=p,A=u/24,z=l.lineOffsetX*A,B=l.lineOffsetY*A;let O;if(l.numGlyphs>1){const X=l.glyphStartIndex+l.numGlyphs,W=l.lineStartIndex,K=l.lineStartIndex+l.lineLength,J=Mt(A,w,z,B,f,l,E,e);if(!J)return{notEnoughRoom:!0};const oe=hn(J.first.point.x,J.first.point.y,e,n),se=hn(J.last.point.x,J.last.point.y,e,n);if(y&&!f){const ae=Ve(l.writingMode,oe,se,M);if(ae)return ae}O=[J.first];for(let ae=l.glyphStartIndex+1;ae<X-1;ae++)O.push(gs(A*w.getoffsetX(ae),z,B,f,l.segment,W,K,e,E));O.push(J.last)}else{if(y&&!f){const W=Rr(e.tileAnchorPoint.x,e.tileAnchorPoint.y,e).point,K=l.lineStartIndex+l.segment+1,J=new c.P(e.lineVertexArray.getx(K),e.lineVertexArray.gety(K)),oe=Rr(J.x,J.y,e),se=oe.signedDistanceFromCamera>0?oe.point:kt(e.tileAnchorPoint,J,W,1,e),ae=hn(W.x,W.y,e,n),fe=hn(se.x,se.y,e,n),ue=Ve(l.writingMode,ae,fe,M);if(ue)return ue}const X=gs(A*w.getoffsetX(l.glyphStartIndex),z,B,f,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,e,E);if(!X||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};O=[X]}for(const X of O)c.as(S,X.point,X.angle);return{}}function kt(p,e,n,l,u){const f=p.add(p.sub(e)._unit()),y=Rr(f.x,f.y,u).point,w=n.sub(y);return n.add(w._mult(l/w.mag()))}function Pr(p,e,n){const l=e.projectionCache;if(l.projections[p])return l.projections[p];const u=new c.P(e.lineVertexArray.getx(p),e.lineVertexArray.gety(p)),f=Rr(u.x,u.y,e);if(f.signedDistanceFromCamera>0)return l.projections[p]=f.point,l.anyProjectionOccluded=l.anyProjectionOccluded||f.isOccluded,f.point;const y=p-n.direction;return kt(n.distanceFromAnchor===0?e.tileAnchorPoint:new c.P(e.lineVertexArray.getx(y),e.lineVertexArray.gety(y)),u,n.previousVertex,n.absOffsetX-n.distanceFromAnchor+1,e)}function Rr(p,e,n){const l=p+n.translation[0],u=e+n.translation[1];let f;return n.pitchWithMap?(f=Ie(l,u,n.pitchedLabelPlaneMatrix,n.getElevation),f.isOccluded=!1):(f=n.transform.projectTileCoordinates(l,u,n.unwrappedTileID,n.getElevation),f.point.x=(.5*f.point.x+.5)*n.width,f.point.y=(.5*-f.point.y+.5)*n.height),f}function hn(p,e,n,l){if(n.pitchWithMap){const u=[p,e,0,1];return c.at(u,u,l),n.transform.projectTileCoordinates(u[0]/u[3],u[1]/u[3],n.unwrappedTileID,n.getElevation).point}return{x:p/n.width*2-1,y:e/n.height*2-1}}function Ft(p,e,n){return n.transform.projectTileCoordinates(p,e,n.unwrappedTileID,n.getElevation)}function Fs(p,e,n){return p._unit()._perp()._mult(e*n)}function so(p,e,n,l,u,f,y,w,S){if(w.projectionCache.offsets[p])return w.projectionCache.offsets[p];const M=n.add(e);if(p+S.direction<l||p+S.direction>=u)return w.projectionCache.offsets[p]=M,M;const E=Pr(p+S.direction,w,S),A=Fs(E.sub(n),y,S.direction),z=n.add(A),B=E.add(A);return w.projectionCache.offsets[p]=c.au(f,M,z,B)||M,w.projectionCache.offsets[p]}function gs(p,e,n,l,u,f,y,w,S){const M=l?p-e:p+e;let E=M>0?1:-1,A=0;l&&(E*=-1,A=Math.PI),E<0&&(A+=Math.PI);let z,B=E>0?f+u:f+u+1;w.projectionCache.cachedAnchorPoint?z=w.projectionCache.cachedAnchorPoint:(z=Rr(w.tileAnchorPoint.x,w.tileAnchorPoint.y,w).point,w.projectionCache.cachedAnchorPoint=z);let O,X,W=z,K=z,J=0,oe=0;const se=Math.abs(M),ae=[];let fe;for(;J+oe<=se;){if(B+=E,B<f||B>=y)return null;J+=oe,K=W,X=O;const Fe={absOffsetX:se,direction:E,distanceFromAnchor:J,previousVertex:K};if(W=Pr(B,w,Fe),n===0)ae.push(K),fe=W.sub(K);else{let ke;const Ee=W.sub(K);ke=Ee.mag()===0?Fs(Pr(B+E,w,Fe).sub(W),n,E):Fs(Ee,n,E),X||(X=K.add(ke)),O=so(B,ke,W,f,y,X,n,w,Fe),ae.push(X),fe=O.sub(X)}oe=fe.mag()}const ue=fe._mult((se-J)/oe)._add(X||K),Se=A+Math.atan2(W.y-K.y,W.x-K.x);return ae.push(ue),{point:ue,angle:S?Se:0,path:ae}}const oo=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ji(p,e){for(let n=0;n<p;n++){const l=e.length;e.resize(l+4),e.float32.set(oo,3*l)}}function _s(p,e,n){const l=e[0],u=e[1];return p[0]=n[0]*l+n[4]*u+n[12],p[1]=n[1]*l+n[5]*u+n[13],p[3]=n[3]*l+n[7]*u+n[15],p}const Or=100;class Hn{constructor(e,n=new ot(e.width+200,e.height+200,25),l=new ot(e.width+200,e.height+200,25)){this.transform=e,this.grid=n,this.ignoredGrid=l,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Or,this.screenBottomBoundary=e.height+Or,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,n,l,u,f,y,w,S,M,E,A,z){const B=this.projectAndGetPerspectiveRatio(e.anchorPointX+S[0],e.anchorPointY+S[1],f,E,z),O=l*B.perspectiveRatio;let X;if(y||w)X=this._projectCollisionBox(e,O,u,f,y,w,S,B,E,A,z);else{const fe=B.x+(A?A.x*O:0),ue=B.y+(A?A.y*O:0);X={allPointsOccluded:!1,box:[fe+e.x1*O,ue+e.y1*O,fe+e.x2*O,ue+e.y2*O]}}const[W,K,J,oe]=X.box,se=y?X.allPointsOccluded:B.isOccluded;let ae=se;return ae||(ae=B.perspectiveRatio<this.perspectiveRatioCutoff),ae||(ae=!this.isInsideGrid(W,K,J,oe)),ae||n!=="always"&&this.grid.hitTest(W,K,J,oe,n,M)?{box:[W,K,J,oe],placeable:!1,offscreen:!1,occluded:se}:{box:[W,K,J,oe],placeable:!0,offscreen:this.isOffscreen(W,K,J,oe),occluded:se}}placeCollisionCircles(e,n,l,u,f,y,w,S,M,E,A,z,B,O){const X=[],W=new c.P(n.anchorX,n.anchorY),K=this.getPerspectiveRatio(W.x,W.y,y,O),J=(M?f*this.transform.getPitchedTextCorrection(n.anchorX,n.anchorY,y)/K:f*K)/c.ay,oe={getElevation:O,pitchedLabelPlaneMatrix:w,lineVertexArray:l,pitchWithMap:M,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:W,unwrappedTileID:y,width:this.transform.width,height:this.transform.height,translation:B},se=Mt(J,u,n.lineOffsetX*J,n.lineOffsetY*J,!1,n,!1,oe);let ae=!1,fe=!1,ue=!0;if(se){const Se=.5*A*K+z,Fe=new c.P(-100,-100),ke=new c.P(this.screenRightBoundary,this.screenBottomBoundary),Ee=new $e,ze=se.first,nt=se.last;let et=[];for(let $t=ze.path.length-1;$t>=1;$t--)et.push(ze.path[$t]);for(let $t=1;$t<nt.path.length;$t++)et.push(nt.path[$t]);const Ze=2.5*Se;if(M){const $t=this.projectPathToScreenSpace(et,oe);et=$t.some(sr=>sr.signedDistanceFromCamera<=0)?[]:$t.map(sr=>sr.point)}let dt=[];if(et.length>0){const $t=et[0].clone(),sr=et[0].clone();for(let Lr=1;Lr<et.length;Lr++)$t.x=Math.min($t.x,et[Lr].x),$t.y=Math.min($t.y,et[Lr].y),sr.x=Math.max(sr.x,et[Lr].x),sr.y=Math.max(sr.y,et[Lr].y);dt=$t.x>=Fe.x&&sr.x<=ke.x&&$t.y>=Fe.y&&sr.y<=ke.y?[et]:sr.x<Fe.x||$t.x>ke.x||sr.y<Fe.y||$t.y>ke.y?[]:c.av([et],Fe.x,Fe.y,ke.x,ke.y)}for(const $t of dt){Ee.reset($t,.25*Se);let sr=0;sr=Ee.length<=.5*Se?1:Math.ceil(Ee.paddedLength/Ze)+1;for(let Lr=0;Lr<sr;Lr++){const wr=Lr/Math.max(sr-1,1),jr=Ee.lerp(wr),Ir=jr.x+Or,xr=jr.y+Or;X.push(Ir,xr,Se,0);const pr=Ir-Se,pn=xr-Se,wn=Ir+Se,zn=xr+Se;if(ue=ue&&this.isOffscreen(pr,pn,wn,zn),fe=fe||this.isInsideGrid(pr,pn,wn,zn),e!=="always"&&this.grid.hitTestCircle(Ir,xr,Se,e,E)&&(ae=!0,!S))return{circles:[],offscreen:!1,collisionDetected:ae}}}}return{circles:!S&&ae||!fe||K<this.perspectiveRatioCutoff?[]:X,offscreen:ue,collisionDetected:ae}}projectPathToScreenSpace(e,n){const l=function(u,f){const y=c.K();return c.an(y,f.pitchedLabelPlaneMatrix),u.map(w=>{const S=Ie(w.x,w.y,y,f.getElevation),M=f.transform.projectTileCoordinates(S.point.x,S.point.y,f.unwrappedTileID,f.getElevation);return M.point.x=(.5*M.point.x+.5)*f.width,M.point.y=(.5*-M.point.y+.5)*f.height,M})}(e,n);return function(u){let f=0,y=0,w=0,S=0;for(let M=0;M<u.length;M++)u[M].isOccluded?(w=M+1,S=0):(S++,S>y&&(y=S,f=w));return u.slice(f,f+y)}(l)}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const n=[];let l=1/0,u=1/0,f=-1/0,y=-1/0;for(const E of e){const A=new c.P(E.x+Or,E.y+Or);l=Math.min(l,A.x),u=Math.min(u,A.y),f=Math.max(f,A.x),y=Math.max(y,A.y),n.push(A)}const w=this.grid.query(l,u,f,y).concat(this.ignoredGrid.query(l,u,f,y)),S={},M={};for(const E of w){const A=E.key;if(S[A.bucketInstanceId]===void 0&&(S[A.bucketInstanceId]={}),S[A.bucketInstanceId][A.featureIndex])continue;const z=[new c.P(E.x1,E.y1),new c.P(E.x2,E.y1),new c.P(E.x2,E.y2),new c.P(E.x1,E.y2)];c.aw(n,z)&&(S[A.bucketInstanceId][A.featureIndex]=!0,M[A.bucketInstanceId]===void 0&&(M[A.bucketInstanceId]=[]),M[A.bucketInstanceId].push(A.featureIndex))}return M}insertCollisionBox(e,n,l,u,f,y){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:f,collisionGroupID:y,overlapMode:n},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,n,l,u,f,y){const w=l?this.ignoredGrid:this.grid,S={bucketInstanceId:u,featureIndex:f,collisionGroupID:y,overlapMode:n};for(let M=0;M<e.length;M+=4)w.insertCircle(S,e[M],e[M+1],e[M+2])}projectAndGetPerspectiveRatio(e,n,l,u,f){if(f){let y;u?(y=[e,n,u(e,n),1],c.at(y,y,f)):(y=[e,n,0,1],_s(y,y,f));const w=y[3];return{x:(y[0]/w+1)/2*this.transform.width+Or,y:(-y[1]/w+1)/2*this.transform.height+Or,perspectiveRatio:.5+this.transform.cameraToCenterDistance/w*.5,isOccluded:!1,signedDistanceFromCamera:w}}{const y=this.transform.projectTileCoordinates(e,n,l,u);return{x:(y.point.x+1)/2*this.transform.width+Or,y:(1-y.point.y)/2*this.transform.height+Or,perspectiveRatio:.5+this.transform.cameraToCenterDistance/y.signedDistanceFromCamera*.5,isOccluded:y.isOccluded,signedDistanceFromCamera:y.signedDistanceFromCamera}}}getPerspectiveRatio(e,n,l,u){const f=this.transform.projectTileCoordinates(e,n,l,u);return .5+this.transform.cameraToCenterDistance/f.signedDistanceFromCamera*.5}isOffscreen(e,n,l,u){return l<Or||e>=this.screenRightBoundary||u<Or||n>this.screenBottomBoundary}isInsideGrid(e,n,l,u){return l>=0&&e<this.gridRightBoundary&&u>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const e=c.ad([]);return c.L(e,e,[-100,-100,0]),e}_projectCollisionBox(e,n,l,u,f,y,w,S,M,E,A){let z=1,B=0,O=0,X=1;const W=e.anchorPointX+w[0],K=e.anchorPointY+w[1];if(y&&!f){const et=this.projectAndGetPerspectiveRatio(W+1,K,u,M,A),Ze=et.x-S.x,dt=Math.atan((et.y-S.y)/Ze)+(Ze<0?Math.PI:0),$t=Math.sin(dt),sr=Math.cos(dt);z=sr,B=$t,O=-$t,X=sr}else if(!y&&f){const et=Tt(this.transform);z=et.vecEast[0],B=et.vecEast[1],O=et.vecSouth[0],X=et.vecSouth[1]}let J=S.x,oe=S.y,se=n;f&&(J=W,oe=K,se=Math.pow(2,-(this.transform.zoom-l.overscaledZ)),se*=this.transform.getPitchedTextCorrection(W,K,u),E||(se*=c.ae(.5+S.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),E&&(J+=z*E.x*se+O*E.y*se,oe+=B*E.x*se+X*E.y*se);const ae=e.x1*se,fe=e.x2*se,ue=(ae+fe)/2,Se=e.y1*se,Fe=e.y2*se,ke=(Se+Fe)/2,Ee=[{offsetX:ae,offsetY:Se},{offsetX:ue,offsetY:Se},{offsetX:fe,offsetY:Se},{offsetX:fe,offsetY:ke},{offsetX:fe,offsetY:Fe},{offsetX:ue,offsetY:Fe},{offsetX:ae,offsetY:Fe},{offsetX:ae,offsetY:ke}];let ze=[];for(const{offsetX:et,offsetY:Ze}of Ee)ze.push(new c.P(J+z*et+O*Ze,oe+B*et+X*Ze));let nt=!1;if(f){const et=ze.map(Ze=>this.projectAndGetPerspectiveRatio(Ze.x,Ze.y,u,M,A));nt=et.some(Ze=>!Ze.isOccluded),ze=et.map(Ze=>new c.P(Ze.x,Ze.y))}else nt=!0;return{box:c.ax(ze),allPointsOccluded:!nt}}}class Cr{constructor(e,n,l,u){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?n:-n))):u&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class ao{constructor(e,n,l,u,f){this.text=new Cr(e?e.text:null,n,l,f),this.icon=new Cr(e?e.icon:null,n,u,f)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Bs{constructor(e,n,l){this.text=e,this.icon=n,this.skipFade=l}}class Ta{constructor(e,n,l,u,f){this.bucketInstanceId=e,this.featureIndex=n,this.sourceLayerIndex=l,this.bucketIndex=u,this.tileID=f}}class ys{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const n=++this.maxGroupID;this.collisionGroups[e]={ID:n,predicate:l=>l.collisionGroupID===n}}return this.collisionGroups[e]}}function Fi(p,e,n,l,u){const{horizontalAlign:f,verticalAlign:y}=c.aE(p);return new c.P(-(f-.5)*e+l[0]*u,-(y-.5)*n+l[1]*u)}class Ml{constructor(e,n,l,u,f){this.transform=e.clone(),this.terrain=n,this.collisionIndex=new Hn(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new ys(u),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=f,f&&(f.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const n=this.terrain;return n?(l,u)=>n.getElevation(e,l,u):null}getBucketParts(e,n,l,u){const f=l.getBucket(n),y=l.latestFeatureIndex;if(!f||!y||n.id!==f.layerIds[0])return;const w=l.collisionBoxArray,S=f.layers[0].layout,M=f.layers[0].paint,E=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),A=l.tileSize/c.Z,z=l.tileID.toUnwrapped(),B=S.get("text-rotation-alignment")==="map",O=c.az(l,1,this.transform.zoom),X=c.aA(this.collisionIndex.transform,l,M.get("text-translate"),M.get("text-translate-anchor")),W=c.aA(this.collisionIndex.transform,l,M.get("icon-translate"),M.get("icon-translate-anchor")),K=xt(B,this.transform,O);this.retainedQueryData[f.bucketInstanceId]=new Ta(f.bucketInstanceId,y,f.sourceLayerIndex,f.index,l.tileID);const J={bucket:f,layout:S,translationText:X,translationIcon:W,unwrappedTileID:z,pitchedLabelPlaneMatrix:K,scale:E,textPixelRatio:A,holdingForFade:l.holdingForFade(),collisionBoxArray:w,partiallyEvaluatedTextSize:c.ak(f.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(f.sourceID)};if(u)for(const oe of f.sortKeyRanges){const{sortKey:se,symbolInstanceStart:ae,symbolInstanceEnd:fe}=oe;e.push({sortKey:se,symbolInstanceStart:ae,symbolInstanceEnd:fe,parameters:J})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:f.symbolInstances.length,parameters:J})}attemptAnchorPlacement(e,n,l,u,f,y,w,S,M,E,A,z,B,O,X,W,K,J,oe,se){const ae=c.aB[e.textAnchor],fe=[e.textOffset0,e.textOffset1],ue=Fi(ae,l,u,fe,f),Se=this.collisionIndex.placeCollisionBox(n,z,S,M,E,w,y,W,A.predicate,oe,ue,se);if((!J||this.collisionIndex.placeCollisionBox(J,z,S,M,E,w,y,K,A.predicate,oe,ue,se).placeable)&&Se.placeable){let Fe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[B.crossTileID]&&this.prevPlacement.placements[B.crossTileID]&&this.prevPlacement.placements[B.crossTileID].text&&(Fe=this.prevPlacement.variableOffsets[B.crossTileID].anchor),B.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[B.crossTileID]={textOffset:fe,width:l,height:u,anchor:ae,textBoxScale:f,prevAnchor:Fe},this.markUsedJustification(O,ae,B,X),O.allowVerticalPlacement&&(this.markUsedOrientation(O,X,B),this.placedOrientations[B.crossTileID]=X),{shift:ue,placedGlyphBoxes:Se}}}placeLayerBucketPart(e,n,l){const{bucket:u,layout:f,translationText:y,translationIcon:w,unwrappedTileID:S,pitchedLabelPlaneMatrix:M,textPixelRatio:E,holdingForFade:A,collisionBoxArray:z,partiallyEvaluatedTextSize:B,collisionGroup:O}=e.parameters,X=f.get("text-optional"),W=f.get("icon-optional"),K=c.aC(f,"text-overlap","text-allow-overlap"),J=K==="always",oe=c.aC(f,"icon-overlap","icon-allow-overlap"),se=oe==="always",ae=f.get("text-rotation-alignment")==="map",fe=f.get("text-pitch-alignment")==="map",ue=f.get("icon-text-fit")!=="none",Se=f.get("symbol-z-order")==="viewport-y",Fe=J&&(se||!u.hasIconData()||W),ke=se&&(J||!u.hasTextData()||X);!u.collisionArrays&&z&&u.deserializeCollisionBoxes(z);const Ee=this.retainedQueryData[u.bucketInstanceId].tileID,ze=this._getTerrainElevationFunc(Ee),nt=this.transform.getFastPathSimpleProjectionMatrix(Ee),et=(Ze,dt,$t)=>{var sr,Lr;if(n[Ze.crossTileID])return;if(A)return void(this.placements[Ze.crossTileID]=new Bs(!1,!1,!1));let wr=!1,jr=!1,Ir=!0,xr=null,pr={box:null,placeable:!1,offscreen:null,occluded:!1},pn={placeable:!1},wn=null,zn=null,fr=null,$s=0,as=0,Us=0;dt.textFeatureIndex?$s=dt.textFeatureIndex:Ze.useRuntimeCollisionCircles&&($s=Ze.featureIndex),dt.verticalTextFeatureIndex&&(as=dt.verticalTextFeatureIndex);const vo=dt.textBox;if(vo){const di=sn=>{let on=c.al.horizontal;if(u.allowVerticalPlacement&&!sn&&this.prevPlacement){const Kn=this.prevPlacement.placedOrientations[Ze.crossTileID];Kn&&(this.placedOrientations[Ze.crossTileID]=Kn,on=Kn,this.markUsedOrientation(u,on,Ze))}return on},Gs=(sn,on)=>{if(u.allowVerticalPlacement&&Ze.numVerticalGlyphVertices>0&&dt.verticalTextBox){for(const Kn of u.writingModes)if(Kn===c.al.vertical?(pr=on(),pn=pr):pr=sn(),pr&&pr.placeable)break}else pr=sn()},ws=Ze.textAnchorOffsetStartIndex,qs=Ze.textAnchorOffsetEndIndex;if(qs===ws){const sn=(on,Kn)=>{const Ar=this.collisionIndex.placeCollisionBox(on,K,E,Ee,S,fe,ae,y,O.predicate,ze,void 0,nt);return Ar&&Ar.placeable&&(this.markUsedOrientation(u,Kn,Ze),this.placedOrientations[Ze.crossTileID]=Kn),Ar};Gs(()=>sn(vo,c.al.horizontal),()=>{const on=dt.verticalTextBox;return u.allowVerticalPlacement&&Ze.numVerticalGlyphVertices>0&&on?sn(on,c.al.vertical):{box:null,offscreen:null}}),di(pr&&pr.placeable)}else{let sn=c.aB[(Lr=(sr=this.prevPlacement)===null||sr===void 0?void 0:sr.variableOffsets[Ze.crossTileID])===null||Lr===void 0?void 0:Lr.anchor];const on=(Ar,dc,Hd)=>{const Wd=Ar.x2-Ar.x1,lm=Ar.y2-Ar.y1,Gu=Ze.textBoxScale,el=ue&&oe==="never"?dc:null;let Si=null,ls=K==="never"?1:2,Pi="never";sn&&ls++;for(let Ts=0;Ts<ls;Ts++){for(let pc=ws;pc<qs;pc++){const Hs=u.textAnchorOffsets.get(pc);if(sn&&Hs.textAnchor!==sn)continue;const qu=this.attemptAnchorPlacement(Hs,Ar,Wd,lm,Gu,ae,fe,E,Ee,S,O,Pi,Ze,u,Hd,y,w,el,ze);if(qu&&(Si=qu.placedGlyphBoxes,Si&&Si.placeable))return wr=!0,xr=qu.shift,Si}sn?sn=null:Pi=K}return l&&!Si&&(Si={box:this.collisionIndex.placeCollisionBox(vo,"always",E,Ee,S,fe,ae,y,O.predicate,ze,void 0,nt).box,offscreen:!1,placeable:!1,occluded:!1}),Si};Gs(()=>on(vo,dt.iconBox,c.al.horizontal),()=>{const Ar=dt.verticalTextBox;return u.allowVerticalPlacement&&(!pr||!pr.placeable)&&Ze.numVerticalGlyphVertices>0&&Ar?on(Ar,dt.verticalIconBox,c.al.vertical):{box:null,occluded:!0,offscreen:null}}),pr&&(wr=pr.placeable,Ir=pr.offscreen);const Kn=di(pr&&pr.placeable);if(!wr&&this.prevPlacement){const Ar=this.prevPlacement.variableOffsets[Ze.crossTileID];Ar&&(this.variableOffsets[Ze.crossTileID]=Ar,this.markUsedJustification(u,Ar.anchor,Ze,Kn))}}}if(wn=pr,wr=wn&&wn.placeable,Ir=wn&&wn.offscreen,Ze.useRuntimeCollisionCircles){const di=u.text.placedSymbolArray.get(Ze.centerJustifiedTextSymbolIndex),Gs=c.am(u.textSizeData,B,di),ws=f.get("text-padding");zn=this.collisionIndex.placeCollisionCircles(K,di,u.lineVertexArray,u.glyphOffsetArray,Gs,S,M,l,fe,O.predicate,Ze.collisionCircleDiameter,ws,y,ze),zn.circles.length&&zn.collisionDetected&&!l&&c.w("Collisions detected, but collision boxes are not shown"),wr=J||zn.circles.length>0&&!zn.collisionDetected,Ir=Ir&&zn.offscreen}if(dt.iconFeatureIndex&&(Us=dt.iconFeatureIndex),dt.iconBox){const di=Gs=>this.collisionIndex.placeCollisionBox(Gs,oe,E,Ee,S,fe,ae,w,O.predicate,ze,ue&&xr?xr:void 0,nt);pn&&pn.placeable&&dt.verticalIconBox?(fr=di(dt.verticalIconBox),jr=fr.placeable):(fr=di(dt.iconBox),jr=fr.placeable),Ir=Ir&&fr.offscreen}const Ja=X||Ze.numHorizontalGlyphVertices===0&&Ze.numVerticalGlyphVertices===0,Zs=W||Ze.numIconVertices===0;Ja||Zs?Zs?Ja||(jr=jr&&wr):wr=jr&&wr:jr=wr=jr&&wr;const xo=jr&&fr.placeable;if(wr&&wn.placeable&&this.collisionIndex.insertCollisionBox(wn.box,K,f.get("text-ignore-placement"),u.bucketInstanceId,pn&&pn.placeable&&as?as:$s,O.ID),xo&&this.collisionIndex.insertCollisionBox(fr.box,oe,f.get("icon-ignore-placement"),u.bucketInstanceId,Us,O.ID),zn&&wr&&this.collisionIndex.insertCollisionCircles(zn.circles,K,f.get("text-ignore-placement"),u.bucketInstanceId,$s,O.ID),l&&this.storeCollisionData(u.bucketInstanceId,$t,dt,wn,fr,zn),Ze.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(u.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ze.crossTileID]=new Bs((wr||Fe)&&!(wn!=null&&wn.occluded),(jr||ke)&&!(fr!=null&&fr.occluded),Ir||u.justReloaded),n[Ze.crossTileID]=!0};if(Se){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ze=u.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let dt=Ze.length-1;dt>=0;--dt){const $t=Ze[dt];et(u.symbolInstances.get($t),u.collisionArrays[$t],$t)}}else for(let Ze=e.symbolInstanceStart;Ze<e.symbolInstanceEnd;Ze++)et(u.symbolInstances.get(Ze),u.collisionArrays[Ze],Ze);u.justReloaded=!1}storeCollisionData(e,n,l,u,f,y){if(l.textBox||l.iconBox){let w,S;this.collisionBoxArrays.has(e)?w=this.collisionBoxArrays.get(e):(w=new Map,this.collisionBoxArrays.set(e,w)),w.has(n)?S=w.get(n):(S={text:null,icon:null},w.set(n,S)),l.textBox&&(S.text=u.box),l.iconBox&&(S.icon=f.box)}if(y){let w=this.collisionCircleArrays[e];w===void 0&&(w=this.collisionCircleArrays[e]=[]);for(let S=0;S<y.circles.length;S+=4)w.push(y.circles[S+0]-Or),w.push(y.circles[S+1]-Or),w.push(y.circles[S+2]),w.push(y.collisionDetected?1:0)}}markUsedJustification(e,n,l,u){let f;f=u===c.al.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[c.aD(n)];const y=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const w of y)w>=0&&(e.text.placedSymbolArray.get(w).crossTileID=f>=0&&w!==f?0:l.crossTileID)}markUsedOrientation(e,n,l){const u=n===c.al.horizontal||n===c.al.horizontalOnly?n:0,f=n===c.al.vertical?n:0,y=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const w of y)e.text.placedSymbolArray.get(w).placedOrientation=u;l.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=f)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let l=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const u=n?n.symbolFadeChange(e):1,f=n?n.opacities:{},y=n?n.variableOffsets:{},w=n?n.placedOrientations:{};for(const S in this.placements){const M=this.placements[S],E=f[S];E?(this.opacities[S]=new ao(E,u,M.text,M.icon),l=l||M.text!==E.text.placed||M.icon!==E.icon.placed):(this.opacities[S]=new ao(null,u,M.text,M.icon,M.skipFade),l=l||M.text||M.icon)}for(const S in f){const M=f[S];if(!this.opacities[S]){const E=new ao(M,u,!1,!1);E.isHidden()||(this.opacities[S]=E,l=l||M.text.placed||M.icon.placed)}}for(const S in y)this.variableOffsets[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.variableOffsets[S]=y[S]);for(const S in w)this.placedOrientations[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.placedOrientations[S]=w[S]);if(n&&n.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:e)}updateLayerOpacities(e,n){const l={};for(const u of n){const f=u.getBucket(e);f&&u.latestFeatureIndex&&e.id===f.layerIds[0]&&this.updateBucketOpacities(f,u.tileID,l,u.collisionBoxArray)}}updateBucketOpacities(e,n,l,u){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const f=e.layers[0],y=f.layout,w=new ao(null,0,!1,!1,!0),S=y.get("text-allow-overlap"),M=y.get("icon-allow-overlap"),E=f._unevaluatedLayout.hasValue("text-variable-anchor")||f._unevaluatedLayout.hasValue("text-variable-anchor-offset"),A=y.get("text-rotation-alignment")==="map",z=y.get("text-pitch-alignment")==="map",B=y.get("icon-text-fit")!=="none",O=new ao(null,0,S&&(M||!e.hasIconData()||y.get("icon-optional")),M&&(S||!e.hasTextData()||y.get("text-optional")),!0);!e.collisionArrays&&u&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(u);const X=(K,J,oe)=>{for(let se=0;se<J/4;se++)K.opacityVertexArray.emplaceBack(oe);K.hasVisibleVertices=K.hasVisibleVertices||oe!==Dt},W=this.collisionBoxArrays.get(e.bucketInstanceId);for(let K=0;K<e.symbolInstances.length;K++){const J=e.symbolInstances.get(K),{numHorizontalGlyphVertices:oe,numVerticalGlyphVertices:se,crossTileID:ae}=J;let fe=this.opacities[ae];l[ae]?fe=w:fe||(fe=O,this.opacities[ae]=fe),l[ae]=!0;const ue=J.numIconVertices>0,Se=this.placedOrientations[J.crossTileID],Fe=Se===c.al.vertical,ke=Se===c.al.horizontal||Se===c.al.horizontalOnly;if(oe>0||se>0){const ze=ct(fe.text);X(e.text,oe,Fe?Dt:ze),X(e.text,se,ke?Dt:ze);const nt=fe.text.isHidden();[J.rightJustifiedTextSymbolIndex,J.centerJustifiedTextSymbolIndex,J.leftJustifiedTextSymbolIndex].forEach(dt=>{dt>=0&&(e.text.placedSymbolArray.get(dt).hidden=nt||Fe?1:0)}),J.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(J.verticalPlacedTextSymbolIndex).hidden=nt||ke?1:0);const et=this.variableOffsets[J.crossTileID];et&&this.markUsedJustification(e,et.anchor,J,Se);const Ze=this.placedOrientations[J.crossTileID];Ze&&(this.markUsedJustification(e,"left",J,Ze),this.markUsedOrientation(e,Ze,J))}if(ue){const ze=ct(fe.icon),nt=!(B&&J.verticalPlacedIconSymbolIndex&&Fe);J.placedIconSymbolIndex>=0&&(X(e.icon,J.numIconVertices,nt?ze:Dt),e.icon.placedSymbolArray.get(J.placedIconSymbolIndex).hidden=fe.icon.isHidden()),J.verticalPlacedIconSymbolIndex>=0&&(X(e.icon,J.numVerticalIconVertices,nt?Dt:ze),e.icon.placedSymbolArray.get(J.verticalPlacedIconSymbolIndex).hidden=fe.icon.isHidden())}const Ee=W&&W.has(K)?W.get(K):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const ze=e.collisionArrays[K];if(ze){let nt=new c.P(0,0);if(ze.textBox||ze.verticalTextBox){let et=!0;if(E){const Ze=this.variableOffsets[ae];Ze?(nt=Fi(Ze.anchor,Ze.width,Ze.height,Ze.textOffset,Ze.textBoxScale),A&&nt._rotate(z?-this.transform.bearingInRadians:this.transform.bearingInRadians)):et=!1}if(ze.textBox||ze.verticalTextBox){let Ze;ze.textBox&&(Ze=Fe),ze.verticalTextBox&&(Ze=ke),Sa(e.textCollisionBox.collisionVertexArray,fe.text.placed,!et||Ze,Ee.text,nt.x,nt.y)}}if(ze.iconBox||ze.verticalIconBox){const et=!!(!ke&&ze.verticalIconBox);let Ze;ze.iconBox&&(Ze=et),ze.verticalIconBox&&(Ze=!et),Sa(e.iconCollisionBox.collisionVertexArray,fe.icon.placed,Ze,Ee.icon,B?nt.x:0,B?nt.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,n){const l=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*l>e}setStale(){this.stale=!0}}function Sa(p,e,n,l,u,f){l&&l.length!==0||(l=[0,0,0,0]);const y=l[0]-Or,w=l[1]-Or,S=l[2]-Or,M=l[3]-Or;p.emplaceBack(e?1:0,n?1:0,u||0,f||0,y,w),p.emplaceBack(e?1:0,n?1:0,u||0,f||0,S,w),p.emplaceBack(e?1:0,n?1:0,u||0,f||0,S,M),p.emplaceBack(e?1:0,n?1:0,u||0,f||0,y,M)}const Oe=Math.pow(2,25),we=Math.pow(2,24),He=Math.pow(2,17),Ke=Math.pow(2,16),yt=Math.pow(2,9),lt=Math.pow(2,8),ht=Math.pow(2,1);function ct(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;const e=p.placed?1:0,n=Math.floor(127*p.opacity);return n*Oe+e*we+n*He+e*Ke+n*yt+e*lt+n*ht+e}const Dt=0;class Nt{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,n,l,u,f){const y=this._bucketParts;for(;this._currentTileIndex<e.length;)if(n.getBucketParts(y,u,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,f())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,y.sort((w,S)=>w.sortKey-S.sortKey));this._currentPartIndex<y.length;)if(n.placeLayerBucketPart(y[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,f())return!0;return!1}}class ar{constructor(e,n,l,u,f,y,w,S){this.placement=new Ml(e,n,y,w,S),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=f,this._done=!1}isDone(){return this._done}continuePlacement(e,n,l){const u=me.now(),f=()=>!this._forceFullPlacement&&me.now()-u>2;for(;this._currentPlacementIndex>=0;){const y=n[e[this._currentPlacementIndex]],w=this.placement.collisionIndex.transform.zoom;if(y.type==="symbol"&&(!y.minzoom||y.minzoom<=w)&&(!y.maxzoom||y.maxzoom>w)){if(this._inProgressLayer||(this._inProgressLayer=new Nt(y)),this._inProgressLayer.continuePlacement(l[y.source],this.placement,this._showCollisionBoxes,y,f))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const At=512/c.Z/2;class mt{constructor(e,n,l){this.tileID=e,this.bucketInstanceId=l,this._symbolsByKey={};const u=new Map;for(let f=0;f<n.length;f++){const y=n.get(f),w=y.key,S=u.get(w);S?S.push(y):u.set(w,[y])}for(const[f,y]of u){const w={positions:y.map(S=>({x:Math.floor(S.anchorX*At),y:Math.floor(S.anchorY*At)})),crossTileIDs:y.map(S=>S.crossTileID)};if(w.positions.length>128){const S=new c.aF(w.positions.length,16,Uint16Array);for(const{x:M,y:E}of w.positions)S.add(M,E);S.finish(),delete w.positions,w.index=S}this._symbolsByKey[f]=w}}getScaledCoordinates(e,n){const{x:l,y:u,z:f}=this.tileID.canonical,{x:y,y:w,z:S}=n.canonical,M=At/Math.pow(2,S-f),E=(w*c.Z+e.anchorY)*M,A=u*c.Z*At;return{x:Math.floor((y*c.Z+e.anchorX)*M-l*c.Z*At),y:Math.floor(E-A)}}findMatches(e,n,l){const u=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z);for(let f=0;f<e.length;f++){const y=e.get(f);if(y.crossTileID)continue;const w=this._symbolsByKey[y.key];if(!w)continue;const S=this.getScaledCoordinates(y,n);if(w.index){const M=w.index.range(S.x-u,S.y-u,S.x+u,S.y+u).sort();for(const E of M){const A=w.crossTileIDs[E];if(!l[A]){l[A]=!0,y.crossTileID=A;break}}}else if(w.positions)for(let M=0;M<w.positions.length;M++){const E=w.positions[M],A=w.crossTileIDs[M];if(Math.abs(E.x-S.x)<=u&&Math.abs(E.y-S.y)<=u&&!l[A]){l[A]=!0,y.crossTileID=A;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class Bt{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ht{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const n=Math.round((e-this.lng)/360);if(n!==0)for(const l in this.indexes){const u=this.indexes[l],f={};for(const y in u){const w=u[y];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+n),f[w.tileID.key]=w}this.indexes[l]=f}this.lng=e}addBucket(e,n,l){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let f=0;f<n.symbolInstances.length;f++)n.symbolInstances.get(f).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const u=this.usedCrossTileIDs[e.overscaledZ];for(const f in this.indexes){const y=this.indexes[f];if(Number(f)>e.overscaledZ)for(const w in y){const S=y[w];S.tileID.isChildOf(e)&&S.findMatches(n.symbolInstances,e,u)}else{const w=y[e.scaledTo(Number(f)).key];w&&w.findMatches(n.symbolInstances,e,u)}}for(let f=0;f<n.symbolInstances.length;f++){const y=n.symbolInstances.get(f);y.crossTileID||(y.crossTileID=l.generate(),u[y.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new mt(e,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(e,n){for(const l of n.getCrossTileIDsLists())for(const u of l)delete this.usedCrossTileIDs[e][u]}removeStaleBuckets(e){let n=!1;for(const l in this.indexes){const u=this.indexes[l];for(const f in u)e[u[f].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,u[f]),delete u[f],n=!0)}return n}}class gt{constructor(){this.layerIndexes={},this.crossTileIDs=new Bt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,n,l){let u=this.layerIndexes[e.id];u===void 0&&(u=this.layerIndexes[e.id]=new Ht);let f=!1;const y={};u.handleWrapJump(l);for(const w of n){const S=w.getBucket(e);S&&e.id===S.layerIds[0]&&(S.bucketInstanceId||(S.bucketInstanceId=++this.maxBucketInstanceId),u.addBucket(w.tileID,S,this.crossTileIDs)&&(f=!0),y[S.bucketInstanceId]=!0)}return u.removeStaleBuckets(y)&&(f=!0),f}pruneUnusedLayers(e){const n={};e.forEach(l=>{n[l]=!0});for(const l in this.layerIndexes)n[l]||delete this.layerIndexes[l]}}var Ot="void main() {fragColor=vec4(1.0);}";const Rt={prelude:Et(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:Et("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:Et("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:Et(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:Et(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Et(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Et(Ot,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:Et(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:Et(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Et("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Et("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Et("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:Et(Ot,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:Et(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:Et(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:Et(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:Et(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Et(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Et(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Et(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Et(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;switch(u_method){case BASIC:
basic_hillshade(deriv);break;case COMBINED:
combined_hillshade(deriv);break;case IGOR:
igor_hillshade(deriv);break;case MULTIDIRECTIONAL:
multidirectional_hillshade(deriv);break;case STANDARD:
default:
standard_hillshade(deriv);break;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:Et(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Et(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Et(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Et(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Et(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:Et(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Et(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Et(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Et("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Et("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Et("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:Et("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:Et(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to TrackAsia Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:Et("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Et(p,e){const n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=e.match(/in ([\w]+) ([\w]+)/g),u=p.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),f=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=f?f.concat(u):u,w={};return{fragmentSource:p=p.replace(n,(S,M,E,A,z)=>(w[z]=!0,M==="define"?`
#ifndef HAS_UNIFORM_u_${z}
in ${E} ${A} ${z};
#else
uniform ${E} ${A} u_${z};
#endif
`:`
#ifdef HAS_UNIFORM_u_${z}
    ${E} ${A} ${z} = u_${z};
#endif
`)),vertexSource:e=e.replace(n,(S,M,E,A,z)=>{const B=A==="float"?"vec2":"vec4",O=z.match(/color/)?"color":B;return w[z]?M==="define"?`
#ifndef HAS_UNIFORM_u_${z}
uniform lowp float u_${z}_t;
in ${E} ${B} a_${z};
out ${E} ${A} ${z};
#else
uniform ${E} ${A} u_${z};
#endif
`:O==="vec4"?`
#ifndef HAS_UNIFORM_u_${z}
    ${z} = a_${z};
#else
    ${E} ${A} ${z} = u_${z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${z}
    ${z} = unpack_mix_${O}(a_${z}, u_${z}_t);
#else
    ${E} ${A} ${z} = u_${z};
#endif
`:M==="define"?`
#ifndef HAS_UNIFORM_u_${z}
uniform lowp float u_${z}_t;
in ${E} ${B} a_${z};
#else
uniform ${E} ${A} u_${z};
#endif
`:O==="vec4"?`
#ifndef HAS_UNIFORM_u_${z}
    ${E} ${A} ${z} = a_${z};
#else
    ${E} ${A} ${z} = u_${z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${z}
    ${E} ${A} ${z} = unpack_mix_${O}(a_${z}, u_${z}_t);
#else
    ${E} ${A} ${z} = u_${z};
#endif
`}),staticAttributes:l,staticUniforms:y}}class vs{constructor(e,n,l){this.vertexBuffer=e,this.indexBuffer=n,this.segments=l}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var vn=c.aG([{name:"a_pos",type:"Int16",components:2}]);const rs="#define PROJECTION_MERCATOR",Kt="mercator";class Pa{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Kt}get shaderDefine(){return rs}get shaderPreludeCode(){return Rt.projectionMercator}get vertexShaderPreludeCode(){return Rt.projectionMercator.vertexSource}get subdivisionGranularity(){return c.aH.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,n,l,u,f){if(this._cachedMesh)return this._cachedMesh;const y=new c.aI;y.emplaceBack(0,0),y.emplaceBack(c.Z,0),y.emplaceBack(0,c.Z),y.emplaceBack(c.Z,c.Z);const w=e.createVertexBuffer(y,vn.members),S=c.aJ.simpleSegment(0,0,4,2),M=new c.aK;M.emplaceBack(1,0,2),M.emplaceBack(1,2,3);const E=e.createIndexBuffer(M);return this._cachedMesh=new vs(w,E,S),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}class Ca{constructor(e=0,n=0,l=0,u=0){if(isNaN(e)||e<0||isNaN(n)||n<0||isNaN(l)||l<0||isNaN(u)||u<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=n,this.left=l,this.right=u}interpolate(e,n,l){return n.top!=null&&e.top!=null&&(this.top=c.B.number(e.top,n.top,l)),n.bottom!=null&&e.bottom!=null&&(this.bottom=c.B.number(e.bottom,n.bottom,l)),n.left!=null&&e.left!=null&&(this.left=c.B.number(e.left,n.left,l)),n.right!=null&&e.right!=null&&(this.right=c.B.number(e.right,n.right,l)),this}getCenter(e,n){const l=c.ae((this.left+e-this.right)/2,0,e),u=c.ae((this.top+n-this.bottom)/2,0,n);return new c.P(l,u)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Ca(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function zo(p,e){if(!p.renderWorldCopies||p.lngRange)return;const n=e.lng-p.center.lng;e.lng+=n>180?-360:n<-180?360:0}function ti(p){return Math.max(0,Math.floor(p))}class In{constructor(e,n,l,u,f,y){this._callbacks=e,this._tileSize=512,this._renderWorldCopies=y===void 0||!!y,this._minZoom=n||0,this._maxZoom=l||22,this._minPitch=u??0,this._maxPitch=f??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new c.Q(0,0),this._elevation=0,this._zoom=0,this._tileZoom=ti(this._zoom),this._scale=c.ac(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Ca,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,n,l){this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=ti(this._zoom),this._scale=c.ac(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new Ca(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!l&&e.autoCalculateNearFarZ,n&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){const n=c.aL(e,-180,180)*Math.PI/180;var l,u,f,y,w,S,M,E,A;this._bearingInRadians!==n&&(this._unmodified=!1,this._bearingInRadians=n,this._calcMatrices(),this._rotationMatrix=Q(),l=this._rotationMatrix,f=-this._bearingInRadians,y=(u=this._rotationMatrix)[0],w=u[1],S=u[2],M=u[3],E=Math.sin(f),A=Math.cos(f),l[0]=y*A+S*E,l[1]=w*A+M*E,l[2]=y*-E+S*A,l[3]=w*-E+M*A)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){const n=c.ae(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==n&&(this._unmodified=!1,this._pitchInRadians=n,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){const n=e/180*Math.PI;this._rollInRadians!==n&&(this._unmodified=!1,this._rollInRadians=n,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return c.aM(this._fovInRadians)}setFov(e){e=c.ae(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=c.ab(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){const n=this.getConstrained(this._center,e).zoom;this._zoom!==n&&(this._unmodified=!1,this._zoom=n,this._tileZoom=Math.max(0,Math.floor(n)),this._scale=c.ac(n),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,n){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=n,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,n,l){this._unmodified=!1,this._edgeInsets.interpolate(e,n,l),this._constrain(),this._calcMatrices()}resize(e,n,l=!0){this._width=e,this._height=n,l&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new mr([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-85.051129,c.af])}getConstrained(e,n){return this._callbacks.getConstrained(e,n)}getCameraQueryGeometry(e,n){if(n.length===1)return[n[0],e];{let l=e.x,u=e.y,f=e.x,y=e.y;for(const w of n)l=Math.min(l,w.x),u=Math.min(u,w.y),f=Math.max(f,w.x),y=Math.max(y,w.y);return[new c.P(l,u),new c.P(f,u),new c.P(f,y),new c.P(l,y),new c.P(l,u)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:n,zoom:l}=this.getConstrained(this.center,this.zoom);this.setCenter(n),this.setZoom(l),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=c.ad(new Float64Array(16));c.M(e,e,[this._width/2,-this._height/2,1]),c.L(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=c.ad(new Float64Array(16)),c.M(e,e,[1,-1,1]),c.L(e,e,[-1,-1,0]),c.M(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,n,l,u){const f=l!==void 0?l:this.bearing,y=u=u!==void 0?u:this.pitch,w=c.$.fromLngLat(e,n),S=-Math.cos(c.ab(y)),M=Math.sin(c.ab(y)),E=M*Math.sin(c.ab(f)),A=-M*Math.cos(c.ab(f));let z=this.elevation;const B=n-z;let O;S*B>=0||Math.abs(S)<.1?(O=1e4,z=n+O*S):O=-B/S;let X,W,K=c.aN(1,w.y),J=0;do{if(J+=1,J>10)break;W=O/K,X=new c.$(w.x+E*W,w.y+A*W),K=1/X.meterInMercatorCoordinateUnits()}while(Math.abs(O-W*K)>1e-12);return{center:X.toLngLat(),elevation:z,zoom:c.ah(this.height/2/Math.tan(this.fovInRadians/2)/W/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;const n=c.ag(1,this.center.lat)*this.worldSize,l=this.cameraToCenterDistance/n,u=c.$.fromLngLat(this.center,this.elevation),f=$(this.center,this.elevation,this.pitch,this.bearing,l);this._elevation=e;const y=this.calculateCenterFromCameraLngLatAlt(f.toLngLat(),c.aN(f.z,u.y),this.bearing,this.pitch);this._elevation=y.elevation,this._center=y.center,this.setZoom(y.zoom)}getCameraPoint(){const e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const e=c.ag(1,this.center.lat)*this.worldSize;return $(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];const n=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/n,e.canonical.y/n,1/n/c.Z,1/n/c.Z]}}class Kr{constructor(e,n){this.min=e,this.max=n,this.center=c.aO([],c.aP([],this.min,this.max),.5)}quadrant(e){const n=[e%2==0,e<2],l=c.aQ(this.min),u=c.aQ(this.max);for(let f=0;f<n.length;f++)l[f]=n[f]?this.min[f]:this.center[f],u[f]=n[f]?this.center[f]:this.max[f];return u[2]=this.max[2],new Kr(l,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let n=!0;for(let l=0;l<e.planes.length;l++){const u=this.intersectsPlane(e.planes[l]);if(u===0)return 0;u===1&&(n=!1)}return n?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let n=e[3],l=e[3];for(let u=0;u<3;u++)e[u]>0?(n+=e[u]*this.min[u],l+=e[u]*this.max[u]):(l+=e[u]*this.min[u],n+=e[u]*this.max[u]);return n>=0?2:l<0?0:1}}class An{distanceToTile2d(e,n,l,u){const f=u.distanceX([e,n]),y=u.distanceY([e,n]);return Math.hypot(f,y)}getWrap(e,n,l){return l}getTileAABB(e,n,l,u){var f,y;let w=l,S=l;if(u.terrain){const E=new c.Y(e.z,n,e.z,e.x,e.y),A=u.terrain.getMinMaxElevation(E);w=(f=A.minElevation)!==null&&f!==void 0?f:l,S=(y=A.maxElevation)!==null&&y!==void 0?y:l}const M=1<<e.z;return new Kr([n+e.x/M,e.y/M,w],[n+(e.x+1)/M,(e.y+1)/M,S])}allowVariableZoom(e,n){const l=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,u=c.ae(78.5-l/2,0,60);return!!n.terrain||e.pitch>u}allowWorldCopies(){return!0}recalculateCache(){}}class kr{constructor(e,n,l){this.points=e,this.planes=n,this.aabb=l}static fromInvProjectionMatrix(e,n=1,l=0){const u=Math.pow(2,l),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(M=>{const E=1/(M=c.at([],M,e))[3]/n*u;return c.aR(M,M,[E,E,1/M[3],E])}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(M=>{const E=c.aS([],f[M[0]],f[M[1]]),A=c.aS([],f[M[2]],f[M[1]]),z=c.aT([],c.aU([],E,A)),B=-c.aV(z,f[M[1]]);return z.concat(B)}),w=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],S=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const M of f)for(let E=0;E<3;E++)w[E]=Math.min(w[E],M[E]),S[E]=Math.max(S[E],M[E]);return new kr(f,y,new Kr(w,S))}}class Ro{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,n,l){return this._helper.interpolatePadding(e,n,l)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,n,l=!0){this._helper.resize(e,n,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,n){this._helper.overrideNearFarZ(e,n)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,n){}constructor(e,n,l,u,f){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new In({calcMatrices:()=>{this._calcMatrices()},getConstrained:(y,w)=>this.getConstrained(y,w)},e,n,l,u,f),this._coveringTilesDetailsProvider=new An}clone(){const e=new Ro;return e.apply(this),e}apply(e,n,l){this._helper.apply(e,n,l)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){const n=[new c.aW(0,e)];if(this._helper._renderWorldCopies){const l=this.screenPointToMercatorCoordinate(new c.P(0,0)),u=this.screenPointToMercatorCoordinate(new c.P(this._helper._width,0)),f=this.screenPointToMercatorCoordinate(new c.P(this._helper._width,this._helper._height)),y=this.screenPointToMercatorCoordinate(new c.P(0,this._helper._height)),w=Math.floor(Math.min(l.x,u.x,f.x,y.x)),S=Math.floor(Math.max(l.x,u.x,f.x,y.x)),M=1;for(let E=w-M;E<=S+M;E++)E!==0&&n.push(new c.aW(E,e))}return n}getCameraFrustum(){return kr.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){const n=this.screenPointToLocation(this.centerPoint,e),l=e?e.getElevationForLngLatZoom(n,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(l)}setLocationAtPoint(e,n){const l=c.ag(this.elevation,this.center.lat),u=this.screenPointToMercatorCoordinateAtZ(n,l),f=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,l),y=c.$.fromLngLat(e),w=new c.$(y.x-(u.x-f.x),y.y-(u.y-f.y));this.setCenter(w==null?void 0:w.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,n){return n?this.coordinatePoint(c.$.fromLngLat(e),n.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(c.$.fromLngLat(e))}screenPointToLocation(e,n){var l;return(l=this.screenPointToMercatorCoordinate(e,n))===null||l===void 0?void 0:l.toLngLat()}screenPointToMercatorCoordinate(e,n){if(n){const l=n.pointCoordinate(e);if(l!=null)return l}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,n){const l=n||0,u=[e.x,e.y,0,1],f=[e.x,e.y,1,1];c.at(u,u,this._pixelMatrixInverse),c.at(f,f,this._pixelMatrixInverse);const y=u[3],w=f[3],S=u[1]/y,M=f[1]/w,E=u[2]/y,A=f[2]/w,z=E===A?0:(l-E)/(A-E);return new c.$(c.B.number(u[0]/y,f[0]/w,z)/this.worldSize,c.B.number(S,M,z)/this.worldSize,l)}coordinatePoint(e,n=0,l=this._pixelMatrix){const u=[e.x*this.worldSize,e.y*this.worldSize,n,1];return c.at(u,u,l),new c.P(u[0]/u[3],u[1]/u[3])}getBounds(){const e=Math.max(0,this._helper._height/2-ge(this));return new mr().extend(this.screenPointToLocation(new c.P(0,e))).extend(this.screenPointToLocation(new c.P(this._helper._width,e))).extend(this.screenPointToLocation(new c.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new c.P(0,this._helper._height)))}isPointOnMapSurface(e,n){return n?n.pointCoordinate(e)!=null:e.y>this.height/2-ge(this)}calculatePosMatrix(e,n=!1,l){var u;const f=(u=e.key)!==null&&u!==void 0?u:c.aX(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),y=n?this._alignedPosMatrixCache:this._posMatrixCache;if(y.has(f)){const M=y.get(f);return l?M.f32:M.f64}const w=V(e,this.worldSize);c.N(w,n?this._alignedProjMatrix:this._viewProjMatrix,w);const S={f64:w,f32:new Float32Array(w)};return y.set(f,S),l?S.f32:S.f64}calculateFogMatrix(e){const n=e.key,l=this._fogMatrixCacheF32;if(l.has(n))return l.get(n);const u=V(e,this.worldSize);return c.N(u,this._fogMatrix,u),l.set(n,new Float32Array(u)),l.get(n)}getConstrained(e,n){n=c.ae(+n,this.minZoom,this.maxZoom);const l={center:new c.Q(e.lng,e.lat),zoom:n};let u=this._helper._lngRange;this._helper._renderWorldCopies||u!==null||(u=[-179.9999999999,180-1e-10]);const f=this.tileSize*c.ac(l.zoom);let y=0,w=f,S=0,M=f,E=0,A=0;const{x:z,y:B}=this.size;if(this._helper._latRange){const oe=this._helper._latRange;y=c.S(oe[1])*f,w=c.S(oe[0])*f,w-y<B&&(E=B/(w-y))}u&&(S=c.aL(c.U(u[0])*f,0,f),M=c.aL(c.U(u[1])*f,0,f),M<S&&(M+=f),M-S<z&&(A=z/(M-S)));const{x:O,y:X}=En(f,e);let W,K;const J=Math.max(A||0,E||0);if(J){const oe=new c.P(A?(M+S)/2:O,E?(w+y)/2:X);return l.center=xi(f,oe).wrap(),l.zoom+=c.ah(J),l}if(this._helper._latRange){const oe=B/2;X-oe<y&&(K=y+oe),X+oe>w&&(K=w-oe)}if(u){const oe=(S+M)/2;let se=O;this._helper._renderWorldCopies&&(se=c.aL(O,oe-f/2,oe+f/2));const ae=z/2;se-ae<S&&(W=S+ae),se+ae>M&&(W=M-ae)}if(W!==void 0||K!==void 0){const oe=new c.P(W??O,K??X);l.center=xi(f,oe).wrap()}return l}calculateCenterFromCameraLngLatAlt(e,n,l,u){return this._helper.calculateCenterFromCameraLngLatAlt(e,n,l,u)}_calculateNearFarZIfNeeded(e,n,l){if(!this._helper.autoCalculateNearFarZ)return;const u=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),f=e-u*this._helper._pixelPerMeter/Math.cos(n),y=u<0?f:e,w=Math.PI/2+this.pitchInRadians,S=c.ab(this.fov)*(Math.abs(Math.cos(c.ab(this.roll)))*this.height+Math.abs(Math.sin(c.ab(this.roll)))*this.width)/this.height*(.5+l.y/this.height),M=Math.sin(S)*y/Math.sin(c.ae(Math.PI-w-S,.01,Math.PI-.01)),E=ge(this),A=Math.atan(E/this._helper.cameraToCenterDistance),z=c.ab(.75),B=A>z?2*A*(.5+l.y/(2*E)):z,O=Math.sin(B)*y/Math.sin(c.ae(Math.PI-w-B,.01,Math.PI-.01)),X=Math.min(M,O);this._helper._farZ=1.01*(Math.cos(Math.PI/2-n)*X+y),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const e=this.centerOffset,n=En(this.worldSize,this.center),l=n.x,u=n.y;this._helper._pixelPerMeter=c.ag(1,this.center.lat)*this.worldSize;const f=c.ab(Math.min(this.pitch,qn)),y=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(f));let w;this._calculateNearFarZIfNeeded(y,f,e),w=new Float64Array(16),c.aY(w,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),c.an(this._invProjMatrix,w),w[8]=2*-e.x/this._helper._width,w[9]=2*e.y/this._helper._height,this._projectionMatrix=c.aZ(w),c.M(w,w,[1,-1,1]),c.L(w,w,[0,0,-this._helper.cameraToCenterDistance]),c.a_(w,w,-this.rollInRadians),c.a$(w,w,this.pitchInRadians),c.a_(w,w,-this.bearingInRadians),c.L(w,w,[-l,-u,0]),this._mercatorMatrix=c.M([],w,[this.worldSize,this.worldSize,this.worldSize]),c.M(w,w,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=c.N(new Float64Array(16),this.clipSpaceToPixelsMatrix,w),c.L(w,w,[0,0,-this.elevation]),this._viewProjMatrix=w,this._invViewProjMatrix=c.an([],w);const S=[0,0,-1,1];c.at(S,S,this._invViewProjMatrix),this._cameraPosition=[S[0]/S[3],S[1]/S[3],S[2]/S[3]],this._fogMatrix=new Float64Array(16),c.aY(this._fogMatrix,this.fovInRadians,this.width/this.height,y,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,c.M(this._fogMatrix,this._fogMatrix,[1,-1,1]),c.L(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),c.a_(this._fogMatrix,this._fogMatrix,-this.rollInRadians),c.a$(this._fogMatrix,this._fogMatrix,this.pitchInRadians),c.a_(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),c.L(this._fogMatrix,this._fogMatrix,[-l,-u,0]),c.M(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),c.L(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=c.N(new Float64Array(16),this.clipSpaceToPixelsMatrix,w);const M=this._helper._width%2/2,E=this._helper._height%2/2,A=Math.cos(this.bearingInRadians),z=Math.sin(-this.bearingInRadians),B=l-Math.round(l)+A*M+z*E,O=u-Math.round(u)+A*E+z*M,X=new Float64Array(w);if(c.L(X,X,[B>.5?B-1:B,O>.5?O-1:O,0]),this._alignedProjMatrix=X,w=c.an(new Float64Array(16),this._pixelMatrix),!w)throw new Error("failed to invert matrix");this._pixelMatrixInverse=w,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const e=this.screenPointToMercatorCoordinate(new c.P(0,0)),n=[e.x*this.worldSize,e.y*this.worldSize,0,1];return c.at(n,n,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const e=c.ag(1,this.center.lat)*this.worldSize;return $(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,n){const l=c.$.fromLngLat(e),u=[l.x*this.worldSize,l.y*this.worldSize,n,1];return c.at(u,u,this._viewProjMatrix),u[2]/u[3]}getProjectionData(e){const{overscaledTileID:n,aligned:l,applyTerrainMatrix:u}=e,f=this._helper.getMercatorTileCoordinates(n),y=n?this.calculatePosMatrix(n,l,!0):null;let w;return w=n&&n.terrainRttPosMatrix32f&&u?n.terrainRttPosMatrix32f:y||c.b0(),{mainMatrix:w,tileMercatorCoords:f,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:w}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,n,l){return 1}transformLightDirection(e){return c.aQ(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,n,l,u){const f=this.calculatePosMatrix(l);let y;u?(y=[e,n,u(e,n),1],c.at(y,y,f)):(y=[e,n,0,1],_s(y,y,f));const w=y[3];return{point:new c.P(y[0]/w,y[1]/w),signedDistanceFromCamera:w,isOccluded:!1}}populateCache(e){for(const n of e)this.calculatePosMatrix(n)}getMatrixForModel(e,n){const l=c.$.fromLngLat(e,n),u=l.meterInMercatorCoordinateUnits(),f=c.b1();return c.L(f,f,[l.x,l.y,l.z]),c.a_(f,f,Math.PI),c.a$(f,f,Math.PI/2),c.M(f,f,[-u,u,u]),f}getProjectionDataForCustomLayer(e=!0){const n=new c.Y(0,0,0,0,0),l=this.getProjectionData({overscaledTileID:n,applyGlobeMatrix:e}),u=V(n,this.worldSize);c.N(u,this._viewProjMatrix,u),l.tileMercatorCoords=[0,0,1,1];const f=[c.Z,c.Z,this.worldSize/this._helper.pixelsPerMeter],y=c.b2();return c.M(y,u,f),l.fallbackMatrix=y,l.mainMatrix=y,l}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function Wn(){c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function ui(p){if(p.useSlerp)if(p.k<1){const e=c.b3(p.startEulerAngles.roll,p.startEulerAngles.pitch,p.startEulerAngles.bearing),n=c.b3(p.endEulerAngles.roll,p.endEulerAngles.pitch,p.endEulerAngles.bearing),l=new Float64Array(4);c.b4(l,e,n,p.k);const u=c.b5(l);p.tr.setRoll(u.roll),p.tr.setPitch(u.pitch),p.tr.setBearing(u.bearing)}else p.tr.setRoll(p.endEulerAngles.roll),p.tr.setPitch(p.endEulerAngles.pitch),p.tr.setBearing(p.endEulerAngles.bearing);else p.tr.setRoll(c.B.number(p.startEulerAngles.roll,p.endEulerAngles.roll,p.k)),p.tr.setPitch(c.B.number(p.startEulerAngles.pitch,p.endEulerAngles.pitch,p.k)),p.tr.setBearing(c.B.number(p.startEulerAngles.bearing,p.endEulerAngles.bearing,p.k))}function ri(p,e,n,l,u){const f=u.padding,y=En(u.worldSize,n.getNorthWest()),w=En(u.worldSize,n.getNorthEast()),S=En(u.worldSize,n.getSouthEast()),M=En(u.worldSize,n.getSouthWest()),E=c.ab(-l),A=y.rotate(E),z=w.rotate(E),B=S.rotate(E),O=M.rotate(E),X=new c.P(Math.max(A.x,z.x,O.x,B.x),Math.max(A.y,z.y,O.y,B.y)),W=new c.P(Math.min(A.x,z.x,O.x,B.x),Math.min(A.y,z.y,O.y,B.y)),K=X.sub(W),J=(u.width-(f.left+f.right+e.left+e.right))/K.x,oe=(u.height-(f.top+f.bottom+e.top+e.bottom))/K.y;if(oe<0||J<0)return void Wn();const se=Math.min(c.ah(u.scale*Math.min(J,oe)),p.maxZoom),ae=c.P.convert(p.offset),fe=new c.P((e.left-e.right)/2,(e.top-e.bottom)/2).rotate(c.ab(l)),ue=ae.add(fe).mult(u.scale/c.ac(se));return{center:xi(u.worldSize,y.add(S).div(2).sub(ue)),zoom:se,bearing:l}}class Ma{get useGlobeControls(){return!1}handlePanInertia(e,n){return{easingOffset:e,easingCenter:n.center}}handleMapControlsRollPitchBearingZoom(e,n){e.bearingDelta&&n.setBearing(n.bearing+e.bearingDelta),e.pitchDelta&&n.setPitch(n.pitch+e.pitchDelta),e.rollDelta&&n.setRoll(n.roll+e.rollDelta),e.zoomDelta&&n.setZoom(n.zoom+e.zoomDelta)}handleMapControlsPan(e,n,l){e.around.distSqr(n.centerPoint)<.01||n.setLocationAtPoint(l,e.around)}cameraForBoxAndBearing(e,n,l,u,f){return ri(e,n,l,u,f)}handleJumpToCenterZoom(e,n){e.zoom!==(n.zoom!==void 0?+n.zoom:e.zoom)&&e.setZoom(+n.zoom),n.center!==void 0&&e.setCenter(c.Q.convert(n.center))}handleEaseTo(e,n){const l=e.zoom,u=e.padding,f={roll:e.roll,pitch:e.pitch,bearing:e.bearing},y={roll:n.roll===void 0?e.roll:n.roll,pitch:n.pitch===void 0?e.pitch:n.pitch,bearing:n.bearing===void 0?e.bearing:n.bearing},w=n.zoom!==void 0,S=!e.isPaddingEqual(n.padding);let M=!1;const E=w?+n.zoom:e.zoom;let A=e.centerPoint.add(n.offsetAsPoint);const z=e.screenPointToLocation(A),{center:B,zoom:O}=e.getConstrained(c.Q.convert(n.center||z),E??l);zo(e,B);const X=En(e.worldSize,z),W=En(e.worldSize,B).sub(X),K=c.ac(O-l);return M=O!==l,{easeFunc:J=>{if(M&&e.setZoom(c.B.number(l,O,J)),c.b6(f,y)||ui({startEulerAngles:f,endEulerAngles:y,tr:e,k:J,useSlerp:f.roll!=y.roll}),S&&(e.interpolatePadding(u,n.padding,J),A=e.centerPoint.add(n.offsetAsPoint)),n.around)e.setLocationAtPoint(n.around,n.aroundPoint);else{const oe=c.ac(e.zoom-l),se=O>l?Math.min(2,K):Math.max(.5,K),ae=Math.pow(se,1-J),fe=xi(e.worldSize,X.add(W.mult(J*ae)).mult(oe));e.setLocationAtPoint(e.renderWorldCopies?fe.wrap():fe,A)}},isZooming:M,elevationCenter:B}}handleFlyTo(e,n){const l=n.zoom!==void 0,u=e.zoom,f=e.getConstrained(c.Q.convert(n.center||n.locationAtOffset),l?+n.zoom:u),y=f.center,w=f.zoom;zo(e,y);const S=En(e.worldSize,n.locationAtOffset),M=En(e.worldSize,y).sub(S),E=M.mag(),A=c.ac(w-u);let z;if(n.minZoom!==void 0){const B=Math.min(+n.minZoom,u,w),O=e.getConstrained(y,B).zoom;z=c.ac(O-u)}return{easeFunc:(B,O,X,W)=>{e.setZoom(B===1?w:u+c.ah(O));const K=B===1?y:xi(e.worldSize,S.add(M.mult(X)).mult(O));e.setLocationAtPoint(e.renderWorldCopies?K.wrap():K,W)},scaleOfZoom:A,targetCenter:y,scaleOfMinZoom:z,pixelPathLength:E}}}class vr{constructor(e,n,l){this.blendFunction=e,this.blendColor=n,this.mask=l}}vr.Replace=[1,0],vr.disabled=new vr(vr.Replace,c.b7.transparent,[!1,!1,!1,!1]),vr.unblended=new vr(vr.Replace,c.b7.transparent,[!0,!0,!0,!0]),vr.alphaBlended=new vr([1,771],c.b7.transparent,[!0,!0,!0,!0]);const Nr=2305;class ir{constructor(e,n,l){this.enable=e,this.mode=n,this.frontFace=l}}ir.disabled=new ir(!1,1029,Nr),ir.backCCW=new ir(!0,1029,Nr),ir.frontCCW=new ir(!0,1028,Nr);class jt{constructor(e,n,l){this.func=e,this.mask=n,this.range=l}}jt.ReadOnly=!1,jt.ReadWrite=!0,jt.disabled=new jt(519,jt.ReadOnly,[0,1]);const Do=7680;class Vt{constructor(e,n,l,u,f,y){this.test=e,this.ref=n,this.mask=l,this.fail=u,this.depthFail=f,this.pass=y}}Vt.disabled=new Vt({func:519,mask:0},0,0,Do,Do,Do);const kl=new WeakMap;function Bn(p){var e;if(kl.has(p))return kl.get(p);{const n=(e=p.getParameter(p.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return kl.set(p,n),n}}class au{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;const n=e.context,l=n.gl;this._texFormat=l.RGBA,this._texType=l.UNSIGNED_BYTE;const u=new c.aI;u.emplaceBack(-1,-1),u.emplaceBack(2,-1),u.emplaceBack(-1,2);const f=new c.aK;f.emplaceBack(0,1,2),this._fullscreenTriangle=new vs(n.createVertexBuffer(u,vn.members),n.createIndexBuffer(f),c.aJ.simpleSegment(0,0,u.length,f.length)),this._resultBuffer=new Uint8Array(4),n.activeTexture.set(l.TEXTURE1);const y=l.createTexture();l.bindTexture(l.TEXTURE_2D,y),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST),l.texImage2D(l.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=n.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(y),Bn(l)&&(this._pbo=l.createBuffer(),l.bindBuffer(l.PIXEL_PACK_BUFFER,this._pbo),l.bufferData(l.PIXEL_PACK_BUFFER,4,l.STREAM_READ),l.bindBuffer(l.PIXEL_PACK_BUFFER,null))}destroy(){const e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,n){const l=this._updateCount;return this._readbackQueue?l>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():l>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,n),this._updateCount++,this._measuredError}_bindFramebuffer(){const e=this._cachedRenderContext.context,n=e.gl;e.activeTexture.set(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,n){const l=this._cachedRenderContext.context,u=l.gl;if(this._bindFramebuffer(),l.viewport.set([0,0,this._texWidth,this._texHeight]),l.clear({color:c.b7.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(l,u.TRIANGLES,jt.disabled,Vt.disabled,vr.unblended,ir.disabled,((f,y)=>({u_input:f,u_output_expected:y}))(e,n),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Bn(u)){u.bindBuffer(u.PIXEL_PACK_BUFFER,this._pbo),u.readBuffer(u.COLOR_ATTACHMENT0),u.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),u.bindBuffer(u.PIXEL_PACK_BUFFER,null);const f=u.fenceSync(u.SYNC_GPU_COMMANDS_COMPLETE,0);u.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:f}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Bn(e)){const n=e.clientWaitSync(this._readbackQueue.sync,0,0);if(n===e.WAIT_FAILED)return c.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(n===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=au._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let n=0;return n+=e[0]/256,n+=e[1]/65536,n+=e[2]/16777216,e[3]<127&&(n=-n),n/128}}const lu=c.Z/128;function ka(p,e){const n=p.granularity!==void 0?Math.max(p.granularity,1):1,l=n+(p.generateBorders?2:0),u=n+(p.extendToNorthPole||p.generateBorders?1:0)+(p.extendToSouthPole||p.generateBorders?1:0),f=l+1,y=u+1,w=p.generateBorders?-1:0,S=p.generateBorders||p.extendToNorthPole?-1:0,M=n+(p.generateBorders?1:0),E=n+(p.generateBorders||p.extendToSouthPole?1:0),A=f*y,z=l*u*6,B=f*y>65536;if(B&&e==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const O=B||e==="32bit",X=new Int16Array(2*A);let W=0;for(let oe=S;oe<=E;oe++)for(let se=w;se<=M;se++){let ae=se/n*c.Z;se===-1&&(ae=-64),se===n+1&&(ae=c.Z+lu);let fe=oe/n*c.Z;oe===-1&&(fe=p.extendToNorthPole?c.b9:-64),oe===n+1&&(fe=p.extendToSouthPole?c.ba:c.Z+lu),X[W++]=ae,X[W++]=fe}const K=O?new Uint32Array(z):new Uint16Array(z);let J=0;for(let oe=0;oe<u;oe++)for(let se=0;se<l;se++){const ae=se+1+oe*f,fe=se+(oe+1)*f,ue=se+1+(oe+1)*f;K[J++]=se+oe*f,K[J++]=fe,K[J++]=ae,K[J++]=ae,K[J++]=fe,K[J++]=ue}return{vertices:X.buffer.slice(0),indices:K.buffer.slice(0),uses32bitIndices:O}}const Lo=new c.aH({fill:new c.bb(128,2),line:new c.bb(512,0),tile:new c.bb(128,32),stencil:new c.bb(128,1),circle:3});class Ea{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Rt.projectionGlobe}get vertexShaderPreludeCode(){return Rt.projectionMercator.vertexSource}get subdivisionGranularity(){return Lo}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new au(e));const n=c.S(this._errorQueryLatitudeDegrees),l=2*Math.atan(Math.exp(Math.PI-n*Math.PI*2))-.5*Math.PI,u=this._errorMeasurement.updateErrorLoop(n,l),f=me.now();u!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=u,this._errorMeasurementLastChangeTime=f);const y=Math.min(Math.max((f-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=c.bc(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,c.bd(y))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,n,l,u,f){const y=(f==="stencil"?Lo.stencil:Lo.tile).getGranularityForZoomLevel(n.z);return this._getMesh(e,{granularity:y,generateBorders:l,extendToNorthPole:n.y===0&&u,extendToSouthPole:n.y===(1<<n.z)-1&&u})}_getMesh(e,n){const l=this._getMeshKey(n);if(l in this._tileMeshCache)return this._tileMeshCache[l];const u=function(f,y){const w=ka(y,"16bit"),S=c.aI.deserialize({arrayBuffer:w.vertices,length:w.vertices.byteLength/2/2}),M=c.aK.deserialize({arrayBuffer:w.indices,length:w.indices.byteLength/2/3});return new vs(f.createVertexBuffer(S,vn.members),f.createIndexBuffer(M),c.aJ.simpleSegment(0,0,S.length,M.length))}(e,n);return this._tileMeshCache[l]=u,u}recalculate(e){}hasTransition(){const e=me.now();let n=!1;return n=n||(e-this._errorMeasurementLastChangeTime)/1e3<.7,n=n||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,n}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}const cu=new c.r({type:new c.D(c.v.projection.type)});class El extends c.E{constructor(e){super(),this._transitionable=new c.T(cu),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.C(0)),this._mercatorProjection=new Pa,this._verticalPerspectiveProjection=new Ea}get transitionState(){const e=this.properties.get("type");if(typeof e=="string"&&e==="mercator")return 0;if(typeof e=="string"&&e==="vertical-perspective")return 1;if(e instanceof c.be){if(e.from==="vertical-perspective"&&e.to==="mercator")return 1-e.transition;if(e.from==="mercator"&&e.to==="vertical-perspective")return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,n,l,u,f){return this.currentProjection.getMeshFromTileID(e,n,l,u,f)}setProjection(e){this._transitionable.setValue("type",(e==null?void 0:e.type)||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function Ia(p){const e=co(p.worldSize,p.center.lat);return 2*Math.PI*e}function lo(p,e,n,l,u){const f=1/(1<<u),y=e/c.Z*f+l*f,w=c.bg((p/c.Z*f+n*f)*Math.PI*2+Math.PI,2*Math.PI),S=2*Math.atan(Math.exp(Math.PI-y*Math.PI*2))-.5*Math.PI,M=Math.cos(S),E=new Float64Array(3);return E[0]=Math.sin(w)*M,E[1]=Math.sin(S),E[2]=Math.cos(w)*M,E}function xn(p){return function(e,n){const l=Math.cos(n),u=new Float64Array(3);return u[0]=Math.sin(e)*l,u[1]=Math.sin(n),u[2]=Math.cos(e)*l,u}(p.lng*Math.PI/180,p.lat*Math.PI/180)}function co(p,e){return p/(2*Math.PI)/Math.cos(e*Math.PI/180)}function Aa(p){const e=Math.asin(p[1])/Math.PI*180,n=Math.sqrt(p[0]*p[0]+p[2]*p[2]);if(n>1e-6){const l=p[0]/n,u=Math.acos(p[2]/n),f=(l>0?u:-u)/Math.PI*180;return new c.Q(c.aL(f,-180,180),e)}return new c.Q(0,e)}function Os(p){return Math.cos(p*Math.PI/180)}function bn(p,e){const n=Os(p),l=Os(e);return c.ah(l/n)}function Il(p,e){const n=p.rotate(e.bearingInRadians),l=e.zoom+bn(e.center.lat,0),u=c.bc(1/Os(e.center.lat),1/Os(Math.min(Math.abs(e.center.lat),60)),c.bf(l,7,3,0,1)),f=360/Ia({worldSize:e.worldSize,center:{lat:e.center.lat}});return new c.Q(e.center.lng-n.x*f*u,c.ae(e.center.lat+n.y*f,-85.051129,c.af))}function Al(p){const e=.5*p,n=Math.sin(e),l=Math.cos(e);return Math.log(n+l)-Math.log(l-n)}function ad(p,e,n,l){const u=p.lat+n*l;if(Math.abs(n)>1){const f=(Math.sign(p.lat+n)!==Math.sign(p.lat)?-Math.abs(p.lat):Math.abs(p.lat))*Math.PI/180,y=Math.abs(p.lat+n)*Math.PI/180,w=Al(f+l*(y-f)),S=Al(f),M=Al(y);return new c.Q(p.lng+e*((w-S)/(M-S)),u)}return new c.Q(p.lng+e*l,u)}class Of{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._aabbFactory=e}recalculateCache(){if(!this._hadAnyChanges)return;const e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileAABB(e,n,l,u){const f=`${e.z}_${e.x}_${e.y}`,y=this._cache.get(f);if(y)return y;const w=this._cachePrevious.get(f);if(w)return this._cache.set(f,w),w;const S=this._aabbFactory(e,n,l,u);return this._cache.set(f,S),this._hadAnyChanges=!0,S}}function On(p,e,n){const l=p-e;return l<0?-l:Math.max(0,l-n)}function za(p,e,n,l,u){const f=p-n;let y;return y=f<0?Math.min(-f,1+f-u):f>1?Math.min(Math.max(f-u,0),1-f):0,Math.max(y,On(e,l,u))}class ns{constructor(){this._aabbCache=new Of(this._computeTileAABB)}recalculateCache(){this._aabbCache.recalculateCache()}distanceToTile2d(e,n,l,u){const f=1<<l.z,y=1/f,w=l.x/f,S=l.y/f;let M=2;return M=Math.min(M,za(e,n,w,S,y)),M=Math.min(M,za(e,n,w+.5,-S-y,y)),M=Math.min(M,za(e,n,w+.5,2-S-y,y)),M}getWrap(e,n,l){const u=1<<n.z,f=1/u,y=n.x/u,w=On(e.x,y,f),S=On(e.x,y-1,f),M=On(e.x,y+1,f),E=Math.min(w,S,M);return E===M?1:E===S?-1:0}allowVariableZoom(e,n){return Te(e,n)>4}allowWorldCopies(){return!1}getTileAABB(e,n,l,u){return this._aabbCache.getTileAABB(e,n,l,u)}_computeTileAABB(e,n,l,u){if(e.z<=0)return new Kr([-1,-1,-1],[1,1,1]);if(e.z===1)return new Kr([e.x===0?-1:0,e.y===0?0:-1,-1],[e.x===0?0:1,e.y===0?1:0,1]);{const f=[lo(0,0,e.x,e.y,e.z),lo(c.Z,0,e.x,e.y,e.z),lo(c.Z,c.Z,e.x,e.y,e.z),lo(0,c.Z,e.x,e.y,e.z)],y=[1,1,1],w=[-1,-1,-1];for(const S of f)for(let M=0;M<3;M++)y[M]=Math.min(y[M],S[M]),w[M]=Math.max(w[M],S[M]);if(e.y===0||e.y===(1<<e.z)-1){const S=[0,e.y===0?1:-1,0];for(let M=0;M<3;M++)y[M]=Math.min(y[M],S[M]),w[M]=Math.max(w[M],S[M])}return new Kr(y,w)}}}class uo{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,n,l){return this._helper.interpolatePadding(e,n,l)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,n){this._helper.resize(e,n)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,n){this._helper.overrideNearFarZ(e,n)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(){this._cachedClippingPlane=c.bk(),this._projectionMatrix=c.b1(),this._globeViewProjMatrix32f=c.b0(),this._globeViewProjMatrixNoCorrection=c.b1(),this._globeViewProjMatrixNoCorrectionInverted=c.b1(),this._globeProjMatrixInverted=c.b1(),this._cameraPosition=c.bh(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new In({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,n)=>this.getConstrained(e,n)}),this._coveringTilesDetailsProvider=new ns}clone(){const e=new uo;return e.apply(this),e}apply(e,n){this._globeLatitudeErrorCorrectionRadians=n||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const e=c.bh();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){const{overscaledTileID:n,applyGlobeMatrix:l}=e,u=this._helper.getMercatorTileCoordinates(n);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:u,clippingPlane:this._cachedClippingPlane,projectionTransition:l?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){const n=this.pitchInRadians,l=this.cameraToCenterDistance/e,u=Math.sin(n)*l,f=Math.cos(n)*l+1,y=1/Math.sqrt(u*u+f*f)*1;let w=-u,S=f;const M=Math.sqrt(w*w+S*S);w/=M,S/=M;const E=[0,w,S];c.bl(E,E,[0,0,0],-this.bearingInRadians),c.bm(E,E,[0,0,0],-1*this.center.lat*Math.PI/180),c.bn(E,E,[0,0,0],this.center.lng*Math.PI/180);const A=1/c.bo(E);return c.aO(E,E,A),[...E,-y*A]}isLocationOccluded(e){return!this.isSurfacePointVisible(xn(e))}transformLightDirection(e){const n=this._helper._center.lng*Math.PI/180,l=this._helper._center.lat*Math.PI/180,u=Math.cos(l),f=[Math.sin(n)*u,Math.sin(l),Math.cos(n)*u],y=[f[2],0,-f[0]],w=[0,0,0];c.aU(w,y,f),c.aT(y,y),c.aT(w,w);const S=[0,0,0];return c.aT(S,[y[0]*e[0]+w[0]*e[1]+f[0]*e[2],y[1]*e[0]+w[1]*e[1]+f[1]*e[2],y[2]*e[0]+w[2]*e[1]+f[2]*e[2]]),S}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,n,l){const u=function(w,S,M){const E=1/(1<<M.z);return new c.$(w/c.Z*E+M.x*E,S/c.Z*E+M.y*E)}(e,n,l.canonical),f=(y=u.y,[c.bg(u.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-y*Math.PI*2))-.5*Math.PI]);var y;return this.getCircleRadiusCorrection()/Math.cos(f[1])}projectTileCoordinates(e,n,l,u){const f=l.canonical,y=lo(e,n,f.x,f.y,f.z),w=1+(u?u(e,n):0)/c.bu,S=[y[0]*w,y[1]*w,y[2]*w,1];c.at(S,S,this._globeViewProjMatrixNoCorrection);const M=this._cachedClippingPlane,E=M[0]*y[0]+M[1]*y[1]+M[2]*y[2]+M[3]<0;return{point:new c.P(S[0]/S[3],S[1]/S[3]),signedDistanceFromCamera:S[3],isOccluded:E}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const e=co(this.worldSize,this.center.lat),n=c.b2(),l=c.b2();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),c.aY(n,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const u=this.centerOffset;n[8]=2*-u.x/this._helper._width,n[9]=2*u.y/this._helper._height,this._projectionMatrix=c.aZ(n),this._globeProjMatrixInverted=c.b2(),c.an(this._globeProjMatrixInverted,n),c.L(n,n,[0,0,-this.cameraToCenterDistance]),c.a_(n,n,this.rollInRadians),c.a$(n,n,-this.pitchInRadians),c.a_(n,n,this.bearingInRadians),c.L(n,n,[0,0,-e]);const f=c.bh();f[0]=e,f[1]=e,f[2]=e,c.a$(l,n,this.center.lat*Math.PI/180),c.bp(l,l,-this.center.lng*Math.PI/180),c.M(l,l,f),this._globeViewProjMatrixNoCorrection=l,c.a$(n,n,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),c.bp(n,n,-this.center.lng*Math.PI/180),c.M(n,n,f),this._globeViewProjMatrix32f=new Float32Array(n),this._globeViewProjMatrixNoCorrectionInverted=c.b2(),c.an(this._globeViewProjMatrixNoCorrectionInverted,l);const y=c.bh();this._cameraPosition=c.bh(),this._cameraPosition[2]=this.cameraToCenterDistance/e,c.bl(this._cameraPosition,this._cameraPosition,y,-this.rollInRadians),c.bm(this._cameraPosition,this._cameraPosition,y,this.pitchInRadians),c.bl(this._cameraPosition,this._cameraPosition,y,-this.bearingInRadians),c.aP(this._cameraPosition,this._cameraPosition,[0,0,1]),c.bm(this._cameraPosition,this._cameraPosition,y,-this.center.lat*Math.PI/180),c.bn(this._cameraPosition,this._cameraPosition,y,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);const w=c.aZ(this._globeViewProjMatrixNoCorrectionInverted);c.M(w,w,[1,1,-1]),this._cachedFrustum=kr.fromInvProjectionMatrix(w)}calculateFogMatrix(e){c.w("calculateFogMatrix is not supported on globe projection.");const n=c.b2();return c.ad(n),n}getVisibleUnwrappedCoordinates(e){return[new c.aW(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&c.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,n){if(!this._globeViewProjMatrixNoCorrection)return 1;const l=xn(e);c.aO(l,l,1+n/c.bu);const u=c.bk();return c.at(u,[l[0],l[1],l[2],1],this._globeViewProjMatrixNoCorrection),u[2]/u[3]}populateCache(e){}getBounds(){const e=.5*this.width,n=.5*this.height,l=[new c.P(0,0),new c.P(e,0),new c.P(this.width,0),new c.P(this.width,n),new c.P(this.width,this.height),new c.P(e,this.height),new c.P(0,this.height),new c.P(0,n)],u=[];for(const A of l)u.push(this.unprojectScreenPoint(A));let f=0,y=0,w=0,S=0;const M=this.center;for(const A of u){const z=c.bq(M.lng,A.lng),B=c.bq(M.lat,A.lat);z<y&&(y=z),z>f&&(f=z),B<S&&(S=B),B>w&&(w=B)}const E=[M.lng+y,M.lat+S,M.lng+f,M.lat+w];return this.isSurfacePointOnScreen([0,1,0])&&(E[3]=90,E[0]=-180,E[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(E[1]=-90,E[0]=-180,E[2]=180),new mr(E)}getConstrained(e,n){const l=c.ae(e.lat,-85.051129,c.af),u=c.ae(+n,this.minZoom+bn(0,l),this.maxZoom);return{center:new c.Q(e.lng,l),zoom:u}}calculateCenterFromCameraLngLatAlt(e,n,l,u){return this._helper.calculateCenterFromCameraLngLatAlt(e,n,l,u)}setLocationAtPoint(e,n){const l=xn(this.unprojectScreenPoint(n)),u=xn(e),f=c.bh();c.br(f);const y=c.bh();c.bn(y,l,f,-this.center.lng*Math.PI/180),c.bm(y,y,f,this.center.lat*Math.PI/180);const w=u[0]*u[0]+u[2]*u[2],S=y[0]*y[0];if(w<S)return;const M=Math.sqrt(w-S),E=-M,A=c.bs(u[0],u[2],y[0],M),z=c.bs(u[0],u[2],y[0],E),B=c.bh();c.bn(B,u,f,-A);const O=c.bs(B[1],B[2],y[1],y[2]),X=c.bh();c.bn(X,u,f,-z);const W=c.bs(X[1],X[2],y[1],y[2]),K=.5*Math.PI,J=O>=-K&&O<=K,oe=W>=-K&&W<=K;let se,ae;if(J&&oe){const Fe=this.center.lng*Math.PI/180,ke=this.center.lat*Math.PI/180;c.bv(A,Fe)+c.bv(O,ke)<c.bv(z,Fe)+c.bv(W,ke)?(se=A,ae=O):(se=z,ae=W)}else if(J)se=A,ae=O;else{if(!oe)return;se=z,ae=W}const fe=se/Math.PI*180,ue=ae/Math.PI*180,Se=this.center.lat;this.setCenter(new c.Q(fe,c.ae(ue,-90,90))),this.setZoom(this.zoom+bn(Se,this.center.lat))}locationToScreenPoint(e,n){const l=xn(e);if(n){const u=n.getElevationForLngLatZoom(e,this._helper._tileZoom);c.aO(l,l,1+u/c.bu)}return this._projectSurfacePointToScreen(l)}_projectSurfacePointToScreen(e){const n=c.bk();return c.at(n,[...e,1],this._globeViewProjMatrixNoCorrection),n[0]/=n[3],n[1]/=n[3],new c.P((.5*n[0]+.5)*this.width,(.5*-n[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,n){if(n){const l=n.pointCoordinate(e);if(l)return l}return c.$.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,n){var l;return(l=this.screenPointToMercatorCoordinate(e,n))===null||l===void 0?void 0:l.toLngLat()}isPointOnMapSurface(e,n){const l=this._cameraPosition,u=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(l,u)}getRayDirectionFromPixel(e){const n=c.bk();n[0]=e.x/this.width*2-1,n[1]=-1*(e.y/this.height*2-1),n[2]=1,n[3]=1,c.at(n,n,this._globeViewProjMatrixNoCorrectionInverted),n[0]/=n[3],n[1]/=n[3],n[2]/=n[3];const l=c.bh();l[0]=n[0]-this._cameraPosition[0],l[1]=n[1]-this._cameraPosition[1],l[2]=n[2]-this._cameraPosition[2];const u=c.bh();return c.aT(u,l),u}isSurfacePointVisible(e){const n=this._cachedClippingPlane;return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]+n[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;const n=c.bk();return c.at(n,[...e,1],this._globeViewProjMatrixNoCorrection),n[0]/=n[3],n[1]/=n[3],n[2]/=n[3],n[0]>-1&&n[0]<1&&n[1]>-1&&n[1]<1&&n[2]>-1&&n[2]<1}rayPlanetIntersection(e,n){const l=c.aV(e,n),u=c.bh(),f=c.bh();c.aO(f,n,l),c.aS(u,e,f);const y=1-c.aV(u,u);if(y<0)return null;const w=c.aV(e,e)-1,S=-l+(l<0?1:-1)*Math.sqrt(y),M=w/S,E=S;return{tMin:Math.min(M,E),tMax:Math.max(M,E)}}unprojectScreenPoint(e){const n=this._cameraPosition,l=this.getRayDirectionFromPixel(e),u=this.rayPlanetIntersection(n,l);if(u){const E=c.bh();c.aP(E,n,[l[0]*u.tMin,l[1]*u.tMin,l[2]*u.tMin]);const A=c.bh();return c.aT(A,E),Aa(A)}const f=this._cachedClippingPlane,y=f[0]*l[0]+f[1]*l[1]+f[2]*l[2],w=-c.bt(f,n)/y,S=c.bh();if(w>0)c.aP(S,n,[l[0]*w,l[1]*w,l[2]*w]);else{const E=c.bh();c.aP(E,n,[2*l[0],2*l[1],2*l[2]]);const A=c.bt(this._cachedClippingPlane,E);c.aS(S,E,[this._cachedClippingPlane[0]*A,this._cachedClippingPlane[1]*A,this._cachedClippingPlane[2]*A])}const M=function(E){const A=c.bh();return A[0]=E[0]*-E[3],A[1]=E[1]*-E[3],A[2]=E[2]*-E[3],{center:A,radius:Math.sqrt(1-E[3]*E[3])}}(f);return Aa(function(E,A,z){const B=c.bh();c.aS(B,z,E);const O=c.bh();return c.bi(O,E,B,A/c.bj(B)),O}(M.center,M.radius,S))}getMatrixForModel(e,n){const l=c.Q.convert(e),u=1/c.bu,f=c.b1();return c.bp(f,f,l.lng/180*Math.PI),c.a$(f,f,-l.lat/180*Math.PI),c.L(f,f,[0,0,1+n/c.bu]),c.a$(f,f,.5*Math.PI),c.M(f,f,[u,u,u]),f}getProjectionDataForCustomLayer(e=!0){const n=this.getProjectionData({overscaledTileID:new c.Y(0,0,0,0,0),applyGlobeMatrix:e});return n.tileMercatorCoords=[0,0,1,1],n}getFastPathSimpleProjectionMatrix(e){}}class Ra{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,n,l){return this._helper.interpolatePadding(e,n,l)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,n,l=!0){this._helper.resize(e,n,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,n){this._helper.overrideNearFarZ(e,n)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,n){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=n,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().recalculateCache(),this._mercatorTransform.getCoveringTilesDetailsProvider().recalculateCache()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new In({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,n)=>this.getConstrained(e,n)}),this._globeness=1,this._mercatorTransform=new Ro,this._verticalPerspectiveTransform=new uo}clone(){const e=new Ra;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){const n=this._mercatorTransform.getProjectionData(e),l=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?l.mainMatrix:n.mainMatrix,clippingPlane:l.clippingPlane,tileMercatorCoords:l.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:n.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return c.bc(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return c.bc(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,n,l){const u=this._mercatorTransform.getPitchedTextCorrection(e,n,l),f=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,n,l);return c.bc(u,f,this._globeness)}projectTileCoordinates(e,n,l,u){return this.currentTransform.projectTileCoordinates(e,n,l,u)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,n){return this.currentTransform.lngLatToCameraDepth(e,n)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}getConstrained(e,n){return this.currentTransform.getConstrained(e,n)}calculateCenterFromCameraLngLatAlt(e,n,l,u){return this._helper.calculateCenterFromCameraLngLatAlt(e,n,l,u)}setLocationAtPoint(e,n){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,n),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,n),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,n){return this.currentTransform.locationToScreenPoint(e,n)}screenPointToMercatorCoordinate(e,n){return this.currentTransform.screenPointToMercatorCoordinate(e,n)}screenPointToLocation(e,n){return this.currentTransform.screenPointToLocation(e,n)}isPointOnMapSurface(e,n){return this.currentTransform.isPointOnMapSurface(e,n)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,n){return this.currentTransform.getMatrixForModel(e,n)}getProjectionDataForCustomLayer(e=!0){const n=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return n;const l=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return l.fallbackMatrix=n.mainMatrix,l}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class bi{get useGlobeControls(){return!0}handlePanInertia(e,n){const l=Il(e,n);return Math.abs(l.lng-n.center.lng)>180&&(l.lng=n.center.lng+179.5*Math.sign(l.lng-n.center.lng)),{easingCenter:l,easingOffset:new c.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,n){const l=e.around,u=n.screenPointToLocation(l);e.bearingDelta&&n.setBearing(n.bearing+e.bearingDelta),e.pitchDelta&&n.setPitch(n.pitch+e.pitchDelta),e.rollDelta&&n.setRoll(n.roll+e.rollDelta);const f=n.zoom;e.zoomDelta&&n.setZoom(n.zoom+e.zoomDelta);const y=n.zoom-f;if(y===0)return;const w=c.bq(n.center.lng,u.lng),S=w/(Math.abs(w/180)+1),M=c.bq(n.center.lat,u.lat),E=n.getRayDirectionFromPixel(l),A=n.cameraPosition,z=-1*c.aV(A,E),B=c.bh();c.aP(B,A,[E[0]*z,E[1]*z,E[2]*z]);const O=c.bo(B)-1,X=Math.exp(.5*-Math.max(O-.3,0)),W=co(n.worldSize,n.center.lat)/Math.min(n.width,n.height),K=c.bf(W,.9,.5,1,.25),J=(1-c.ac(-y))*Math.min(X,K),oe=n.center.lat,se=n.zoom,ae=new c.Q(n.center.lng+S*J,c.ae(n.center.lat+M*J,-85.051129,c.af));n.setLocationAtPoint(u,l);const fe=n.center,ue=c.bf(Math.abs(w),45,85,0,1),Se=c.bf(W,.75,.35,0,1),Fe=Math.pow(Math.max(ue,Se),.25),ke=c.bq(fe.lng,ae.lng),Ee=c.bq(fe.lat,ae.lat);n.setCenter(new c.Q(fe.lng+ke*Fe,fe.lat+Ee*Fe).wrap()),n.setZoom(se+bn(oe,n.center.lat))}handleMapControlsPan(e,n,l){if(!e.panDelta)return;const u=n.center.lat,f=n.zoom;n.setCenter(Il(e.panDelta,n).wrap()),n.setZoom(f+bn(u,n.center.lat))}cameraForBoxAndBearing(e,n,l,u,f){const y=ri(e,n,l,u,f),w=n.left/f.width*2-1,S=(f.width-n.right)/f.width*2-1,M=n.top/f.height*-2+1,E=(f.height-n.bottom)/f.height*-2+1,A=c.bq(l.getWest(),l.getEast())<0,z=A?l.getEast():l.getWest(),B=A?l.getWest():l.getEast(),O=Math.max(l.getNorth(),l.getSouth()),X=Math.min(l.getNorth(),l.getSouth()),W=z+.5*c.bq(z,B),K=O+.5*c.bq(O,X),J=f.clone();J.setCenter(y.center),J.setBearing(y.bearing),J.setPitch(0),J.setRoll(0),J.setZoom(y.zoom);const oe=J.modelViewProjectionMatrix,se=[xn(l.getNorthWest()),xn(l.getNorthEast()),xn(l.getSouthWest()),xn(l.getSouthEast()),xn(new c.Q(B,K)),xn(new c.Q(z,K)),xn(new c.Q(W,O)),xn(new c.Q(W,X))],ae=xn(y.center);let fe=Number.POSITIVE_INFINITY;for(const ue of se)w<0&&(fe=bi.getLesserNonNegativeNonNull(fe,bi.solveVectorScale(ue,ae,oe,"x",w))),S>0&&(fe=bi.getLesserNonNegativeNonNull(fe,bi.solveVectorScale(ue,ae,oe,"x",S))),M>0&&(fe=bi.getLesserNonNegativeNonNull(fe,bi.solveVectorScale(ue,ae,oe,"y",M))),E<0&&(fe=bi.getLesserNonNegativeNonNull(fe,bi.solveVectorScale(ue,ae,oe,"y",E)));if(Number.isFinite(fe)&&fe!==0)return y.zoom=J.zoom+c.ah(fe),y;Wn()}handleJumpToCenterZoom(e,n){const l=e.center.lat,u=e.getConstrained(n.center?c.Q.convert(n.center):e.center,e.zoom).center;e.setCenter(u.wrap());const f=n.zoom!==void 0?+n.zoom:e.zoom+bn(l,u.lat);e.zoom!==f&&e.setZoom(f)}handleEaseTo(e,n){const l=e.zoom,u=e.center,f=e.padding,y={roll:e.roll,pitch:e.pitch,bearing:e.bearing},w={roll:n.roll===void 0?e.roll:n.roll,pitch:n.pitch===void 0?e.pitch:n.pitch,bearing:n.bearing===void 0?e.bearing:n.bearing},S=n.zoom!==void 0,M=!e.isPaddingEqual(n.padding);let E=!1;const A=n.center?c.Q.convert(n.center):u,z=e.getConstrained(A,l).center;zo(e,z);const B=e.clone();B.setCenter(z),B.setZoom(S?+n.zoom:l+bn(u.lat,A.lat)),B.setBearing(n.bearing);const O=new c.P(c.ae(e.centerPoint.x+n.offsetAsPoint.x,0,e.width),c.ae(e.centerPoint.y+n.offsetAsPoint.y,0,e.height));B.setLocationAtPoint(z,O);const X=(n.offset&&n.offsetAsPoint.mag())>0?B.center:z,W=S?+n.zoom:l+bn(u.lat,X.lat),K=l+bn(u.lat,0),J=W+bn(X.lat,0),oe=c.bq(u.lng,X.lng),se=c.bq(u.lat,X.lat),ae=c.ac(J-K);return E=W!==l,{easeFunc:fe=>{if(c.b6(y,w)||ui({startEulerAngles:y,endEulerAngles:w,tr:e,k:fe,useSlerp:y.roll!=w.roll}),M&&e.interpolatePadding(f,n.padding,fe),n.around)c.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(n.around,n.aroundPoint);else{const ue=J>K?Math.min(2,ae):Math.max(.5,ae),Se=Math.pow(ue,1-fe),Fe=ad(u,oe,se,fe*Se);e.setCenter(Fe.wrap())}if(E){const ue=c.B.number(K,J,fe)+bn(0,e.center.lat);e.setZoom(ue)}},isZooming:E,elevationCenter:X}}handleFlyTo(e,n){const l=n.zoom!==void 0,u=e.center,f=e.zoom,y=e.padding,w=!e.isPaddingEqual(n.padding),S=e.getConstrained(c.Q.convert(n.center||n.locationAtOffset),f).center,M=l?+n.zoom:e.zoom+bn(e.center.lat,S.lat),E=e.clone();E.setCenter(S),E.setZoom(M),E.setBearing(n.bearing);const A=new c.P(c.ae(e.centerPoint.x+n.offsetAsPoint.x,0,e.width),c.ae(e.centerPoint.y+n.offsetAsPoint.y,0,e.height));E.setLocationAtPoint(S,A);const z=E.center;zo(e,z);const B=function(se,ae,fe){const ue=xn(ae),Se=xn(fe),Fe=c.aV(ue,Se),ke=Math.acos(Fe),Ee=Ia(se);return ke/(2*Math.PI)*Ee}(e,u,z),O=f+bn(u.lat,0),X=M+bn(z.lat,0),W=c.ac(X-O);let K;if(typeof n.minZoom=="number"){const se=+n.minZoom+bn(z.lat,0),ae=Math.min(se,O,X)+bn(0,z.lat),fe=e.getConstrained(z,ae).zoom+bn(z.lat,0);K=c.ac(fe-O)}const J=c.bq(u.lng,z.lng),oe=c.bq(u.lat,z.lat);return{easeFunc:(se,ae,fe,ue)=>{const Se=ad(u,J,oe,fe);w&&e.interpolatePadding(y,n.padding,se);const Fe=se===1?z:Se;e.setCenter(Fe.wrap());const ke=O+c.ah(ae);e.setZoom(se===1?M:ke+bn(0,Fe.lat))},scaleOfZoom:W,targetCenter:z,scaleOfMinZoom:K,pixelPathLength:B}}static solveVectorScale(e,n,l,u,f){const y=u==="x"?[l[0],l[4],l[8],l[12]]:[l[1],l[5],l[9],l[13]],w=[l[3],l[7],l[11],l[15]],S=e[0]*y[0]+e[1]*y[1]+e[2]*y[2],M=e[0]*w[0]+e[1]*w[1]+e[2]*w[2],E=n[0]*y[0]+n[1]*y[1]+n[2]*y[2],A=n[0]*w[0]+n[1]*w[1]+n[2]*w[2];return E+f*M===S+f*A||w[3]*(S-E)+y[3]*(A-M)+S*A==E*M?null:(E+y[3]-f*A-f*w[3])/(E-S-f*A+f*M)}static getLesserNonNegativeNonNull(e,n){return n!==null&&n>=0&&n<e?n:e}}class ho{constructor(e){this._globe=e,this._mercatorCameraHelper=new Ma,this._verticalPerspectiveCameraHelper=new bi}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,n){return this.currentHelper.handlePanInertia(e,n)}handleMapControlsRollPitchBearingZoom(e,n){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,n)}handleMapControlsPan(e,n,l){this.currentHelper.handleMapControlsPan(e,n,l)}cameraForBoxAndBearing(e,n,l,u,f){return this.currentHelper.cameraForBoxAndBearing(e,n,l,u,f)}handleJumpToCenterZoom(e,n){this.currentHelper.handleJumpToCenterZoom(e,n)}handleEaseTo(e,n){return this.currentHelper.handleEaseTo(e,n)}handleFlyTo(e,n){return this.currentHelper.handleFlyTo(e,n)}}const zl=(p,e)=>c.x(p,e&&e.filter(n=>n.identifier!=="source.canvas")),Nf=c.bw();class uu extends c.E{constructor(e,n={}){super(),this._rtlPluginLoaded=()=>{for(const l in this.sourceCaches){const u=this.sourceCaches[l].getSource().type;u!=="vector"&&u!=="geojson"||this.sourceCaches[l].reload()}},this.map=e,this.dispatcher=new Xr(cn(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(l,u)=>this.getGlyphs(l,u)),this.dispatcher.registerMessageHandler("GI",(l,u)=>this.getImages(l,u)),this.imageManager=new zt,this.imageManager.setEventedParent(this),this.glyphManager=new Wt(e._requestManager,n.localIdeographFontFamily),this.lineAtlas=new bt(256,512),this.crossTileSymbolIndex=new gt,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new c.bx,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",c.by()),ts().on(ro,this._rtlPluginLoaded),this.on("data",l=>{if(l.dataType!=="source"||l.sourceDataType!=="metadata")return;const u=this.sourceCaches[l.sourceId];if(!u)return;const f=u.getSource();if(f&&f.vectorLayerIds)for(const y in this._layers){const w=this._layers[y];w.source===f.id&&this._validateLayer(w)}})}loadURL(e,n={},l){this.fire(new c.l("dataloading",{dataType:"style"})),n.validate=typeof n.validate!="boolean"||n.validate;const u=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const f=this._loadStyleRequest;c.j(u,this._loadStyleRequest).then(y=>{this._loadStyleRequest=null,this._load(y.data,n,l)}).catch(y=>{this._loadStyleRequest=null,y&&!f.signal.aborted&&this.fire(new c.k(y))})}loadJSON(e,n={},l){this.fire(new c.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,me.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,n.validate=n.validate!==!1,this._load(e,n,l)}).catch(()=>{})}loadEmpty(){this.fire(new c.l("dataloading",{dataType:"style"})),this._load(Nf,{validate:!1})}_load(e,n,l){var u,f;const y=n.transformStyle?n.transformStyle(l,e):e;if(!n.validate||!zl(this,c.y(y))){this._loaded=!0,this.stylesheet=y;for(const w in y.sources)this.addSource(w,y.sources[w],{validate:!1});y.sprite?this._loadSprite(y.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(y.glyphs),this._createLayers(),this.light=new Gr(this.stylesheet.light),this._setProjectionInternal(((u=this.stylesheet.projection)===null||u===void 0?void 0:u.type)||"mercator"),this.sky=new ft(this.stylesheet.sky),this.map.setTerrain((f=this.stylesheet.terrain)!==null&&f!==void 0?f:null),this.fire(new c.l("data",{dataType:"style"})),this.fire(new c.l("style.load"))}}_createLayers(){const e=c.bz(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(n=>n.id),this._layers={},this._serializedLayers=null;for(const n of e){const l=c.bA(n);l.setEventedParent(this,{layer:{id:n.id}}),this._layers[n.id]=l}}_loadSprite(e,n=!1,l=void 0){let u;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(f,y,w,S){return c._(this,void 0,void 0,function*(){const M=Je(f),E=w>1?"@2x":"",A={},z={};for(const{id:B,url:O}of M){const X=y.transformRequest(st(O,E,".json"),"SpriteJSON");A[B]=c.j(X,S);const W=y.transformRequest(st(O,E,".png"),"SpriteImage");z[B]=Be.getImage(W,S)}return yield Promise.all([...Object.values(A),...Object.values(z)]),function(B,O){return c._(this,void 0,void 0,function*(){const X={};for(const W in B){X[W]={};const K=me.getImageCanvasContext((yield O[W]).data),J=(yield B[W]).data;for(const oe in J){const{width:se,height:ae,x:fe,y:ue,sdf:Se,pixelRatio:Fe,stretchX:ke,stretchY:Ee,content:ze,textFitWidth:nt,textFitHeight:et}=J[oe];X[W][oe]={data:null,pixelRatio:Fe,sdf:Se,stretchX:ke,stretchY:Ee,content:ze,textFitWidth:nt,textFitHeight:et,spriteData:{width:se,height:ae,x:fe,y:ue,context:K}}}}return X})}(A,z)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(f=>{if(this._spriteRequest=null,f)for(const y in f){this._spritesImagesIds[y]=[];const w=this._spritesImagesIds[y]?this._spritesImagesIds[y].filter(S=>!(S in f)):[];for(const S of w)this.imageManager.removeImage(S),this._changedImages[S]=!0;for(const S in f[y]){const M=y==="default"?S:`${y}:${S}`;this._spritesImagesIds[y].push(M),M in this.imageManager.images?this.imageManager.updateImage(M,f[y][S],!1):this.imageManager.addImage(M,f[y][S]),n&&(this._changedImages[M]=!0)}}}).catch(f=>{this._spriteRequest=null,u=f,this.fire(new c.k(u))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),n&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"})),l&&l(u)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}_validateLayer(e){const n=this.sourceCaches[e.source];if(!n)return;const l=e.sourceLayer;if(!l)return;const u=n.getSource();(u.type==="geojson"||u.vectorLayerIds&&u.vectorLayerIds.indexOf(l)===-1)&&this.fire(new c.k(new Error(`Source layer "${l}" does not exist on source "${u.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,n=!1){const l=this._serializedAllLayers();if(!e||e.length===0)return Object.values(n?c.bB(l):l);const u=[];for(const f of e)if(l[f]){const y=n?c.bB(l[f]):l[f];u.push(y)}return u}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const n=Object.keys(this._layers);for(const l of n){const u=this._layers[l];u.type!=="custom"&&(e[l]=u.serialize())}return e}hasTransitions(){var e,n,l;if(!((e=this.light)===null||e===void 0)&&e.hasTransition()||!((n=this.sky)===null||n===void 0)&&n.hasTransition()||!((l=this.projection)===null||l===void 0)&&l.hasTransition())return!0;for(const u in this.sourceCaches)if(this.sourceCaches[u].hasTransition())return!0;for(const u in this._layers)if(this._layers[u].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const n=this._changed;if(n){const u=Object.keys(this._updatedLayers),f=Object.keys(this._removedLayers);(u.length||f.length)&&this._updateWorkerLayers(u,f);for(const y in this._updatedSources){const w=this._updatedSources[y];if(w==="reload")this._reloadSource(y);else{if(w!=="clear")throw new Error(`Invalid action ${w}`);this._clearSource(y)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const y in this._updatedPaintProps)this._layers[y].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const l={};for(const u in this.sourceCaches){const f=this.sourceCaches[u];l[u]=f.used,f.used=!1}for(const u of this._order){const f=this._layers[u];f.recalculate(e,this._availableImages),!f.isHidden(e.zoom)&&f.source&&(this.sourceCaches[f.source].used=!0)}for(const u in l){const f=this.sourceCaches[u];!!l[u]!=!!f.used&&f.fire(new c.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:u}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,n&&this.fire(new c.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const n in this.sourceCaches)this.sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,n){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:n})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,n={}){var l;this._checkLoaded();const u=this.serialize();if(e=n.transformStyle?n.transformStyle(u,e):e,((l=n.validate)===null||l===void 0||l)&&zl(this,c.y(e)))return!1;(e=c.bB(e)).layers=c.bz(e.layers);const f=c.bC(u,e),y=this._getOperationsToPerform(f);if(y.unimplemented.length>0)throw new Error(`Unimplemented: ${y.unimplemented.join(", ")}.`);if(y.operations.length===0)return!1;for(const w of y.operations)w();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const n=[],l=[];for(const u of e)switch(u.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":n.push(()=>this.addLayer.apply(this,u.args));break;case"removeLayer":n.push(()=>this.removeLayer.apply(this,u.args));break;case"setPaintProperty":n.push(()=>this.setPaintProperty.apply(this,u.args));break;case"setLayoutProperty":n.push(()=>this.setLayoutProperty.apply(this,u.args));break;case"setFilter":n.push(()=>this.setFilter.apply(this,u.args));break;case"addSource":n.push(()=>this.addSource.apply(this,u.args));break;case"removeSource":n.push(()=>this.removeSource.apply(this,u.args));break;case"setLayerZoomRange":n.push(()=>this.setLayerZoomRange.apply(this,u.args));break;case"setLight":n.push(()=>this.setLight.apply(this,u.args));break;case"setGeoJSONSourceData":n.push(()=>this.setGeoJSONSourceData.apply(this,u.args));break;case"setGlyphs":n.push(()=>this.setGlyphs.apply(this,u.args));break;case"setSprite":n.push(()=>this.setSprite.apply(this,u.args));break;case"setTerrain":n.push(()=>this.map.setTerrain.apply(this,u.args));break;case"setSky":n.push(()=>this.setSky.apply(this,u.args));break;case"setProjection":this.setProjection.apply(this,u.args);break;case"setTransition":n.push(()=>{});break;default:l.push(u.command)}return{operations:n,unimplemented:l}}addImage(e,n){if(this.getImage(e))return this.fire(new c.k(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,n),this._afterImageUpdated(e)}updateImage(e,n){this.imageManager.updateImage(e,n)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new c.k(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,n,l={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(c.y.source,`sources.${e}`,n,null,l))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const u=this.sourceCaches[e]=new be(e,n,this.dispatcher);u.style=this,u.setEventedParent(this,()=>({isSourceLoaded:u.loaded(),source:u.serialize(),sourceId:e})),u.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===e)return this.fire(new c.k(new Error(`Source "${e}" cannot be removed while layer "${l}" is using it.`)));const n=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],n.fire(new c.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),n.setEventedParent(null),n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,n){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const l=this.sourceCaches[e].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(n),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,n,l={}){this._checkLoaded();const u=e.id;if(this.getLayer(u))return void this.fire(new c.k(new Error(`Layer "${u}" already exists on this map.`)));let f;if(e.type==="custom"){if(zl(this,c.bD(e)))return;f=c.bA(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(u,e.source),e=c.bB(e),e=c.e(e,{source:u})),this._validate(c.y.layer,`layers.${u}`,e,{arrayIndex:-1},l))return;f=c.bA(e),this._validateLayer(f),f.setEventedParent(this,{layer:{id:u}})}const y=n?this._order.indexOf(n):this._order.length;if(n&&y===-1)this.fire(new c.k(new Error(`Cannot add layer "${u}" before non-existing layer "${n}".`)));else{if(this._order.splice(y,0,u),this._layerOrderChanged=!0,this._layers[u]=f,this._removedLayers[u]&&f.source&&f.type!=="custom"){const w=this._removedLayers[u];delete this._removedLayers[u],w.type!==f.type?this._updatedSources[f.source]="clear":(this._updatedSources[f.source]="reload",this.sourceCaches[f.source].pause())}this._updateLayer(f),f.onAdd&&f.onAdd(this.map)}}moveLayer(e,n){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new c.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===n)return;const l=this._order.indexOf(e);this._order.splice(l,1);const u=n?this._order.indexOf(n):this._order.length;n&&u===-1?this.fire(new c.k(new Error(`Cannot move layer "${e}" before non-existing layer "${n}".`))):(this._order.splice(u,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const n=this._layers[e];if(!n)return void this.fire(new c.k(new Error(`Cannot remove non-existing layer "${e}".`)));n.setEventedParent(null);const l=this._order.indexOf(e);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=n,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],n.onRemove&&n.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,n,l){this._checkLoaded();const u=this.getLayer(e);u?u.minzoom===n&&u.maxzoom===l||(n!=null&&(u.minzoom=n),l!=null&&(u.maxzoom=l),this._updateLayer(u)):this.fire(new c.k(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,n,l={}){this._checkLoaded();const u=this.getLayer(e);if(u){if(!c.bE(u.filter,n))return n==null?(u.filter=void 0,void this._updateLayer(u)):void(this._validate(c.y.filter,`layers.${u.id}.filter`,n,null,l)||(u.filter=c.bB(n),this._updateLayer(u)))}else this.fire(new c.k(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return c.bB(this.getLayer(e).filter)}setLayoutProperty(e,n,l,u={}){this._checkLoaded();const f=this.getLayer(e);f?c.bE(f.getLayoutProperty(n),l)||(f.setLayoutProperty(n,l,u),this._updateLayer(f)):this.fire(new c.k(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,n){const l=this.getLayer(e);if(l)return l.getLayoutProperty(n);this.fire(new c.k(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,n,l,u={}){this._checkLoaded();const f=this.getLayer(e);f?c.bE(f.getPaintProperty(n),l)||(f.setPaintProperty(n,l,u)&&this._updateLayer(f),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new c.k(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,n){return this.getLayer(e).getPaintProperty(n)}setFeatureState(e,n){this._checkLoaded();const l=e.source,u=e.sourceLayer,f=this.sourceCaches[l];if(f===void 0)return void this.fire(new c.k(new Error(`The source '${l}' does not exist in the map's style.`)));const y=f.getSource().type;y==="geojson"&&u?this.fire(new c.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):y!=="vector"||u?(e.id===void 0&&this.fire(new c.k(new Error("The feature id parameter must be provided."))),f.setFeatureState(u,e.id,n)):this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,n){this._checkLoaded();const l=e.source,u=this.sourceCaches[l];if(u===void 0)return void this.fire(new c.k(new Error(`The source '${l}' does not exist in the map's style.`)));const f=u.getSource().type,y=f==="vector"?e.sourceLayer:void 0;f!=="vector"||y?n&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new c.k(new Error("A feature id is required to remove its specific state property."))):u.removeFeatureState(y,e.id,n):this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const n=e.source,l=e.sourceLayer,u=this.sourceCaches[n];if(u!==void 0)return u.getSource().type!=="vector"||l?(e.id===void 0&&this.fire(new c.k(new Error("The feature id parameter must be provided."))),u.getFeatureState(l,e.id)):void this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new c.k(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return c.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=c.bF(this.sourceCaches,f=>f.serialize()),n=this._serializeByIds(this._order,!0),l=this.map.getTerrain()||void 0,u=this.stylesheet;return c.bG({version:u.version,name:u.name,metadata:u.metadata,light:u.light,sky:u.sky,center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch,sprite:u.sprite,glyphs:u.glyphs,transition:u.transition,projection:u.projection,sources:e,layers:n,terrain:l},f=>f!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const n=y=>this._layers[y].type==="fill-extrusion",l={},u=[];for(let y=this._order.length-1;y>=0;y--){const w=this._order[y];if(n(w)){l[w]=y;for(const S of e){const M=S[w];if(M)for(const E of M)u.push(E)}}}u.sort((y,w)=>w.intersectionZ-y.intersectionZ);const f=[];for(let y=this._order.length-1;y>=0;y--){const w=this._order[y];if(n(w))for(let S=u.length-1;S>=0;S--){const M=u[S].feature;if(l[M.layer.id]<y)break;f.push(M),u.pop()}else for(const S of e){const M=S[w];if(M)for(const E of M)f.push(E.feature)}}return f}queryRenderedFeatures(e,n,l){n&&n.filter&&this._validate(c.y.filter,"queryRenderedFeatures.filter",n.filter,null,n);const u={};if(n&&n.layers){if(!(Array.isArray(n.layers)||n.layers instanceof Set))return this.fire(new c.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const M of n.layers){const E=this._layers[M];if(!E)return this.fire(new c.k(new Error(`The layer '${M}' does not exist in the map's style and cannot be queried for features.`))),[];u[E.source]=!0}}const f=[];n.availableImages=this._availableImages;const y=this._serializedAllLayers(),w=n.layers instanceof Set?n.layers:Array.isArray(n.layers)?new Set(n.layers):null,S=Object.assign(Object.assign({},n),{layers:w});for(const M in this.sourceCaches)n.layers&&!u[M]||f.push(Yt(this.sourceCaches[M],this._layers,y,e,S,l,this.map.terrain?(E,A,z)=>this.map.terrain.getElevation(E,A,z):void 0));return this.placement&&f.push(function(M,E,A,z,B,O,X){const W={},K=O.queryRenderedSymbols(z),J=[];for(const oe of Object.keys(K).map(Number))J.push(X[oe]);J.sort(yr);for(const oe of J){const se=oe.featureIndex.lookupSymbolFeatures(K[oe.bucketInstanceId],E,oe.bucketIndex,oe.sourceLayerIndex,B.filter,B.layers,B.availableImages,M);for(const ae in se){const fe=W[ae]=W[ae]||[],ue=se[ae];ue.sort((Se,Fe)=>{const ke=oe.featureSortOrder;if(ke){const Ee=ke.indexOf(Se.featureIndex);return ke.indexOf(Fe.featureIndex)-Ee}return Fe.featureIndex-Se.featureIndex});for(const Se of ue)fe.push(Se)}}return function(oe,se,ae){for(const fe in oe)for(const ue of oe[fe])qr(ue,ae[se[fe].source]);return oe}(W,M,A)}(this._layers,y,this.sourceCaches,e,S,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(f)}querySourceFeatures(e,n){n&&n.filter&&this._validate(c.y.filter,"querySourceFeatures.filter",n.filter,null,n);const l=this.sourceCaches[e];return l?function(u,f){const y=u.getRenderableIds().map(M=>u.getTileByID(M)),w=[],S={};for(let M=0;M<y.length;M++){const E=y[M],A=E.tileID.canonical.key;S[A]||(S[A]=!0,E.querySourceFeatures(w,f))}return w}(l,n):[]}getLight(){return this.light.getLight()}setLight(e,n={}){this._checkLoaded();const l=this.light.getLight();let u=!1;for(const y in e)if(!c.bE(e[y],l[y])){u=!0;break}if(!u)return;const f={now:me.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,n),this.light.updateTransitions(f)}getProjection(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,n={}){this._checkLoaded();const l=this.getSky();let u=!1;if(!e&&!l)return;if(e&&!l)u=!0;else if(!e&&l)u=!0;else for(const y in e)if(!c.bE(e[y],l[y])){u=!0;break}if(!u)return;const f={now:me.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,n),this.sky.updateTransitions(f)}_setProjectionInternal(e){const n=function(l){if(Array.isArray(l)){const u=new El({type:l});return{projection:u,transform:new Ra,cameraHelper:new ho(u)}}switch(l){case"mercator":return{projection:new Pa,transform:new Ro,cameraHelper:new Ma};case"globe":{const u=new El({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:u,transform:new Ra,cameraHelper:new ho(u)}}case"vertical-perspective":return{projection:new Ea,transform:new uo,cameraHelper:new bi};default:return c.w(`Unknown projection name: ${l}. Falling back to mercator projection.`),{projection:new Pa,transform:new Ro,cameraHelper:new Ma}}}(e);this.projection=n.projection,this.map.migrateProjection(n.transform,n.cameraHelper);for(const l in this.sourceCaches)this.sourceCaches[l].reload()}_validate(e,n,l,u,f={}){return(!f||f.validate!==!1)&&zl(this,e.call(c.y,c.e({key:n,style:this.serialize(),value:l,styleSpec:c.v},u)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),ts().off(ro,this._rtlPluginLoaded);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this.sourceCaches){const l=this.sourceCaches[n];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const n in this.sourceCaches)this.sourceCaches[n].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,n,l,u,f=!1){let y=!1,w=!1;const S={};for(const M of this._order){const E=this._layers[M];if(E.type!=="symbol")continue;if(!S[E.source]){const z=this.sourceCaches[E.source];S[E.source]=z.getRenderableIds(!0).map(B=>z.getTileByID(B)).sort((B,O)=>O.tileID.overscaledZ-B.tileID.overscaledZ||(B.tileID.isLessThan(O.tileID)?-1:1))}const A=this.crossTileSymbolIndex.addLayer(E,S[E.source],e.center.lng);y=y||A}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((f=f||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(me.now(),e.zoom))&&(this.pauseablePlacement=new ar(e,this.map.terrain,this._order,f,n,l,u,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,S),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(me.now()),w=!0),y&&this.pauseablePlacement.placement.setStale()),w||y)for(const M of this._order){const E=this._layers[M];E.type==="symbol"&&this.placement.updateLayerOpacities(E,S[E.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(me.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,n){return c._(this,void 0,void 0,function*(){const l=yield this.imageManager.getImages(n.icons);this._updateTilesForChangedImages();const u=this.sourceCaches[n.source];return u&&u.setDependencies(n.tileID.key,n.type,n.icons),l})}getGlyphs(e,n){return c._(this,void 0,void 0,function*(){const l=yield this.glyphManager.getGlyphs(n.stacks),u=this.sourceCaches[n.source];return u&&u.setDependencies(n.tileID.key,n.type,[""]),l})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,n={}){this._checkLoaded(),e&&this._validate(c.y.glyphs,"glyphs",e,null,n)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,n,l={},u){this._checkLoaded();const f=[{id:e,url:n}],y=[...Je(this.stylesheet.sprite),...f];this._validate(c.y.sprite,"sprite",y,null,l)||(this.stylesheet.sprite=y,this._loadSprite(f,!0,u))}removeSprite(e){this._checkLoaded();const n=Je(this.stylesheet.sprite);if(n.find(l=>l.id===e)){if(this._spritesImagesIds[e])for(const l of this._spritesImagesIds[e])this.imageManager.removeImage(l),this._changedImages[l]=!0;n.splice(n.findIndex(l=>l.id===e),1),this.stylesheet.sprite=n.length>0?n:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}else this.fire(new c.k(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return Je(this.stylesheet.sprite)}setSprite(e,n={},l){this._checkLoaded(),e&&this._validate(c.y.sprite,"sprite",e,null,n)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,l):(this._unloadSprite(),l&&l(null)))}}var Vf=c.aG([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class $f{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,n,l,u,f,y,w,S,M){this.context=e;let E=this.boundPaintVertexBuffers.length!==u.length;for(let A=0;!E&&A<u.length;A++)this.boundPaintVertexBuffers[A]!==u[A]&&(E=!0);!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==l||E||this.boundIndexBuffer!==f||this.boundVertexOffset!==y||this.boundDynamicVertexBuffer!==w||this.boundDynamicVertexBuffer2!==S||this.boundDynamicVertexBuffer3!==M?this.freshBind(n,l,u,f,y,w,S,M):(e.bindVertexArray.set(this.vao),w&&w.bind(),f&&f.dynamicDraw&&f.bind(),S&&S.bind(),M&&M.bind())}freshBind(e,n,l,u,f,y,w,S){const M=e.numAttributes,E=this.context,A=E.gl;this.vao&&this.destroy(),this.vao=E.createVertexArray(),E.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=u,this.boundVertexOffset=f,this.boundDynamicVertexBuffer=y,this.boundDynamicVertexBuffer2=w,this.boundDynamicVertexBuffer3=S,n.enableAttributes(A,e);for(const z of l)z.enableAttributes(A,e);y&&y.enableAttributes(A,e),w&&w.enableAttributes(A,e),S&&S.enableAttributes(A,e),n.bind(),n.setVertexAttribPointers(A,e,f);for(const z of l)z.bind(),z.setVertexAttribPointers(A,e,f);y&&(y.bind(),y.setVertexAttribPointers(A,e,f)),u&&u.bind(),w&&(w.bind(),w.setVertexAttribPointers(A,e,f)),S&&(S.bind(),S.setVertexAttribPointers(A,e,f)),E.currentNumAttributes=M}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Uf=(p,e,n,l,u)=>({u_texture:0,u_ele_delta:p,u_fog_matrix:e,u_fog_color:n?n.properties.get("fog-color"):c.b7.white,u_fog_ground_blend:n?n.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:u?0:n?n.calculateFogBlendOpacity(l):0,u_horizon_color:n?n.properties.get("horizon-color"):c.b7.white,u_horizon_fog_blend:n?n.properties.get("horizon-fog-blend"):1,u_is_globe_mode:u?1:0}),Rl={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function jo(p){const e=[];for(let n=0;n<p.length;n++){if(p[n]===null)continue;const l=p[n].split(" ");e.push(l.pop())}return e}class Dl{constructor(e,n,l,u,f,y,w,S,M=[]){const E=e.gl;this.program=E.createProgram();const A=jo(n.staticAttributes),z=l?l.getBinderAttributes():[],B=A.concat(z),O=Rt.prelude.staticUniforms?jo(Rt.prelude.staticUniforms):[],X=w.staticUniforms?jo(w.staticUniforms):[],W=n.staticUniforms?jo(n.staticUniforms):[],K=l?l.getBinderUniforms():[],J=O.concat(X).concat(W).concat(K),oe=[];for(const ke of J)oe.indexOf(ke)<0&&oe.push(ke);const se=l?l.defines():[];Bn(E)&&se.unshift("#version 300 es"),f&&se.push("#define OVERDRAW_INSPECTOR;"),y&&se.push("#define TERRAIN3D;"),S&&se.push(S),M&&se.push(...M);let ae=se.concat(Rt.prelude.fragmentSource,w.fragmentSource,n.fragmentSource).join(`
`),fe=se.concat(Rt.prelude.vertexSource,w.vertexSource,n.vertexSource).join(`
`);Bn(E)||(ae=function(ke){return ke.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(ae),fe=function(ke){return ke.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(fe));const ue=E.createShader(E.FRAGMENT_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);if(E.shaderSource(ue,ae),E.compileShader(ue),!E.getShaderParameter(ue,E.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${E.getShaderInfoLog(ue)}`);E.attachShader(this.program,ue);const Se=E.createShader(E.VERTEX_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);if(E.shaderSource(Se,fe),E.compileShader(Se),!E.getShaderParameter(Se,E.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${E.getShaderInfoLog(Se)}`);E.attachShader(this.program,Se),this.attributes={};const Fe={};this.numAttributes=B.length;for(let ke=0;ke<this.numAttributes;ke++)B[ke]&&(E.bindAttribLocation(this.program,ke,B[ke]),this.attributes[B[ke]]=ke);if(E.linkProgram(this.program),!E.getProgramParameter(this.program,E.LINK_STATUS))throw new Error(`Program failed to link: ${E.getProgramInfoLog(this.program)}`);E.deleteShader(Se),E.deleteShader(ue);for(let ke=0;ke<oe.length;ke++){const Ee=oe[ke];if(Ee&&!Fe[Ee]){const ze=E.getUniformLocation(this.program,Ee);ze&&(Fe[Ee]=ze)}}this.fixedUniforms=u(e,Fe),this.terrainUniforms=((ke,Ee)=>({u_depth:new c.bH(ke,Ee.u_depth),u_terrain:new c.bH(ke,Ee.u_terrain),u_terrain_dim:new c.b8(ke,Ee.u_terrain_dim),u_terrain_matrix:new c.bJ(ke,Ee.u_terrain_matrix),u_terrain_unpack:new c.bK(ke,Ee.u_terrain_unpack),u_terrain_exaggeration:new c.b8(ke,Ee.u_terrain_exaggeration)}))(e,Fe),this.projectionUniforms=((ke,Ee)=>({u_projection_matrix:new c.bJ(ke,Ee.u_projection_matrix),u_projection_tile_mercator_coords:new c.bK(ke,Ee.u_projection_tile_mercator_coords),u_projection_clipping_plane:new c.bK(ke,Ee.u_projection_clipping_plane),u_projection_transition:new c.b8(ke,Ee.u_projection_transition),u_projection_fallback_matrix:new c.bJ(ke,Ee.u_projection_fallback_matrix)}))(e,Fe),this.binderUniforms=l?l.getUniforms(e,Fe):[]}draw(e,n,l,u,f,y,w,S,M,E,A,z,B,O,X,W,K,J,oe){const se=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(l),e.setStencilMode(u),e.setColorMode(f),e.setCullFace(y),S){e.activeTexture.set(se.TEXTURE2),se.bindTexture(se.TEXTURE_2D,S.depthTexture),e.activeTexture.set(se.TEXTURE3),se.bindTexture(se.TEXTURE_2D,S.texture);for(const fe in this.terrainUniforms)this.terrainUniforms[fe].set(S[fe])}if(M)for(const fe in M)this.projectionUniforms[Rl[fe]].set(M[fe]);if(w)for(const fe in this.fixedUniforms)this.fixedUniforms[fe].set(w[fe]);W&&W.setUniforms(e,this.binderUniforms,O,{zoom:X});let ae=0;switch(n){case se.LINES:ae=2;break;case se.TRIANGLES:ae=3;break;case se.LINE_STRIP:ae=1}for(const fe of B.get()){const ue=fe.vaos||(fe.vaos={});(ue[E]||(ue[E]=new $f)).bind(e,this,A,W?W.getPaintVertexBuffers():[],z,fe.vertexOffset,K,J,oe),se.drawElements(n,fe.primitiveLength*ae,se.UNSIGNED_SHORT,fe.primitiveOffset*ae*2)}}}function Ll(p,e,n){const l=1/c.az(n,1,e.transform.tileZoom),u=Math.pow(2,n.tileID.overscaledZ),f=n.tileSize*Math.pow(2,e.transform.tileZoom)/u,y=f*(n.tileID.canonical.x+n.tileID.wrap*u),w=f*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[l,p.fromScale,p.toScale],u_fade:p.t,u_pixel_coord_upper:[y>>16,w>>16],u_pixel_coord_lower:[65535&y,65535&w]}}const jl=(p,e,n,l)=>{const u=p.style.light,f=u.properties.get("position"),y=[f.x,f.y,f.z],w=c.bN();u.properties.get("anchor")==="viewport"&&c.bO(w,p.transform.bearingInRadians),c.bP(y,y,w);const S=p.transform.transformLightDirection(y),M=u.properties.get("color");return{u_lightpos:y,u_lightpos_globe:S,u_lightintensity:u.properties.get("intensity"),u_lightcolor:[M.r,M.g,M.b],u_vertical_gradient:+e,u_opacity:n,u_fill_translate:l}},is=(p,e,n,l,u,f,y)=>c.e(jl(p,e,n,l),Ll(f,p,y),{u_height_factor:-Math.pow(2,u.overscaledZ)/y.tileSize/8}),ld=(p,e,n,l)=>c.e(Ll(e,p,n),{u_fill_translate:l}),hu=(p,e)=>({u_world:p,u_fill_translate:e}),Da=(p,e,n,l,u)=>c.e(ld(p,e,n,u),{u_world:l}),La=(p,e,n,l,u)=>{const f=p.transform;let y,w,S=0;if(n.paint.get("circle-pitch-alignment")==="map"){const M=c.az(e,1,f.zoom);y=!0,w=[M,M],S=M/(c.Z*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*u}else y=!1,w=f.pixelsToGLUnits;return{u_camera_to_center_distance:f.cameraToCenterDistance,u_scale_with_map:+(n.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+y,u_device_pixel_ratio:p.pixelRatio,u_extrude_scale:w,u_globe_extrude_scale:S,u_translate:l}},Zf=p=>({u_pixel_extrude_scale:[1/p.width,1/p.height]}),Fl=p=>({u_viewport_size:[p.width,p.height]}),cd=(p,e=1)=>({u_color:p,u_overlay:0,u_overlay_scale:e}),po=(p,e,n,l)=>{const u=c.az(p,1,e)/(c.Z*Math.pow(2,p.tileID.overscaledZ))*2*Math.PI*l;return{u_extrude_scale:c.az(p,1,e),u_intensity:n,u_globe_extrude_scale:u}},ud=(p,e,n,l)=>{const u=c.K();c.bQ(u,0,p.width,p.height,0,0,1);const f=p.context.gl;return{u_matrix:u,u_world:[f.drawingBufferWidth,f.drawingBufferHeight],u_image:n,u_color_ramp:l,u_opacity:e.paint.get("heatmap-opacity")}},hd=(p,e,n)=>{const l=n.paint.get("hillshade-accent-color");let u;switch(n.paint.get("hillshade-method")){case"basic":u=4;break;case"combined":u=1;break;case"igor":u=2;break;case"multidirectional":u=3;break;default:u=0}const f=n.getIlluminationProperties();for(let y=0;y<f.directionRadians.length;y++)n.paint.get("hillshade-illumination-anchor")==="viewport"&&(f.directionRadians[y]+=p.transform.bearingInRadians);return{u_image:0,u_latrange:dd(0,e.tileID),u_exaggeration:n.paint.get("hillshade-exaggeration"),u_altitudes:f.altitudeRadians,u_azimuths:f.directionRadians,u_accent:l,u_method:u,u_highlights:f.highlightColor,u_shadows:f.shadowColor}},Gf=(p,e)=>{const n=e.stride,l=c.K();return c.bQ(l,0,c.Z,-8192,0,0,1),c.L(l,l,[0,-8192,0]),{u_matrix:l,u_image:1,u_dimension:[n,n],u_zoom:p.overscaledZ,u_unpack:e.getUnpackVector()}};function dd(p,e){const n=Math.pow(2,e.canonical.z),l=e.canonical.y;return[new c.$(0,l/n).toLngLat().lat,new c.$(0,(l+1)/n).toLngLat().lat]}const ja=(p,e,n,l)=>{const u=p.transform;return{u_translation:Ns(p,e,n),u_ratio:l/c.az(e,1,u.zoom),u_device_pixel_ratio:p.pixelRatio,u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]]}},pd=(p,e,n,l,u)=>c.e(ja(p,e,n,l),{u_image:0,u_image_height:u}),fd=(p,e,n,l,u)=>{const f=p.transform,y=du(e,f);return{u_translation:Ns(p,e,n),u_texsize:e.imageAtlasTexture.size,u_ratio:l/c.az(e,1,f.zoom),u_device_pixel_ratio:p.pixelRatio,u_image:0,u_scale:[y,u.fromScale,u.toScale],u_fade:u.t,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]]}},md=(p,e,n,l,u,f)=>{const y=p.lineAtlas,w=du(e,p.transform),S=n.layout.get("line-cap")==="round",M=y.getDash(u.from,S),E=y.getDash(u.to,S),A=M.width*f.fromScale,z=E.width*f.toScale;return c.e(ja(p,e,n,l),{u_patternscale_a:[w/A,-M.height/2],u_patternscale_b:[w/z,-E.height/2],u_sdfgamma:y.width/(256*Math.min(A,z)*p.pixelRatio)/2,u_image:0,u_tex_y_a:M.y,u_tex_y_b:E.y,u_mix:f.t})};function du(p,e){return 1/c.az(p,1,e.tileZoom)}function Ns(p,e,n){return c.aA(p.transform,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const gd=(p,e,n,l,u)=>{return{u_tl_parent:p,u_scale_parent:e,u_buffer_scale:1,u_fade_t:n.mix,u_opacity:n.opacity*l.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:l.paint.get("raster-brightness-min"),u_brightness_high:l.paint.get("raster-brightness-max"),u_saturation_factor:(y=l.paint.get("raster-saturation"),y>0?1-1/(1.001-y):-y),u_contrast_factor:(f=l.paint.get("raster-contrast"),f>0?1/(1-f):1+f),u_spin_weights:_d(l.paint.get("raster-hue-rotate")),u_coords_top:[u[0].x,u[0].y,u[1].x,u[1].y],u_coords_bottom:[u[3].x,u[3].y,u[2].x,u[2].y]};var f,y};function _d(p){p*=Math.PI/180;const e=Math.sin(p),n=Math.cos(p);return[(2*n+1)/3,(-Math.sqrt(3)*e-n+1)/3,(Math.sqrt(3)*e-n+1)/3]}const Fo=(p,e,n,l,u,f,y,w,S,M,E,A,z)=>{const B=y.transform;return{u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:B.cameraToCenterDistance,u_pitch:B.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:B.width/B.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_label_plane_matrix:w,u_coord_matrix:S,u_is_text:+E,u_pitch_with_map:+l,u_is_along_line:u,u_is_variable_anchor:f,u_texsize:A,u_texture:0,u_translation:M,u_pitched_scale:z}},yd=(p,e,n,l,u,f,y,w,S,M,E,A,z,B)=>{const O=y.transform;return c.e(Fo(p,e,n,l,u,f,y,w,S,M,E,A,B),{u_gamma_scale:l?Math.cos(O.pitch*Math.PI/180)*O.cameraToCenterDistance:1,u_device_pixel_ratio:y.pixelRatio,u_is_halo:1})},Bl=(p,e,n,l,u,f,y,w,S,M,E,A,z)=>c.e(yd(p,e,n,l,u,f,y,w,S,M,!0,E,0,z),{u_texsize_icon:A,u_texture_icon:1}),qf=(p,e)=>({u_opacity:p,u_color:e}),Hf=(p,e,n,l,u)=>c.e(function(f,y,w,S){const M=w.imageManager.getPattern(f.from.toString()),E=w.imageManager.getPattern(f.to.toString()),{width:A,height:z}=w.imageManager.getPixelSize(),B=Math.pow(2,S.tileID.overscaledZ),O=S.tileSize*Math.pow(2,w.transform.tileZoom)/B,X=O*(S.tileID.canonical.x+S.tileID.wrap*B),W=O*S.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:M.tl,u_pattern_br_a:M.br,u_pattern_tl_b:E.tl,u_pattern_br_b:E.br,u_texsize:[A,z],u_mix:y.t,u_pattern_size_a:M.displaySize,u_pattern_size_b:E.displaySize,u_scale_a:y.fromScale,u_scale_b:y.toScale,u_tile_units_to_pixels:1/c.az(S,1,w.transform.tileZoom),u_pixel_coord_upper:[X>>16,W>>16],u_pixel_coord_lower:[65535&X,65535&W]}}(n,u,e,l),{u_opacity:p}),pu=(p,e)=>{},vd={fillExtrusion:(p,e)=>({u_lightpos:new c.bL(p,e.u_lightpos),u_lightpos_globe:new c.bL(p,e.u_lightpos_globe),u_lightintensity:new c.b8(p,e.u_lightintensity),u_lightcolor:new c.bL(p,e.u_lightcolor),u_vertical_gradient:new c.b8(p,e.u_vertical_gradient),u_opacity:new c.b8(p,e.u_opacity),u_fill_translate:new c.bM(p,e.u_fill_translate)}),fillExtrusionPattern:(p,e)=>({u_lightpos:new c.bL(p,e.u_lightpos),u_lightpos_globe:new c.bL(p,e.u_lightpos_globe),u_lightintensity:new c.b8(p,e.u_lightintensity),u_lightcolor:new c.bL(p,e.u_lightcolor),u_vertical_gradient:new c.b8(p,e.u_vertical_gradient),u_height_factor:new c.b8(p,e.u_height_factor),u_opacity:new c.b8(p,e.u_opacity),u_fill_translate:new c.bM(p,e.u_fill_translate),u_image:new c.bH(p,e.u_image),u_texsize:new c.bM(p,e.u_texsize),u_pixel_coord_upper:new c.bM(p,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.bM(p,e.u_pixel_coord_lower),u_scale:new c.bL(p,e.u_scale),u_fade:new c.b8(p,e.u_fade)}),fill:(p,e)=>({u_fill_translate:new c.bM(p,e.u_fill_translate)}),fillPattern:(p,e)=>({u_image:new c.bH(p,e.u_image),u_texsize:new c.bM(p,e.u_texsize),u_pixel_coord_upper:new c.bM(p,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.bM(p,e.u_pixel_coord_lower),u_scale:new c.bL(p,e.u_scale),u_fade:new c.b8(p,e.u_fade),u_fill_translate:new c.bM(p,e.u_fill_translate)}),fillOutline:(p,e)=>({u_world:new c.bM(p,e.u_world),u_fill_translate:new c.bM(p,e.u_fill_translate)}),fillOutlinePattern:(p,e)=>({u_world:new c.bM(p,e.u_world),u_image:new c.bH(p,e.u_image),u_texsize:new c.bM(p,e.u_texsize),u_pixel_coord_upper:new c.bM(p,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.bM(p,e.u_pixel_coord_lower),u_scale:new c.bL(p,e.u_scale),u_fade:new c.b8(p,e.u_fade),u_fill_translate:new c.bM(p,e.u_fill_translate)}),circle:(p,e)=>({u_camera_to_center_distance:new c.b8(p,e.u_camera_to_center_distance),u_scale_with_map:new c.bH(p,e.u_scale_with_map),u_pitch_with_map:new c.bH(p,e.u_pitch_with_map),u_extrude_scale:new c.bM(p,e.u_extrude_scale),u_device_pixel_ratio:new c.b8(p,e.u_device_pixel_ratio),u_globe_extrude_scale:new c.b8(p,e.u_globe_extrude_scale),u_translate:new c.bM(p,e.u_translate)}),collisionBox:(p,e)=>({u_pixel_extrude_scale:new c.bM(p,e.u_pixel_extrude_scale)}),collisionCircle:(p,e)=>({u_viewport_size:new c.bM(p,e.u_viewport_size)}),debug:(p,e)=>({u_color:new c.bI(p,e.u_color),u_overlay:new c.bH(p,e.u_overlay),u_overlay_scale:new c.b8(p,e.u_overlay_scale)}),depth:pu,clippingMask:pu,heatmap:(p,e)=>({u_extrude_scale:new c.b8(p,e.u_extrude_scale),u_intensity:new c.b8(p,e.u_intensity),u_globe_extrude_scale:new c.b8(p,e.u_globe_extrude_scale)}),heatmapTexture:(p,e)=>({u_matrix:new c.bJ(p,e.u_matrix),u_world:new c.bM(p,e.u_world),u_image:new c.bH(p,e.u_image),u_color_ramp:new c.bH(p,e.u_color_ramp),u_opacity:new c.b8(p,e.u_opacity)}),hillshade:(p,e)=>({u_image:new c.bH(p,e.u_image),u_latrange:new c.bM(p,e.u_latrange),u_exaggeration:new c.b8(p,e.u_exaggeration),u_altitudes:new c.bS(p,e.u_altitudes),u_azimuths:new c.bS(p,e.u_azimuths),u_accent:new c.bI(p,e.u_accent),u_method:new c.bH(p,e.u_method),u_shadows:new c.bR(p,e.u_shadows),u_highlights:new c.bR(p,e.u_highlights)}),hillshadePrepare:(p,e)=>({u_matrix:new c.bJ(p,e.u_matrix),u_image:new c.bH(p,e.u_image),u_dimension:new c.bM(p,e.u_dimension),u_zoom:new c.b8(p,e.u_zoom),u_unpack:new c.bK(p,e.u_unpack)}),line:(p,e)=>({u_translation:new c.bM(p,e.u_translation),u_ratio:new c.b8(p,e.u_ratio),u_device_pixel_ratio:new c.b8(p,e.u_device_pixel_ratio),u_units_to_pixels:new c.bM(p,e.u_units_to_pixels)}),lineGradient:(p,e)=>({u_translation:new c.bM(p,e.u_translation),u_ratio:new c.b8(p,e.u_ratio),u_device_pixel_ratio:new c.b8(p,e.u_device_pixel_ratio),u_units_to_pixels:new c.bM(p,e.u_units_to_pixels),u_image:new c.bH(p,e.u_image),u_image_height:new c.b8(p,e.u_image_height)}),linePattern:(p,e)=>({u_translation:new c.bM(p,e.u_translation),u_texsize:new c.bM(p,e.u_texsize),u_ratio:new c.b8(p,e.u_ratio),u_device_pixel_ratio:new c.b8(p,e.u_device_pixel_ratio),u_image:new c.bH(p,e.u_image),u_units_to_pixels:new c.bM(p,e.u_units_to_pixels),u_scale:new c.bL(p,e.u_scale),u_fade:new c.b8(p,e.u_fade)}),lineSDF:(p,e)=>({u_translation:new c.bM(p,e.u_translation),u_ratio:new c.b8(p,e.u_ratio),u_device_pixel_ratio:new c.b8(p,e.u_device_pixel_ratio),u_units_to_pixels:new c.bM(p,e.u_units_to_pixels),u_patternscale_a:new c.bM(p,e.u_patternscale_a),u_patternscale_b:new c.bM(p,e.u_patternscale_b),u_sdfgamma:new c.b8(p,e.u_sdfgamma),u_image:new c.bH(p,e.u_image),u_tex_y_a:new c.b8(p,e.u_tex_y_a),u_tex_y_b:new c.b8(p,e.u_tex_y_b),u_mix:new c.b8(p,e.u_mix)}),raster:(p,e)=>({u_tl_parent:new c.bM(p,e.u_tl_parent),u_scale_parent:new c.b8(p,e.u_scale_parent),u_buffer_scale:new c.b8(p,e.u_buffer_scale),u_fade_t:new c.b8(p,e.u_fade_t),u_opacity:new c.b8(p,e.u_opacity),u_image0:new c.bH(p,e.u_image0),u_image1:new c.bH(p,e.u_image1),u_brightness_low:new c.b8(p,e.u_brightness_low),u_brightness_high:new c.b8(p,e.u_brightness_high),u_saturation_factor:new c.b8(p,e.u_saturation_factor),u_contrast_factor:new c.b8(p,e.u_contrast_factor),u_spin_weights:new c.bL(p,e.u_spin_weights),u_coords_top:new c.bK(p,e.u_coords_top),u_coords_bottom:new c.bK(p,e.u_coords_bottom)}),symbolIcon:(p,e)=>({u_is_size_zoom_constant:new c.bH(p,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.bH(p,e.u_is_size_feature_constant),u_size_t:new c.b8(p,e.u_size_t),u_size:new c.b8(p,e.u_size),u_camera_to_center_distance:new c.b8(p,e.u_camera_to_center_distance),u_pitch:new c.b8(p,e.u_pitch),u_rotate_symbol:new c.bH(p,e.u_rotate_symbol),u_aspect_ratio:new c.b8(p,e.u_aspect_ratio),u_fade_change:new c.b8(p,e.u_fade_change),u_label_plane_matrix:new c.bJ(p,e.u_label_plane_matrix),u_coord_matrix:new c.bJ(p,e.u_coord_matrix),u_is_text:new c.bH(p,e.u_is_text),u_pitch_with_map:new c.bH(p,e.u_pitch_with_map),u_is_along_line:new c.bH(p,e.u_is_along_line),u_is_variable_anchor:new c.bH(p,e.u_is_variable_anchor),u_texsize:new c.bM(p,e.u_texsize),u_texture:new c.bH(p,e.u_texture),u_translation:new c.bM(p,e.u_translation),u_pitched_scale:new c.b8(p,e.u_pitched_scale)}),symbolSDF:(p,e)=>({u_is_size_zoom_constant:new c.bH(p,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.bH(p,e.u_is_size_feature_constant),u_size_t:new c.b8(p,e.u_size_t),u_size:new c.b8(p,e.u_size),u_camera_to_center_distance:new c.b8(p,e.u_camera_to_center_distance),u_pitch:new c.b8(p,e.u_pitch),u_rotate_symbol:new c.bH(p,e.u_rotate_symbol),u_aspect_ratio:new c.b8(p,e.u_aspect_ratio),u_fade_change:new c.b8(p,e.u_fade_change),u_label_plane_matrix:new c.bJ(p,e.u_label_plane_matrix),u_coord_matrix:new c.bJ(p,e.u_coord_matrix),u_is_text:new c.bH(p,e.u_is_text),u_pitch_with_map:new c.bH(p,e.u_pitch_with_map),u_is_along_line:new c.bH(p,e.u_is_along_line),u_is_variable_anchor:new c.bH(p,e.u_is_variable_anchor),u_texsize:new c.bM(p,e.u_texsize),u_texture:new c.bH(p,e.u_texture),u_gamma_scale:new c.b8(p,e.u_gamma_scale),u_device_pixel_ratio:new c.b8(p,e.u_device_pixel_ratio),u_is_halo:new c.bH(p,e.u_is_halo),u_translation:new c.bM(p,e.u_translation),u_pitched_scale:new c.b8(p,e.u_pitched_scale)}),symbolTextAndIcon:(p,e)=>({u_is_size_zoom_constant:new c.bH(p,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.bH(p,e.u_is_size_feature_constant),u_size_t:new c.b8(p,e.u_size_t),u_size:new c.b8(p,e.u_size),u_camera_to_center_distance:new c.b8(p,e.u_camera_to_center_distance),u_pitch:new c.b8(p,e.u_pitch),u_rotate_symbol:new c.bH(p,e.u_rotate_symbol),u_aspect_ratio:new c.b8(p,e.u_aspect_ratio),u_fade_change:new c.b8(p,e.u_fade_change),u_label_plane_matrix:new c.bJ(p,e.u_label_plane_matrix),u_coord_matrix:new c.bJ(p,e.u_coord_matrix),u_is_text:new c.bH(p,e.u_is_text),u_pitch_with_map:new c.bH(p,e.u_pitch_with_map),u_is_along_line:new c.bH(p,e.u_is_along_line),u_is_variable_anchor:new c.bH(p,e.u_is_variable_anchor),u_texsize:new c.bM(p,e.u_texsize),u_texsize_icon:new c.bM(p,e.u_texsize_icon),u_texture:new c.bH(p,e.u_texture),u_texture_icon:new c.bH(p,e.u_texture_icon),u_gamma_scale:new c.b8(p,e.u_gamma_scale),u_device_pixel_ratio:new c.b8(p,e.u_device_pixel_ratio),u_is_halo:new c.bH(p,e.u_is_halo),u_translation:new c.bM(p,e.u_translation),u_pitched_scale:new c.b8(p,e.u_pitched_scale)}),background:(p,e)=>({u_opacity:new c.b8(p,e.u_opacity),u_color:new c.bI(p,e.u_color)}),backgroundPattern:(p,e)=>({u_opacity:new c.b8(p,e.u_opacity),u_image:new c.bH(p,e.u_image),u_pattern_tl_a:new c.bM(p,e.u_pattern_tl_a),u_pattern_br_a:new c.bM(p,e.u_pattern_br_a),u_pattern_tl_b:new c.bM(p,e.u_pattern_tl_b),u_pattern_br_b:new c.bM(p,e.u_pattern_br_b),u_texsize:new c.bM(p,e.u_texsize),u_mix:new c.b8(p,e.u_mix),u_pattern_size_a:new c.bM(p,e.u_pattern_size_a),u_pattern_size_b:new c.bM(p,e.u_pattern_size_b),u_scale_a:new c.b8(p,e.u_scale_a),u_scale_b:new c.b8(p,e.u_scale_b),u_pixel_coord_upper:new c.bM(p,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.bM(p,e.u_pixel_coord_lower),u_tile_units_to_pixels:new c.b8(p,e.u_tile_units_to_pixels)}),terrain:(p,e)=>({u_texture:new c.bH(p,e.u_texture),u_ele_delta:new c.b8(p,e.u_ele_delta),u_fog_matrix:new c.bJ(p,e.u_fog_matrix),u_fog_color:new c.bI(p,e.u_fog_color),u_fog_ground_blend:new c.b8(p,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new c.b8(p,e.u_fog_ground_blend_opacity),u_horizon_color:new c.bI(p,e.u_horizon_color),u_horizon_fog_blend:new c.b8(p,e.u_horizon_fog_blend),u_is_globe_mode:new c.b8(p,e.u_is_globe_mode)}),terrainDepth:(p,e)=>({u_ele_delta:new c.b8(p,e.u_ele_delta)}),terrainCoords:(p,e)=>({u_texture:new c.bH(p,e.u_texture),u_terrain_coords_id:new c.b8(p,e.u_terrain_coords_id),u_ele_delta:new c.b8(p,e.u_ele_delta)}),projectionErrorMeasurement:(p,e)=>({u_input:new c.b8(p,e.u_input),u_output_expected:new c.b8(p,e.u_output_expected)}),atmosphere:(p,e)=>({u_sun_pos:new c.bL(p,e.u_sun_pos),u_atmosphere_blend:new c.b8(p,e.u_atmosphere_blend),u_globe_position:new c.bL(p,e.u_globe_position),u_globe_radius:new c.b8(p,e.u_globe_radius),u_inv_proj_matrix:new c.bJ(p,e.u_inv_proj_matrix)}),sky:(p,e)=>({u_sky_color:new c.bI(p,e.u_sky_color),u_horizon_color:new c.bI(p,e.u_horizon_color),u_horizon:new c.bM(p,e.u_horizon),u_horizon_normal:new c.bM(p,e.u_horizon_normal),u_sky_horizon_blend:new c.b8(p,e.u_sky_horizon_blend),u_sky_blend:new c.b8(p,e.u_sky_blend)})};class xd{constructor(e,n,l){this.context=e;const u=e.gl;this.buffer=u.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),u.bufferData(u.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?u.DYNAMIC_DRAW:u.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const n=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const fu={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class bd{constructor(e,n,l,u){this.length=n.length,this.attributes=l,this.itemSize=n.bytesPerElement,this.dynamicDraw=u,this.context=e;const f=e.gl;this.buffer=f.createBuffer(),e.bindVertexBuffer.set(this.buffer),f.bufferData(f.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,n){for(let l=0;l<this.attributes.length;l++){const u=n.attributes[this.attributes[l].name];u!==void 0&&e.enableVertexAttribArray(u)}}setVertexAttribPointers(e,n,l){for(let u=0;u<this.attributes.length;u++){const f=this.attributes[u],y=n.attributes[f.name];y!==void 0&&e.vertexAttribPointer(y,f.components,e[fu[f.type]],!1,this.itemSize,f.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class lr{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class xs extends lr{getDefault(){return c.b7.transparent}set(e){const n=this.current;(e.r!==n.r||e.g!==n.g||e.b!==n.b||e.a!==n.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class mu extends lr{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class gu extends lr{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class _u extends lr{getDefault(){return[!0,!0,!0,!0]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class wd extends lr{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class yu extends lr{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class fo extends lr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const n=this.current;(e.func!==n.func||e.ref!==n.ref||e.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class vu extends lr{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Wf extends lr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=e,this.dirty=!1}}class Xf extends lr{getDefault(){return[0,1]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Kf extends lr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=e,this.dirty=!1}}class Yf extends lr{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Td extends lr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.BLEND):n.disable(n.BLEND),this.current=e,this.dirty=!1}}class Qf extends lr{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Sd extends lr{getDefault(){return c.b7.transparent}set(e){const n=this.current;(e.r!==n.r||e.g!==n.g||e.b!==n.b||e.a!==n.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Ol extends lr{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Nl extends lr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=e,this.dirty=!1}}class Vl extends lr{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class xu extends lr{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class mo extends lr{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class $l extends lr{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Bo extends lr{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class wi extends lr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Pd extends lr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Cd extends lr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class bu extends lr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class go extends lr{getDefault(){return null}set(e){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Ul extends lr{getDefault(){return null}set(e){var n;if(e===this.current&&!this.dirty)return;const l=this.gl;Bn(l)?l.bindVertexArray(e):(n=l.getExtension("OES_vertex_array_object"))===null||n===void 0||n.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class Zl extends lr{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class Fa extends lr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Gl extends lr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class ql extends lr{constructor(e,n){super(e),this.context=e,this.parent=n}getDefault(){return null}}class Oo extends ql{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class No extends ql{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Md extends ql{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}const Hl="Framebuffer is not complete";class Qt{constructor(e,n,l,u,f){this.context=e,this.width=n,this.height=l;const y=e.gl,w=this.framebuffer=y.createFramebuffer();if(this.colorAttachment=new Oo(e,w),u)this.depthAttachment=f?new Md(e,w):new No(e,w);else if(f)throw new Error("Stencil cannot be set without depth");if(y.checkFramebufferStatus(y.FRAMEBUFFER)!==y.FRAMEBUFFER_COMPLETE)throw new Error(Hl)}destroy(){const e=this.context.gl,n=this.colorAttachment.get();if(n&&e.deleteTexture(n),this.depthAttachment){const l=this.depthAttachment.get();l&&e.deleteRenderbuffer(l)}e.deleteFramebuffer(this.framebuffer)}}class Wl{constructor(e){var n,l;if(this.gl=e,this.clearColor=new xs(this),this.clearDepth=new mu(this),this.clearStencil=new gu(this),this.colorMask=new _u(this),this.depthMask=new wd(this),this.stencilMask=new yu(this),this.stencilFunc=new fo(this),this.stencilOp=new vu(this),this.stencilTest=new Wf(this),this.depthRange=new Xf(this),this.depthTest=new Kf(this),this.depthFunc=new Yf(this),this.blend=new Td(this),this.blendFunc=new Qf(this),this.blendColor=new Sd(this),this.blendEquation=new Ol(this),this.cullFace=new Nl(this),this.cullFaceSide=new Vl(this),this.frontFace=new xu(this),this.program=new mo(this),this.activeTexture=new $l(this),this.viewport=new Bo(this),this.bindFramebuffer=new wi(this),this.bindRenderbuffer=new Pd(this),this.bindTexture=new Cd(this),this.bindVertexBuffer=new bu(this),this.bindElementBuffer=new go(this),this.bindVertexArray=new Ul(this),this.pixelStoreUnpack=new Zl(this),this.pixelStoreUnpackPremultiplyAlpha=new Fa(this),this.pixelStoreUnpackFlipY=new Gl(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),Bn(e)){this.HALF_FLOAT=e.HALF_FLOAT;const u=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(n=e.RGBA16F)!==null&&n!==void 0?n:u==null?void 0:u.RGBA16F_EXT,this.RGB16F=(l=e.RGB16F)!==null&&l!==void 0?l:u==null?void 0:u.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const u=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=u==null?void 0:u.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,n){return new xd(this,e,n)}createVertexBuffer(e,n,l){return new bd(this,e,n,l)}createRenderbuffer(e,n,l){const u=this.gl,f=u.createRenderbuffer();return this.bindRenderbuffer.set(f),u.renderbufferStorage(u.RENDERBUFFER,e,n,l),this.bindRenderbuffer.set(null),f}createFramebuffer(e,n,l,u){return new Qt(this,e,n,l,u)}clear({color:e,depth:n,stencil:l}){const u=this.gl;let f=0;e&&(f|=u.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),n!==void 0&&(f|=u.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),l!==void 0&&(f|=u.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),u.clear(f)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){c.bE(e.blendFunction,vr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return Bn(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var n;return Bn(this.gl)?this.gl.deleteVertexArray(e):(n=this.gl.getExtension("OES_vertex_array_object"))===null||n===void 0?void 0:n.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let Xl;function wu(p,e,n,l,u){const f=p.context,y=p.transform,w=f.gl,S=p.useProgram("collisionBox"),M=[];let E=0,A=0;for(let K=0;K<l.length;K++){const J=l[K],oe=e.getTile(J).getBucket(n);if(!oe)continue;const se=u?oe.textCollisionBox:oe.iconCollisionBox,ae=oe.collisionCircleArray;ae.length>0&&(M.push({circleArray:ae,circleOffset:A,coord:J}),E+=ae.length/4,A=E),se&&S.draw(f,w.LINES,jt.disabled,Vt.disabled,p.colorModeForRenderPass(),ir.disabled,Zf(p.transform),p.style.map.terrain&&p.style.map.terrain.getTerrainData(J),y.getProjectionData({overscaledTileID:J,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),n.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,null,p.transform.zoom,null,null,se.collisionVertexBuffer)}if(!u||!M.length)return;const z=p.useProgram("collisionCircle"),B=new c.bT;B.resize(4*E),B._trim();let O=0;for(const K of M)for(let J=0;J<K.circleArray.length/4;J++){const oe=4*J,se=K.circleArray[oe+0],ae=K.circleArray[oe+1],fe=K.circleArray[oe+2],ue=K.circleArray[oe+3];B.emplace(O++,se,ae,fe,ue,0),B.emplace(O++,se,ae,fe,ue,1),B.emplace(O++,se,ae,fe,ue,2),B.emplace(O++,se,ae,fe,ue,3)}(!Xl||Xl.length<2*E)&&(Xl=function(K){const J=2*K,oe=new c.bV;oe.resize(J),oe._trim();for(let se=0;se<J;se++){const ae=6*se;oe.uint16[ae+0]=4*se+0,oe.uint16[ae+1]=4*se+1,oe.uint16[ae+2]=4*se+2,oe.uint16[ae+3]=4*se+2,oe.uint16[ae+4]=4*se+3,oe.uint16[ae+5]=4*se+0}return oe}(E));const X=f.createIndexBuffer(Xl,!0),W=f.createVertexBuffer(B,c.bU.members,!0);for(const K of M){const J=Fl(p.transform);z.draw(f,w.TRIANGLES,jt.disabled,Vt.disabled,p.colorModeForRenderPass(),ir.disabled,J,p.style.map.terrain&&p.style.map.terrain.getTerrainData(K.coord),null,n.id,W,X,c.aJ.simpleSegment(0,2*K.circleOffset,K.circleArray.length,K.circleArray.length/2),null,p.transform.zoom,null,null,null)}W.destroy(),X.destroy()}const Ba=c.ad(new Float32Array(16));function Jf(p,e,n,l,u,f){const{horizontalAlign:y,verticalAlign:w}=c.aE(p);return new c.P((-(y-.5)*e/u+l[0])*f,(-(w-.5)*n/u+l[1])*f)}function em(p,e,n,l,u,f){const y=e.tileAnchorPoint.add(new c.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let w=l.mult(f);n||(w=w.rotate(-u));const S=y.add(w);return Ie(S.x,S.y,e.pitchedLabelPlaneMatrix,e.getElevation).point}if(n){const w=Rr(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(p),S=Math.atan(w.y/w.x)+(w.x<0?Math.PI:0);return p.add(l.rotate(S))}return p.add(l)}function kd(p,e,n,l,u,f,y,w,S,M,E,A){const z=p.text.placedSymbolArray,B=p.text.dynamicLayoutVertexArray,O=p.icon.dynamicLayoutVertexArray,X={};B.clear();for(let W=0;W<z.length;W++){const K=z.get(W),J=K.hidden||!K.crossTileID||p.allowVerticalPlacement&&!K.placedOrientation?null:l[K.crossTileID];if(J){const oe=new c.P(K.anchorX,K.anchorY),se={getElevation:A,width:u.width,height:u.height,pitchedLabelPlaneMatrix:f,pitchWithMap:n,transform:u,tileAnchorPoint:oe,translation:M,unwrappedTileID:E},ae=n?Ft(oe.x,oe.y,se):Rr(oe.x,oe.y,se),fe=or(u.cameraToCenterDistance,ae.signedDistanceFromCamera);let ue=c.am(p.textSizeData,w,K)*fe/c.ay;n&&(ue*=p.tilePixelRatio/y);const{width:Se,height:Fe,anchor:ke,textOffset:Ee,textBoxScale:ze}=J,nt=Jf(ke,Se,Fe,Ee,ze,ue),et=u.getPitchedTextCorrection(oe.x+M[0],oe.y+M[1],E),Ze=em(ae.point,se,e,nt,-u.bearingInRadians,et),dt=p.allowVerticalPlacement&&K.placedOrientation===c.al.vertical?Math.PI/2:0;for(let $t=0;$t<K.numGlyphs;$t++)c.as(B,Ze,dt);S&&K.associatedIconIndex>=0&&(X[K.associatedIconIndex]={shiftedAnchor:Ze,angle:dt})}else ji(K.numGlyphs,B)}if(S){O.clear();const W=p.icon.placedSymbolArray;for(let K=0;K<W.length;K++){const J=W.get(K);if(J.hidden)ji(J.numGlyphs,O);else{const oe=X[K];if(oe)for(let se=0;se<J.numGlyphs;se++)c.as(O,oe.shiftedAnchor,oe.angle);else ji(J.numGlyphs,O)}}p.icon.dynamicLayoutVertexBuffer.updateData(O)}p.text.dynamicLayoutVertexBuffer.updateData(B)}function tm(p,e,n){return n.iconsInText&&e?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function Kl(p,e,n,l,u,f,y,w,S,M,E,A,z){const B=p.context,O=B.gl,X=p.transform,W=w==="map",K=S==="map",J=w!=="viewport"&&n.layout.get("symbol-placement")!=="point",oe=W&&!K&&!J,se=!n.layout.get("symbol-sort-key").isConstant();let ae=!1;const fe=p.getDepthModeForSublayer(0,jt.ReadOnly),ue=n._unevaluatedLayout.hasValue("text-variable-anchor")||n._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Se=[],Fe=X.getCircleRadiusCorrection();for(const ke of l){const Ee=e.getTile(ke),ze=Ee.getBucket(n);if(!ze)continue;const nt=u?ze.text:ze.icon;if(!nt||!nt.segments.get().length||!nt.hasVisibleVertices)continue;const et=nt.programConfigurations.get(n.id),Ze=u||ze.sdfIcons,dt=u?ze.textSizeData:ze.iconSizeData,$t=K||X.pitch!==0,sr=p.useProgram(tm(Ze,u,ze),et),Lr=c.ak(dt,X.zoom),wr=p.style.map.terrain&&p.style.map.terrain.getTerrainData(ke);let jr,Ir,xr,pr,pn=[0,0],wn=null;if(u)Ir=Ee.glyphAtlasTexture,xr=O.LINEAR,jr=Ee.glyphAtlasTexture.size,ze.iconsInText&&(pn=Ee.imageAtlasTexture.size,wn=Ee.imageAtlasTexture,pr=$t||p.options.rotating||p.options.zooming||dt.kind==="composite"||dt.kind==="camera"?O.LINEAR:O.NEAREST);else{const sn=n.layout.get("icon-size").constantOr(0)!==1||ze.iconsNeedLinear;Ir=Ee.imageAtlasTexture,xr=Ze||p.options.rotating||p.options.zooming||sn||$t?O.LINEAR:O.NEAREST,jr=Ee.imageAtlasTexture.size}const zn=c.az(Ee,1,p.transform.zoom),fr=xt(W,p.transform,zn),$s=c.K();c.an($s,fr);const as=Lt(K,W,p.transform,zn),Us=c.aA(X,Ee,f,y),vo=X.getProjectionData({overscaledTileID:ke,applyGlobeMatrix:!z,applyTerrainMatrix:!0}),Ja=ue&&ze.hasTextData(),Zs=n.layout.get("icon-text-fit")!=="none"&&Ja&&ze.hasIconData();if(J){const sn=p.style.map.terrain?(Kn,Ar)=>p.style.map.terrain.getElevation(ke,Kn,Ar):null,on=n.layout.get("text-rotation-alignment")==="map";tr(ze,p,u,fr,$s,K,M,on,ke.toUnwrapped(),X.width,X.height,Us,sn)}const xo=u&&ue||Zs,di=J||xo?Ba:K?fr:p.transform.clipSpaceToPixelsMatrix,Gs=Ze&&n.paint.get(u?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ws;ws=Ze?ze.iconsInText?Bl(dt.kind,Lr,oe,K,J,xo,p,di,as,Us,jr,pn,Fe):yd(dt.kind,Lr,oe,K,J,xo,p,di,as,Us,u,jr,0,Fe):Fo(dt.kind,Lr,oe,K,J,xo,p,di,as,Us,u,jr,Fe);const qs={program:sr,buffers:nt,uniformValues:ws,projectionData:vo,atlasTexture:Ir,atlasTextureIcon:wn,atlasInterpolation:xr,atlasInterpolationIcon:pr,isSDF:Ze,hasHalo:Gs};if(se&&ze.canOverlap){ae=!0;const sn=nt.segments.get();for(const on of sn)Se.push({segments:new c.aJ([on]),sortKey:on.sortKey,state:qs,terrainData:wr})}else Se.push({segments:nt.segments,sortKey:0,state:qs,terrainData:wr})}ae&&Se.sort((ke,Ee)=>ke.sortKey-Ee.sortKey);for(const ke of Se){const Ee=ke.state;if(B.activeTexture.set(O.TEXTURE0),Ee.atlasTexture.bind(Ee.atlasInterpolation,O.CLAMP_TO_EDGE),Ee.atlasTextureIcon&&(B.activeTexture.set(O.TEXTURE1),Ee.atlasTextureIcon&&Ee.atlasTextureIcon.bind(Ee.atlasInterpolationIcon,O.CLAMP_TO_EDGE)),Ee.isSDF){const ze=Ee.uniformValues;Ee.hasHalo&&(ze.u_is_halo=1,Oa(Ee.buffers,ke.segments,n,p,Ee.program,fe,E,A,ze,Ee.projectionData,ke.terrainData)),ze.u_is_halo=0}Oa(Ee.buffers,ke.segments,n,p,Ee.program,fe,E,A,Ee.uniformValues,Ee.projectionData,ke.terrainData)}}function Oa(p,e,n,l,u,f,y,w,S,M,E){const A=l.context;u.draw(A,A.gl.TRIANGLES,f,y,w,ir.backCCW,S,E,M,n.id,p.layoutVertexBuffer,p.indexBuffer,e,n.paint,l.transform.zoom,p.programConfigurations.get(n.id),p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer)}function Yl(p,e,n,l,u){const f=p.context,y=f.gl,w=Vt.disabled,S=new vr([y.ONE,y.ONE],c.b7.transparent,[!0,!0,!0,!0]),M=e.getBucket(n);if(!M)return;const E=l.key;let A=n.heatmapFbos.get(E);A||(A=Ql(f,e.tileSize,e.tileSize),n.heatmapFbos.set(E,A)),f.bindFramebuffer.set(A.framebuffer),f.viewport.set([0,0,e.tileSize,e.tileSize]),f.clear({color:c.b7.transparent});const z=M.programConfigurations.get(n.id),B=p.useProgram("heatmap",z,!u),O=p.transform.getProjectionData({overscaledTileID:e.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),X=p.style.map.terrain.getTerrainData(l);B.draw(f,y.TRIANGLES,jt.disabled,w,S,ir.disabled,po(e,p.transform.zoom,n.paint.get("heatmap-intensity"),1),X,O,n.id,M.layoutVertexBuffer,M.indexBuffer,M.segments,n.paint,p.transform.zoom,z)}function Tu(p,e,n,l,u){const f=p.context,y=f.gl,w=p.transform;f.setColorMode(p.colorModeForRenderPass());const S=Su(f,e),M=n.key,E=e.heatmapFbos.get(M);if(!E)return;f.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,E.colorAttachment.get()),f.activeTexture.set(y.TEXTURE1),S.bind(y.LINEAR,y.CLAMP_TO_EDGE);const A=w.getProjectionData({overscaledTileID:n,applyTerrainMatrix:u,applyGlobeMatrix:!l});p.useProgram("heatmapTexture").draw(f,y.TRIANGLES,jt.disabled,Vt.disabled,p.colorModeForRenderPass(),ir.disabled,ud(p,e,0,1),null,A,e.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments,e.paint,w.zoom),E.destroy(),e.heatmapFbos.delete(M)}function Ql(p,e,n){var l,u;const f=p.gl,y=f.createTexture();f.bindTexture(f.TEXTURE_2D,y),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR);const w=(l=p.HALF_FLOAT)!==null&&l!==void 0?l:f.UNSIGNED_BYTE,S=(u=p.RGBA16F)!==null&&u!==void 0?u:f.RGBA;f.texImage2D(f.TEXTURE_2D,0,S,e,n,0,f.RGBA,w,null);const M=p.createFramebuffer(e,n,!1,!1);return M.colorAttachment.set(y),M}function Su(p,e){return e.colorRampTexture||(e.colorRampTexture=new rt(p,e.colorRamp,p.gl.RGBA)),e.colorRampTexture}function Na(p,e,n,l,u){if(!n||!l||!l.imageAtlas)return;const f=l.imageAtlas.patternPositions;let y=f[n.to.toString()],w=f[n.from.toString()];if(!y&&w&&(y=w),!w&&y&&(w=y),!y||!w){const S=u.getPaintProperty(e);y=f[S],w=f[S]}y&&w&&p.setConstantPatternPositions(y,w)}function Va(p,e,n,l,u,f,y,w){const S=p.context.gl,M="fill-pattern",E=n.paint.get(M),A=E&&E.constantOr(1),z=n.getCrossfadeParameters();let B,O,X,W,K;const J=p.transform,oe=n.paint.get("fill-translate"),se=n.paint.get("fill-translate-anchor");y?(O=A&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=S.LINES):(O=A?"fillPattern":"fill",B=S.TRIANGLES);const ae=E.constantOr(null);for(const fe of l){const ue=e.getTile(fe);if(A&&!ue.patternsLoaded())continue;const Se=ue.getBucket(n);if(!Se)continue;const Fe=Se.programConfigurations.get(n.id),ke=p.useProgram(O,Fe),Ee=p.style.map.terrain&&p.style.map.terrain.getTerrainData(fe);A&&(p.context.activeTexture.set(S.TEXTURE0),ue.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),Fe.updatePaintBuffers(z)),Na(Fe,M,ae,ue,n);const ze=J.getProjectionData({overscaledTileID:fe,applyGlobeMatrix:!w,applyTerrainMatrix:!0}),nt=c.aA(J,ue,oe,se);if(y){W=Se.indexBuffer2,K=Se.segments2;const Ze=[S.drawingBufferWidth,S.drawingBufferHeight];X=O==="fillOutlinePattern"&&A?Da(p,z,ue,Ze,nt):hu(Ze,nt)}else W=Se.indexBuffer,K=Se.segments,X=A?ld(p,z,ue,nt):{u_fill_translate:nt};let et;if(p.renderPass==="translucent"&&w){const[Ze]=p.getStencilConfigForOverlapAndUpdateStencilID(l);et=Ze[fe.overscaledZ]}else et=p.stencilModeForClipping(fe);ke.draw(p.context,B,u,et,f,ir.backCCW,X,Ee,ze,n.id,Se.layoutVertexBuffer,W,K,n.paint,p.transform.zoom,Fe)}}function $a(p,e,n,l,u,f,y,w){const S=p.context,M=S.gl,E="fill-extrusion-pattern",A=n.paint.get(E),z=A.constantOr(1),B=n.getCrossfadeParameters(),O=n.paint.get("fill-extrusion-opacity"),X=A.constantOr(null),W=p.transform;for(const K of l){const J=e.getTile(K),oe=J.getBucket(n);if(!oe)continue;const se=p.style.map.terrain&&p.style.map.terrain.getTerrainData(K),ae=oe.programConfigurations.get(n.id),fe=p.useProgram(z?"fillExtrusionPattern":"fillExtrusion",ae);z&&(p.context.activeTexture.set(M.TEXTURE0),J.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),ae.updatePaintBuffers(B));const ue=W.getProjectionData({overscaledTileID:K,applyGlobeMatrix:!w,applyTerrainMatrix:!0});Na(ae,E,X,J,n);const Se=c.aA(W,J,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),Fe=n.paint.get("fill-extrusion-vertical-gradient"),ke=z?is(p,Fe,O,Se,K,B,J):jl(p,Fe,O,Se);fe.draw(S,S.gl.TRIANGLES,u,f,y,ir.backCCW,ke,se,ue,n.id,oe.layoutVertexBuffer,oe.indexBuffer,oe.segments,n.paint,p.transform.zoom,ae,p.style.map.terrain&&oe.centroidVertexBuffer)}}function Pu(p,e,n,l,u,f,y,w,S){var M;const E=p.style.projection,A=p.context,z=p.transform,B=A.gl,O=[`#define NUM_ILLUMINATION_SOURCES ${n.paint.get("hillshade-highlight-color").values.length}`],X=p.useProgram("hillshade",null,!1,O),W=!p.options.moving;for(const K of l){const J=e.getTile(K),oe=J.fbo;if(!oe)continue;const se=E.getMeshFromTileID(A,K.canonical,w,!0,"raster"),ae=(M=p.style.map.terrain)===null||M===void 0?void 0:M.getTerrainData(K);A.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,oe.colorAttachment.get());const fe=z.getProjectionData({overscaledTileID:K,aligned:W,applyGlobeMatrix:!S,applyTerrainMatrix:!0});X.draw(A,B.TRIANGLES,f,u[K.overscaledZ],y,ir.backCCW,hd(p,J,n),ae,fe,n.id,se.vertexBuffer,se.indexBuffer,se.segments)}}const Ua=[new c.P(0,0),new c.P(c.Z,0),new c.P(c.Z,c.Z),new c.P(0,c.Z)];function Jl(p,e,n,l,u,f,y,w,S=!1,M=!1){const E=l[l.length-1].overscaledZ,A=p.context,z=A.gl,B=p.useProgram("raster"),O=p.transform,X=p.style.projection,W=p.colorModeForRenderPass(),K=!p.options.moving;for(const J of l){const oe=p.getDepthModeForSublayer(J.overscaledZ-E,n.paint.get("raster-opacity")===1?jt.ReadWrite:jt.ReadOnly,z.LESS),se=e.getTile(J);se.registerFadeDuration(n.paint.get("raster-fade-duration"));const ae=e.findLoadedParent(J,0),fe=e.findLoadedSibling(J),ue=Ed(se,ae||fe||null,e,n,p.transform,p.style.map.terrain);let Se,Fe;const ke=n.paint.get("raster-resampling")==="nearest"?z.NEAREST:z.LINEAR;A.activeTexture.set(z.TEXTURE0),se.texture.bind(ke,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST),A.activeTexture.set(z.TEXTURE1),ae?(ae.texture.bind(ke,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST),Se=Math.pow(2,ae.tileID.overscaledZ-se.tileID.overscaledZ),Fe=[se.tileID.canonical.x*Se%1,se.tileID.canonical.y*Se%1]):se.texture.bind(ke,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST),se.texture.useMipmap&&A.extTextureFilterAnisotropic&&p.transform.pitch>20&&z.texParameterf(z.TEXTURE_2D,A.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,A.extTextureFilterAnisotropicMax);const Ee=p.style.map.terrain&&p.style.map.terrain.getTerrainData(J),ze=O.getProjectionData({overscaledTileID:J,aligned:K,applyGlobeMatrix:!M,applyTerrainMatrix:!0}),nt=gd(Fe||[0,0],Se||1,ue,n,w),et=X.getMeshFromTileID(A,J.canonical,f,y,"raster");B.draw(A,z.TRIANGLES,oe,u?u[J.overscaledZ]:Vt.disabled,W,S?ir.frontCCW:ir.backCCW,nt,Ee,ze,n.id,et.vertexBuffer,et.indexBuffer,et.segments)}}function Ed(p,e,n,l,u,f){const y=l.paint.get("raster-fade-duration");if(!f&&y>0){const w=me.now(),S=(w-p.timeAdded)/y,M=e?(w-e.timeAdded)/y:-1,E=n.getSource(),A=Te(u,{tileSize:E.tileSize,roundZoom:E.roundZoom}),z=!e||Math.abs(e.tileID.overscaledZ-A)>Math.abs(p.tileID.overscaledZ-A),B=z&&p.refreshedUponExpiration?1:c.ae(z?S:1-M,0,1);return p.refreshedUponExpiration&&S>=1&&(p.refreshedUponExpiration=!1),e?{opacity:1,mix:1-B}:{opacity:B,mix:0}}return{opacity:1,mix:0}}const ec=new c.b7(1,0,0,1),Cu=new c.b7(0,1,0,1),Id=new c.b7(0,0,1,1),Ad=new c.b7(1,0,1,1),tc=new c.b7(0,1,1,1);function rc(p,e,n,l){Za(p,0,e+n/2,p.transform.width,n,l)}function zd(p,e,n,l){Za(p,e-n/2,0,n,p.transform.height,l)}function Za(p,e,n,l,u,f){const y=p.context,w=y.gl;w.enable(w.SCISSOR_TEST),w.scissor(e*p.pixelRatio,n*p.pixelRatio,l*p.pixelRatio,u*p.pixelRatio),y.clear({color:f}),w.disable(w.SCISSOR_TEST)}function Hr(p,e,n){const l=p.context,u=l.gl,f=p.useProgram("debug"),y=jt.disabled,w=Vt.disabled,S=p.colorModeForRenderPass(),M="$debug",E=p.style.map.terrain&&p.style.map.terrain.getTerrainData(n);l.activeTexture.set(u.TEXTURE0);const A=e.getTileByID(n.key).latestRawTileData,z=Math.floor((A&&A.byteLength||0)/1024),B=e.getTile(n).tileSize,O=512/Math.min(B,512)*(n.overscaledZ/p.transform.zoom)*.5;let X=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(X+=` => ${n.overscaledZ}`),function(K,J){K.initDebugOverlayCanvas();const oe=K.debugOverlayCanvas,se=K.context.gl,ae=K.debugOverlayCanvas.getContext("2d");ae.clearRect(0,0,oe.width,oe.height),ae.shadowColor="white",ae.shadowBlur=2,ae.lineWidth=1.5,ae.strokeStyle="white",ae.textBaseline="top",ae.font="bold 36px Open Sans, sans-serif",ae.fillText(J,5,5),ae.strokeText(J,5,5),K.debugOverlayTexture.update(oe),K.debugOverlayTexture.bind(se.LINEAR,se.CLAMP_TO_EDGE)}(p,`${X} ${z}kB`);const W=p.transform.getProjectionData({overscaledTileID:n,applyGlobeMatrix:!0,applyTerrainMatrix:!0});f.draw(l,u.TRIANGLES,y,w,vr.alphaBlended,ir.disabled,cd(c.b7.transparent,O),null,W,M,p.debugBuffer,p.quadTriangleIndexBuffer,p.debugSegments),f.draw(l,u.LINE_STRIP,y,w,S,ir.disabled,cd(c.b7.red),E,W,M,p.debugBuffer,p.tileBorderIndexBuffer,p.debugSegments)}function Vs(p,e,n,l){const{isRenderingGlobe:u}=l,f=p.context,y=f.gl,w=p.transform,S=p.colorModeForRenderPass(),M=p.getDepthModeFor3D(),E=p.useProgram("terrain");f.bindFramebuffer.set(null),f.viewport.set([0,0,p.width,p.height]);for(const A of n){const z=e.getTerrainMesh(A.tileID),B=p.renderToTexture.getTexture(A),O=e.getTerrainData(A.tileID);f.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,B.texture);const X=e.getMeshFrameDelta(w.zoom),W=w.calculateFogMatrix(A.tileID.toUnwrapped()),K=Uf(X,W,p.style.sky,w.pitch,u),J=w.getProjectionData({overscaledTileID:A.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});E.draw(f,y.TRIANGLES,M,Vt.disabled,S,ir.backCCW,K,O,J,"terrain",z.vertexBuffer,z.indexBuffer,z.segments)}}function hi(p,e){if(!e.mesh){const n=new c.aI;n.emplaceBack(-1,-1),n.emplaceBack(1,-1),n.emplaceBack(1,1),n.emplaceBack(-1,1);const l=new c.aK;l.emplaceBack(0,1,2),l.emplaceBack(0,2,3),e.mesh=new vs(p.createVertexBuffer(n,vn.members),p.createIndexBuffer(l),c.aJ.simpleSegment(0,0,n.length,l.length))}return e.mesh}class Mu{constructor(e,n){this.context=new Wl(e),this.transform=n,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:c.ad(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=be.maxUnderzooming+be.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new gt}resize(e,n,l){if(this.width=Math.floor(e*l),this.height=Math.floor(n*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style._order)this.style._layers[u].resize()}setup(){const e=this.context,n=new c.aI;n.emplaceBack(0,0),n.emplaceBack(c.Z,0),n.emplaceBack(0,c.Z),n.emplaceBack(c.Z,c.Z),this.tileExtentBuffer=e.createVertexBuffer(n,vn.members),this.tileExtentSegments=c.aJ.simpleSegment(0,0,4,2);const l=new c.aI;l.emplaceBack(0,0),l.emplaceBack(c.Z,0),l.emplaceBack(0,c.Z),l.emplaceBack(c.Z,c.Z),this.debugBuffer=e.createVertexBuffer(l,vn.members),this.debugSegments=c.aJ.simpleSegment(0,0,4,5);const u=new c.b_;u.emplaceBack(0,0,0,0),u.emplaceBack(c.Z,0,c.Z,0),u.emplaceBack(0,c.Z,0,c.Z),u.emplaceBack(c.Z,c.Z,c.Z,c.Z),this.rasterBoundsBuffer=e.createVertexBuffer(u,Vf.members),this.rasterBoundsSegments=c.aJ.simpleSegment(0,0,4,2);const f=new c.aI;f.emplaceBack(0,0),f.emplaceBack(c.Z,0),f.emplaceBack(0,c.Z),f.emplaceBack(c.Z,c.Z),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(f,vn.members),this.rasterBoundsSegmentsPosOnly=c.aJ.simpleSegment(0,0,4,5);const y=new c.aI;y.emplaceBack(0,0),y.emplaceBack(1,0),y.emplaceBack(0,1),y.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(y,vn.members),this.viewportSegments=c.aJ.simpleSegment(0,0,4,2);const w=new c.b$;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(w);const S=new c.aK;S.emplaceBack(1,0,2),S.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(S);const M=this.context.gl;this.stencilClearMode=new Vt({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO),this.tileExtentMesh=new vs(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const e=this.context,n=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=c.K();c.bQ(l,0,this.width,this.height,0,0,1),c.M(l,l,[n.drawingBufferWidth,n.drawingBufferHeight,0]);const u={mainMatrix:l,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:l};this.useProgram("clippingMask",null,!0).draw(e,n.TRIANGLES,jt.disabled,this.stencilClearMode,vr.disabled,ir.disabled,null,null,u,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,n,l){if(this.currentStencilSource===e.source||!e.isTileClipped()||!n||!n.length)return;this.currentStencilSource=e.source,this.nextStencilID+n.length>256&&this.clearStencil();const u=this.context;u.setColorMode(vr.disabled),u.setDepthMode(jt.disabled);const f={};for(const y of n)f[y.key]=this.nextStencilID++;this._renderTileMasks(f,n,l,!0),this._renderTileMasks(f,n,l,!1),this._tileClippingMaskIDs=f}_renderTileMasks(e,n,l,u){const f=this.context,y=f.gl,w=this.style.projection,S=this.transform,M=this.useProgram("clippingMask");for(const E of n){const A=e[E.key],z=this.style.map.terrain&&this.style.map.terrain.getTerrainData(E),B=w.getMeshFromTileID(this.context,E.canonical,u,!0,"stencil"),O=S.getProjectionData({overscaledTileID:E,applyGlobeMatrix:!0,applyTerrainMatrix:!0});M.draw(f,y.TRIANGLES,jt.disabled,new Vt({func:y.ALWAYS,mask:0},A,255,y.KEEP,y.KEEP,y.REPLACE),vr.disabled,l?ir.disabled:ir.backCCW,null,z,O,"$clipping",B.vertexBuffer,B.indexBuffer,B.segments)}}_renderTilesDepthBuffer(){const e=this.context,n=e.gl,l=this.style.projection,u=this.transform,f=this.useProgram("depth"),y=this.getDepthModeFor3D(),w=_e(u,{tileSize:u.tileSize});for(const S of w){const M=this.style.map.terrain&&this.style.map.terrain.getTerrainData(S),E=l.getMeshFromTileID(this.context,S.canonical,!0,!0,"raster"),A=u.getProjectionData({overscaledTileID:S,applyGlobeMatrix:!0,applyTerrainMatrix:!0});f.draw(e,n.TRIANGLES,y,Vt.disabled,vr.disabled,ir.backCCW,null,M,A,"$clipping",E.vertexBuffer,E.indexBuffer,E.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,n=this.context.gl;return new Vt({func:n.NOTEQUAL,mask:255},e,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(e){const n=this.context.gl;return new Vt({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,n.KEEP,n.KEEP,n.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){const n=this.context.gl,l=e.sort((y,w)=>w.overscaledZ-y.overscaledZ),u=l[l.length-1].overscaledZ,f=l[0].overscaledZ-u+1;if(f>1){this.currentStencilSource=void 0,this.nextStencilID+f>256&&this.clearStencil();const y={};for(let w=0;w<f;w++)y[w+u]=new Vt({func:n.GEQUAL,mask:255},w+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=f,[y,l]}return[{[u]:Vt.disabled},l]}stencilConfigForOverlapTwoPass(e){const n=this.context.gl,l=e.sort((y,w)=>w.overscaledZ-y.overscaledZ),u=l[l.length-1].overscaledZ,f=l[0].overscaledZ-u+1;if(this.clearStencil(),f>1){const y={},w={};for(let S=0;S<f;S++)y[S+u]=new Vt({func:n.GREATER,mask:255},f+1+S,255,n.KEEP,n.KEEP,n.REPLACE),w[S+u]=new Vt({func:n.GREATER,mask:255},1+S,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID=2*f+1,[y,w,l]}return this.nextStencilID=3,[{[u]:new Vt({func:n.GREATER,mask:255},2,255,n.KEEP,n.KEEP,n.REPLACE)},{[u]:new Vt({func:n.GREATER,mask:255},1,255,n.KEEP,n.KEEP,n.REPLACE)},l]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new vr([e.CONSTANT_COLOR,e.ONE],new c.b7(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?vr.unblended:vr.alphaBlended}getDepthModeForSublayer(e,n,l){if(!this.opaquePassEnabledForLayer())return jt.disabled;const u=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new jt(l||this.context.gl.LEQUAL,n,[u,u])}getDepthModeFor3D(){return new jt(this.context.gl.LEQUAL,jt.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,n){var l,u;this.style=e,this.options=n,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(me.now()),this.imageManager.beginFrame();const f=this.style._order,y=this.style.sourceCaches,w={},S={},M={},E={isRenderingToTexture:!1,isRenderingGlobe:((l=e.projection)===null||l===void 0?void 0:l.transitionState)>0};for(const z in y){const B=y[z];B.used&&B.prepare(this.context),w[z]=B.getVisibleCoordinates(!1),S[z]=w[z].slice().reverse(),M[z]=B.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let z=0;z<f.length;z++)if(this.style._layers[f[z]].is3D()){this.opaquePassCutoff=z;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const z of f){const B=this.style._layers[z];if(!B.hasOffscreenPass()||B.isHidden(this.transform.zoom))continue;const O=S[B.source];(B.type==="custom"||O.length)&&this.renderLayer(this,y[B.source],B,O,E)}if((u=this.style.projection)===null||u===void 0||u.updateGPUdependent({context:this.context,useProgram:z=>this.useProgram(z)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?c.b7.black:c.b7.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(z,B){const O=z.context,X=O.gl,W=((fe,ue,Se)=>{const Fe=Math.cos(ue.rollInRadians),ke=Math.sin(ue.rollInRadians),Ee=ge(ue),ze=ue.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:fe.properties.get("sky-color"),u_horizon_color:fe.properties.get("horizon-color"),u_horizon:[(ue.width/2-Ee*ke)*Se,(ue.height/2+Ee*Fe)*Se],u_horizon_normal:[-ke,Fe],u_sky_horizon_blend:fe.properties.get("sky-horizon-blend")*ue.height/2*Se,u_sky_blend:ze}})(B,z.style.map.transform,z.pixelRatio),K=new jt(X.LEQUAL,jt.ReadWrite,[0,1]),J=Vt.disabled,oe=z.colorModeForRenderPass(),se=z.useProgram("sky"),ae=hi(O,B);se.draw(O,X.TRIANGLES,K,J,oe,ir.disabled,W,null,void 0,"sky",ae.vertexBuffer,ae.indexBuffer,ae.segments)}(this,this.style.sky),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=f.length-1;this.currentLayer>=0;this.currentLayer--){const z=this.style._layers[f[this.currentLayer]],B=y[z.source],O=w[z.source];this._renderTileClippingMasks(z,O,!1),this.renderLayer(this,B,z,O,E)}this.renderPass="translucent";let A=!1;for(this.currentLayer=0;this.currentLayer<f.length;this.currentLayer++){const z=this.style._layers[f[this.currentLayer]],B=y[z.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(z,E))continue;this.opaquePassEnabledForLayer()||A||(A=!0,E.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const O=(z.type==="symbol"?M:S)[z.source];this._renderTileClippingMasks(z,w[z.source],!1),this.renderLayer(this,B,z,O,E)}if(E.isRenderingGlobe&&function(z,B,O){const X=z.context,W=X.gl,K=z.useProgram("atmosphere"),J=new jt(W.LEQUAL,jt.ReadOnly,[0,1]),oe=z.transform,se=function(ze,nt){const et=ze.properties.get("position"),Ze=[-et.x,-et.y,-et.z],dt=c.ad(new Float64Array(16));return ze.properties.get("anchor")==="map"&&(c.a_(dt,dt,nt.rollInRadians),c.a$(dt,dt,-nt.pitchInRadians),c.a_(dt,dt,nt.bearingInRadians),c.a$(dt,dt,nt.center.lat*Math.PI/180),c.bp(dt,dt,-nt.center.lng*Math.PI/180)),c.bZ(Ze,Ze,dt),Ze}(O,z.transform),ae=oe.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),fe=B.properties.get("atmosphere-blend")*ae.projectionTransition;if(fe===0)return;const ue=co(oe.worldSize,oe.center.lat),Se=oe.inverseProjectionMatrix,Fe=new Float64Array(4);Fe[3]=1,c.at(Fe,Fe,oe.modelViewProjectionMatrix),Fe[0]/=Fe[3],Fe[1]/=Fe[3],Fe[2]/=Fe[3],Fe[3]=1,c.at(Fe,Fe,Se),Fe[0]/=Fe[3],Fe[1]/=Fe[3],Fe[2]/=Fe[3],Fe[3]=1;const ke=((ze,nt,et,Ze,dt)=>({u_sun_pos:ze,u_atmosphere_blend:nt,u_globe_position:et,u_globe_radius:Ze,u_inv_proj_matrix:dt}))(se,fe,[Fe[0],Fe[1],Fe[2]],ue,Se),Ee=hi(X,B);K.draw(X,W.TRIANGLES,J,Vt.disabled,vr.alphaBlended,ir.disabled,ke,null,null,"atmosphere",Ee.vertexBuffer,Ee.indexBuffer,Ee.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const z=function(B,O){let X=null;const W=Object.values(B._layers).flatMap(se=>se.source&&!se.isHidden(O)?[B.sourceCaches[se.source]]:[]),K=W.filter(se=>se.getSource().type==="vector"),J=W.filter(se=>se.getSource().type!=="vector"),oe=se=>{(!X||X.getSource().maxzoom<se.getSource().maxzoom)&&(X=se)};return K.forEach(se=>oe(se)),X||J.forEach(se=>oe(se)),X}(this.style,this.transform.zoom);z&&function(B,O,X){for(let W=0;W<X.length;W++)Hr(B,O,X[W])}(this,z,z.getVisibleCoordinates())}this.options.showPadding&&function(z){const B=z.transform.padding;rc(z,z.transform.height-(B.top||0),3,ec),rc(z,B.bottom||0,3,Cu),zd(z,B.left||0,3,Id),zd(z,z.transform.width-(B.right||0),3,Ad);const O=z.transform.centerPoint;(function(X,W,K,J){Za(X,W-1,K-10,2,20,J),Za(X,W-10,K-1,20,2,J)})(z,O.x,z.transform.height-O.y,tc)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const n=this.terrainFacilitator.matrix,l=this.transform.modelViewProjectionMatrix;let u=this.terrainFacilitator.dirty;u||(u=e?!c.c0(n,l):!c.c1(n,l)),u||(u=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),u&&(c.c2(n,l),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(f,y){const w=f.context,S=w.gl,M=f.transform,E=vr.unblended,A=new jt(S.LEQUAL,jt.ReadWrite,[0,1]),z=y.sourceCache.getRenderableTiles(),B=f.useProgram("terrainDepth");w.bindFramebuffer.set(y.getFramebuffer("depth").framebuffer),w.viewport.set([0,0,f.width/devicePixelRatio,f.height/devicePixelRatio]),w.clear({color:c.b7.transparent,depth:1});for(const O of z){const X=y.getTerrainMesh(O.tileID),W=y.getTerrainData(O.tileID),K=M.getProjectionData({overscaledTileID:O.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),J={u_ele_delta:y.getMeshFrameDelta(M.zoom)};B.draw(w,S.TRIANGLES,A,Vt.disabled,E,ir.backCCW,J,W,K,"terrain",X.vertexBuffer,X.indexBuffer,X.segments)}w.bindFramebuffer.set(null),w.viewport.set([0,0,f.width,f.height])}(this,this.style.map.terrain),function(f,y){const w=f.context,S=w.gl,M=f.transform,E=vr.unblended,A=new jt(S.LEQUAL,jt.ReadWrite,[0,1]),z=y.getCoordsTexture(),B=y.sourceCache.getRenderableTiles(),O=f.useProgram("terrainCoords");w.bindFramebuffer.set(y.getFramebuffer("coords").framebuffer),w.viewport.set([0,0,f.width/devicePixelRatio,f.height/devicePixelRatio]),w.clear({color:c.b7.transparent,depth:1}),y.coordsIndex=[];for(const X of B){const W=y.getTerrainMesh(X.tileID),K=y.getTerrainData(X.tileID);w.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,z.texture);const J={u_terrain_coords_id:(255-y.coordsIndex.length)/255,u_texture:0,u_ele_delta:y.getMeshFrameDelta(M.zoom)},oe=M.getProjectionData({overscaledTileID:X.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});O.draw(w,S.TRIANGLES,A,Vt.disabled,E,ir.backCCW,J,K,oe,"terrain",W.vertexBuffer,W.indexBuffer,W.segments),y.coordsIndex.push(X.tileID.key)}w.bindFramebuffer.set(null),w.viewport.set([0,0,f.width,f.height])}(this,this.style.map.terrain))}renderLayer(e,n,l,u,f){l.isHidden(this.transform.zoom)||(l.type==="background"||l.type==="custom"||(u||[]).length)&&(this.id=l.id,c.c3(l)?function(y,w,S,M,E,A){if(y.renderPass!=="translucent")return;const{isRenderingToTexture:z}=A,B=Vt.disabled,O=y.colorModeForRenderPass();(S._unevaluatedLayout.hasValue("text-variable-anchor")||S._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(X,W,K,J,oe,se,ae,fe,ue){const Se=W.transform,Fe=W.style.map.terrain,ke=oe==="map",Ee=se==="map";for(const ze of X){const nt=J.getTile(ze),et=nt.getBucket(K);if(!et||!et.text||!et.text.segments.get().length)continue;const Ze=c.ak(et.textSizeData,Se.zoom),dt=c.az(nt,1,W.transform.zoom),$t=xt(ke,W.transform,dt),sr=K.layout.get("icon-text-fit")!=="none"&&et.hasIconData();if(Ze){const Lr=Math.pow(2,Se.zoom-nt.tileID.overscaledZ),wr=Fe?(jr,Ir)=>Fe.getElevation(ze,jr,Ir):null;kd(et,ke,Ee,ue,Se,$t,Lr,Ze,sr,c.aA(Se,nt,ae,fe),ze.toUnwrapped(),wr)}}}(M,y,S,w,S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),E),S.paint.get("icon-opacity").constantOr(1)!==0&&Kl(y,w,S,M,!1,S.paint.get("icon-translate"),S.paint.get("icon-translate-anchor"),S.layout.get("icon-rotation-alignment"),S.layout.get("icon-pitch-alignment"),S.layout.get("icon-keep-upright"),B,O,z),S.paint.get("text-opacity").constantOr(1)!==0&&Kl(y,w,S,M,!0,S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),S.layout.get("text-keep-upright"),B,O,z),w.map.showCollisionBoxes&&(wu(y,w,S,M,!0),wu(y,w,S,M,!1))}(e,n,l,u,this.style.placement.variableOffsets,f):c.c4(l)?function(y,w,S,M,E){if(y.renderPass!=="translucent")return;const{isRenderingToTexture:A}=E,z=S.paint.get("circle-opacity"),B=S.paint.get("circle-stroke-width"),O=S.paint.get("circle-stroke-opacity"),X=!S.layout.get("circle-sort-key").isConstant();if(z.constantOr(1)===0&&(B.constantOr(1)===0||O.constantOr(1)===0))return;const W=y.context,K=W.gl,J=y.transform,oe=y.getDepthModeForSublayer(0,jt.ReadOnly),se=Vt.disabled,ae=y.colorModeForRenderPass(),fe=[],ue=J.getCircleRadiusCorrection();for(let Se=0;Se<M.length;Se++){const Fe=M[Se],ke=w.getTile(Fe),Ee=ke.getBucket(S);if(!Ee)continue;const ze=S.paint.get("circle-translate"),nt=S.paint.get("circle-translate-anchor"),et=c.aA(J,ke,ze,nt),Ze=Ee.programConfigurations.get(S.id),dt=y.useProgram("circle",Ze),$t=Ee.layoutVertexBuffer,sr=Ee.indexBuffer,Lr=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Fe),wr={programConfiguration:Ze,program:dt,layoutVertexBuffer:$t,indexBuffer:sr,uniformValues:La(y,ke,S,et,ue),terrainData:Lr,projectionData:J.getProjectionData({overscaledTileID:Fe,applyGlobeMatrix:!A,applyTerrainMatrix:!0})};if(X){const jr=Ee.segments.get();for(const Ir of jr)fe.push({segments:new c.aJ([Ir]),sortKey:Ir.sortKey,state:wr})}else fe.push({segments:Ee.segments,sortKey:0,state:wr})}X&&fe.sort((Se,Fe)=>Se.sortKey-Fe.sortKey);for(const Se of fe){const{programConfiguration:Fe,program:ke,layoutVertexBuffer:Ee,indexBuffer:ze,uniformValues:nt,terrainData:et,projectionData:Ze}=Se.state;ke.draw(W,K.TRIANGLES,oe,se,ae,ir.backCCW,nt,et,Ze,S.id,Ee,ze,Se.segments,S.paint,y.transform.zoom,Fe)}}(e,n,l,u,f):c.c5(l)?function(y,w,S,M,E){if(S.paint.get("heatmap-opacity")===0)return;const A=y.context,{isRenderingToTexture:z,isRenderingGlobe:B}=E;if(y.style.map.terrain){for(const O of M){const X=w.getTile(O);w.hasRenderableParent(O)||(y.renderPass==="offscreen"?Yl(y,X,S,O,B):y.renderPass==="translucent"&&Tu(y,S,O,z,B))}A.viewport.set([0,0,y.width,y.height])}else y.renderPass==="offscreen"?function(O,X,W,K){const J=O.context,oe=J.gl,se=O.transform,ae=Vt.disabled,fe=new vr([oe.ONE,oe.ONE],c.b7.transparent,[!0,!0,!0,!0]);(function(ue,Se,Fe){const ke=ue.gl;ue.activeTexture.set(ke.TEXTURE1),ue.viewport.set([0,0,Se.width/4,Se.height/4]);let Ee=Fe.heatmapFbos.get(c.bW);Ee?(ke.bindTexture(ke.TEXTURE_2D,Ee.colorAttachment.get()),ue.bindFramebuffer.set(Ee.framebuffer)):(Ee=Ql(ue,Se.width/4,Se.height/4),Fe.heatmapFbos.set(c.bW,Ee))})(J,O,W),J.clear({color:c.b7.transparent});for(let ue=0;ue<K.length;ue++){const Se=K[ue];if(X.hasRenderableParent(Se))continue;const Fe=X.getTile(Se),ke=Fe.getBucket(W);if(!ke)continue;const Ee=ke.programConfigurations.get(W.id),ze=O.useProgram("heatmap",Ee),nt=se.getProjectionData({overscaledTileID:Se,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),et=se.getCircleRadiusCorrection();ze.draw(J,oe.TRIANGLES,jt.disabled,ae,fe,ir.backCCW,po(Fe,se.zoom,W.paint.get("heatmap-intensity"),et),null,nt,W.id,ke.layoutVertexBuffer,ke.indexBuffer,ke.segments,W.paint,se.zoom,Ee)}J.viewport.set([0,0,O.width,O.height])}(y,w,S,M):y.renderPass==="translucent"&&function(O,X){const W=O.context,K=W.gl;W.setColorMode(O.colorModeForRenderPass());const J=X.heatmapFbos.get(c.bW);J&&(W.activeTexture.set(K.TEXTURE0),K.bindTexture(K.TEXTURE_2D,J.colorAttachment.get()),W.activeTexture.set(K.TEXTURE1),Su(W,X).bind(K.LINEAR,K.CLAMP_TO_EDGE),O.useProgram("heatmapTexture").draw(W,K.TRIANGLES,jt.disabled,Vt.disabled,O.colorModeForRenderPass(),ir.disabled,ud(O,X,0,1),null,null,X.id,O.viewportBuffer,O.quadTriangleIndexBuffer,O.viewportSegments,X.paint,O.transform.zoom))}(y,S)}(e,n,l,u,f):c.c6(l)?function(y,w,S,M,E){if(y.renderPass!=="translucent")return;const{isRenderingToTexture:A}=E,z=S.paint.get("line-opacity"),B=S.paint.get("line-width");if(z.constantOr(1)===0||B.constantOr(1)===0)return;const O=y.getDepthModeForSublayer(0,jt.ReadOnly),X=y.colorModeForRenderPass(),W=S.paint.get("line-dasharray"),K=S.paint.get("line-pattern"),J=K.constantOr(1),oe=S.paint.get("line-gradient"),se=S.getCrossfadeParameters(),ae=J?"linePattern":W?"lineSDF":oe?"lineGradient":"line",fe=y.context,ue=fe.gl,Se=y.transform;let Fe=!0;for(const ke of M){const Ee=w.getTile(ke);if(J&&!Ee.patternsLoaded())continue;const ze=Ee.getBucket(S);if(!ze)continue;const nt=ze.programConfigurations.get(S.id),et=y.context.program.get(),Ze=y.useProgram(ae,nt),dt=Fe||Ze.program!==et,$t=y.style.map.terrain&&y.style.map.terrain.getTerrainData(ke),sr=K.constantOr(null);if(sr&&Ee.imageAtlas){const xr=Ee.imageAtlas,pr=xr.patternPositions[sr.to.toString()],pn=xr.patternPositions[sr.from.toString()];pr&&pn&&nt.setConstantPatternPositions(pr,pn)}const Lr=Se.getProjectionData({overscaledTileID:ke,applyGlobeMatrix:!A,applyTerrainMatrix:!0}),wr=Se.getPixelScale(),jr=J?fd(y,Ee,S,wr,se):W?md(y,Ee,S,wr,W,se):oe?pd(y,Ee,S,wr,ze.lineClipsArray.length):ja(y,Ee,S,wr);if(J)fe.activeTexture.set(ue.TEXTURE0),Ee.imageAtlasTexture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE),nt.updatePaintBuffers(se);else if(W&&(dt||y.lineAtlas.dirty))fe.activeTexture.set(ue.TEXTURE0),y.lineAtlas.bind(fe);else if(oe){const xr=ze.gradients[S.id];let pr=xr.texture;if(S.gradientVersion!==xr.version){let pn=256;if(S.stepInterpolant){const wn=w.getSource().maxzoom,zn=ke.canonical.z===wn?Math.ceil(1<<y.transform.maxZoom-ke.canonical.z):1;pn=c.ae(c.bX(ze.maxLineLength/c.Z*1024*zn),256,fe.maxTextureSize)}xr.gradient=c.bY({expression:S.gradientExpression(),evaluationKey:"lineProgress",resolution:pn,image:xr.gradient||void 0,clips:ze.lineClipsArray}),xr.texture?xr.texture.update(xr.gradient):xr.texture=new rt(fe,xr.gradient,ue.RGBA),xr.version=S.gradientVersion,pr=xr.texture}fe.activeTexture.set(ue.TEXTURE0),pr.bind(S.stepInterpolant?ue.NEAREST:ue.LINEAR,ue.CLAMP_TO_EDGE)}let Ir;if(A){const[xr]=y.getStencilConfigForOverlapAndUpdateStencilID(M);Ir=xr[ke.overscaledZ]}else Ir=y.stencilModeForClipping(ke);Ze.draw(fe,ue.TRIANGLES,O,Ir,X,ir.disabled,jr,$t,Lr,S.id,ze.layoutVertexBuffer,ze.indexBuffer,ze.segments,S.paint,y.transform.zoom,nt,ze.layoutVertexBuffer2),Fe=!1}}(e,n,l,u,f):c.c7(l)?function(y,w,S,M,E){const A=S.paint.get("fill-color"),z=S.paint.get("fill-opacity");if(z.constantOr(1)===0)return;const{isRenderingToTexture:B}=E,O=y.colorModeForRenderPass(),X=S.paint.get("fill-pattern"),W=y.opaquePassEnabledForLayer()&&!X.constantOr(1)&&A.constantOr(c.b7.transparent).a===1&&z.constantOr(0)===1?"opaque":"translucent";if(y.renderPass===W){const K=y.getDepthModeForSublayer(1,y.renderPass==="opaque"?jt.ReadWrite:jt.ReadOnly);Va(y,w,S,M,K,O,!1,B)}if(y.renderPass==="translucent"&&S.paint.get("fill-antialias")){const K=y.getDepthModeForSublayer(S.getPaintProperty("fill-outline-color")?2:0,jt.ReadOnly);Va(y,w,S,M,K,O,!0,B)}}(e,n,l,u,f):c.c8(l)?function(y,w,S,M,E){const A=S.paint.get("fill-extrusion-opacity");if(A===0)return;const{isRenderingToTexture:z}=E;if(y.renderPass==="translucent"){const B=new jt(y.context.gl.LEQUAL,jt.ReadWrite,y.depthRangeFor3D);if(A!==1||S.paint.get("fill-extrusion-pattern").constantOr(1))$a(y,w,S,M,B,Vt.disabled,vr.disabled,z),$a(y,w,S,M,B,y.stencilModeFor3D(),y.colorModeForRenderPass(),z);else{const O=y.colorModeForRenderPass();$a(y,w,S,M,B,Vt.disabled,O,z)}}}(e,n,l,u,f):c.c9(l)?function(y,w,S,M,E){if(y.renderPass!=="offscreen"&&y.renderPass!=="translucent")return;const{isRenderingToTexture:A}=E,z=y.context,B=y.style.projection.useSubdivision,O=y.getDepthModeForSublayer(0,jt.ReadOnly),X=y.colorModeForRenderPass();if(y.renderPass==="offscreen")(function(W,K,J,oe,se,ae,fe){const ue=W.context,Se=ue.gl;for(const Fe of J){const ke=K.getTile(Fe),Ee=ke.dem;if(!Ee||!Ee.data||!ke.needsHillshadePrepare)continue;const ze=Ee.dim,nt=Ee.stride,et=Ee.getPixels();if(ue.activeTexture.set(Se.TEXTURE1),ue.pixelStoreUnpackPremultiplyAlpha.set(!1),ke.demTexture=ke.demTexture||W.getTileTexture(nt),ke.demTexture){const dt=ke.demTexture;dt.update(et,{premultiply:!1}),dt.bind(Se.NEAREST,Se.CLAMP_TO_EDGE)}else ke.demTexture=new rt(ue,et,Se.RGBA,{premultiply:!1}),ke.demTexture.bind(Se.NEAREST,Se.CLAMP_TO_EDGE);ue.activeTexture.set(Se.TEXTURE0);let Ze=ke.fbo;if(!Ze){const dt=new rt(ue,{width:ze,height:ze,data:null},Se.RGBA);dt.bind(Se.LINEAR,Se.CLAMP_TO_EDGE),Ze=ke.fbo=ue.createFramebuffer(ze,ze,!0,!1),Ze.colorAttachment.set(dt.texture)}ue.bindFramebuffer.set(Ze.framebuffer),ue.viewport.set([0,0,ze,ze]),W.useProgram("hillshadePrepare").draw(ue,Se.TRIANGLES,se,ae,fe,ir.disabled,Gf(ke.tileID,Ee),null,null,oe.id,W.rasterBoundsBuffer,W.quadTriangleIndexBuffer,W.rasterBoundsSegments),ke.needsHillshadePrepare=!1}})(y,w,M,S,O,Vt.disabled,X),z.viewport.set([0,0,y.width,y.height]);else if(y.renderPass==="translucent")if(B){const[W,K,J]=y.stencilConfigForOverlapTwoPass(M);Pu(y,w,S,J,W,O,X,!1,A),Pu(y,w,S,J,K,O,X,!0,A)}else{const[W,K]=y.getStencilConfigForOverlapAndUpdateStencilID(M);Pu(y,w,S,K,W,O,X,!1,A)}}(e,n,l,u,f):c.ca(l)?function(y,w,S,M,E){if(y.renderPass!=="translucent"||S.paint.get("raster-opacity")===0||!M.length)return;const{isRenderingToTexture:A}=E,z=w.getSource(),B=y.style.projection.useSubdivision;if(z instanceof un)Jl(y,w,S,M,null,!1,!1,z.tileCoords,z.flippedWindingOrder,A);else if(B){const[O,X,W]=y.stencilConfigForOverlapTwoPass(M);Jl(y,w,S,W,O,!1,!0,Ua,!1,A),Jl(y,w,S,W,X,!0,!0,Ua,!1,A)}else{const[O,X]=y.getStencilConfigForOverlapAndUpdateStencilID(M);Jl(y,w,S,X,O,!1,!0,Ua,!1,A)}}(e,n,l,u,f):c.cb(l)?function(y,w,S,M,E){const A=S.paint.get("background-color"),z=S.paint.get("background-opacity");if(z===0)return;const{isRenderingToTexture:B}=E,O=y.context,X=O.gl,W=y.style.projection,K=y.transform,J=K.tileSize,oe=S.paint.get("background-pattern");if(y.isPatternMissing(oe))return;const se=!oe&&A.a===1&&z===1&&y.opaquePassEnabledForLayer()?"opaque":"translucent";if(y.renderPass!==se)return;const ae=Vt.disabled,fe=y.getDepthModeForSublayer(0,se==="opaque"?jt.ReadWrite:jt.ReadOnly),ue=y.colorModeForRenderPass(),Se=y.useProgram(oe?"backgroundPattern":"background"),Fe=M||_e(K,{tileSize:J,terrain:y.style.map.terrain});oe&&(O.activeTexture.set(X.TEXTURE0),y.imageManager.bind(y.context));const ke=S.getCrossfadeParameters();for(const Ee of Fe){const ze=K.getProjectionData({overscaledTileID:Ee,applyGlobeMatrix:!B,applyTerrainMatrix:!0}),nt=oe?Hf(z,y,oe,{tileID:Ee,tileSize:J},ke):qf(z,A),et=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Ee),Ze=W.getMeshFromTileID(O,Ee.canonical,!1,!0,"raster");Se.draw(O,X.TRIANGLES,fe,ae,ue,ir.backCCW,nt,et,ze,S.id,Ze.vertexBuffer,Ze.indexBuffer,Ze.segments)}}(e,0,l,u,f):c.cc(l)&&function(y,w,S,M){const{isRenderingGlobe:E}=M,A=y.context,z=S.implementation,B=y.style.projection,O=y.transform,X=O.getProjectionDataForCustomLayer(E),W={farZ:O.farZ,nearZ:O.nearZ,fov:O.fov*Math.PI/180,modelViewProjectionMatrix:O.modelViewProjectionMatrix,projectionMatrix:O.projectionMatrix,shaderData:{variantName:B.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${B.shaderPreludeCode.vertexSource}`,define:B.shaderDefine},defaultProjectionData:X},K=z.renderingMode?z.renderingMode:"2d";if(y.renderPass==="offscreen"){const J=z.prerender;J&&(y.setCustomLayerDefaults(),A.setColorMode(y.colorModeForRenderPass()),J.call(z,A.gl,W),A.setDirty(),y.setBaseState())}else if(y.renderPass==="translucent"){y.setCustomLayerDefaults(),A.setColorMode(y.colorModeForRenderPass()),A.setStencilMode(Vt.disabled);const J=K==="3d"?y.getDepthModeFor3D():y.getDepthModeForSublayer(0,jt.ReadOnly);A.setDepthMode(J),z.render(A.gl,W),A.setDirty(),y.setBaseState(),A.bindFramebuffer.set(null)}}(e,0,l,f))}saveTileTexture(e){const n=this._tileTextures[e.size[0]];n?n.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const n=this._tileTextures[e];return n&&n.length>0?n.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const n=this.imageManager.getPattern(e.from.toString()),l=this.imageManager.getPattern(e.to.toString());return!n||!l}useProgram(e,n,l=!1,u=[]){this.cache=this.cache||{};const f=!!this.style.map.terrain,y=this.style.projection,w=l?Rt.projectionMercator:y.shaderPreludeCode,S=l?rs:y.shaderDefine,M=e+(n?n.cacheKey:"")+`/${l?Kt:y.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(f?"/terrain":"")+(u?`/${u.join("/")}`:"");return this.cache[M]||(this.cache[M]=new Dl(this.context,Rt[e],n,vd[e],this._showOverdrawInspector,f,w,S,u)),this.cache[M]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new rt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:n}=this.context.gl;return this.width!==e||this.height!==n}}function Ga(p,e){let n,l=!1,u=null,f=null;const y=()=>{u=null,l&&(p.apply(f,n),u=setTimeout(y,e),l=!1)};return(...w)=>(l=!0,f=this,n=w,u||y(),u)}class ku{constructor(e){this._getCurrentHash=()=>{const n=window.location.hash.replace("#","");if(this._hashName){let l;return n.split("&").map(u=>u.split("=")).forEach(u=>{u[0]===this._hashName&&(l=u)}),(l&&l[1]||"").split("/")}return n.split("/")},this._onHashChange=()=>{const n=this._getCurrentHash();if(!this._isValidHash(n))return!1;const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:l,pitch:+(n[4]||0)}),!0},this._updateHashUnthrottled=()=>{const n=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,n)},this._removeHash=()=>{const n=this._getCurrentHash();if(n.length===0)return;const l=n.join("/");let u=l;u.split("&").length>0&&(u=u.split("&")[0]),this._hashName&&(u=`${this._hashName}=${l}`);let f=window.location.hash.replace(u,"");f.startsWith("#&")?f=f.slice(0,1)+f.slice(2):f==="#"&&(f="");let y=window.location.href.replace(/(#.+)?$/,f);y=y.replace("&&","&"),window.history.replaceState(window.history.state,null,y)},this._updateHash=Ga(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const n=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,u=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),f=Math.pow(10,u),y=Math.round(n.lng*f)/f,w=Math.round(n.lat*f)/f,S=this._map.getBearing(),M=this._map.getPitch();let E="";if(E+=e?`/${y}/${w}/${l}`:`${l}/${w}/${y}`,(S||M)&&(E+="/"+Math.round(10*S)/10),M&&(E+=`/${Math.round(M)}`),this._hashName){const A=this._hashName;let z=!1;const B=window.location.hash.slice(1).split("&").map(O=>{const X=O.split("=")[0];return X===A?(z=!0,`${X}=${E}`):O}).filter(O=>O);return z||B.push(`${A}=${E}`),`#${B.join("&")}`}return`#${E}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new c.Q(+e[2],+e[1])}catch{return!1}const n=+e[0],l=+(e[3]||0),u=+(e[4]||0);return n>=this._map.getMinZoom()&&n<=this._map.getMaxZoom()&&l>=-180&&l<=180&&u>=this._map.getMinPitch()&&u<=this._map.getMaxPitch()}}const ss={linearity:.3,easing:c.cd(0,0,.3,1)},Eu=c.e({deceleration:2500,maxSpeed:1400},ss),qa=c.e({deceleration:20,maxSpeed:1400},ss),Iu=c.e({deceleration:1e3,maxSpeed:360},ss),Rd=c.e({deceleration:1e3,maxSpeed:90},ss),Dd=c.e({deceleration:1e3,maxSpeed:360},ss);class Ld{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:me.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,n=me.now();for(;e.length>0&&n-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,roll:0,pan:new c.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:f}of this._inertiaBuffer)n.zoom+=f.zoomDelta||0,n.bearing+=f.bearingDelta||0,n.pitch+=f.pitchDelta||0,n.roll+=f.rollDelta||0,f.panDelta&&n.pan._add(f.panDelta),f.around&&(n.around=f.around),f.pinchAround&&(n.pinchAround=f.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,u={};if(n.pan.mag()){const f=$o(n.pan.mag(),l,c.e({},Eu,e||{})),y=n.pan.mult(f.amount/n.pan.mag()),w=this._map.cameraHelper.handlePanInertia(y,this._map.transform);u.center=w.easingCenter,u.offset=w.easingOffset,Vo(u,f)}if(n.zoom){const f=$o(n.zoom,l,qa);u.zoom=this._map.transform.zoom+f.amount,Vo(u,f)}if(n.bearing){const f=$o(n.bearing,l,Iu);u.bearing=this._map.transform.bearing+c.ae(f.amount,-179,179),Vo(u,f)}if(n.pitch){const f=$o(n.pitch,l,Rd);u.pitch=this._map.transform.pitch+f.amount,Vo(u,f)}if(n.roll){const f=$o(n.roll,l,Dd);u.roll=this._map.transform.roll+c.ae(f.amount,-179,179),Vo(u,f)}if(u.zoom||u.bearing){const f=n.pinchAround===void 0?n.around:n.pinchAround;u.around=f?this._map.unproject(f):this._map.getCenter()}return this.clear(),c.e(u,{noMoveStart:!0})}}function Vo(p,e){(!p.duration||p.duration<e.duration)&&(p.duration=e.duration,p.easing=e.easing)}function $o(p,e,n){const{maxSpeed:l,linearity:u,deceleration:f}=n,y=c.ae(p*u/(e/1e3),-l,l),w=Math.abs(y)/(f*u);return{easing:n.easing,duration:1e3*w,amount:y*(w/2)}}class dn extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,l,u={}){l=l instanceof MouseEvent?l:new MouseEvent(e,l);const f=re.mousePos(n.getCanvas(),l),y=n.unproject(f);super(e,c.e({point:f,lngLat:y,originalEvent:l},u)),this._defaultPrevented=!1,this.target=n}}class Uo extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,l){const u=e==="touchend"?l.changedTouches:l.touches,f=re.touchPos(n.getCanvasContainer(),u),y=f.map(S=>n.unproject(S)),w=f.reduce((S,M,E,A)=>S.add(M.div(A.length)),new c.P(0,0));super(e,{points:f,point:w,lngLats:y,lngLat:n.unproject(w),originalEvent:l}),this._defaultPrevented=!1}}class Au extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,l){super(e,{originalEvent:l}),this._defaultPrevented=!1}}class jd{constructor(e,n){this._map=e,this._clickTolerance=n.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new Au(e.type,this._map,e))}mousedown(e,n){return this._mousedownPos=n,this._firePreventable(new dn(e.type,this._map,e))}mouseup(e){this._map.fire(new dn(e.type,this._map,e))}click(e,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||this._map.fire(new dn(e.type,this._map,e))}dblclick(e){return this._firePreventable(new dn(e.type,this._map,e))}mouseover(e){this._map.fire(new dn(e.type,this._map,e))}mouseout(e){this._map.fire(new dn(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Uo(e.type,this._map,e))}touchmove(e){this._map.fire(new Uo(e.type,this._map,e))}touchend(e){this._map.fire(new Uo(e.type,this._map,e))}touchcancel(e){this._map.fire(new Uo(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Fd{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new dn(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new dn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new dn(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Zo{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(c.P.convert(e),this._map.terrain)}}class zu{constructor(e,n){this._map=e,this._tr=new Zo(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,n){this.isEnabled()&&e.shiftKey&&e.button===0&&(re.disableDrag(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(e,n){if(!this._active)return;const l=n;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const u=this._startPos;this._lastPos=l,this._box||(this._box=re.create("div","trackasiagl-boxzoom",this._container),this._container.classList.add("trackasiagl-crosshair"),this._fireEvent("boxzoomstart",e));const f=Math.min(u.x,l.x),y=Math.max(u.x,l.x),w=Math.min(u.y,l.y),S=Math.max(u.y,l.y);re.setTransform(this._box,`translate(${f}px,${w}px)`),this._box.style.width=y-f+"px",this._box.style.height=S-w+"px"}mouseupWindow(e,n){if(!this._active||e.button!==0)return;const l=this._startPos,u=n;if(this.reset(),re.suppressClick(),l.x!==u.x||l.y!==u.y)return this._map.fire(new c.l("boxzoomend",{originalEvent:e})),{cameraAnimation:f=>f.fitScreenCoordinates(l,u,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("trackasiagl-crosshair"),this._box&&(re.remove(this._box),this._box=null),re.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,n){return this._map.fire(new c.l(e,{originalEvent:n}))}}function nc(p,e){if(p.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${p.length}, points ${e.length}`);const n={};for(let l=0;l<p.length;l++)n[p[l].identifier]=e[l];return n}class Bd{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,n,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),l.length===this.numTouches&&(this.centroid=function(u){const f=new c.P(0,0);for(const y of u)f._add(y);return f.div(u.length)}(n),this.touches=nc(l,n)))}touchmove(e,n,l){if(this.aborted||!this.centroid)return;const u=nc(l,n);for(const f in this.touches){const y=u[f];(!y||y.dist(this.touches[f])>30)&&(this.aborted=!0)}}touchend(e,n,l){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const u=!this.aborted&&this.centroid;if(this.reset(),u)return u}}}class Go{constructor(e){this.singleTap=new Bd(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,n,l){this.singleTap.touchstart(e,n,l)}touchmove(e,n,l){this.singleTap.touchmove(e,n,l)}touchend(e,n,l){const u=this.singleTap.touchend(e,n,l);if(u){const f=e.timeStamp-this.lastTime<500,y=!this.lastTap||this.lastTap.dist(u)<30;if(f&&y||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=u,this.count===this.numTaps)return this.reset(),u}}}class Od{constructor(e){this._tr=new Zo(e),this._zoomIn=new Go({numTouches:1,numTaps:2}),this._zoomOut=new Go({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,n,l){this._zoomIn.touchstart(e,n,l),this._zoomOut.touchstart(e,n,l)}touchmove(e,n,l){this._zoomIn.touchmove(e,n,l),this._zoomOut.touchmove(e,n,l)}touchend(e,n,l){const u=this._zoomIn.touchend(e,n,l),f=this._zoomOut.touchend(e,n,l),y=this._tr;return u?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:y.zoom+1,around:y.unproject(u)},{originalEvent:e})}):f?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:y.zoom-1,around:y.unproject(f)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Nn{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const n=this._moveFunction(...e);if(n.bearingDelta||n.pitchDelta||n.rollDelta||n.around||n.panDelta)return this._active=!0,n}dragStart(e,n){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(n)?n[0]:n,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,n){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const u=Array.isArray(n)?n[0]:n;return!this._moved&&u.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=u,this._move(l,u))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&re.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Bi={0:1,2:2};class qo{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const n=re.mouseButton(e);this._eventButton=n}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(n,l){const u=Bi[l];return n.buttons===void 0||(n.buttons&u)!==u}(e,this._eventButton)}isValidEndEvent(e){return re.mouseButton(e)===this._eventButton}}class Oi{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class Ho{constructor(e=new qo({checkCorrectEvent:()=>!0}),n=new Oi){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=n}_executeRelevantHandler(e,n,l){return e instanceof MouseEvent?n(e):typeof TouchEvent<"u"&&e instanceof TouchEvent?l(e):void 0}startMove(e){this._executeRelevantHandler(e,n=>this.mouseMoveStateManager.startMove(n),n=>this.oneFingerTouchMoveStateManager.startMove(n))}endMove(e){this._executeRelevantHandler(e,n=>this.mouseMoveStateManager.endMove(n),n=>this.oneFingerTouchMoveStateManager.endMove(n))}isValidStartEvent(e){return this._executeRelevantHandler(e,n=>this.mouseMoveStateManager.isValidStartEvent(n),n=>this.oneFingerTouchMoveStateManager.isValidStartEvent(n))}isValidMoveEvent(e){return this._executeRelevantHandler(e,n=>this.mouseMoveStateManager.isValidMoveEvent(n),n=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(n))}isValidEndEvent(e){return this._executeRelevantHandler(e,n=>this.mouseMoveStateManager.isValidEndEvent(n),n=>this.oneFingerTouchMoveStateManager.isValidEndEvent(n))}}const ic=p=>{p.mousedown=p.dragStart,p.mousemoveWindow=p.dragMove,p.mouseup=p.dragEnd,p.contextmenu=e=>{e.preventDefault()}};class rm{constructor(e,n){this._clickTolerance=e.clickTolerance||1,this._map=n,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new c.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,n,l){return this._calculateTransform(e,n,l)}touchmove(e,n,l){if(this._active){if(!this._shouldBePrevented(l.length))return e.preventDefault(),this._calculateTransform(e,n,l);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,n,l){this._calculateTransform(e,n,l),this._active&&this._shouldBePrevented(l.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,n,l){l.length>0&&(this._active=!0);const u=nc(l,n),f=new c.P(0,0),y=new c.P(0,0);let w=0;for(const M in u){const E=u[M],A=this._touches[M];A&&(f._add(E),y._add(E.sub(A)),w++,u[M]=E)}if(this._touches=u,this._shouldBePrevented(w)||!y.mag())return;const S=y.div(w);return this._sum._add(S),this._sum.mag()<this._clickTolerance?void 0:{around:f.div(w),panDelta:S}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ru{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,n,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([n[0],n[1]]))}touchmove(e,n,l){if(!this._firstTwoTouches)return;e.preventDefault();const[u,f]=this._firstTwoTouches,y=sc(l,n,u),w=sc(l,n,f);if(!y||!w)return;const S=this._aroundCenter?null:y.add(w).div(2);return this._move([y,w],S,e)}touchend(e,n,l){if(!this._firstTwoTouches)return;const[u,f]=this._firstTwoTouches,y=sc(l,n,u),w=sc(l,n,f);y&&w||(this._active&&re.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function sc(p,e,n){for(let l=0;l<p.length;l++)if(p[l].identifier===n)return e[l]}function Du(p,e){return Math.log(p/e)/Math.LN2}class Wo extends Ru{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,n){const l=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Du(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Du(this._distance,l),pinchAround:n}}}function os(p,e){return 180*p.angleWith(e)/Math.PI}class at extends Ru{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,n,l){const u=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:os(this._vector,u),pinchAround:n}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const n=25/(Math.PI*this._minDiameter)*360,l=os(e,this._startVector);return Math.abs(l)<n}}function oc(p){return Math.abs(p.y)>Math.abs(p.x)}class ac extends Ru{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,n,l){super.touchstart(e,n,l),this._currentTouchCount=l.length}_start(e){this._lastPoints=e,oc(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,n,l){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const u=e[0].sub(this._lastPoints[0]),f=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(u,f,l.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(u.y+f.y)/2*-.5}):void 0}gestureBeginsVertically(e,n,l){if(this._valid!==void 0)return this._valid;const u=e.mag()>=2,f=n.mag()>=2;if(!u&&!f)return;if(!u||!f)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const y=e.y>0==n.y>0;return oc(e)&&oc(n)&&y}}const Nd={panStep:100,bearingStep:15,pitchStep:10};class Xo{constructor(e){this._tr=new Zo(e);const n=Nd;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let n=0,l=0,u=0,f=0,y=0;switch(e.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:e.shiftKey?l=-1:(e.preventDefault(),f=-1);break;case 39:e.shiftKey?l=1:(e.preventDefault(),f=1);break;case 38:e.shiftKey?u=1:(e.preventDefault(),y=-1);break;case 40:e.shiftKey?u=-1:(e.preventDefault(),y=1);break;default:return}return this._rotationDisabled&&(l=0,u=0),{cameraAnimation:w=>{const S=this._tr;w.easeTo({duration:300,easeId:"keyboardHandler",easing:Ha,zoom:n?Math.round(S.zoom)+n*(e.shiftKey?2:1):S.zoom,bearing:S.bearing+l*this._bearingStep,pitch:S.pitch+u*this._pitchStep,offset:[-f*this._panStep,-y*this._panStep],center:S.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Ha(p){return p*(2-p)}const Lu=4.000244140625;class Jt{constructor(e,n){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=e,this._tr=new Zo(e),this._triggerRenderFrame=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let n=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const l=me.now(),u=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,n!==0&&n%Lu==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":u>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(u*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),e.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=e,this._delta-=n,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=re.mousePos(this._map.getCanvas(),e),l=this._tr;this._aroundPoint=this._aroundCenter?l.transform.locationToScreenPoint(c.Q.convert(l.center)):n,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const w=e.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=w),typeof this._targetZoom=="number"&&(this._targetZoom+=w)}if(this._delta!==0){const w=this._type==="wheel"&&Math.abs(this._delta)>Lu?this._wheelZoomRate:this._defaultZoomRate;let S=2/(1+Math.exp(-Math.abs(this._delta*w)));this._delta<0&&S!==0&&(S=1/S);const M=typeof this._targetZoom!="number"?e.scale:c.ac(this._targetZoom);this._targetZoom=e.getConstrained(e.getCameraLngLat(),c.ah(M*S)).zoom,this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const n=typeof this._targetZoom!="number"?e.zoom:this._targetZoom,l=this._startZoom,u=this._easing;let f,y=!1;if(this._type==="wheel"&&l&&u){const w=me.now()-this._lastWheelEventTime,S=Math.min((w+5)/200,1),M=u(S);f=c.B.number(l,n,M),S<1?this._frameId||(this._frameId=!0):y=!0}else f=n,y=!0;return this._active=!0,y&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=f,{noInertia:!0,needsRenderFrame:!y,zoomDelta:f-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let n=c.cf;if(this._prevEase){const l=this._prevEase,u=(me.now()-l.start)/l.duration,f=l.easing(u+.01)-l.easing(u),y=.27/Math.sqrt(f*f+1e-4)*.01,w=Math.sqrt(.0729-y*y);n=c.cd(y,w,.25,1)}return this._prevEase={start:me.now(),duration:e,easing:n},n}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class lc{constructor(e,n){this._clickZoom=e,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class nm{constructor(e){this._tr=new Zo(e),this.reset()}reset(){this._active=!1}dblclick(e,n){return e.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(n)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ju{constructor(){this._tap=new Go({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,n,l){if(!this._swipePoint)if(this._tapTime){const u=n[0],f=e.timeStamp-this._tapTime<500,y=this._tapPoint.dist(u)<30;f&&y?l.length>0&&(this._swipePoint=u,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(e,n,l)}touchmove(e,n,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const u=n[0],f=u.y-this._swipePoint.y;return this._swipePoint=u,e.preventDefault(),this._active=!0,{zoomDelta:f/128}}}else this._tap.touchmove(e,n,l)}touchend(e,n,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const u=this._tap.touchend(e,n,l);u&&(this._tapTime=e.timeStamp,this._tapPoint=u)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Vd{constructor(e,n,l){this._el=e,this._mousePan=n,this._touchPan=l}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("trackasiagl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("trackasiagl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class $d{constructor(e,n,l,u){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=n,this._mousePitch=l,this._mouseRoll=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Fu{constructor(e,n,l,u){this._el=e,this._touchZoom=n,this._touchRotate=l,this._tapDragZoom=u,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("trackasiagl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("trackasiagl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class cc{constructor(e,n){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=n,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("trackasiagl-cooperative-gestures"),this._container=re.create("div","trackasiagl-cooperative-gesture-screen",e);let n=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(n=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const l=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),u=document.createElement("div");u.className="trackasiagl-desktop-message",u.textContent=n,this._container.appendChild(u);const f=document.createElement("div");f.className="trackasiagl-mobile-message",f.textContent=l,this._container.appendChild(f),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(re.remove(this._container),this._map.getCanvasContainer().classList.remove("trackasiagl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,n){this._enabled&&(this._map.fire(new c.l("cooperativegestureprevented",{gestureType:e,originalEvent:n})),this._container.classList.add("trackasiagl-show"),setTimeout(()=>{this._container.classList.remove("trackasiagl-show")},100))}}const Wa=p=>p.zoom||p.drag||p.roll||p.pitch||p.rotate;class im extends c.l{}function uc(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta||p.rollDelta}class sm{constructor(e,n){this.handleWindowEvent=u=>{this.handleEvent(u,`${u.type}Window`)},this.handleEvent=(u,f)=>{if(u.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const y=u.type==="renderFrame"?void 0:u,w={needsRenderFrame:!1},S={},M={};for(const{handlerName:z,handler:B,allowed:O}of this._handlers){if(!B.isEnabled())continue;let X;if(this._blockedByActive(M,O,z))B.reset();else if(B[f||u.type]){if(c.cg(u,f||u.type)){const W=re.mousePos(this._map.getCanvas(),u);X=B[f||u.type](u,W)}else if(c.ch(u,f||u.type)){const W=this._getMapTouches(u.touches),K=re.touchPos(this._map.getCanvas(),W);X=B[f||u.type](u,K,W)}else c.ci(f||u.type)||(X=B[f||u.type](u));this.mergeHandlerResult(w,S,X,z,y),X&&X.needsRenderFrame&&this._triggerRenderFrame()}(X||B.isActive())&&(M[z]=B)}const E={};for(const z in this._previousActiveHandlers)M[z]||(E[z]=y);this._previousActiveHandlers=M,(Object.keys(E).length||uc(w))&&(this._changes.push([w,S,E]),this._triggerRenderFrame()),(Object.keys(M).length||uc(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:A}=w;A&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],A(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ld(e),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[u,f,y]of this._listeners)re.addEventListener(u,f,u===document?this.handleWindowEvent:this.handleEvent,y)}destroy(){for(const[e,n,l]of this._listeners)re.removeEventListener(e,n,e===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(e){const n=this._map,l=n.getCanvasContainer();this._add("mapEvent",new jd(n,e));const u=n.boxZoom=new zu(n,e);this._add("boxZoom",u),e.interactive&&e.boxZoom&&u.enable();const f=n.cooperativeGestures=new cc(n,e.cooperativeGestures);this._add("cooperativeGestures",f),e.cooperativeGestures&&f.enable();const y=new Od(n),w=new nm(n);n.doubleClickZoom=new lc(w,y),this._add("tapZoom",y),this._add("clickZoom",w),e.interactive&&e.doubleClickZoom&&n.doubleClickZoom.enable();const S=new ju;this._add("tapDragZoom",S);const M=n.touchPitch=new ac(n);this._add("touchPitch",M),e.interactive&&e.touchPitch&&n.touchPitch.enable(e.touchPitch);const E=()=>n.project(n.getCenter()),A=function({enable:se,clickTolerance:ae,aroundCenter:fe=!0,minPixelCenterThreshold:ue=100,rotateDegreesPerPixelMoved:Se=.8},Fe){const ke=new qo({checkCorrectEvent:Ee=>re.mouseButton(Ee)===0&&Ee.ctrlKey||re.mouseButton(Ee)===2&&!Ee.ctrlKey});return new Nn({clickTolerance:ae,move:(Ee,ze)=>{const nt=Fe();if(fe&&Math.abs(nt.y-Ee.y)>ue)return{bearingDelta:c.ce(new c.P(Ee.x,ze.y),ze,nt)};let et=(ze.x-Ee.x)*Se;return fe&&ze.y<nt.y&&(et=-et),{bearingDelta:et}},moveStateManager:ke,enable:se,assignEvents:ic})}(e,E),z=function({enable:se,clickTolerance:ae,pitchDegreesPerPixelMoved:fe=-.5}){const ue=new qo({checkCorrectEvent:Se=>re.mouseButton(Se)===0&&Se.ctrlKey||re.mouseButton(Se)===2});return new Nn({clickTolerance:ae,move:(Se,Fe)=>({pitchDelta:(Fe.y-Se.y)*fe}),moveStateManager:ue,enable:se,assignEvents:ic})}(e),B=function({enable:se,clickTolerance:ae,rollDegreesPerPixelMoved:fe=.3},ue){const Se=new qo({checkCorrectEvent:Fe=>re.mouseButton(Fe)===2&&Fe.ctrlKey});return new Nn({clickTolerance:ae,move:(Fe,ke)=>{const Ee=ue();let ze=(ke.x-Fe.x)*fe;return ke.y<Ee.y&&(ze=-ze),{rollDelta:ze}},moveStateManager:Se,enable:se,assignEvents:ic})}(e,E);n.dragRotate=new $d(e,A,z,B),this._add("mouseRotate",A,["mousePitch"]),this._add("mousePitch",z,["mouseRotate","mouseRoll"]),this._add("mouseRoll",B,["mousePitch"]),e.interactive&&e.dragRotate&&n.dragRotate.enable();const O=function({enable:se,clickTolerance:ae}){const fe=new qo({checkCorrectEvent:ue=>re.mouseButton(ue)===0&&!ue.ctrlKey});return new Nn({clickTolerance:ae,move:(ue,Se)=>({around:Se,panDelta:Se.sub(ue)}),activateOnStart:!0,moveStateManager:fe,enable:se,assignEvents:ic})}(e),X=new rm(e,n);n.dragPan=new Vd(l,O,X),this._add("mousePan",O),this._add("touchPan",X,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&n.dragPan.enable(e.dragPan);const W=new at,K=new Wo;n.touchZoomRotate=new Fu(l,K,W,S),this._add("touchRotate",W,["touchPan","touchZoom"]),this._add("touchZoom",K,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&n.touchZoomRotate.enable(e.touchZoomRotate);const J=n.scrollZoom=new Jt(n,()=>this._triggerRenderFrame());this._add("scrollZoom",J,["mousePan"]),e.interactive&&e.scrollZoom&&n.scrollZoom.enable(e.scrollZoom);const oe=n.keyboard=new Xo(n);this._add("keyboard",oe),e.interactive&&e.keyboard&&n.keyboard.enable(),this._add("blockableMapEvent",new Fd(n))}_add(e,n,l){this._handlers.push({handlerName:e,handler:n,allowed:l}),this._handlersById[e]=n}stop(e){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Wa(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,n,l){for(const u in e)if(u!==l&&(!n||n.indexOf(u)<0))return!0;return!1}_getMapTouches(e){const n=[];for(const l of e)this._el.contains(l.target)&&n.push(l);return n}mergeHandlerResult(e,n,l,u,f){if(!l)return;c.e(e,l);const y={handlerName:u,originalEvent:l.originalEvent||f};l.zoomDelta!==void 0&&(n.zoom=y),l.panDelta!==void 0&&(n.drag=y),l.rollDelta!==void 0&&(n.roll=y),l.pitchDelta!==void 0&&(n.pitch=y),l.bearingDelta!==void 0&&(n.rotate=y)}_applyChanges(){const e={},n={},l={};for(const[u,f,y]of this._changes)u.panDelta&&(e.panDelta=(e.panDelta||new c.P(0,0))._add(u.panDelta)),u.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+u.zoomDelta),u.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+u.bearingDelta),u.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+u.pitchDelta),u.rollDelta&&(e.rollDelta=(e.rollDelta||0)+u.rollDelta),u.around!==void 0&&(e.around=u.around),u.pinchAround!==void 0&&(e.pinchAround=u.pinchAround),u.noInertia&&(e.noInertia=u.noInertia),c.e(n,f),c.e(l,y);this._updateMapTransform(e,n,l),this._changes=[]}_updateMapTransform(e,n,l){const u=this._map,f=u._getTransformForUpdate(),y=u.terrain;if(!(uc(e)||y&&this._terrainMovement))return this._fireEvents(n,l,!0);u._stop(!0);let{panDelta:w,zoomDelta:S,bearingDelta:M,pitchDelta:E,rollDelta:A,around:z,pinchAround:B}=e;B!==void 0&&(z=B),z=z||u.transform.centerPoint,y&&!f.isPointOnMapSurface(z)&&(z=f.centerPoint);const O={panDelta:w,zoomDelta:S,rollDelta:A,pitchDelta:E,bearingDelta:M,around:z};this._map.cameraHelper.useGlobeControls&&!f.isPointOnMapSurface(z)&&(z=f.centerPoint);const X=z.distSqr(f.centerPoint)<.01?f.center:f.screenPointToLocation(w?z.sub(w):z);y?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(O,f),this._terrainMovement||!n.drag&&!n.zoom?n.drag&&this._terrainMovement?f.setCenter(f.screenPointToLocation(f.centerPoint.sub(w))):this._map.cameraHelper.handleMapControlsPan(O,f,X):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(O,f,X))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(O,f),this._map.cameraHelper.handleMapControlsPan(O,f,X)),u._applyUpdatedTransform(f),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(n,l,!0)}_fireEvents(e,n,l){const u=Wa(this._eventsInProgress),f=Wa(e),y={};for(const A in e){const{originalEvent:z}=e[A];this._eventsInProgress[A]||(y[`${A}start`]=z),this._eventsInProgress[A]=e[A]}!u&&f&&this._fireEvent("movestart",f.originalEvent);for(const A in y)this._fireEvent(A,y[A]);f&&this._fireEvent("move",f.originalEvent);for(const A in e){const{originalEvent:z}=e[A];this._fireEvent(A,z)}const w={};let S;for(const A in this._eventsInProgress){const{handlerName:z,originalEvent:B}=this._eventsInProgress[A];this._handlersById[z].isActive()||(delete this._eventsInProgress[A],S=n[z]||B,w[`${A}end`]=S)}for(const A in w)this._fireEvent(A,w[A]);const M=Wa(this._eventsInProgress),E=(u||f)&&!M;if(E&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const A=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&A.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(A)}if(l&&E){this._updatingCamera=!0;const A=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),z=B=>B!==0&&-this._bearingSnap<B&&B<this._bearingSnap;!A||!A.essential&&me.prefersReducedMotion?(this._map.fire(new c.l("moveend",{originalEvent:S})),z(this._map.getBearing())&&this._map.resetNorth()):(z(A.bearing||this._map.getBearing())&&(A.bearing=0),A.freezeElevation=!0,this._map.easeTo(A,{originalEvent:S})),this._updatingCamera=!1}}_fireEvent(e,n){this._map.fire(new c.l(e,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new im("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class om extends c.E{constructor(e,n,l){super(),this._renderFrameCallback=()=>{const u=Math.min((me.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(u)),u<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=l.bearingSnap,this.cameraHelper=n,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(e,n){e.apply(this.transform),this.transform=e,this.cameraHelper=n}getCenter(){return new c.Q(this.transform.center.lng,this.transform.center.lat)}setCenter(e,n){return this.jumpTo({center:e},n)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,n){return this.jumpTo({elevation:e},n),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,n,l){return e=c.P.convert(e).mult(-1),this.panTo(this.transform.center,c.e({offset:e},n),l)}panTo(e,n,l){return this.easeTo(c.e({center:e},n),l)}getZoom(){return this.transform.zoom}setZoom(e,n){return this.jumpTo({zoom:e},n),this}zoomTo(e,n,l){return this.easeTo(c.e({zoom:e},n),l)}zoomIn(e,n){return this.zoomTo(this.getZoom()+1,e,n),this}zoomOut(e,n){return this.zoomTo(this.getZoom()-1,e,n),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,n){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new c.l("movestart",n)).fire(new c.l("move",n)).fire(new c.l("moveend",n))),this}getBearing(){return this.transform.bearing}setBearing(e,n){return this.jumpTo({bearing:e},n),this}getPadding(){return this.transform.padding}setPadding(e,n){return this.jumpTo({padding:e},n),this}rotateTo(e,n,l){return this.easeTo(c.e({bearing:e},n),l)}resetNorth(e,n){return this.rotateTo(0,c.e({duration:1e3},e),n),this}resetNorthPitch(e,n){return this.easeTo(c.e({bearing:0,pitch:0,roll:0,duration:1e3},e),n),this}snapToNorth(e,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,n):this}getPitch(){return this.transform.pitch}setPitch(e,n){return this.jumpTo({pitch:e},n),this}getRoll(){return this.transform.roll}setRoll(e,n){return this.jumpTo({roll:e},n),this}cameraForBounds(e,n){e=mr.convert(e).adjustAntiMeridian();const l=n&&n.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),l,n)}_cameraForBoxAndBearing(e,n,l,u){const f={top:0,bottom:0,right:0,left:0};if(typeof(u=c.e({padding:f,offset:[0,0],maxZoom:this.transform.maxZoom},u)).padding=="number"){const M=u.padding;u.padding={top:M,bottom:M,right:M,left:M}}const y=c.e(f,u.padding);u.padding=y;const w=this.transform,S=new mr(e,n);return this.cameraHelper.cameraForBoxAndBearing(u,y,S,l,w)}fitBounds(e,n,l){return this._fitInternal(this.cameraForBounds(e,n),n,l)}fitScreenCoordinates(e,n,l,u,f){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(c.P.convert(e)),this.transform.screenPointToLocation(c.P.convert(n)),l,u),u,f)}_fitInternal(e,n,l){return e?(delete(n=c.e(e,n)).padding,n.linear?this.easeTo(n,l):this.flyTo(n,l)):this}jumpTo(e,n){this.stop();const l=this._getTransformForUpdate();let u=!1,f=!1,y=!1;const w=l.zoom;this.cameraHelper.handleJumpToCenterZoom(l,e);const S=l.zoom!==w;return"elevation"in e&&l.elevation!==+e.elevation&&l.setElevation(+e.elevation),"bearing"in e&&l.bearing!==+e.bearing&&(u=!0,l.setBearing(+e.bearing)),"pitch"in e&&l.pitch!==+e.pitch&&(f=!0,l.setPitch(+e.pitch)),"roll"in e&&l.roll!==+e.roll&&(y=!0,l.setRoll(+e.roll)),e.padding==null||l.isPaddingEqual(e.padding)||l.setPadding(e.padding),this._applyUpdatedTransform(l),this.fire(new c.l("movestart",n)).fire(new c.l("move",n)),S&&this.fire(new c.l("zoomstart",n)).fire(new c.l("zoom",n)).fire(new c.l("zoomend",n)),u&&this.fire(new c.l("rotatestart",n)).fire(new c.l("rotate",n)).fire(new c.l("rotateend",n)),f&&this.fire(new c.l("pitchstart",n)).fire(new c.l("pitch",n)).fire(new c.l("pitchend",n)),y&&this.fire(new c.l("rollstart",n)).fire(new c.l("roll",n)).fire(new c.l("rollend",n)),this.fire(new c.l("moveend",n))}calculateCameraOptionsFromTo(e,n,l,u=0){const f=c.$.fromLngLat(e,n),y=c.$.fromLngLat(l,u),w=y.x-f.x,S=y.y-f.y,M=y.z-f.z,E=Math.hypot(w,S,M);if(E===0)throw new Error("Can't calculate camera options with same From and To");const A=Math.hypot(w,S),z=c.ah(this.transform.cameraToCenterDistance/E/this.transform.tileSize),B=180*Math.atan2(w,-S)/Math.PI;let O=180*Math.acos(A/E)/Math.PI;return O=M<0?90-O:90+O,{center:y.toLngLat(),elevation:u,zoom:z,pitch:O,bearing:B}}calculateCameraOptionsFromCameraLngLatAltRotation(e,n,l,u,f){const y=this.transform.calculateCenterFromCameraLngLatAlt(e,n,l,u);return{center:y.center,elevation:y.elevation,zoom:y.zoom,bearing:l,pitch:u,roll:f}}easeTo(e,n){this._stop(!1,e.easeId),((e=c.e({offset:[0,0],duration:500,easing:c.cf},e)).animate===!1||!e.essential&&me.prefersReducedMotion)&&(e.duration=0);const l=this._getTransformForUpdate(),u=this.getBearing(),f=l.pitch,y=l.roll,w="bearing"in e?this._normalizeBearing(e.bearing,u):u,S="pitch"in e?+e.pitch:f,M="roll"in e?this._normalizeBearing(e.roll,y):y,E="padding"in e?e.padding:l.padding,A=c.P.convert(e.offset);let z,B;e.around&&(z=c.Q.convert(e.around),B=l.locationToScreenPoint(z));const O={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},X=this.cameraHelper.handleEaseTo(l,{bearing:w,pitch:S,roll:M,padding:E,around:z,aroundPoint:B,offsetAsPoint:A,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||u!==w,this._pitching=this._pitching||S!==f,this._rolling=this._rolling||M!==y,this._padding=!l.isPaddingEqual(E),this._zooming=this._zooming||X.isZooming,this._easeId=e.easeId,this._prepareEase(n,e.noMoveStart,O),this.terrain&&this._prepareElevation(X.elevationCenter),this._ease(W=>{X.easeFunc(W),this.terrain&&!e.freezeElevation&&this._updateElevation(W),this._applyUpdatedTransform(l),this._fireMoveEvents(n)},W=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(n,W)},e),this}_prepareEase(e,n,l={}){this._moving=!0,n||l.moving||this.fire(new c.l("movestart",e)),this._zooming&&!l.zooming&&this.fire(new c.l("zoomstart",e)),this._rotating&&!l.rotating&&this.fire(new c.l("rotatestart",e)),this._pitching&&!l.pitching&&this.fire(new c.l("pitchstart",e)),this._rolling&&!l.rolling&&this.fire(new c.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const n=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&n!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(l-(n-(l*e+this._elevationStart))/(1-e)),this._elevationTarget=n}this.transform.setElevation(c.B.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};const n=e.getCameraLngLat(),l=e.getCameraAltitude(),u=this.terrain?this.terrain.getElevationForLngLatZoom(n,e.zoom):0;if(l<u){const f=this.calculateCameraOptionsFromTo(n,u,e.center,e.elevation);return{pitch:f.pitch,zoom:f.zoom}}return{}}_applyUpdatedTransform(e){const n=[];if(n.push(u=>this._elevateCameraIfInsideTerrain(u)),this.transformCameraUpdate&&n.push(u=>this.transformCameraUpdate(u)),!n.length)return;const l=e.clone();for(const u of n){const f=l.clone(),{center:y,zoom:w,roll:S,pitch:M,bearing:E,elevation:A}=u(f);y&&f.setCenter(y),A!==void 0&&f.setElevation(A),w!==void 0&&f.setZoom(w),S!==void 0&&f.setRoll(S),M!==void 0&&f.setPitch(M),E!==void 0&&f.setBearing(E),l.apply(f)}this.transform.apply(l)}_fireMoveEvents(e){this.fire(new c.l("move",e)),this._zooming&&this.fire(new c.l("zoom",e)),this._rotating&&this.fire(new c.l("rotate",e)),this._pitching&&this.fire(new c.l("pitch",e)),this._rolling&&this.fire(new c.l("roll",e))}_afterEase(e,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId;const l=this._zooming,u=this._rotating,f=this._pitching,y=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,l&&this.fire(new c.l("zoomend",e)),u&&this.fire(new c.l("rotateend",e)),f&&this.fire(new c.l("pitchend",e)),y&&this.fire(new c.l("rollend",e)),this.fire(new c.l("moveend",e))}flyTo(e,n){if(!e.essential&&me.prefersReducedMotion){const ze=c.O(e,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(ze,n)}this.stop(),e=c.e({offset:[0,0],speed:1.2,curve:1.42,easing:c.cf},e);const l=this._getTransformForUpdate(),u=l.bearing,f=l.pitch,y=l.roll,w=l.padding,S="bearing"in e?this._normalizeBearing(e.bearing,u):u,M="pitch"in e?+e.pitch:f,E="roll"in e?this._normalizeBearing(e.roll,y):y,A="padding"in e?e.padding:l.padding,z=c.P.convert(e.offset);let B=l.centerPoint.add(z);const O=l.screenPointToLocation(B),X=this.cameraHelper.handleFlyTo(l,{bearing:S,pitch:M,roll:E,padding:A,locationAtOffset:O,offsetAsPoint:z,center:e.center,minZoom:e.minZoom,zoom:e.zoom});let W=e.curve;const K=Math.max(l.width,l.height),J=K/X.scaleOfZoom,oe=X.pixelPathLength;typeof X.scaleOfMinZoom=="number"&&(W=Math.sqrt(K/X.scaleOfMinZoom/oe*2));const se=W*W;function ae(ze){const nt=(J*J-K*K+(ze?-1:1)*se*se*oe*oe)/(2*(ze?J:K)*se*oe);return Math.log(Math.sqrt(nt*nt+1)-nt)}function fe(ze){return(Math.exp(ze)-Math.exp(-ze))/2}function ue(ze){return(Math.exp(ze)+Math.exp(-ze))/2}const Se=ae(!1);let Fe=function(ze){return ue(Se)/ue(Se+W*ze)},ke=function(ze){return K*((ue(Se)*(fe(nt=Se+W*ze)/ue(nt))-fe(Se))/se)/oe;var nt},Ee=(ae(!0)-Se)/W;if(Math.abs(oe)<2e-6||!isFinite(Ee)){if(Math.abs(K-J)<1e-6)return this.easeTo(e,n);const ze=J<K?-1:1;Ee=Math.abs(Math.log(J/K))/W,ke=()=>0,Fe=nt=>Math.exp(ze*W*nt)}return e.duration="duration"in e?+e.duration:1e3*Ee/("screenSpeed"in e?+e.screenSpeed/W:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=u!==S,this._pitching=M!==f,this._rolling=E!==y,this._padding=!l.isPaddingEqual(A),this._prepareEase(n,!1),this.terrain&&this._prepareElevation(X.targetCenter),this._ease(ze=>{const nt=ze*Ee,et=1/Fe(nt),Ze=ke(nt);this._rotating&&l.setBearing(c.B.number(u,S,ze)),this._pitching&&l.setPitch(c.B.number(f,M,ze)),this._rolling&&l.setRoll(c.B.number(y,E,ze)),this._padding&&(l.interpolatePadding(w,A,ze),B=l.centerPoint.add(z)),X.easeFunc(ze,et,Ze,B),this.terrain&&!e.freezeElevation&&this._updateElevation(ze),this._applyUpdatedTransform(l),this._fireMoveEvents(n)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(n)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,n){var l;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const u=this._onEaseEnd;delete this._onEaseEnd,u.call(this,n)}return e||(l=this.handlers)===null||l===void 0||l.stop(!1),this}_ease(e,n,l){l.animate===!1||l.duration===0?(e(1),n()):(this._easeStart=me.now(),this._easeOptions=l,this._onEaseFrame=e,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,n){e=c.aL(e,-180,180);const l=Math.abs(e-n);return Math.abs(e-360-n)<l&&(e-=360),Math.abs(e+360-n)<l&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(c.Q.convert(e),this.transform.tileZoom):null}}const bs={compact:!0,customAttribution:'<a href="https://track-asia.com/" target="_blank">TrackAsia</a>'};class Er{constructor(e=bs){this._toggleAttribution=()=>{this._container.classList.contains("trackasiagl-compact")&&(this._container.classList.contains("trackasiagl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("trackasiagl-compact-show")):(this._container.classList.add("trackasiagl-compact-show"),this._container.removeAttribute("open")))},this._updateData=n=>{!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"&&n.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("trackasiagl-compact")||this._container.classList.contains("trackasiagl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("trackasiagl-compact","trackasiagl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("trackasiagl-compact")&&this._container.classList.remove("trackasiagl-compact","trackasiagl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("trackasiagl-compact")&&this._container.classList.contains("trackasiagl-compact-show")&&this._container.classList.remove("trackasiagl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=re.create("details","trackasiagl-ctrl trackasiagl-ctrl-attrib"),this._compactButton=re.create("summary","trackasiagl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=re.create("div","trackasiagl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){re.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,n){const l=this._map._getUIString(`AttributionControl.${n}`);e.title=l,e.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(u=>typeof u!="string"?"":u)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}const n=this._map.style.sourceCaches;for(const u in n){const f=n[u];if(f.used||f.usedForTerrain){const y=f.getSource();y.attribution&&e.indexOf(y.attribution)<0&&e.push(y.attribution)}}e=e.filter(u=>String(u).trim()),e.sort((u,f)=>u.length-f.length),e=e.filter((u,f)=>{for(let y=f+1;y<e.length;y++)if(e[y].indexOf(u)>=0)return!1;return!0});const l=e.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,e.length?(this._innerContainer.innerHTML=re.sanitize(l),this._container.classList.remove("trackasiagl-attrib-empty")):this._container.classList.add("trackasiagl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Xa{constructor(e={}){this._updateCompact=()=>{const n=this._container.children;if(n.length){const l=n[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("trackasiagl-compact"):l.classList.remove("trackasiagl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=re.create("div","trackasiagl-ctrl");const n=re.create("a","trackasiagl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://track-asia.com/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){re.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Bu{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const n=++this._id;return this._queue.push({callback:e,id:n,cancelled:!1}),n}remove(e){const n=this._currentlyRunning,l=n?this._queue.concat(n):this._queue;for(const u of l)if(u.id===e)return void(u.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const n=this._currentlyRunning=this._queue;this._queue=[];for(const l of n)if(!l.cancelled&&(l.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Ud=c.aG([{name:"a_pos3d",type:"Int16",components:3}]);class Zd extends c.E{constructor(e){super(),this._lastTilesetChange=me.now(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,n){this.sourceCache.update(e,n),this._renderableTilesKeys=[];const l={};for(const u of _e(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:n,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))l[u.key]=!0,this._renderableTilesKeys.push(u.key),this._tiles[u.key]||(u.terrainRttPosMatrix32f=new Float64Array(16),c.bQ(u.terrainRttPosMatrix32f,0,c.Z,c.Z,0,0,1),this._tiles[u.key]=new Gn(u,this.tileSize),this._lastTilesetChange=me.now());for(const u in this._tiles)l[u]||delete this._tiles[u]}freeRtt(e){for(const n in this._tiles){const l=this._tiles[n];(!e||l.tileID.equals(e)||l.tileID.isChildOf(e)||e.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e,n){return n?this._getTerrainCoordsForTileRanges(e,n):this._getTerrainCoordsForRegularTile(e)}_getTerrainCoordsForRegularTile(e){const n={};for(const l of this._renderableTilesKeys){const u=this._tiles[l].tileID,f=e.clone(),y=c.b2();if(u.canonical.equals(e.canonical))c.bQ(y,0,c.Z,c.Z,0,0,1);else if(u.canonical.isChildOf(e.canonical)){const w=u.canonical.z-e.canonical.z,S=u.canonical.x-(u.canonical.x>>w<<w),M=u.canonical.y-(u.canonical.y>>w<<w),E=c.Z>>w;c.bQ(y,0,E,E,0,0,1),c.L(y,y,[-S*E,-M*E,0])}else{if(!e.canonical.isChildOf(u.canonical))continue;{const w=e.canonical.z-u.canonical.z,S=e.canonical.x-(e.canonical.x>>w<<w),M=e.canonical.y-(e.canonical.y>>w<<w),E=c.Z>>w;c.bQ(y,0,c.Z,c.Z,0,0,1),c.L(y,y,[S*E,M*E,0]),c.M(y,y,[1/2**w,1/2**w,0])}}f.terrainRttPosMatrix32f=new Float32Array(y),n[l]=f}return n}_getTerrainCoordsForTileRanges(e,n){const l={};for(const u of this._renderableTilesKeys){const f=this._tiles[u].tileID;if(!this._isWithinTileRanges(f,n))continue;const y=e.clone(),w=c.b2();if(f.canonical.z===e.canonical.z){const S=e.canonical.x-f.canonical.x,M=e.canonical.y-f.canonical.y;c.bQ(w,0,c.Z,c.Z,0,0,1),c.L(w,w,[S*c.Z,M*c.Z,0])}else if(f.canonical.z>e.canonical.z){const S=f.canonical.z-e.canonical.z,M=f.canonical.x-(f.canonical.x>>S<<S),E=f.canonical.y-(f.canonical.y>>S<<S),A=e.canonical.x-(f.canonical.x>>S),z=e.canonical.y-(f.canonical.y>>S),B=c.Z>>S;c.bQ(w,0,B,B,0,0,1),c.L(w,w,[-M*B+A*c.Z,-E*B+z*c.Z,0])}else{const S=e.canonical.z-f.canonical.z,M=e.canonical.x-(e.canonical.x>>S<<S),E=e.canonical.y-(e.canonical.y>>S<<S),A=(e.canonical.x>>S)-f.canonical.x,z=(e.canonical.y>>S)-f.canonical.y,B=c.Z<<S;c.bQ(w,0,B,B,0,0,1),c.L(w,w,[M*c.Z+A*B,E*c.Z+z*B,0])}y.terrainRttPosMatrix32f=new Float32Array(w),l[u]=y}return l}getSourceTile(e,n){const l=this.sourceCache._source;let u=e.overscaledZ-this.deltaZoom;if(u>l.maxzoom&&(u=l.maxzoom),u<l.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(u).key);let f=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!f||!f.dem)&&n)for(;u>=l.minzoom&&(!f||!f.dem);)f=this.sourceCache.getTileByID(e.scaledTo(u--).key);return f}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}_isWithinTileRanges(e,n){return n[e.canonical.z]&&e.canonical.x>=n[e.canonical.z].minTileX&&e.canonical.x<=n[e.canonical.z].maxTileX&&e.canonical.y>=n[e.canonical.z].minTileY&&e.canonical.y<=n[e.canonical.z].maxTileY}}class Gd{constructor(e,n,l){this._meshCache={},this.painter=e,this.sourceCache=new Zd(n),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,n,l,u=c.Z){var f;if(!(n>=0&&n<u&&l>=0&&l<u))return 0;const y=this.getTerrainData(e),w=(f=y.tile)===null||f===void 0?void 0:f.dem;if(!w)return 0;const S=c.cj([],[n/u*c.Z,l/u*c.Z],y.u_terrain_matrix),M=[S[0]*w.dim,S[1]*w.dim],E=Math.floor(M[0]),A=Math.floor(M[1]),z=M[0]-E,B=M[1]-A;return w.get(E,A)*(1-z)*(1-B)+w.get(E+1,A)*z*(1-B)+w.get(E,A+1)*(1-z)*B+w.get(E+1,A+1)*z*B}getElevationForLngLatZoom(e,n){if(!c.ck(n,e.wrap()))return 0;const{tileID:l,mercatorX:u,mercatorY:f}=this._getOverscaledTileIDFromLngLatZoom(e,n);return this.getElevation(l,u%c.Z,f%c.Z,c.Z)}getElevation(e,n,l,u=c.Z){return this.getDEMElevation(e,n,l,u)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const u=this.painter.context,f=new c.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new rt(u,f,u.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new rt(u,new c.R({width:1,height:1}),u.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=c.ad([])}const n=this.sourceCache.getSourceTile(e,!0);if(n&&n.dem&&(!n.demTexture||n.needsTerrainPrepare)){const u=this.painter.context;n.demTexture=this.painter.getTileTexture(n.dem.stride),n.demTexture?n.demTexture.update(n.dem.getPixels(),{premultiply:!1}):n.demTexture=new rt(u,n.dem.getPixels(),u.gl.RGBA,{premultiply:!1}),n.demTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),n.needsTerrainPrepare=!1}const l=n&&n+n.tileID.key+e.key;if(l&&!this._demMatrixCache[l]){const u=this.sourceCache.sourceCache._source.maxzoom;let f=e.canonical.z-n.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=u?f=e.canonical.z-u:c.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const y=e.canonical.x-(e.canonical.x>>f<<f),w=e.canonical.y-(e.canonical.y>>f<<f),S=c.cl(new Float64Array(16),[1/(c.Z<<f),1/(c.Z<<f),0]);c.L(S,S,[y*c.Z,w*c.Z,0]),this._demMatrixCache[e.key]={matrix:S,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:n&&n.dem&&n.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:n&&n.dem&&n.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(n&&n.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:n}}getFramebuffer(e){const n=this.painter,l=n.width/devicePixelRatio,u=n.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===u||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new rt(n.context,{width:l,height:u,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new rt(n.context,{width:l,height:u,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=n.context.createFramebuffer(l,u,!0,!1),this._fbo.depthAttachment.set(n.context.createRenderbuffer(n.context.gl.DEPTH_COMPONENT16,l,u))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const n=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let f=0,y=0;f<this._coordsTextureSize;f++)for(let w=0;w<this._coordsTextureSize;w++,y+=4)n[y+0]=255&w,n[y+1]=255&f,n[y+2]=w>>8<<4|f>>8,n[y+3]=0;const l=new c.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(n.buffer)),u=new rt(e,l,e.gl.RGBA,{premultiply:!1});return u.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=u,u}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const n=new Uint8Array(4),l=this.painter.context,u=l.gl,f=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),y=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),w=Math.round(this.painter.height/devicePixelRatio);l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),u.readPixels(f,w-y-1,1,1,u.RGBA,u.UNSIGNED_BYTE,n),l.bindFramebuffer.set(null);const S=n[0]+(n[2]>>4<<8),M=n[1]+((15&n[2])<<8),E=this.coordsIndex[255-n[3]],A=E&&this.sourceCache.getTileByID(E);if(!A)return null;const z=this._coordsTextureSize,B=(1<<A.tileID.canonical.z)*z;return new c.$((A.tileID.canonical.x*z+S)/B+A.tileID.wrap,(A.tileID.canonical.y*z+M)/B,this.getElevation(A.tileID,S,M,z))}depthAtPoint(e){const n=new Uint8Array(4),l=this.painter.context,u=l.gl;return l.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),u.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,u.RGBA,u.UNSIGNED_BYTE,n),l.bindFramebuffer.set(null),(n[0]/16777216+n[1]/65536+n[2]/256+n[3])/256}getTerrainMesh(e){var n;const l=((n=this.painter.style.projection)===null||n===void 0?void 0:n.transitionState)>0,u=l&&e.canonical.y===0,f=l&&e.canonical.y===(1<<e.canonical.z)-1,y=`m_${u?"n":""}_${f?"s":""}`;if(this._meshCache[y])return this._meshCache[y];const w=this.painter.context,S=new c.cm,M=new c.aK,E=this.meshSize,A=c.Z/E,z=E*E;for(let ue=0;ue<=E;ue++)for(let Se=0;Se<=E;Se++)S.emplaceBack(Se*A,ue*A,0);for(let ue=0;ue<z;ue+=E+1)for(let Se=0;Se<E;Se++)M.emplaceBack(Se+ue,E+Se+ue+1,E+Se+ue+2),M.emplaceBack(Se+ue,E+Se+ue+2,Se+ue+1);const B=S.length,O=B+(E+1),X=(E+1)*E,W=u?c.b9:0,K=u?0:1,J=f?c.ba:c.Z,oe=f?0:1;for(let ue=0;ue<=E;ue++)S.emplaceBack(ue*A,W,K);for(let ue=0;ue<=E;ue++)S.emplaceBack(ue*A,J,oe);for(let ue=0;ue<E;ue++)M.emplaceBack(X+ue,O+ue,O+ue+1),M.emplaceBack(X+ue,O+ue+1,X+ue+1),M.emplaceBack(0+ue,B+ue+1,B+ue),M.emplaceBack(0+ue,0+ue+1,B+ue+1);const se=S.length,ae=se+2*(E+1);for(const ue of[0,1])for(let Se=0;Se<=E;Se++)for(const Fe of[0,1])S.emplaceBack(ue*c.Z,Se*A,Fe);for(let ue=0;ue<2*E;ue+=2)M.emplaceBack(se+ue,se+ue+1,se+ue+3),M.emplaceBack(se+ue,se+ue+3,se+ue+2),M.emplaceBack(ae+ue,ae+ue+3,ae+ue+1),M.emplaceBack(ae+ue,ae+ue+2,ae+ue+3);const fe=new vs(w.createVertexBuffer(S,Ud.members),w.createIndexBuffer(M),c.aJ.simpleSegment(0,0,S.length,M.length));return this._meshCache[y]=fe,fe}getMeshFrameDelta(e){return 2*Math.PI*c.bu/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,n){var l;const{tileID:u}=this._getOverscaledTileIDFromLngLatZoom(e,n);return(l=this.getMinMaxElevation(u).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(e){const n=this.getTerrainData(e).tile,l={minElevation:null,maxElevation:null};return n&&n.dem&&(l.minElevation=n.dem.min*this.exaggeration,l.maxElevation=n.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(e,n){const l=c.$.fromLngLat(e.wrap()),u=(1<<n)*c.Z,f=l.x*u,y=l.y*u,w=Math.floor(f/c.Z),S=Math.floor(y/c.Z);return{tileID:new c.Y(n,0,n,w,S),mercatorX:f,mercatorY:y}}}class am{constructor(e,n,l){this._context=e,this._size=n,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const n=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new rt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),n.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),n.colorAttachment.set(l.texture),{id:e,fbo:n,texture:l,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(n=>e.id!==n),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const n of this._recentlyUsed)if(!this._objects[n].inUse)return this._objects[n];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const Xn={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class hc{constructor(e,n){this.painter=e,this.terrain=n,this.pool=new am(e.context,30,n.sourceCache.tileSize*n.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,n){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(l=>!e._layers[l].isHidden(n)),this._coordsAscending={};for(const l in e.sourceCaches){this._coordsAscending[l]={};const u=e.sourceCaches[l].getVisibleCoordinates(),f=e.sourceCaches[l].getSource(),y=f instanceof un?f.terrainTileRanges:null;for(const w of u){const S=this.terrain.sourceCache.getTerrainCoords(w,y);for(const M in S)this._coordsAscending[l][M]||(this._coordsAscending[l][M]=[]),this._coordsAscending[l][M].push(S[M])}}this._coordsAscendingStr={};for(const l of e._order){const u=e._layers[l],f=u.source;if(Xn[u.type]&&!this._coordsAscendingStr[f]){this._coordsAscendingStr[f]={};for(const y in this._coordsAscending[f])this._coordsAscendingStr[f][y]=this._coordsAscending[f][y].map(w=>w.key).sort().join()}}for(const l of this._renderableTiles)for(const u in this._coordsAscendingStr){const f=this._coordsAscendingStr[u][l.tileID.key];f&&f!==l.rttCoords[u]&&(l.rtt=[])}}renderLayer(e,n){if(e.isHidden(this.painter.transform.zoom))return!1;const l=Object.assign(Object.assign({},n),{isRenderingToTexture:!0}),u=e.type,f=this.painter,y=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(Xn[u]&&(this._prevType&&Xn[this._prevType]||this._stacks.push([]),this._prevType=u,this._stacks[this._stacks.length-1].push(e.id),!y))return!0;if(Xn[this._prevType]||Xn[u]&&y){this._prevType=u;const w=this._stacks.length-1,S=this._stacks[w]||[];for(const M of this._renderableTiles){if(this.pool.isFull()&&(Vs(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(M),M.rtt[w]){const A=this.pool.getObjectForId(M.rtt[w].id);if(A.stamp===M.rtt[w].stamp){this.pool.useObject(A);continue}}const E=this.pool.getOrCreateFreeObject();this.pool.useObject(E),this.pool.stampObject(E),M.rtt[w]={id:E.id,stamp:E.stamp},f.context.bindFramebuffer.set(E.fbo.framebuffer),f.context.clear({color:c.b7.transparent,stencil:0}),f.currentStencilSource=void 0;for(let A=0;A<S.length;A++){const z=f.style._layers[S[A]],B=z.source?this._coordsAscending[z.source][M.tileID.key]:[M.tileID];f.context.viewport.set([0,0,E.fbo.width,E.fbo.height]),f._renderTileClippingMasks(z,B,!0),f.renderLayer(f,f.style.sourceCaches[z.source],z,B,l),z.source&&(M.rttCoords[z.source]=this._coordsAscendingStr[z.source][M.tileID.key])}}return Vs(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects(),Xn[u]}return!1}}const _t={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"TrackAsia logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},It=U,Ka={hash:!1,interactive:!0,bearingSnap:7,attributionControl:bs,trackasiaLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:c.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},Ou={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Nu{constructor(e,n,l=!1){this.mousedown=f=>{this.startMove(f,re.mousePos(this.element,f)),re.addEventListener(window,"mousemove",this.mousemove),re.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=f=>{this.move(f,re.mousePos(this.element,f))},this.mouseup=f=>{this._rotatePitchHanlder.dragEnd(f),this.offTemp()},this.touchstart=f=>{f.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=re.touchPos(this.element,f.targetTouches)[0],this.startMove(f,this._startPos),re.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),re.addEventListener(window,"touchend",this.touchend))},this.touchmove=f=>{f.targetTouches.length!==1?this.reset():(this._lastPos=re.touchPos(this.element,f.targetTouches)[0],this.move(f,this._lastPos))},this.touchend=f=>{f.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHanlder.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=n;const u=new Ho;this._rotatePitchHanlder=new Nn({clickTolerance:3,move:(f,y)=>{const w=n.getBoundingClientRect(),S=new c.P((w.bottom-w.top)/2,(w.right-w.left)/2);return{bearingDelta:c.ce(new c.P(f.x,y.y),y,S),pitchDelta:l?-.5*(y.y-f.y):void 0}},moveStateManager:u,enable:!0,assignEvents:()=>{}}),this.map=e,re.addEventListener(n,"mousedown",this.mousedown),re.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),re.addEventListener(n,"touchcancel",this.reset)}startMove(e,n){this._rotatePitchHanlder.dragStart(e,n),re.disableDrag()}move(e,n){const l=this.map,{bearingDelta:u,pitchDelta:f}=this._rotatePitchHanlder.dragMove(e,n)||{};u&&l.setBearing(l.getBearing()+u),f&&l.setPitch(l.getPitch()+f)}off(){const e=this.element;re.removeEventListener(e,"mousedown",this.mousedown),re.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),re.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),re.removeEventListener(window,"touchend",this.touchend),re.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){re.enableDrag(),re.removeEventListener(window,"mousemove",this.mousemove),re.removeEventListener(window,"mouseup",this.mouseup),re.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),re.removeEventListener(window,"touchend",this.touchend)}}let nn;function Vu(p,e,n,l=!1){if(l||!n.getCoveringTilesDetailsProvider().allowWorldCopies())return p==null?void 0:p.wrap();const u=new c.Q(p.lng,p.lat);if(p=new c.Q(p.lng,p.lat),e){const f=new c.Q(p.lng-360,p.lat),y=new c.Q(p.lng+360,p.lat),w=n.locationToScreenPoint(p).distSqr(e);n.locationToScreenPoint(f).distSqr(e)<w?p=f:n.locationToScreenPoint(y).distSqr(e)<w&&(p=y)}for(;Math.abs(p.lng-n.center.lng)>180;){const f=n.locationToScreenPoint(p);if(f.x>=0&&f.y>=0&&f.x<=n.width&&f.y<=n.height)break;p.lng>n.center.lng?p.lng-=360:p.lng+=360}return p.lng!==u.lng&&n.isPointOnMapSurface(n.locationToScreenPoint(p))?p:u}const Ti={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function qd(p,e,n){const l=p.classList;for(const u in Ti)l.remove(`trackasiagl-${n}-anchor-${u}`);l.add(`trackasiagl-${n}-anchor-${e}`)}class _o extends c.E{constructor(e){if(super(),this._onKeyPress=n=>{const l=n.code,u=n.charCode||n.keyCode;l!=="Space"&&l!=="Enter"&&u!==32&&u!==13||this.togglePopup()},this._onMapClick=n=>{const l=n.originalEvent.target,u=this._element;this._popup&&(l===u||u.contains(l))&&this.togglePopup()},this._update=n=>{if(!this._map)return;const l=this._map.loaded()&&!this._map.isMoving();((n==null?void 0:n.type)==="terrain"||(n==null?void 0:n.type)==="render"&&!l)&&this._map.once("render",this._update),this._lngLat=Vu(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let u="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?u=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(u=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let f="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?f="rotateX(0deg)":this._pitchAlignment==="map"&&(f=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||n&&n.type!=="moveend"||(this._pos=this._pos.round()),re.setTransform(this._element,`${Ti[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${f} ${u}`),me.frameAsync(new AbortController).then(()=>{this._updateOpacity(n&&n.type==="moveend")}).catch(()=>{})},this._onMove=n=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.l("dragstart"))),this.fire(new c.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new c.l("dragend")),this._state="inactive"},this._addDragHandler=n=>{this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos).add(this._offset),this._pointerdownPos=n.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=c.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=re.create("div");const n=re.createNS("http://www.w3.org/2000/svg","svg"),l=41,u=27;n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height",`${l}px`),n.setAttributeNS(null,"width",`${u}px`),n.setAttributeNS(null,"viewBox",`0 0 ${u} ${l}`);const f=re.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"stroke","none"),f.setAttributeNS(null,"stroke-width","1"),f.setAttributeNS(null,"fill","none"),f.setAttributeNS(null,"fill-rule","evenodd");const y=re.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"fill-rule","nonzero");const w=re.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"transform","translate(3.0, 29.0)"),w.setAttributeNS(null,"fill","#000000");const S=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const K of S){const J=re.createNS("http://www.w3.org/2000/svg","ellipse");J.setAttributeNS(null,"opacity","0.04"),J.setAttributeNS(null,"cx","10.5"),J.setAttributeNS(null,"cy","5.80029008"),J.setAttributeNS(null,"rx",K.rx),J.setAttributeNS(null,"ry",K.ry),w.appendChild(J)}const M=re.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"fill",this._color);const E=re.createNS("http://www.w3.org/2000/svg","path");E.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),M.appendChild(E);const A=re.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"opacity","0.25"),A.setAttributeNS(null,"fill","#000000");const z=re.createNS("http://www.w3.org/2000/svg","path");z.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),A.appendChild(z);const B=re.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"transform","translate(6.0, 7.0)"),B.setAttributeNS(null,"fill","#FFFFFF");const O=re.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"transform","translate(8.0, 8.0)");const X=re.createNS("http://www.w3.org/2000/svg","circle");X.setAttributeNS(null,"fill","#000000"),X.setAttributeNS(null,"opacity","0.25"),X.setAttributeNS(null,"cx","5.5"),X.setAttributeNS(null,"cy","5.5"),X.setAttributeNS(null,"r","5.4999962");const W=re.createNS("http://www.w3.org/2000/svg","circle");W.setAttributeNS(null,"fill","#FFFFFF"),W.setAttributeNS(null,"cx","5.5"),W.setAttributeNS(null,"cy","5.5"),W.setAttributeNS(null,"r","5.4999962"),O.appendChild(X),O.appendChild(W),y.appendChild(w),y.appendChild(M),y.appendChild(A),y.appendChild(B),y.appendChild(O),n.appendChild(y),n.setAttributeNS(null,"height",l*this._scale+"px"),n.setAttributeNS(null,"width",u*this._scale+"px"),this._element.appendChild(n),this._offset=c.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("trackasiagl-marker"),this._element.addEventListener("dragstart",n=>{n.preventDefault()}),this._element.addEventListener("mousedown",n=>{n.preventDefault()}),qd(this._element,this._anchor,"marker"),e&&e.className)for(const n of e.className.split(" "))this._element.classList.add(n);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),re.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=c.Q.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const u=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[u,-1*(38.1-13.5+u)],"bottom-right":[-u,-1*(38.1-13.5+u)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var n,l;if(!(!((n=this._map)===null||n===void 0)&&n.terrain)){const A=this._map.transform.isLocationOccluded(this._lngLat)?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==A&&(this._element.style.opacity=A))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const u=this._map,f=u.terrain.depthAtPoint(this._pos),y=u.terrain.getElevationForLngLatZoom(this._lngLat,u.transform.tileZoom);if(u.transform.lngLatToCameraDepth(this._lngLat,y)-f<.006)return void(this._element.style.opacity=this._opacity);const w=-this._offset.y/u.transform.pixelsPerMeter,S=Math.sin(u.getPitch()*Math.PI/180)*w,M=u.terrain.depthAtPoint(new c.P(this._pos.x,this._pos.y-this._offset.y)),E=u.transform.lngLatToCameraDepth(this._lngLat,y+S)-M>.006;!((l=this._popup)===null||l===void 0)&&l.isOpen()&&E&&this._popup.remove(),this._element.style.opacity=E?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=c.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,n){return(this._opacity===void 0||e===void 0&&n===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),n!==void 0&&(this._opacityWhenCovered=n),this._map&&this._updateOpacity(!0),this}}const Vr={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Dr=0,Ko=!1;const Ya={maxWidth:100,unit:"metric"};function Qa(p,e,n){const l=n&&n.maxWidth||100,u=p._container.clientHeight/2,f=p._container.clientWidth/2,y=p.unproject([f-l/2,u]),w=p.unproject([f+l/2,u]),S=Math.round(p.project(w).x-p.project(y).x),M=Math.min(l,S,p._container.clientWidth),E=y.distanceTo(w);if(n&&n.unit==="imperial"){const A=3.2808*E;A>5280?yo(e,M,A/5280,p._getUIString("ScaleControl.Miles")):yo(e,M,A,p._getUIString("ScaleControl.Feet"))}else n&&n.unit==="nautical"?yo(e,M,E/1852,p._getUIString("ScaleControl.NauticalMiles")):E>=1e3?yo(e,M,E/1e3,p._getUIString("ScaleControl.Kilometers")):yo(e,M,E,p._getUIString("ScaleControl.Meters"))}function yo(p,e,n,l){const u=function(f){const y=Math.pow(10,`${Math.floor(f)}`.length-1);let w=f/y;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:function(S){const M=Math.pow(10,Math.ceil(-Math.log(S)/Math.LN10));return Math.round(S*M)/M}(w),y*w}(n);p.style.width=e*(u/n)+"px",p.innerHTML=`${u}&nbsp;${l}`}const $u={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Uu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Yo(p){if(p){if(typeof p=="number"){const e=Math.round(Math.abs(p)/Math.SQRT2);return{center:new c.P(0,0),top:new c.P(0,p),"top-left":new c.P(e,e),"top-right":new c.P(-e,e),bottom:new c.P(0,-p),"bottom-left":new c.P(e,-e),"bottom-right":new c.P(-e,-e),left:new c.P(p,0),right:new c.P(-p,0)}}if(p instanceof c.P||Array.isArray(p)){const e=c.P.convert(p);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:c.P.convert(p.center||[0,0]),top:c.P.convert(p.top||[0,0]),"top-left":c.P.convert(p["top-left"]||[0,0]),"top-right":c.P.convert(p["top-right"]||[0,0]),bottom:c.P.convert(p.bottom||[0,0]),"bottom-left":c.P.convert(p["bottom-left"]||[0,0]),"bottom-right":c.P.convert(p["bottom-right"]||[0,0]),left:c.P.convert(p.left||[0,0]),right:c.P.convert(p.right||[0,0])}}return Yo(new c.P(0,0))}const Zu=U;b.AJAXError=c.cq,b.Event=c.l,b.Evented=c.E,b.LngLat=c.Q,b.MercatorCoordinate=c.$,b.Point=c.P,b.addProtocol=c.cr,b.config=c.a,b.removeProtocol=c.cs,b.AttributionControl=Er,b.BoxZoomHandler=zu,b.CanvasSource=Ji,b.CooperativeGesturesHandler=cc,b.DoubleClickZoomHandler=lc,b.DragPanHandler=Vd,b.DragRotateHandler=$d,b.EdgeInsets=Ca,b.FullscreenControl=class extends c.E{constructor(p={}){super(),this._onFullscreenChange=()=>{var e;let n=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=n==null?void 0:n.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)n=n.shadowRoot.fullscreenElement;n===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,p&&p.container&&(p.container instanceof HTMLElement?this._container=p.container:c.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=re.create("div","trackasiagl-ctrl trackasiagl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){re.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const p=this._fullscreenButton=re.create("button","trackasiagl-ctrl-fullscreen",this._controlContainer);re.create("span","trackasiagl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.title=p}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("trackasiagl-ctrl-shrink"),this._fullscreenButton.classList.toggle("trackasiagl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new c.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new c.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("trackasiagl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},b.GeoJSONSource=ci,b.GeolocateControl=class extends c.E{constructor(p){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new c.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("trackasiagl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("trackasiagl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("trackasiagl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("trackasiagl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("trackasiagl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("trackasiagl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("trackasiagl-user-location-dot-stale"),this.fire(new c.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{const n=new c.Q(e.coords.longitude,e.coords.latitude),l=e.coords.accuracy,u=this._map.getBearing(),f=c.e({bearing:u},this.options.fitBoundsOptions),y=mr.fromLngLat(n,l);this._map.fitBounds(y,f,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const n=new c.Q(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("trackasiagl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("trackasiagl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("trackasiagl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("trackasiagl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("trackasiagl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&Ko)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("trackasiagl-user-location-dot-stale"),this.fire(new c.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=re.create("button","trackasiagl-ctrl-geolocate",this._container),re.create("span","trackasiagl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){c.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=re.create("div","trackasiagl-user-location-dot"),this._userLocationDotMarker=new _o({element:this._dotElement}),this._circleElement=re.create("div","trackasiagl-user-location-accuracy-circle"),this._accuracyCircleMarker=new _o({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("trackasiagl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("trackasiagl-ctrl-geolocate-active"),this.fire(new c.l("trackuserlocationend")),this.fire(new c.l("userlocationlostfocus")))})}},this.options=c.e({},Vr,p)}onAdd(p){return this._map=p,this._container=re.create("div","trackasiagl-ctrl trackasiagl-ctrl-group"),this._setupUI(),function(){return c._(this,arguments,void 0,function*(e=!1){if(nn!==void 0&&!e)return nn;if(window.navigator.permissions===void 0)return nn=!!window.navigator.geolocation,nn;try{nn=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{nn=!!window.navigator.geolocation}return nn})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),re.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Dr=0,Ko=!1}_isOutOfMapMaxBounds(p){const e=this._map.getMaxBounds(),n=p.coords;return e&&(n.longitude<e.getWest()||n.longitude>e.getEast()||n.latitude<e.getSouth()||n.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("trackasiagl-ctrl-geolocate-active"),this._geolocateButton.classList.add("trackasiagl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("trackasiagl-ctrl-geolocate-active"),this._geolocateButton.classList.add("trackasiagl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("trackasiagl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("trackasiagl-ctrl-geolocate-background"),this._geolocateButton.classList.add("trackasiagl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("trackasiagl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const p=this._map.getBounds(),e=p.getSouthEast(),n=p.getNorthEast(),l=e.distanceTo(n),u=Math.ceil(this._accuracy/(l/this._map._container.clientHeight)*2);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}trigger(){if(!this._setup)return c.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Dr--,Ko=!1,this._watchState="OFF",this._geolocateButton.classList.remove("trackasiagl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("trackasiagl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("trackasiagl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("trackasiagl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("trackasiagl-ctrl-geolocate-background-error"),this.fire(new c.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("trackasiagl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.l("trackuserlocationstart")),this.fire(new c.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("trackasiagl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("trackasiagl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("trackasiagl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("trackasiagl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Dr++,Dr>1?(p={maximumAge:6e5,timeout:0},Ko=!0):(p=this.options.positionOptions,Ko=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,p)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("trackasiagl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},b.GlobeControl=class{constructor(){this._toggleProjection=()=>{var p;const e=(p=this._map.getProjection())===null||p===void 0?void 0:p.type;this._map.setProjection(e!=="mercator"&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var p;this._globeButton.classList.remove("trackasiagl-ctrl-globe"),this._globeButton.classList.remove("trackasiagl-ctrl-globe-enabled"),((p=this._map.getProjection())===null||p===void 0?void 0:p.type)==="globe"?(this._globeButton.classList.add("trackasiagl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("trackasiagl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(p){return this._map=p,this._container=re.create("div","trackasiagl-ctrl trackasiagl-ctrl-group"),this._globeButton=re.create("button","trackasiagl-ctrl-globe",this._container),re.create("span","trackasiagl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){re.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},b.Hash=ku,b.ImageSource=un,b.KeyboardHandler=Xo,b.LngLatBounds=mr,b.LogoControl=Xa,b.Map=class extends om{constructor(p){var e,n;c.cn.mark(c.co.create);const l=Object.assign(Object.assign(Object.assign({},Ka),p),{canvasContextAttributes:Object.assign(Object.assign({},Ka.canvasContextAttributes),p.canvasContextAttributes)});if(l.minZoom!=null&&l.maxZoom!=null&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(l.minPitch!=null&&l.maxPitch!=null&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(l.minPitch!=null&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(l.maxPitch!=null&&l.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const u=new Ro,f=new Ma;if(l.minZoom!==void 0&&u.setMinZoom(l.minZoom),l.maxZoom!==void 0&&u.setMaxZoom(l.maxZoom),l.minPitch!==void 0&&u.setMinPitch(l.minPitch),l.maxPitch!==void 0&&u.setMaxPitch(l.maxPitch),l.renderWorldCopies!==void 0&&u.setRenderWorldCopies(l.renderWorldCopies),super(u,f,{bearingSnap:l.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Bu,this._controls=[],this._mapId=c.a4(),this._contextLost=w=>{w.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new c.l("webglcontextlost",{originalEvent:w}))},this._contextRestored=w=>{this._setupPainter(),this.resize(),this._update(),this.fire(new c.l("webglcontextrestored",{originalEvent:w}))},this._onMapScroll=w=>{if(w.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=l.interactive,this._maxTileCacheSize=l.maxTileCacheSize,this._maxTileCacheZoomLevels=l.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},l.canvasContextAttributes),this._trackResize=l.trackResize===!0,this._bearingSnap=l.bearingSnap,this._centerClampedToGround=l.centerClampedToGround,this._refreshExpiredTiles=l.refreshExpiredTiles===!0,this._fadeDuration=l.fadeDuration,this._crossSourceCollisions=l.crossSourceCollisions===!0,this._collectResourceTiming=l.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},_t),l.locale),this._clickTolerance=l.clickTolerance,this._overridePixelRatio=l.pixelRatio,this._maxCanvasSize=l.maxCanvasSize,this.transformCameraUpdate=l.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=l.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Be.addThrottleControl(()=>this.isMoving()),this._requestManager=new We(l.transformRequest),typeof l.container=="string"){if(this._container=document.getElementById(l.container),!this._container)throw new Error(`Container '${l.container}' not found.`)}else{if(!(l.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(l.maxBounds&&this.setMaxBounds(l.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let w=!1;const S=Ga(M=>{this._trackResize&&!this._removed&&(this.resize(M),this.redraw())},50);this._resizeObserver=new ResizeObserver(M=>{w?S(M):w=!0}),this._resizeObserver.observe(this._container)}this.handlers=new sm(this,l),this._hash=l.hash&&new ku(typeof l.hash=="string"&&l.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:l.center,elevation:l.elevation,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch,roll:l.roll}),l.bounds&&(this.resize(),this.fitBounds(l.bounds,c.e({},l.fitBoundsOptions,{duration:0}))));const y=typeof l.style=="string"||((n=(e=l.style)===null||e===void 0?void 0:e.projection)===null||n===void 0?void 0:n.type)!=="globe";this.resize(null,y),this._localIdeographFontFamily=l.localIdeographFontFamily,this._validateStyle=l.validateStyle,l.style&&this.setStyle(l.style,{localIdeographFontFamily:l.localIdeographFontFamily}),l.attributionControl&&this.addControl(new Er(typeof l.attributionControl=="boolean"?void 0:l.attributionControl)),l.trackasiaLogo&&this.addControl(new Xa,l.logoPosition),this.on("style.load",()=>{if(y||this._resizeTransform(),this.transform.unmodified){const w=c.O(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(w)}}),this.on("data",w=>{this._update(w.dataType==="style"),this.fire(new c.l(`${w.dataType}data`,w))}),this.on("dataloading",w=>{this.fire(new c.l(`${w.dataType}dataloading`,w))}),this.on("dataabort",w=>{this.fire(new c.l("sourcedataabort",w))})}_getMapId(){return this._mapId}addControl(p,e){if(e===void 0&&(e=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new c.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=p.onAdd(this);this._controls.push(p);const l=this._controlPositions[e];return e.indexOf("bottom")!==-1?l.insertBefore(n,l.firstChild):l.appendChild(n),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new c.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(p);return e>-1&&this._controls.splice(e,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}calculateCameraOptionsFromTo(p,e,n,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLatZoom(n,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(p,e,n,l)}resize(p,e=!0){const[n,l]=this._containerDimensions(),u=this._getClampedPixelRatio(n,l);if(this._resizeCanvas(n,l,u),this.painter.resize(n,l,u),this.painter.overLimit()){const y=this.painter.context.gl;this._maxCanvasSize=[y.drawingBufferWidth,y.drawingBufferHeight];const w=this._getClampedPixelRatio(n,l);this._resizeCanvas(n,l,w),this.painter.resize(n,l,w)}this._resizeTransform(e);const f=!this._moving;return f&&(this.stop(),this.fire(new c.l("movestart",p)).fire(new c.l("move",p))),this.fire(new c.l("resize",p)),f&&this.fire(new c.l("moveend",p)),this}_resizeTransform(p=!0){var e;const[n,l]=this._containerDimensions();this.transform.resize(n,l,p),(e=this._requestedCameraState)===null||e===void 0||e.resize(n,l,p)}_getClampedPixelRatio(p,e){const{0:n,1:l}=this._maxCanvasSize,u=this.getPixelRatio(),f=p*u,y=e*u;return Math.min(f>n?n/f:1,y>l?l/y:1)*u}getPixelRatio(){var p;return(p=this._overridePixelRatio)!==null&&p!==void 0?p:devicePixelRatio}setPixelRatio(p){this._overridePixelRatio=p,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(p){return this.transform.setMaxBounds(mr.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.setMinZoom(p),this._update(),this.getZoom()<p&&this.setZoom(p),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.setMaxZoom(p),this._update(),this.getZoom()>p&&this.setZoom(p),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.setMinPitch(p),this._update(),this.getPitch()<p&&this.setPitch(p),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(p>=this.transform.minPitch)return this.transform.setMaxPitch(p),this._update(),this.getPitch()>p&&this.setPitch(p),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.setRenderWorldCopies(p),this._update()}project(p){return this.transform.locationToScreenPoint(c.Q.convert(p),this.style&&this.terrain)}unproject(p){return this.transform.screenPointToLocation(c.P.convert(p),this.terrain)}isMoving(){var p;return this._moving||((p=this.handlers)===null||p===void 0?void 0:p.isMoving())}isZooming(){var p;return this._zooming||((p=this.handlers)===null||p===void 0?void 0:p.isZooming())}isRotating(){var p;return this._rotating||((p=this.handlers)===null||p===void 0?void 0:p.isRotating())}_createDelegatedListener(p,e,n){if(p==="mouseenter"||p==="mouseover"){let l=!1;return{layers:e,listener:n,delegates:{mousemove:f=>{const y=e.filter(S=>this.getLayer(S)),w=y.length!==0?this.queryRenderedFeatures(f.point,{layers:y}):[];w.length?l||(l=!0,n.call(this,new dn(p,this,f.originalEvent,{features:w}))):l=!1},mouseout:()=>{l=!1}}}}if(p==="mouseleave"||p==="mouseout"){let l=!1;return{layers:e,listener:n,delegates:{mousemove:y=>{const w=e.filter(S=>this.getLayer(S));(w.length!==0?this.queryRenderedFeatures(y.point,{layers:w}):[]).length?l=!0:l&&(l=!1,n.call(this,new dn(p,this,y.originalEvent)))},mouseout:y=>{l&&(l=!1,n.call(this,new dn(p,this,y.originalEvent)))}}}}{const l=u=>{const f=e.filter(w=>this.getLayer(w)),y=f.length!==0?this.queryRenderedFeatures(u.point,{layers:f}):[];y.length&&(u.features=y,n.call(this,u),delete u.features)};return{layers:e,listener:n,delegates:{[p]:l}}}}_saveDelegatedListener(p,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(e)}_removeDelegatedListener(p,e,n){if(!this._delegatedListeners||!this._delegatedListeners[p])return;const l=this._delegatedListeners[p];for(let u=0;u<l.length;u++){const f=l[u];if(f.listener===n&&f.layers.length===e.length&&f.layers.every(y=>e.includes(y))){for(const y in f.delegates)this.off(y,f.delegates[y]);return void l.splice(u,1)}}}on(p,e,n){if(n===void 0)return super.on(p,e);const l=typeof e=="string"?[e]:e,u=this._createDelegatedListener(p,l,n);this._saveDelegatedListener(p,u);for(const f in u.delegates)this.on(f,u.delegates[f]);return{unsubscribe:()=>{this._removeDelegatedListener(p,l,n)}}}once(p,e,n){if(n===void 0)return super.once(p,e);const l=typeof e=="string"?[e]:e,u=this._createDelegatedListener(p,l,n);for(const f in u.delegates){const y=u.delegates[f];u.delegates[f]=(...w)=>{this._removeDelegatedListener(p,l,n),y(...w)}}this._saveDelegatedListener(p,u);for(const f in u.delegates)this.once(f,u.delegates[f]);return this}off(p,e,n){return n===void 0?super.off(p,e):(this._removeDelegatedListener(p,typeof e=="string"?[e]:e,n),this)}queryRenderedFeatures(p,e){if(!this.style)return[];let n;const l=p instanceof c.P||Array.isArray(p),u=l?p:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(l?{}:p)||{},u instanceof c.P||typeof u[0]=="number")n=[c.P.convert(u)];else{const f=c.P.convert(u[0]),y=c.P.convert(u[1]);n=[f,new c.P(y.x,f.y),y,new c.P(f.x,y.y),f]}return this.style.queryRenderedFeatures(n,e,this.transform)}querySourceFeatures(p,e){return this.style.querySourceFeatures(p,e)}setStyle(p,e){return(e=c.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&p?(this._diffStyle(p,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(p,e))}setTransformRequest(p){return this._requestManager.setTransformRequest(p),this}_getUIString(p){const e=this._locale[p];if(e==null)throw new Error(`Missing UI string '${p}'`);return e}_updateStyle(p,e){var n,l;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(p,e));const u=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!p)),p?(this.style=new uu(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof p=="string"?this.style.loadURL(p,e,u):this.style.loadJSON(p,e,u),this):((l=(n=this.style)===null||n===void 0?void 0:n.projection)===null||l===void 0||l.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new uu(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,e){if(typeof p=="string"){const n=this._requestManager.transformRequest(p,"Style");c.j(n,new AbortController).then(l=>{this._updateDiff(l.data,e)}).catch(l=>{l&&this.fire(new c.k(l))})}else typeof p=="object"&&this._updateDiff(p,e)}_updateDiff(p,e){try{this.style.setState(p,e)&&this._update(!0)}catch(n){c.w(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(p,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():c.w("There is no style added to the map.")}addSource(p,e){return this._lazyInitEmptyStyle(),this.style.addSource(p,e),this._update(!0)}isSourceLoaded(p){const e=this.style&&this.style.sourceCaches[p];if(e!==void 0)return e.loaded();this.fire(new c.k(new Error(`There is no source with ID '${p}'`)))}setTerrain(p){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),p){const e=this.style.sourceCaches[p.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${p.source}`);this.terrain===null&&e.reload();for(const n in this.style._layers){const l=this.style._layers[n];l.type==="hillshade"&&l.source===p.source&&c.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Gd(this.painter,e,p),this.painter.renderToTexture=new hc(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=n=>{var l;n.dataType==="style"?this.terrain.sourceCache.freeRtt():n.dataType==="source"&&n.tile&&(n.sourceId!==p.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((l=n.source)===null||l===void 0?void 0:l.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(n.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new c.l("terrain",{terrain:p})),this}getTerrain(){var p,e;return(e=(p=this.terrain)===null||p===void 0?void 0:p.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const p=this.style&&this.style.sourceCaches;for(const e in p){const n=p[e]._tiles;for(const l in n){const u=n[l];if(u.state!=="loaded"&&u.state!=="errored")return!1}}return!0}removeSource(p){return this.style.removeSource(p),this._update(!0)}getSource(p){return this.style.getSource(p)}setSourceTileLodParams(p,e,n){if(n){const l=this.getSource(n);if(!l)throw new Error(`There is no source with ID "${n}", cannot set LOD parameters`);l.calculateTileZoom=de(Math.max(1,p),Math.max(1,e))}else for(const l in this.style.sourceCaches)this.style.sourceCaches[l].getSource().calculateTileZoom=de(Math.max(1,p),Math.max(1,e));return this._update(!0),this}refreshTiles(p,e){const n=this.style.sourceCaches[p];if(!n)throw new Error(`There is no source cache with ID "${p}", cannot refresh tile`);e===void 0?n.reload():n.refreshTiles(e.map(l=>new c.a1(l.z,l.x,l.y)))}addImage(p,e,n={}){const{pixelRatio:l=1,sdf:u=!1,stretchX:f,stretchY:y,content:w,textFitWidth:S,textFitHeight:M}=n;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||c.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new c.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:E,height:A,data:z}=e,B=e;return this.style.addImage(p,{data:new c.R({width:E,height:A},new Uint8Array(z)),pixelRatio:l,stretchX:f,stretchY:y,content:w,textFitWidth:S,textFitHeight:M,sdf:u,version:0,userImage:B}),B.onAdd&&B.onAdd(this,p),this}}{const{width:E,height:A,data:z}=me.getImageData(e);this.style.addImage(p,{data:new c.R({width:E,height:A},z),pixelRatio:l,stretchX:f,stretchY:y,content:w,textFitWidth:S,textFitHeight:M,sdf:u,version:0})}}updateImage(p,e){const n=this.style.getImage(p);if(!n)return this.fire(new c.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=e instanceof HTMLImageElement||c.b(e)?me.getImageData(e):e,{width:u,height:f,data:y}=l;if(u===void 0||f===void 0)return this.fire(new c.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(u!==n.data.width||f!==n.data.height)return this.fire(new c.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const w=!(e instanceof HTMLImageElement||c.b(e));return n.data.replace(y,w),this.style.updateImage(p,n),this}getImage(p){return this.style.getImage(p)}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new c.k(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p){return Be.getImage(this._requestManager.transformRequest(p,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(p,e){return this._lazyInitEmptyStyle(),this.style.addLayer(p,e),this._update(!0)}moveLayer(p,e){return this.style.moveLayer(p,e),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(p,e,n){return this.style.setLayerZoomRange(p,e,n),this._update(!0)}setFilter(p,e,n={}){return this.style.setFilter(p,e,n),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,e,n,l={}){return this.style.setPaintProperty(p,e,n,l),this._update(!0)}getPaintProperty(p,e){return this.style.getPaintProperty(p,e)}setLayoutProperty(p,e,n,l={}){return this.style.setLayoutProperty(p,e,n,l),this._update(!0)}getLayoutProperty(p,e){return this.style.getLayoutProperty(p,e)}setGlyphs(p,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(p,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(p,e,n={}){return this._lazyInitEmptyStyle(),this.style.addSprite(p,e,n,l=>{l||this._update(!0)}),this}removeSprite(p){return this._lazyInitEmptyStyle(),this.style.removeSprite(p),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(p,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(p,e,n=>{n||this._update(!0)}),this}setLight(p,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(p,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(p,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(p,e){return this.style.setFeatureState(p,e),this._update()}removeFeatureState(p,e){return this.style.removeFeatureState(p,e),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let p=0,e=0;return this._container&&(p=this._container.clientWidth||400,e=this._container.clientHeight||300),[p,e]}_setupContainer(){const p=this._container;p.classList.add("trackasiagl-map");const e=this._canvasContainer=re.create("div","trackasiagl-canvas-container",p);this._interactive&&e.classList.add("trackasiagl-interactive"),this._canvas=re.create("canvas","trackasiagl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const n=this._containerDimensions(),l=this._getClampedPixelRatio(n[0],n[1]);this._resizeCanvas(n[0],n[1],l);const u=this._controlContainer=re.create("div","trackasiagl-control-container",p),f=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(y=>{f[y]=re.create("div",`trackasiagl-ctrl-${y} `,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,e,n){this._canvas.width=Math.floor(n*p),this._canvas.height=Math.floor(n*e),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const p=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let e=null;this._canvas.addEventListener("webglcontextcreationerror",l=>{e={requestedAttributes:p},l&&(e.statusMessage=l.statusMessage,e.type=l.type)},{once:!0});let n=null;if(n=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,p):this._canvas.getContext("webgl2",p)||this._canvas.getContext("webgl",p),!n){const l="Failed to initialize WebGL";throw e?(e.message=l,new Error(JSON.stringify(e))):new Error(l)}this.painter=new Mu(n,this.transform),ce.testSupport(n)}migrateProjection(p,e){super.migrateProjection(p,e),this.painter.transform=p,this.fire(new c.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_render(p){var e,n,l,u,f;const y=this._idleTriggered?this._fadeDuration:0,w=((e=this.style.projection)===null||e===void 0?void 0:e.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(p),this._removed)return;let S=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const A=this.transform.zoom,z=me.now();this.style.zoomHistory.update(A,z);const B=new c.C(A,{now:z,fadeDuration:y,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),O=B.crossFadingFactor();O===1&&O===this._crossFadingFactor||(S=!0,this._crossFadingFactor=O),this.style.update(B)}const M=((n=this.style.projection)===null||n===void 0?void 0:n.transitionState)>0!==w;(l=this.style.projection)===null||l===void 0||l.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((u=this.style.projection)===null||u===void 0?void 0:u.transitionState,(f=this.style.projection)===null||f===void 0?void 0:f.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||M)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,y,this._crossSourceCollisions,M),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,showPadding:this.showPadding}),this.fire(new c.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,c.cn.mark(c.co.load),this.fire(new c.l("load"))),this.style&&(this.style.hasTransitions()||S)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const E=this._sourcesDirty||this._styleDirty||this._placementDirty;return E||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new c.l("idle")),!this._loaded||this._fullyLoaded||E||(this._fullyLoaded=!0,c.cn.mark(c.co.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var p;this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Be.removeThrottleControl(this._imageQueueHandle),(p=this._resizeObserver)===null||p===void 0||p.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),re.remove(this._canvasContainer),re.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("trackasiagl-map"),c.cn.clearMetrics(),this._removed=!0,this.fire(new c.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,me.frame(this._frameRequest,p=>{c.cn.frame(p),this._frameRequest=null;try{this._render(p)}catch(e){if(!c.cp(e)&&!function(n){return n.message===Hl}(e))throw e}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get version(){return It}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(p){return this._lazyInitEmptyStyle(),this.style.setProjection(p),this._update(!0)}},b.MapMouseEvent=dn,b.MapTouchEvent=Uo,b.MapWheelEvent=Au,b.Marker=_o,b.NavigationControl=class{constructor(p){this._updateZoomButtons=()=>{const e=this._map.getZoom(),n=e===this._map.getMaxZoom(),l=e===this._map.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,n)=>{const l=this._map._getUIString(`NavigationControl.${n}`);e.title=l,e.setAttribute("aria-label",l)},this.options=c.e({},Ou,p),this._container=re.create("div","trackasiagl-ctrl trackasiagl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("trackasiagl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),re.create("span","trackasiagl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("trackasiagl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),re.create("span","trackasiagl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("trackasiagl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=re.create("span","trackasiagl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Nu(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){re.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(p,e){const n=re.create("button",p,this._container);return n.type="button",n.addEventListener("click",e),n}},b.Popup=class extends c.E{constructor(p){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:void 0)},this.remove=()=>(this._content&&re.remove(this._content),this._container&&(re.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("trackasiagl-track-pointer"),delete this._map,this.fire(new c.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=re.create("div","trackasiagl-popup",this._map.getContainer()),this._tip=re.create("div","trackasiagl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const y of this.options.className.split(" "))this._container.classList.add(y);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("trackasiagl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Vu(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!e)return;const n=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let l=this.options.anchor;const u=Yo(this.options.offset);if(!l){const y=this._container.offsetWidth,w=this._container.offsetHeight;let S;S=n.y+u.bottom.y<w?["top"]:n.y>this._map.transform.height-w?["bottom"]:[],n.x<y/2?S.push("left"):n.x>this._map.transform.width-y/2&&S.push("right"),l=S.length===0?"bottom":S.join("-")}let f=n.add(u[l]);this.options.subpixelPositioning||(f=f.round()),re.setTransform(this._container,`${Ti[l]} translate(${f.x}px,${f.y}px)`),qd(this._container,l,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=c.e(Object.create($u),p)}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("trackasiagl-popup-track-pointer"),this._map._canvasContainer.classList.add("trackasiagl-track-pointer")):this._map.on("move",this._update),this.fire(new c.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(p){return this._lngLat=c.Q.convert(p),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("trackasiagl-popup-track-pointer"),this._map._canvasContainer.classList.remove("trackasiagl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("trackasiagl-popup-track-pointer"),this._map._canvasContainer.classList.add("trackasiagl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(document.createTextNode(p))}setHTML(p){const e=document.createDocumentFragment(),n=document.createElement("body");let l;for(n.innerHTML=p;l=n.firstChild,l;)e.appendChild(l);return this.setDOMContent(e)}getMaxWidth(){var p;return(p=this._container)===null||p===void 0?void 0:p.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=re.create("div","trackasiagl-popup-content",this._container);return this._content.appendChild(p),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(p){return this._container&&this._container.classList.add(p),this}removeClassName(p){return this._container&&this._container.classList.remove(p),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){if(this._container)return this._container.classList.toggle(p)}setSubpixelPositioning(p){this.options.subpixelPositioning=p}_createCloseButton(){this.options.closeButton&&(this._closeButton=re.create("button","trackasiagl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(Uu);p&&p.focus()}},b.RasterDEMTileSource=Di,b.RasterTileSource=rn,b.ScaleControl=class{constructor(p){this._onMove=()=>{Qa(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Qa(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Ya),p)}getDefaultPosition(){return"bottom-left"}onAdd(p){return this._map=p,this._container=re.create("div","trackasiagl-ctrl trackasiagl-ctrl-scale",p.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){re.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},b.ScrollZoomHandler=Jt,b.Style=uu,b.TerrainControl=class{constructor(p){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("trackasiagl-ctrl-terrain"),this._terrainButton.classList.remove("trackasiagl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("trackasiagl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("trackasiagl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=p}onAdd(p){return this._map=p,this._container=re.create("div","trackasiagl-ctrl trackasiagl-ctrl-group"),this._terrainButton=re.create("button","trackasiagl-ctrl-terrain",this._container),re.create("span","trackasiagl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){re.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},b.TwoFingersTouchPitchHandler=ac,b.TwoFingersTouchRotateHandler=at,b.TwoFingersTouchZoomHandler=Wo,b.TwoFingersTouchZoomRotateHandler=Fu,b.VectorTileSource=Qi,b.VideoSource=kn,b.addSourceType=(p,e)=>c._(void 0,void 0,void 0,function*(){if(es(p))throw new Error(`A source type called "${p}" already exists.`);((n,l)=>{js[n]=l})(p,e)}),b.clearPrewarmedResources=function(){const p=br;p&&(p.isPreloaded()&&p.numActive()===1?(p.release(Gt),br=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},b.createTileMesh=ka,b.getMaxParallelImageRequests=function(){return c.a.MAX_PARALLEL_IMAGE_REQUESTS},b.getRTLTextPluginStatus=function(){return ts().getRTLTextPluginStatus()},b.getVersion=function(){return Zu},b.getWorkerCount=function(){return Xt.workerCount},b.getWorkerUrl=function(){return c.a.WORKER_URL},b.importScriptInWorkers=function(p){return Ae().broadcast("IS",p)},b.prewarm=function(){cn().acquire(Gt)},b.setMaxParallelImageRequests=function(p){c.a.MAX_PARALLEL_IMAGE_REQUESTS=p},b.setRTLTextPlugin=function(p,e){return ts().setRTLTextPlugin(p,e)},b.setWorkerCount=function(p){Xt.workerCount=p},b.setWorkerUrl=function(p){c.a.WORKER_URL=p}});var P=d;return P})})(Tw);var dM=Tw.exports;const pM=hT(dM),j0={},F0={"margherita-pizza":"/images/margherita-pizza.jpg","pepperoni-pizza":"/images/Pepperoni-Pizza.jpg","hawaiian-pizza":"/images/Hawaiian-Pizza.jpg","spaghetti-carbonara":"/images/spaghetti-carbonara.jpg",lasagna:"/images/Italian-Lasagna.jpg",cheeseburger:"/images/cheeseburgers.jpg","double-burger":"/images/double-burger.jpg",fries:"/images/Fries.jpg","coke-soda":"/images/coke.jpg","sushi-maki":"/images/sushi-maki.jpg","nigiri-set":"/images/NigiriSet.jpg","ramen-miso":"/images/MisoRamen.jpg","chicken-katsu":"/images/Chicken-Katsu.jpg","pho-bo":"/images/pho-bo.jpg","banh-mi-thit":"/images/banhmi.jpg","bun-bo-hue":"/images/bun-bo-hue.jpg","com-tam":"/images/com-tam.jpg","goi-cuon":"/images/goi-cuon.jpg","bun-cha-ha-noi":"/images/bun-cha-ha-noi.jpg","banh-xeo":"/images/banh-xeo.jpg","mi-quang":"/images/mi-quang.jpg","bo-kho-banh-mi":"/images/bo-kho-banh-mi.jpg","hu-tieu-nam-vang":"/images/hu-tieu-nam-vang.jpg","taco-bo":"/images/taco-thit-bo.jpg","chicken-burrito":"/images/chicken-burrito.jpg",quesadilla:"/images/quesadilla.jpg","ga-ran":"/images/ga-ran.jpg","steak-bit-tet":"/images/bit-tet.jpg","pad-thai":"/images/pad-thai.jpg","com-chien-duong-chau":"/images/com_chien_duong_chau.jpg","caesar-salad":"/images/caesar-salad.jpg","greek-salad":"/images/greek-salad.jpg","tra-sua-tran-chau":"/images/tra-sua-tran-chau.jpg","nuoc-cam-ep":"/images/nuoc-cam-ep.jpg","che-ba-mau":"/images/che-ba-mau.jpg"};function fM(r){return(r||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(//g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"")}function B0(r){const o=r.id,d=r.name;if(o&&j0[o])return j0[o];if(d){const _=fM(d);if(F0[_])return F0[_]}return null}const Ci="http://10.40.112.64:3002",Ph="http://10.40.112.64:3001",Mc="http://10.40.112.64:3003";function Gi(r){const o=document.getElementById(r);return o?o.value:""}function mM(r){const o=document.getElementById(r);return o&&o.files&&o.files[0]||null}async function Pw(r){var _;const o=new FormData;o.append("file",r);const d=await Ct.post(`${Ci.replace(/\/$/,"")}/upload`,o,{headers:{"Content-Type":"multipart/form-data"}});return((_=d==null?void 0:d.data)==null?void 0:_.path)||""}function Sy(){const r=(()=>{try{const Q=localStorage.getItem("ff_user");if(Q){const ne=JSON.parse(Q);return{token:(ne==null?void 0:ne.token)||"",role:(ne==null?void 0:ne.role)||"user",email:(ne==null?void 0:ne.email)||""}}}catch{}return{token:"",role:"user",email:""}})(),[o,d]=Re.useState(r.token),[_,x]=Re.useState(r.role),[P,b]=Re.useState(r.email),[c,U]=Re.useState(!1);return Re.useEffect(()=>{try{const Q=localStorage.getItem("ff_user");if(Q){const ne=JSON.parse(Q);d((ne==null?void 0:ne.token)||""),b((ne==null?void 0:ne.email)||""),x((ne==null?void 0:ne.role)||"user")}}catch{}},[]),Re.useEffect(()=>{async function Q(){try{if(!o){U(!0);return}const ne=await Ct.get(`${Ph.replace(/\/$/,"")}/me`,{headers:{Authorization:`Bearer ${o}`}});ne!=null&&ne.data&&(x(ne.data.role||_),b(ne.data.email||P))}catch{}U(!0)}Q()},[o]),{token:o,role:_,email:P,ready:c}}function kc({title:r,children:o}){return R.jsxs("div",{className:"card",style:{marginBottom:16},children:[R.jsx("h3",{style:{marginTop:0},children:r}),o]})}function gM(){const{token:r,role:o,ready:d}=Sy(),_=Re.useMemo(()=>r?{Authorization:`Bearer ${r}`}:{},[r]),[x,P]=Re.useState([]),[b,c]=Re.useState([]),U=Re.useRef(null),Q=Re.useRef(null),ne=Re.useRef(null),ye=Re.useRef(null),me=Re.useRef(null),re=Re.useRef(null),ce=Re.useRef(null),Le=Re.useRef(null);Re.useEffect(()=>{Ct.get(`${Ci.replace(/\/$/,"")}/restaurants`).then(pe=>P(pe.data||[])).catch(()=>P([])),Ct.get(`${Ci.replace(/\/$/,"")}/categories`).then(pe=>c(pe.data||[])).catch(()=>c([]))},[]),Re.useEffect(()=>{d&&o!=="admin"&&(window.location.hash="/")},[d,o]);async function Qe(){var rt,Zt,zt,ur,hr,_r,Wt,tn,dr,Gr,qe;const pe=((Zt=(rt=U.current)==null?void 0:rt.value)==null?void 0:Zt.trim())||"",le=Number(((zt=Q.current)==null?void 0:zt.value)||0),ve=((ur=ne.current)==null?void 0:ur.value)||"";let Be=((_r=(hr=me.current)==null?void 0:hr.value)==null?void 0:_r.trim())||"";const We=((tn=(Wt=ce.current)==null?void 0:Wt.value)==null?void 0:tn.trim())||"",Je=Number(((dr=Le.current)==null?void 0:dr.value)||100),st=((Gr=ye.current)==null?void 0:Gr.value)||"";if(!pe||!le){alert("Vui lng nhp tn v gi");return}try{const ft=((qe=re.current)==null?void 0:qe.files)&&re.current.files[0];if(ft){const bt=await Pw(ft);bt&&(Be=bt)}}catch{}await Ct.post(`${Ci.replace(/\/$/,"")}/products`,{name:pe,price:le,stock:Je,imageUrl:Be,description:We,category:ve,restaurantId:st},{headers:_}),window.location.hash="#/admin"}return R.jsxs("div",{className:"page",children:[R.jsx("h2",{children:"Thm sn phm"}),R.jsxs("div",{className:"card",children:[R.jsxs("div",{className:"form-row",children:[R.jsx("label",{children:"Tn"}),R.jsx("input",{className:"input",placeholder:"Tn mn",ref:U,autoComplete:"off"})]}),R.jsxs("div",{className:"form-row",children:[R.jsx("label",{children:"Gi"}),R.jsx("input",{className:"input",placeholder:"Gi",inputMode:"decimal",ref:Q,autoComplete:"off"})]}),R.jsxs("div",{className:"form-row",children:[R.jsx("label",{children:"Danh mc"}),R.jsxs("select",{ref:ne,defaultValue:"",children:[R.jsx("option",{value:"",children:"-- chn danh mc --"}),b.map(pe=>R.jsx("option",{value:pe.name,children:pe.name},pe.id))]})]}),R.jsxs("div",{className:"form-row",children:[R.jsx("label",{children:"Nh hng"}),R.jsxs("select",{ref:ye,defaultValue:"",children:[R.jsx("option",{value:"",children:"-- chn nh hng --"}),x.map(pe=>R.jsx("option",{value:pe.id,children:pe.name},pe.id))]})]}),R.jsxs("div",{className:"form-row",children:[R.jsx("label",{children:"nh (URL hoc /images/...)"}),R.jsx("input",{className:"input",placeholder:"/images/pho-bo.jpg",ref:me,autoComplete:"off"})]}),R.jsxs("div",{className:"form-row",children:[R.jsx("label",{children:"Ti nh"}),R.jsx("input",{type:"file",accept:"image/*",ref:re})]}),R.jsxs("div",{className:"form-row",children:[R.jsx("label",{children:"M t"}),R.jsx("input",{className:"input",placeholder:"M t chi tit",ref:ce,autoComplete:"off"})]}),R.jsxs("div",{className:"form-row",children:[R.jsx("label",{children:"Tn kho"}),R.jsx("input",{className:"input",placeholder:"100",inputMode:"numeric",ref:Le,autoComplete:"off"})]}),R.jsxs("div",{style:{display:"flex",gap:8,marginTop:8},children:[R.jsx("button",{className:"btn",onClick:()=>{window.location.hash="#/admin"},children:"Quay li"}),R.jsx("button",{className:"btn primary",onClick:Qe,children:"Lu"})]})]})]})}function _M(){const{role:r,ready:o}=Sy(),[d,_]=Re.useState(""),[x,P]=Re.useState(""),[b,c]=Re.useState(""),[U,Q]=Re.useState("");Re.useEffect(()=>{o&&r!=="admin"&&(window.location.hash="/")},[o,r]);async function ne(){const ye={name:d.trim(),address:x.trim()},me=parseFloat(b);isNaN(me)||(ye.lat=me);const re=parseFloat(U);if(isNaN(re)||(ye.lng=re),!ye.name){alert("Nhp tn");return}await Ct.post(`${Ci.replace(/\/$/,"")}/restaurants`,ye),window.location.hash="#/admin"}return R.jsxs("div",{className:"page",children:[R.jsx("h2",{children:"Thm nh hng"}),R.jsxs("div",{className:"card",children:[R.jsxs("div",{className:"form-row",children:[R.jsx("label",{children:"Tn"}),R.jsx("input",{className:"input",placeholder:"Tn nh hng",value:d,onChange:ye=>_(ye.target.value)})]}),R.jsxs("div",{className:"form-row",children:[R.jsx("label",{children:"a ch"}),R.jsx("input",{className:"input",placeholder:"a ch",value:x,onChange:ye=>P(ye.target.value)})]}),R.jsxs("div",{className:"form-row",style:{display:"flex",gap:8},children:[R.jsxs("div",{style:{flex:1},children:[R.jsx("label",{children:"Lat"}),R.jsx("input",{className:"input",placeholder:"10.77",value:b,onChange:ye=>c(ye.target.value)})]}),R.jsxs("div",{style:{flex:1},children:[R.jsx("label",{children:"Lng"}),R.jsx("input",{className:"input",placeholder:"106.69",value:U,onChange:ye=>Q(ye.target.value)})]})]}),R.jsxs("div",{style:{display:"flex",gap:8,marginTop:8},children:[R.jsx("button",{className:"btn",onClick:()=>{window.location.hash="#/admin"},children:"Quay li"}),R.jsx("button",{className:"btn primary",onClick:ne,children:"Lu"})]})]})]})}function yM(){const{token:r,role:o,ready:d}=Sy(),_=Re.useMemo(()=>r?{Authorization:`Bearer ${r}`}:{},[r]),[x,P]=Re.useState("orders"),[b,c]=Re.useState([]),[U,Q]=Re.useState([]),[ne,ye]=Re.useState([]),[me,re]=Re.useState([]),[ce,Le]=Re.useState([]),[Qe,pe]=Re.useState(""),[le,ve]=Re.useState(""),[Be,We]=Re.useState(1),[Je,st]=Re.useState(20),[rt,Zt]=Re.useState(0),[zt,ur]=Re.useState(1),[hr,_r]=Re.useState({});Re.useRef(null),Re.useRef(null),Re.useRef(null),Re.useRef(null),Re.useRef(null),Re.useRef(null),Re.useRef(null),Re.useRef(null),Re.useRef(null),Re.useRef(null),Re.useRef(null),Re.useRef(null);const Wt=Re.useRef(null);Re.useEffect(()=>{d&&o!=="admin"&&(window.location.hash="/")},[d,o]);async function tn(){const Ae=await Ct.get(`${Ci.replace(/\/$/,"")}/products`);c(Ae.data||[])}async function dr(){const Ae=await Ct.get(`${Ci.replace(/\/$/,"")}/restaurants`);re(Ae.data||[])}async function Gr(){const Ae=await Ct.get(`${Ci.replace(/\/$/,"")}/categories`);Le(Ae.data||[])}async function qe(){const Ae=await Ct.get(`${Ph.replace(/\/$/,"")}/users`,{headers:_});Q(Ae.data||[])}async function ft(Ae){const Ut=typeof(Ae==null?void 0:Ae.page)=="number"?Ae.page:Be,Yt=typeof(Ae==null?void 0:Ae.limit)=="number"?Ae.limit:Je,yr=typeof(Ae==null?void 0:Ae.fromDate)=="string"?Ae.fromDate:Qe,qr=typeof(Ae==null?void 0:Ae.toDate)=="string"?Ae.toDate:le,Sr={page:Ut,limit:Yt};yr&&(Sr.fromDate=yr),qr&&(Sr.toDate=qr);const nr=(await Ct.get(`${Mc.replace(/\/$/,"")}/orders`,{params:Sr})).data;Array.isArray(nr)?(ye(nr||[]),Zt((nr||[]).length),ur(1),We(1)):(ye((nr==null?void 0:nr.data)||[]),We(Number((nr==null?void 0:nr.page)||Ut)||1),st(Number((nr==null?void 0:nr.limit)||Yt)||20),Zt(Number((nr==null?void 0:nr.total)||0)||0),ur(Number((nr==null?void 0:nr.totalPages)||1)||1))}Re.useEffect(()=>{tn(),dr(),Gr()},[]),Re.useEffect(()=>{o==="admin"&&qe()},[o]),Re.useEffect(()=>{ft()},[]);const bt=Re.useRef({});Re.useEffect(()=>{const Ae=bt.current||{},Ut=new Set(ne.map(Yt=>Yt.id));for(const Yt of Object.keys(Ae))if(!Ut.has(Yt)){try{Ae[Yt].close()}catch{}delete Ae[Yt]}for(const Yt of ne)if(!Ae[Yt.id])try{const yr=new EventSource(`${Mc.replace(/\/$/,"")}/orders/${Yt.id}/events`);yr.addEventListener("status",qr=>{try{const Sr=JSON.parse(qr.data||"{}");ye(mr=>mr.map(nr=>nr.id===Yt.id?{...nr,status:Sr.status}:nr))}catch{}}),yr.addEventListener("deleted",()=>{ye(qr=>qr.filter(Sr=>Sr.id!==Yt.id))}),Ae[Yt.id]=yr}catch{}return bt.current=Ae,()=>{for(const Yt of Object.keys(Ae))try{Ae[Yt].close()}catch{}}},[ne]);async function Gt(Ae){const Ut={name:Gi(`p-name-${Ae.id}`),price:Number(Gi(`p-price-${Ae.id}`)||Ae.price),category:Gi(`p-category-${Ae.id}`),imageUrl:Gi(`p-image-${Ae.id}`),description:Gi(`p-desc-${Ae.id}`),stock:Number(Gi(`p-stock-${Ae.id}`)||Ae.stock)};try{const Yt=document.getElementById(`p-rest-${Ae.id}`);Yt&&(Ut.restaurantId=Yt.value||null)}catch{}try{const Yt=mM(`p-file-${Ae.id}`);if(Yt){const yr=await Pw(Yt);yr&&(Ut.imageUrl=yr)}}catch{}await Ct.put(`${Ci.replace(/\/$/,"")}/products/${Ae.id}`,Ut),await tn()}async function Xt(Ae){confirm("Xo sn phm ny?")&&(await Ct.delete(`${Ci.replace(/\/$/,"")}/products/${Ae}`),await tn())}async function yn(Ae,Ut){await Ct.patch(`${Ph.replace(/\/$/,"")}/users/${Ae.id}`,{role:Ut},{headers:_}),await qe()}async function br(Ae){const Ut={email:Gi(`u-email-${Ae.id}`),name:Gi(`u-name-${Ae.id}`)},Yt=Gi(`u-pass-${Ae.id}`);Yt&&(Ut.password=Yt),await Ct.patch(`${Ph.replace(/\/$/,"")}/users/${Ae.id}`,Ut,{headers:_}),await qe()}async function Tr(Ae){confirm("Xo ti khon ny?")&&(await Ct.delete(`${Ph.replace(/\/$/,"")}/users/${Ae}`,{headers:_}),await qe())}async function cn(Ae,Ut){await Ct.patch(`${Mc.replace(/\/$/,"")}/orders/${Ae.id}`,{status:Ut}),await ft()}async function Xr(Ae){confirm("Xo n hng ny?")&&(await Ct.delete(`${Mc.replace(/\/$/,"")}/orders/${Ae}`),await ft())}return R.jsxs("div",{className:"page",children:[R.jsx("h2",{children:"Admin"}),R.jsx("div",{className:"card",style:{marginBottom:12},children:R.jsx("div",{className:"filters",style:{justifyContent:"flex-start"},children:R.jsxs("div",{className:"chips",children:[R.jsx("button",{className:`chip${x==="products"?" active":""}`,onClick:()=>P("products"),children:"Sn phm"}),R.jsx("button",{className:`chip${x==="users"?" active":""}`,onClick:()=>P("users"),children:"Ngi dng"}),R.jsx("button",{className:`chip${x==="orders"?" active":""}`,onClick:()=>P("orders"),children:"n hng"}),R.jsx("button",{className:`chip${x==="restaurants"?" active":""}`,onClick:()=>P("restaurants"),children:"Nh hng"}),R.jsx("button",{className:`chip${x==="categories"?" active":""}`,onClick:()=>P("categories"),children:"Danh mc"})]})})}),x==="products"&&R.jsxs(R.Fragment,{children:[R.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:8},children:R.jsx("a",{className:"btn primary",href:"#/admin/products/new",children:"Thm"})}),R.jsx(kc,{title:"Danh sch sn phm",children:R.jsx("div",{style:{overflowX:"auto"},children:R.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[R.jsx("thead",{children:R.jsxs("tr",{children:[R.jsx("th",{align:"left",children:"Tn"}),R.jsx("th",{align:"left",children:"Gi"}),R.jsx("th",{align:"left",children:"Danh mc"}),R.jsx("th",{align:"left",children:"Nh hng"}),R.jsx("th",{align:"left",children:"Tn"}),R.jsx("th",{align:"left",children:"nh"}),R.jsx("th",{align:"left",children:"M t"}),R.jsx("th",{align:"left",children:"Hnh ng"})]})}),R.jsx("tbody",{children:b.map(Ae=>R.jsxs("tr",{style:{borderTop:"1px solid var(--border)"},children:[R.jsx("td",{children:R.jsx("input",{id:`p-name-${Ae.id}`,className:"input",defaultValue:Ae.name})}),R.jsx("td",{children:R.jsx("input",{id:`p-price-${Ae.id}`,className:"input",defaultValue:String(Ae.price)})}),R.jsx("td",{children:R.jsx("input",{id:`p-category-${Ae.id}`,className:"input",defaultValue:Ae.category||""})}),R.jsx("td",{children:R.jsxs("select",{id:`p-rest-${Ae.id}`,defaultValue:Ae.restaurantId||"",children:[R.jsx("option",{value:"",children:"--"}),me.map(Ut=>R.jsx("option",{value:Ut.id,children:Ut.name},Ut.id))]})}),R.jsx("td",{children:R.jsx("input",{id:`p-stock-${Ae.id}`,className:"input",defaultValue:String(Ae.stock)})}),R.jsxs("td",{children:[R.jsx("input",{id:`p-image-${Ae.id}`,className:"input",defaultValue:Ae.imageUrl||""}),R.jsx("div",{style:{marginTop:6},children:R.jsx("input",{id:`p-file-${Ae.id}`,type:"file",accept:"image/*"})})]}),R.jsx("td",{children:R.jsx("input",{id:`p-desc-${Ae.id}`,className:"input",defaultValue:Ae.description||""})}),R.jsxs("td",{style:{whiteSpace:"nowrap"},children:[R.jsx("button",{className:"btn small",onClick:()=>Gt(Ae),children:"Lu"}),R.jsx("button",{className:"btn small ghost",onClick:()=>Xt(Ae.id),style:{marginLeft:6},children:"Xo"})]})]},Ae.id))})]})})})]}),x==="users"&&R.jsx(kc,{title:"Danh sch ngi dng",children:R.jsx("div",{style:{overflowX:"auto"},children:R.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[R.jsx("thead",{children:R.jsxs("tr",{children:[R.jsx("th",{align:"left",children:"Email"}),R.jsx("th",{align:"left",children:"Tn"}),R.jsx("th",{align:"left",children:"Quyn"}),R.jsx("th",{align:"left",children:"Mt khu mi"}),R.jsx("th",{align:"left",children:"Hnh ng"})]})}),R.jsx("tbody",{children:U.map(Ae=>R.jsxs("tr",{style:{borderTop:"1px solid var(--border)"},children:[R.jsx("td",{children:R.jsx("input",{id:`u-email-${Ae.id}`,className:"input",defaultValue:Ae.email})}),R.jsx("td",{children:R.jsx("input",{id:`u-name-${Ae.id}`,className:"input",defaultValue:Ae.name||""})}),R.jsx("td",{children:R.jsxs("select",{value:Ae.role,onChange:Ut=>yn(Ae,Ut.target.value),children:[R.jsx("option",{value:"user",children:"user"}),R.jsx("option",{value:"admin",children:"admin"})]})}),R.jsx("td",{children:R.jsx("input",{id:`u-pass-${Ae.id}`,className:"input",placeholder:"(tu chn)",type:"password"})}),R.jsxs("td",{style:{whiteSpace:"nowrap"},children:[R.jsx("button",{className:"btn small",onClick:()=>br(Ae),children:"Lu"}),R.jsx("button",{className:"btn small ghost",onClick:()=>Tr(Ae.id),style:{marginLeft:6},children:"Xo"})]})]},Ae.id))})]})})}),x==="orders"&&R.jsxs(kc,{title:"Danh sch n hng",children:[R.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8,gap:8},children:[R.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[R.jsx("label",{children:"T"}),R.jsx("input",{type:"date",value:Qe,onChange:Ae=>pe(Ae.target.value)}),R.jsx("label",{children:"n"}),R.jsx("input",{type:"date",value:le,onChange:Ae=>ve(Ae.target.value)}),R.jsx("button",{className:"btn",onClick:()=>{We(1),ft({page:1})},children:"Lc"}),R.jsx("button",{className:"btn ghost",onClick:()=>{pe(""),ve(""),We(1),ft({page:1,fromDate:"",toDate:""})},children:"Xo lc"})]}),R.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[R.jsx("span",{children:"Hin th"}),R.jsxs("select",{value:String(Je),onChange:Ae=>{const Ut=parseInt(Ae.target.value||"20");st(Ut),We(1),ft({page:1,limit:Ut})},children:[R.jsx("option",{value:"10",children:"10"}),R.jsx("option",{value:"20",children:"20"}),R.jsx("option",{value:"50",children:"50"}),R.jsx("option",{value:"100",children:"100"})]}),R.jsxs("span",{children:["Trang ",Be,"/",zt]}),R.jsx("button",{className:"btn",disabled:Be<=1,onClick:()=>ft({page:Be-1}),children:"Trc"}),R.jsx("button",{className:"btn",disabled:Be>=zt,onClick:()=>ft({page:Be+1}),children:"Sau"})]})]}),R.jsx("div",{style:{overflowX:"auto"},children:R.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[R.jsx("thead",{children:R.jsxs("tr",{children:[R.jsx("th",{align:"left",children:"M n"}),R.jsx("th",{align:"left",children:"Email"}),R.jsx("th",{align:"left",children:"Thi gian"}),R.jsx("th",{align:"left",children:"Tng"}),R.jsx("th",{align:"left",children:"Trng thi"}),R.jsx("th",{align:"left",children:"Hnh ng"})]})}),R.jsx("tbody",{children:ne.map(Ae=>R.jsxs("tr",{style:{borderTop:"1px solid var(--border)"},children:[R.jsx("td",{children:Ae.id.slice(0,6)}),R.jsx("td",{children:Ae.userEmail||""}),R.jsx("td",{children:Ae.createdAt?new Date(Ae.createdAt).toLocaleString():""}),R.jsxs("td",{children:["$",Number(Ae.total||0).toFixed(2)]}),R.jsx("td",{children:R.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[R.jsx("span",{className:"pill",children:Ae.status||""}),R.jsx("button",{className:"btn small",style:{background:hr[Ae.id]?"var(--accent)":"",color:hr[Ae.id]?"#fff":""},onClick:async()=>{const Ut=!hr[Ae.id];if(Ut)try{await Ct.post(`${Mc.replace(/\/$/,"")}/orders/${Ae.id}/drone/arm`)}catch{}_r(Yt=>({...Yt,[Ae.id]:Ut}))},title:"Bt/tt drone",children:""}),R.jsx("button",{className:"btn small primary",disabled:!hr[Ae.id],onClick:async()=>{await Ct.post(`${Mc.replace(/\/$/,"")}/orders/${Ae.id}/drone/start`)},children:"Bt u drone"}),R.jsx("button",{className:"btn small",onClick:()=>cn(Ae," giao  n ti nh"),children:"Xc nhn  giao"}),R.jsx("a",{className:"btn small ghost",href:`#/track/${Ae.id}`,children:"Theo di"})]})}),R.jsx("td",{style:{whiteSpace:"nowrap"},children:R.jsx("button",{className:"btn small ghost",onClick:()=>Xr(Ae.id),children:"Xo"})})]},Ae.id))})]})})]}),x==="restaurants"&&R.jsxs(R.Fragment,{children:[R.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:8},children:R.jsx("a",{className:"btn primary",href:"#/admin/restaurants/new",children:"Thm"})}),R.jsx(kc,{title:"Danh sch nh hng",children:R.jsx("div",{style:{overflowX:"auto"},children:R.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[R.jsx("thead",{children:R.jsxs("tr",{children:[R.jsx("th",{align:"left",children:"Tn"}),R.jsx("th",{align:"left",children:"a ch"}),R.jsx("th",{align:"left",children:"To "}),R.jsx("th",{align:"left",children:"Hnh ng"})]})}),R.jsx("tbody",{children:me.map(Ae=>R.jsxs("tr",{style:{borderTop:"1px solid var(--border)"},children:[R.jsx("td",{children:R.jsx("input",{id:`r-name-${Ae.id}`,className:"input",defaultValue:Ae.name})}),R.jsx("td",{children:R.jsx("input",{id:`r-addr-${Ae.id}`,className:"input",defaultValue:Ae.address||""})}),R.jsxs("td",{style:{display:"flex",gap:6},children:[R.jsx("input",{id:`r-lat-${Ae.id}`,className:"input",defaultValue:String(Ae.lat??"")}),R.jsx("input",{id:`r-lng-${Ae.id}`,className:"input",defaultValue:String(Ae.lng??"")})]}),R.jsxs("td",{children:[R.jsx("button",{className:"btn small",onClick:async()=>{const Ut={name:Gi(`r-name-${Ae.id}`),address:Gi(`r-addr-${Ae.id}`)},Yt=parseFloat(Gi(`r-lat-${Ae.id}`));isNaN(Yt)||(Ut.lat=Yt);const yr=parseFloat(Gi(`r-lng-${Ae.id}`));isNaN(yr)||(Ut.lng=yr),await Ct.put(`${Ci.replace(/\/$/,"")}/restaurants/${Ae.id}`,Ut),await dr()},children:"Lu"}),R.jsx("button",{className:"btn small ghost",style:{marginLeft:6},onClick:async()=>{confirm("Xo nh hng ny?")&&(await Ct.delete(`${Ci.replace(/\/$/,"")}/restaurants/${Ae.id}`),await dr())},children:"Xo"})]})]},Ae.id))})]})})})]}),x==="categories"&&R.jsxs(R.Fragment,{children:[R.jsxs(kc,{title:"Thm danh mc",children:[R.jsxs("div",{className:"form-row",children:[R.jsx("label",{children:"Tn danh mc"}),R.jsx("input",{className:"input",placeholder:"V d: Vietnamese",ref:Wt})]}),R.jsx("button",{className:"btn primary",onClick:async()=>{var Ut,Yt;const Ae=((Yt=(Ut=Wt.current)==null?void 0:Ut.value)==null?void 0:Yt.trim())||"";if(!Ae){alert("Nhp tn danh mc");return}await Ct.post(`${Ci.replace(/\/$/,"")}/categories`,{name:Ae}),await Gr(),Wt.current&&(Wt.current.value="")},children:"Thm"})]}),R.jsx(kc,{title:"Danh sch danh mc",children:R.jsx("div",{style:{overflowX:"auto"},children:R.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[R.jsx("thead",{children:R.jsxs("tr",{children:[R.jsx("th",{align:"left",children:"Tn"}),R.jsx("th",{align:"left",children:"Hnh ng"})]})}),R.jsx("tbody",{children:ce.map(Ae=>R.jsxs("tr",{style:{borderTop:"1px solid var(--border)"},children:[R.jsx("td",{children:Ae.name}),R.jsx("td",{children:R.jsx("button",{className:"btn small ghost",onClick:async()=>{confirm("Xo danh mc ny?")&&(await Ct.delete(`${Ci.replace(/\/$/,"")}/categories/${Ae.id}`),await Gr())},children:"Xo"})})]},Ae.id))})]})})})]})]})}const Ec="http://10.40.112.64:3002",xh="http://10.40.112.64:3001",cl="http://10.40.112.64:3003",vM="http://10.40.112.64:3004",kg="a8da2e51d0a720ef81a1762860280f15fa";function Eg({src:r,srcList:o=[],alt:d,className:_,style:x}){const b=`<svg xmlns='http://www.w3.org/2000/svg' width='640' height='360'><defs><linearGradient id='g' x1='0' y1='0' x2='1' y2='1'><stop stop-color='#a78bfa' offset='0'/><stop stop-color='#60a5fa' offset='1'/></linearGradient></defs><rect width='100%' height='100%' fill='url(#g)'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-family='Poppins,Arial' font-size='28' fill='white' opacity='0.9'>${String(d||"").slice(0,40)||"Food"}</text></svg>`,c=`data:image/svg+xml;utf8,${encodeURIComponent(b)}`,U=[r,...o,c].filter(Boolean),[Q,ne]=Re.useState(0),[ye,me]=Re.useState(!1),re=U[Q];return Re.useEffect(()=>{ne(0),me(!1)},[r]),re?R.jsxs("div",{style:{position:"relative"},children:[!ye&&R.jsx("div",{className:"img-skeleton"}),R.jsx("img",{src:re,alt:d,loading:"lazy",width:640,height:360,decoding:"async",referrerPolicy:"no-referrer",className:_,style:{...ye?{}:{display:"none"},...x||{}},onLoad:()=>me(!0),onError:()=>{Q<U.length-1?ne(Q+1):ne(U.length)}})]}):R.jsx("div",{className:"img-skeleton "+(_||""),style:x})}function xM(){const[r,o]=Re.useState([]),[d,_]=Re.useState([]),[x,P]=Re.useState(!0),[b,c]=Re.useState(null),[U,Q]=Re.useState("login"),[ne,ye]=Re.useState(""),[me,re]=Re.useState(""),[ce,Le]=Re.useState(null),[Qe,pe]=Re.useState(""),[le,ve]=Re.useState(""),[Be,We]=Re.useState(""),[Je,st]=Re.useState(!1),[rt,Zt]=Re.useState(!1),[zt,ur]=Re.useState("email"),[hr,_r]=Re.useState(""),[Wt,tn]=Re.useState("Tt c"),[dr,Gr]=Re.useState(""),[qe,ft]=Re.useState(""),[bt,Gt]=Re.useState(!1),[Xt,yn]=Re.useState([]),br=Re.useRef(null),[Tr,cn]=Re.useState(!1),[Xr,Ae]=Re.useState(""),[Ut,Yt]=Re.useState(""),[yr,qr]=Re.useState(""),[Sr,mr]=Re.useState(""),[nr,Qi]=Re.useState(""),[rn,Di]=Re.useState(null),[ci,un]=Re.useState(null),[kn,Ji]=Re.useState("COD"),[js,es]=Re.useState("NCB"),[ro,no]=Re.useState("vn"),[io,ts]=Re.useState(""),[Gn,Li]=Re.useState(null),[ms,qn]=Re.useState(!1),[En,xi]=Re.useState(()=>Math.floor(Date.now()/864e5)%1e5),[ge,V]=Re.useState(window.location.hash.replace("#","")||"/"),$=Re.useRef(null),H=Re.useRef(null),te=Re.useRef(null),de=Re.useRef(null),q=Re.useRef(null),Te=Re.useRef(null),_e=Re.useRef(null),be=Re.useRef(null),Ce=Re.useRef(null),xe=Re.useRef(null),$e=Re.useRef(null),tt=Re.useRef(null);Re.useEffect(()=>{const Oe=()=>V(window.location.hash.replace("#","")||"/");return window.addEventListener("hashchange",Oe),()=>window.removeEventListener("hashchange",Oe)},[]),Re.useEffect(()=>{ge==="/register"?Q("register"):ge==="/login"&&Q("login")},[ge]),Re.useEffect(()=>{async function Oe(){try{P(!0);const[we,He]=await Promise.all([Ct.get(`${Ec.replace(/\/$/,"")}/products`),Ct.get(`${Ec.replace(/\/$/,"")}/categories`)]);o(we.data||[]);const Ke=Array.isArray(He==null?void 0:He.data)?He.data.map(yt=>String((yt==null?void 0:yt.name)||"")).filter(Boolean):[];yn(Array.from(new Set(Ke.map(yt=>Tt(yt)).filter(Boolean))))}catch{o([]),yn([])}finally{P(!1)}}Oe()},[]),Re.useEffect(()=>{try{const Oe=localStorage.getItem("ff_user");if(Oe){const we=JSON.parse(Oe);we&&we.email&&c(we)}}catch{}},[]),Re.useEffect(()=>{const Oe=ge||"/",we=Oe==="/login"||Oe==="/register";(b==null?void 0:b.role)==="admin"&&we&&kt("/admin")},[b,ge]);function ot(Oe){return(Oe||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(//g,"d").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"")}function xt(Oe,we){const He=ot(Oe),Ke=[];return He&&Ke.push(`/images/${He}.webp`,`/images/${He}.jpg`,`/images/${He}.png`,`/images/${He}.jpeg`),we&&Ke.push(`/images/${we}.webp`,`/images/${we}.jpg`,`/images/${we}.png`,`/images/${we}.jpeg`),Ke}function Lt(Oe){const we=(Oe||"").toLowerCase();return/pizza/.test(we)?"Pizza":/burger|hamburger|cheeseburger/.test(we)?"Burger":/sushi|nigiri|maki/.test(we)?"Sushi":/spaghetti|pasta|lasagna/.test(we)?"Pasta":/salad|caesar/.test(we)?"Salad":/ph|pho|bn|bun|bnh m|banh mi|cm|com/.test(we)?"Vietnamese":/ramen/.test(we)?"Japanese":/taco|burrito/.test(we)?"Mexican":/fries/.test(we)?"Sides":/coke|soda|drink/.test(we)?"Drinks":/steak/.test(we)?"Steak":/chicken|g|ga/.test(we)?"Chicken":"Khc"}function Tt(Oe){const we=(Oe||"").trim();return we&&we.charAt(0).toUpperCase()+we.slice(1).toLowerCase()}function Ie(Oe){const we=(Oe.name||"").toLowerCase(),He=encodeURIComponent(we.replace(/\s+/g,"-"));return/pizza/.test(we)?`https://loremflickr.com/seed/${He}/640/360/pizza,food`:/burger|hamburger|cheeseburger/.test(we)?`https://loremflickr.com/seed/${He}/640/360/burger,fastfood`:/sushi|maki|nigiri/.test(we)?`https://loremflickr.com/seed/${He}/640/360/sushi,fish`:/salad|caesar/.test(we)?`https://loremflickr.com/seed/${He}/640/360/salad,vegetable`:/pasta|spaghetti|lasagna/.test(we)?`https://loremflickr.com/seed/${He}/640/360/pasta,italian`:/chicken|g|ga|fried chicken|wings/.test(we)?`https://loremflickr.com/seed/${He}/640/360/chicken`:/ramen/.test(we)?`https://loremflickr.com/seed/${He}/640/360/ramen,noodle`:/taco|burrito/.test(we)?`https://loremflickr.com/seed/${He}/640/360/mexican,food`:/steak/.test(we)?`https://loremflickr.com/seed/${He}/640/360/steak,meat`:/coke|soda|drink|tea|milk/.test(we)?`https://loremflickr.com/seed/${He}/640/360/drink,beverage`:/rice|cm|com|risotto|nasi/.test(we)?`https://loremflickr.com/seed/${He}/640/360/rice,food`:`https://picsum.photos/seed/${He}/640/360`}function or(Oe,we){const He=(Oe==null?void 0:Oe.id)||we||"",Ke=(Oe==null?void 0:Oe.name)||"",yt=B0({id:He,name:Ke});if(yt)return yt;const lt=Ie({name:Ke});return lt||(Oe==null?void 0:Oe.imageUrl)||""}function qt(Oe){const we=xt(Oe.name,Oe.id),He=B0({id:Oe.id,name:Oe.name})||"",Ke=Oe.imageUrl||"",yt=Ie({id:Oe.id,name:Oe.name});return[...we,Ke,He,yt].filter(Boolean)}function tr(Oe){return(Oe||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(//g,"d").replace(//g,"D")}function Mt(Oe){let we=String(Oe||"").trim();if(!we)return we;let He=tr(we);return He=He.replace(/\s{2,}/g," ").trim(),/vietnam/i.test(He)||(He=He+", Vietnam"),He}async function Ve(Oe){const we=[],He=String(Oe||"").trim();He&&we.push(He);const Ke=Mt(He);Ke&&Ke!==He&&we.push(Ke);const yt=tr(He);yt&&yt!==He&&yt!==Ke&&we.push(yt);const lt=He.split(",").map(mt=>mt.trim()).filter(Boolean);if(lt.length>=3&&we.push(lt.slice(0,2).join(" ")+", "+lt.slice(2).join(", ")),lt.length>=2){const mt=lt[0];if(/^[a-z0-9][a-z0-9\/\-]{0,12}$/i.test(mt)){const Bt=lt.slice(1).join(", ");Bt&&!we.includes(Bt)&&we.push(Bt);const Ht=Mt(Bt);Ht&&!we.includes(Ht)&&we.push(Ht)}}const ht=tr(He).toLowerCase(),ct=/\d/.test(ht)||/\//.test(ht),Dt=Array.from(new Set(ht.split(/[^a-z0-9]+/).filter(mt=>mt.length>=3)));function Nt(mt){const Bt=tr(String(mt||"")).toLowerCase();let Ht=0;(/viet\s*nam/.test(Bt)||/vietnam/.test(Bt))&&(Ht+=1);let gt=0;for(const Et of Dt)Bt.includes(Et)&&gt++;Ht+=Math.min(gt,6);const Ot=/\d/.test(Bt),Rt=/\//.test(Bt);return ct&&(Ot&&(Ht+=2),Rt&&(Ht+=1)),Ht}function ar(mt){return mt.slice().sort((Bt,Ht)=>Nt(Ht.display_name)-Nt(Bt.display_name))}const At=[];for(const mt of we)try{if(kg){const Bt=`https://maps.track-asia.com/api/v2/place/textsearch/json?language=vi&key=${encodeURIComponent(kg)}&query=${encodeURIComponent(mt)}&new_admin=true&include_old_admin=true`,gt=await(await fetch(Bt,{method:"GET"})).json();let Rt=(Array.isArray(gt==null?void 0:gt.results)?gt.results:[]).map(Et=>{var vs,vn,rs,Kt;return{lat:Number((vn=(vs=Et==null?void 0:Et.geometry)==null?void 0:vs.location)==null?void 0:vn.lat),lon:Number((Kt=(rs=Et==null?void 0:Et.geometry)==null?void 0:rs.location)==null?void 0:Kt.lng),display_name:(Et==null?void 0:Et.formatted_address)||(Et==null?void 0:Et.name)}}).filter(Et=>Number.isFinite(Et.lat)&&Number.isFinite(Et.lon));if(Rt=ar(Rt),Rt.length>0)return Rt}}catch{}for(const mt of we)try{const Bt=`https://nominatim.openstreetmap.org/search?format=json&limit=7&addressdetails=1&accept-language=vi,en&countrycodes=vn&q=${encodeURIComponent(mt)}`,gt=await(await fetch(Bt,{method:"GET"})).json();let Ot=(Array.isArray(gt)?gt:[]).filter(Rt=>Rt&&Rt.lat&&Rt.lon).map(Rt=>({lat:parseFloat(Rt.lat),lon:parseFloat(Rt.lon),display_name:Rt.display_name}));if(Ot=ar(Ot),Ot.length>0)return Ot}catch{}for(const mt of At)try{const Bt=`https://nominatim.openstreetmap.org/search?${mt}`,gt=await(await fetch(Bt,{method:"GET"})).json(),Ot=ar((Array.isArray(gt)?gt:[]).filter(Rt=>Rt&&Rt.lat&&Rt.lon).map(Rt=>({lat:parseFloat(Rt.lat),lon:parseFloat(Rt.lon),display_name:Rt.display_name})));if(Ot.length>0)return Ot}catch{}return[]}function St(Oe,we=9){const He=String(En);function Ke(yt){let lt=0;const ht=He,ct=yt,Dt=Math.max(ht.length,ct.length);for(let Nt=0;Nt<Dt;Nt++){const ar=ht.charCodeAt(Nt%ht.length)||0,At=ct.charCodeAt(Nt%ct.length)||0;lt=lt*31+ar+At>>>0}return lt}return Oe.slice().sort((yt,lt)=>Ke(yt.id)-Ke(lt.id)).slice(0,we)}function kt(Oe){window.location.hash=Oe}function Pr(Oe){_(we=>we.find(Ke=>Ke.productId===Oe)?we.map(Ke=>Ke.productId===Oe?{...Ke,qty:Ke.qty+1}:Ke):[...we,{productId:Oe,qty:1}])}function Rr(Oe){_(we=>we.filter(He=>He.productId!==Oe))}function hn(Oe,we){_(He=>He.map(Ke=>Ke.productId===Oe?{...Ke,qty:Math.max(1,Ke.qty+we)}:Ke))}const Ft=d.reduce((Oe,we)=>{const He=r.find(Ke=>Ke.id===we.productId);return Oe+(He?He.price*we.qty:0)},0);async function Fs(){var Oe,we,He,Ke,yt,lt,ht,ct;Le(null);try{const Dt=((Oe=$.current)==null?void 0:Oe.value)||ne,Nt=((we=H.current)==null?void 0:we.value)||me,ar=((He=te.current)==null?void 0:He.value)||Qe,At=((Ke=de.current)==null?void 0:Ke.value)||le,mt=((yt=q.current)==null?void 0:yt.value)||Be;if(U==="register"){if(!Dt||!Nt){Le("Vui lng nhp email v mt khu");return}if(!Je){Le("Bn phi ng  vi cc iu khon");return}await Ct.post(`${xh.replace(/\/$/,"")}/register`,{email:Dt,password:Nt,name:ar})}const Ht=(await Ct.post(`${xh.replace(/\/$/,"")}/login`,{email:Dt,password:Nt})).data.token;let gt=null;try{gt=(await Ct.get(`${xh.replace(/\/$/,"")}/me`,{headers:{Authorization:`Bearer ${Ht}`}})).data}catch{}const Ot={id:(gt==null?void 0:gt.id)||"",email:Dt,token:Ht,role:(gt==null?void 0:gt.role)||"user"};c(Ot),localStorage.setItem("ff_user",JSON.stringify(Ot)),ye(""),re(""),pe(""),ve(""),We(""),Ot.role==="admin"?kt("/admin"):kt("/")}catch(Dt){const Nt=(lt=Dt==null?void 0:Dt.response)==null?void 0:lt.status;let At=((ct=(ht=Dt==null?void 0:Dt.response)==null?void 0:ht.data)==null?void 0:ct.error)||Dt.message||"ng nhp/ng k tht bi";U==="login"&&(Nt===400||Nt===401||!Nt&&/network/i.test(String((Dt==null?void 0:Dt.message)||"")))&&(At="Ti khon hoc mt khu khng ng"),Le(String(At))}}async function so(){var Oe,we;Le(null);try{const He=((Oe=$.current)==null?void 0:Oe.value)||ne;if(!He){Le("Vui lng nhp email");return}const Ke=await Ct.get(`${xh.replace(/\/$/,"")}/exists`,{params:{email:He}});!!((we=Ke==null?void 0:Ke.data)!=null&&we.exists)?(ye(He),ur("newpass")):Le("Email khng tn ti")}catch{Le("Email khng tn ti")}}async function gs(){var Oe,we,He,Ke,yt;Le(null);try{const lt=((Oe=$.current)==null?void 0:Oe.value)||ne,ht=((we=$e.current)==null?void 0:we.value)||"",ct=((He=tt.current)==null?void 0:He.value)||"";if(!lt||!ht||!ct){Le("Vui lng nhp y ");return}if(ht!==ct){Le("Mt khu mi khng khp");return}await Ct.post(`${xh.replace(/\/$/,"")}/reset`,{email:lt,password:ht}),Zt(!1),re(""),alert("t li mt khu thnh cng. Vui lng ng nhp.")}catch(lt){Le(String(((yt=(Ke=lt==null?void 0:lt.response)==null?void 0:Ke.data)==null?void 0:yt.error)||lt.message||"t li mt khu tht bi"))}}function oo(){c(null),_([]),Li(null);try{localStorage.removeItem("ff_user")}catch{}kt("/")}async function ji(){var Ke,yt,lt,ht,ct,Dt,Nt,ar;if(!b){alert("Vui lng ng nhp hoc ng k trc khi t hng"),kt("/login");return}const Oe=((Ke=be.current)==null?void 0:Ke.value)??yr,we=((yt=Ce.current)==null?void 0:yt.value)??Sr,He=((lt=xe.current)==null?void 0:lt.value)??nr;if(!He.trim()){alert("Vui lng nhp a ch giao hng");return}try{const At={};b!=null&&b.token&&(At.Authorization=`Bearer ${b.token}`);let mt=rn,Bt=ci;if(!(typeof mt=="number"&&typeof Bt=="number")){const Ot=await Ve(He);if(Ot[0]){mt=Ot[0].lat,Bt=Ot[0].lon;try{Di(mt),un(Bt)}catch{}}}if(!(typeof mt=="number"&&typeof Bt=="number")){alert('Khng xc nh c v tr giao hng t a ch. Vui lng bm "nh v" hoc chn im trn bn  (click hoc ko marker), ri th li.');return}const gt=(await Ct.post(`${cl.replace(/\/$/,"")}/orders`,{items:d,shipping:{name:Oe,phone:we,address:He,lat:mt,lng:Bt},payment:{method:kn},userEmail:b.email},{headers:At})).data;if(Li(gt),_([]),kn==="VNPay")try{const Ot=await Ct.post(`${vM.replace(/\/$/,"")}/vnpay/create`,{amount:Number((gt==null?void 0:gt.total)||0),orderId:gt==null?void 0:gt.id}),Rt=(ht=Ot==null?void 0:Ot.data)==null?void 0:ht.url;if(Rt){window.location.href=Rt;return}else alert("Khng to c lin kt VNPay, chuyn sang ho n")}catch(Ot){alert("To thanh ton VNPay tht bi: "+(((Dt=(ct=Ot==null?void 0:Ot.response)==null?void 0:ct.data)==null?void 0:Dt.error)||(Ot==null?void 0:Ot.message)||""))}kt(`/bill/${(gt==null?void 0:gt.id)||""}`)}catch(At){alert("t hng tht bi: "+(((ar=(Nt=At.response)==null?void 0:Nt.data)==null?void 0:ar.error)||At.message))}}function _s(){const Oe=Array.from(new Set(r.map(ct=>Tt(ct.category||Lt(ct.name))))),we=Array.from(new Set([...Xt||[],...Oe]));let He=r.filter(ct=>(ct.name||"").toLowerCase().includes(hr.toLowerCase()));if(Wt&&Wt!=="Tt c"){const ct=Tt(Wt);He=He.filter(Dt=>Tt(Dt.category||Lt(Dt.name))===ct)}const Ke=dr?parseFloat(dr):void 0,yt=qe?parseFloat(qe):void 0;typeof Ke=="number"&&!Number.isNaN(Ke)&&(He=He.filter(ct=>(ct.price||0)>=Ke)),typeof yt=="number"&&!Number.isNaN(yt)&&(He=He.filter(ct=>(ct.price||0)<=yt)),bt&&(He=He.filter(ct=>(ct.stock??0)>0));const lt=!hr.trim()&&Wt==="Tt c"&&!dr&&!qe&&!bt;let ht=He;return ge==="/"&&lt&&!ms?ht=St(r,9):ht=He.slice().sort((ct,Dt)=>(ct.name||"").localeCompare(Dt.name||"")),R.jsxs("div",{children:[ge==="/"&&R.jsxs("div",{className:"card",style:{marginBottom:12},children:[R.jsxs("div",{className:"filters",children:[R.jsx("div",{className:"chips",children:["Tt c",...we].map(ct=>R.jsx("button",{className:"chip"+(Wt===ct?" active":""),onClick:()=>tn(ct),children:ct},ct))}),R.jsxs("div",{className:"range",children:[R.jsx("input",{type:"text",className:"input",placeholder:"Gi min",inputMode:"decimal",defaultValue:dr,ref:Te}),R.jsx("input",{type:"text",className:"input",placeholder:"Gi max",inputMode:"decimal",defaultValue:qe,ref:_e}),R.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6},children:[R.jsx("input",{type:"checkbox",checked:bt,onChange:ct=>Gt(ct.target.checked)})," Cn hng"]}),R.jsx("button",{className:"btn primary",onClick:()=>{var ct,Dt;Gr(((ct=Te.current)==null?void 0:ct.value)||""),ft(((Dt=_e.current)==null?void 0:Dt.value)||"")},children:"p dng"}),R.jsx("button",{className:"btn ghost",onClick:()=>{tn("Tt c"),Gr(""),ft(""),Te.current&&(Te.current.value=""),_e.current&&(_e.current.value=""),Gt(!1)},children:"Reset"})]})]}),ge==="/"&&lt&&R.jsx("div",{style:{display:"flex",gap:8,marginTop:10,flexWrap:"wrap"},children:ms?R.jsx("button",{className:"btn ghost",onClick:()=>qn(!1),children:"Ch hin th gi "}):R.jsxs(R.Fragment,{children:[R.jsx("span",{className:"loading",style:{padding:0},children:"ang hin th gi  hm nay"}),R.jsx("button",{className:"btn ghost",onClick:()=>{const ct=(En+1)%1e5;xi(ct);try{localStorage.setItem("ff_reco_seed",String(ct))}catch{}},children:"Gi  khc"}),R.jsx("button",{className:"btn ghost",onClick:()=>qn(!0),children:"Xem tt c"})]})})]}),x?R.jsx("div",{className:"loading",children:"ang ti sn phm..."}):ht.length===0?R.jsx("div",{className:"loading",children:"Khng tm thy mn ph hp"}):R.jsx("div",{className:"products-grid",children:ht.map(ct=>R.jsxs("div",{className:"product-card",children:[R.jsxs("div",{className:"product-media",onClick:()=>kt(`/product/${ct.id}`),style:{cursor:"pointer"},children:[R.jsx("div",{className:"badge",children:Tt(ct.category||Lt(ct.name))}),(()=>{const Dt=qt(ct);return R.jsx(Eg,{src:Dt[0],srcList:Dt.slice(1),alt:ct.name},ct.id)})()]}),R.jsxs("div",{className:"product-body",children:[R.jsx("div",{className:"product-name",children:ct.name}),R.jsxs("div",{className:"product-price",children:["$",ct.price.toFixed(2)]}),ct.description&&R.jsx("div",{className:"product-desc",children:ct.description}),R.jsxs("div",{className:"product-actions",children:[R.jsx("button",{className:"btn primary",onClick:()=>Pr(ct.id),children:"Thm"}),R.jsx("button",{className:"btn small",onClick:()=>hn(ct.id,1),children:"+1"})]})]})]},ct.id))})]})}function Or(){return R.jsxs("div",{className:"auth-page",children:[R.jsx("h2",{children:U==="login"?"ng nhp":"ng k"}),R.jsxs("div",{className:"card",children:[ce&&R.jsx("div",{className:"error",children:ce}),U==="login"&&rt?zt==="email"&&R.jsxs("div",{className:"form-row",children:[R.jsx("label",{children:"Email"}),R.jsx("input",{className:"input",placeholder:"email",type:"email",name:"email",inputMode:"email",autoComplete:"username",defaultValue:ne,ref:$})]}):R.jsxs("div",{className:"form-row",children:[R.jsx("label",{children:"Email"}),R.jsx("input",{className:"input",placeholder:"email",type:"email",name:"email",inputMode:"email",autoComplete:U==="login"?"username":"email",defaultValue:ne,ref:$})]}),U==="register"&&R.jsxs(R.Fragment,{children:[R.jsxs("div",{className:"form-row",children:[R.jsx("label",{children:"H tn"}),R.jsx("input",{className:"input",placeholder:"h tn",name:"name",autoComplete:"name",defaultValue:Qe,ref:te})]}),R.jsxs("div",{className:"form-row",children:[R.jsx("label",{children:"S in thoi"}),R.jsx("input",{className:"input",placeholder:"s in thoi",type:"tel",name:"tel",inputMode:"tel",autoComplete:"tel",defaultValue:le,ref:de})]}),R.jsxs("div",{className:"form-row",children:[R.jsx("label",{children:"a ch"}),R.jsx("input",{className:"input",placeholder:"a ch",name:"street-address",autoComplete:"street-address",defaultValue:Be,ref:q})]})]}),!(U==="login"&&rt)&&R.jsxs("div",{className:"form-row",children:[R.jsx("label",{children:"Mt khu"}),R.jsx("input",{className:"input",placeholder:"mt khu",type:"password",name:U==="login"?"current-password":"new-password",autoComplete:U==="login"?"current-password":"new-password",defaultValue:me,ref:H})]}),U==="login"&&!rt&&R.jsx("div",{style:{marginBottom:8},children:R.jsx("button",{className:"btn ghost",onClick:()=>{var Oe;ye(((Oe=$.current)==null?void 0:Oe.value)||ne),Zt(!0),ur("email")},children:"Qun mt khu?"})}),U==="login"&&rt&&zt==="email"&&R.jsxs("div",{style:{display:"flex",gap:8},children:[R.jsx("button",{className:"btn primary",onClick:so,children:"Tip tc"}),R.jsx("button",{className:"btn ghost",onClick:()=>{Zt(!1),ur("email")},children:"Hu"})]}),U==="login"&&rt&&zt==="newpass"&&R.jsxs(R.Fragment,{children:[R.jsxs("div",{className:"form-row",children:[R.jsx("label",{children:"Mt khu mi"}),R.jsx("input",{className:"input",type:"password",ref:$e,placeholder:"mt khu mi"})]}),R.jsxs("div",{className:"form-row",children:[R.jsx("label",{children:"Nhp li mt khu mi"}),R.jsx("input",{className:"input",type:"password",ref:tt,placeholder:"nhp li mt khu mi"})]}),R.jsxs("div",{style:{display:"flex",gap:8},children:[R.jsx("button",{className:"btn primary",onClick:gs,children:"t li mt khu"}),R.jsx("button",{className:"btn ghost",onClick:()=>{Zt(!1),ur("email")},children:"Hu"})]})]}),U==="register"&&R.jsx("div",{className:"form-row",children:R.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,justifyContent:"flex-start"},children:[R.jsx("input",{id:"agree-terms",type:"checkbox",checked:Je,onChange:Oe=>st(Oe.target.checked)}),R.jsx("span",{children:"Ti ng  vi cc iu khon"})]})}),!(U==="login"&&rt)&&R.jsx("div",{children:R.jsx("button",{className:"btn primary",onClick:Fs,disabled:U==="register"&&!Je,children:U==="login"?"ng nhp":"ng k"})}),U==="register"&&R.jsx("div",{className:"required-fields",children:"* Cc trng bt buc"})]})]})}function Hn({id:Oe}){var lt,ht,ct,Dt;const[we,He]=Re.useState(Gn&&(Gn==null?void 0:Gn.id)===Oe?Gn:null);if(Re.useEffect(()=>{!we&&Oe&&Ct.get(`${cl.replace(/\/$/,"")}/orders/${Oe}`).then(Nt=>He(Nt.data)).catch(()=>{})},[Oe]),Re.useEffect(()=>{if(!Oe)return;let Nt=null;try{Nt=new EventSource(`${cl.replace(/\/$/,"")}/orders/${Oe}/events`),Nt.addEventListener("status",ar=>{try{const At=JSON.parse(ar.data||"{}");He(mt=>({...mt||{},status:At.status}))}catch{}})}catch{}return()=>{try{Nt&&Nt.close()}catch{}}},[Oe]),!we)return R.jsx("div",{className:"page",children:R.jsx("div",{className:"card",children:R.jsx("div",{className:"loading",children:"ang ti n hng..."})})});const Ke=we.items||[],yt=we.total||0;return R.jsxs("div",{className:"page",children:[R.jsx("h2",{children:"Ha n"}),R.jsxs("div",{className:"card",children:[R.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[R.jsxs("div",{children:[R.jsx("b",{children:"M n:"})," ",we.id]}),we.createdAt&&R.jsxs("div",{children:[R.jsx("b",{children:"Thi gian:"})," ",new Date(we.createdAt).toLocaleString()]}),we.status&&R.jsxs("div",{children:[R.jsx("b",{children:"Trng thi:"})," ",we.status]}),R.jsxs("div",{children:[R.jsx("b",{children:"Ngi nhn:"})," ",we.shippingName||((lt=we==null?void 0:we.shipping)==null?void 0:lt.name)||yr]}),R.jsxs("div",{children:[R.jsx("b",{children:"in thoi:"})," ",we.shippingPhone||((ht=we==null?void 0:we.shipping)==null?void 0:ht.phone)||Sr]}),R.jsxs("div",{children:[R.jsx("b",{children:"a ch:"})," ",we.shippingAddress||((ct=we==null?void 0:we.shipping)==null?void 0:ct.address)||nr]}),R.jsxs("div",{children:[R.jsx("b",{children:"Thanh ton:"})," ",(we.paymentMethod||((Dt=we==null?void 0:we.payment)==null?void 0:Dt.method)||kn)==="COD"?"COD (Thanh ton khi nhn hng)":"VNPay"]})]}),R.jsxs("div",{style:{marginTop:12},children:[R.jsx("div",{style:{fontWeight:700,marginBottom:8},children:"Sn phm"}),R.jsx("ul",{style:{listStyle:"none",padding:0,margin:0},children:Ke.map((Nt,ar)=>{const At=r.find(mt=>mt.id===Nt.productId);return R.jsxs("li",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:8},children:[R.jsx("img",{src:or(At,Nt.productId),style:{width:70,height:48,objectFit:"cover",borderRadius:8}}),R.jsxs("div",{style:{flex:1},children:[R.jsx("div",{style:{fontWeight:600},children:(At==null?void 0:At.name)||Nt.productId}),R.jsxs("div",{style:{color:"var(--muted)"},children:["SL: ",Nt.qty]})]}),R.jsx("div",{style:{fontWeight:600},children:At?`$${(At.price*Nt.qty).toFixed(2)}`:""})]},ar)})}),R.jsxs("div",{style:{marginTop:8,fontWeight:700},children:["Tng cng: $",Number(yt).toFixed(2)]})]}),R.jsxs("div",{style:{marginTop:12,display:"flex",gap:8},children:[R.jsx("a",{className:"btn ghost",href:"#/",children:"V trang ch"}),R.jsx("a",{className:"btn primary",href:`#/track/${Oe}`,children:"Theo di n hng"}),R.jsx("a",{className:"btn ghost",href:"#/history",children:"Lch s"})]})]})]})}function Cr(){const[Oe,we]=Re.useState([]);Re.useEffect(()=>{const Ke=(b==null?void 0:b.email)||"",yt=`${cl.replace(/\/$/,"")}/orders`+(Ke?`?email=${encodeURIComponent(Ke)}`:"");Ct.get(yt).then(lt=>{const ht=lt.data,ct=Array.isArray(ht)?ht:Array.isArray(ht==null?void 0:ht.data)?ht.data:[];we(ct||[])}).catch(()=>we([]))},[b]);const He=Re.useRef({});return Re.useEffect(()=>{const Ke=He.current||{},yt=new Set(Oe.map(lt=>lt.id));for(const lt of Object.keys(Ke))if(!yt.has(lt)){try{Ke[lt].close()}catch{}delete Ke[lt]}for(const lt of Oe)if(!Ke[lt.id])try{const ht=new EventSource(`${cl.replace(/\/$/,"")}/orders/${lt.id}/events`);ht.addEventListener("status",ct=>{try{const Dt=JSON.parse(ct.data||"{}");we(Nt=>Nt.map(ar=>ar.id===lt.id?{...ar,status:Dt.status}:ar))}catch{}}),Ke[lt.id]=ht}catch{}return He.current=Ke,()=>{for(const lt of Object.keys(Ke))try{Ke[lt].close()}catch{}}},[Oe]),R.jsxs("div",{className:"page",children:[R.jsx("h2",{children:"Lch s mua hng"}),R.jsx("div",{className:"card",children:Oe.length===0?R.jsx("div",{className:"loading",children:"Cha c n hng"}):R.jsx("ul",{style:{listStyle:"none",padding:0,margin:0},children:Oe.map(Ke=>R.jsxs("li",{style:{padding:8,borderBottom:"1px solid var(--border)",display:"flex",alignItems:"center",gap:8,justifyContent:"space-between"},children:[R.jsxs("div",{style:{flex:1},children:[R.jsxs("div",{style:{fontWeight:600},children:["n #",Ke.id.slice(0,6),"  $",Number(Ke.total).toFixed(2)]}),R.jsxs("div",{style:{color:"var(--muted)"},children:[Ke.createdAt?new Date(Ke.createdAt).toLocaleString():"","  ",Ke.paymentMethod||"COD"]}),R.jsxs("div",{style:{color:"var(--muted)"},children:["a ch: ",Ke.shippingAddress||""]})]}),R.jsxs("div",{style:{display:"flex",gap:6},children:[R.jsx("a",{className:"btn small ghost",href:`#/bill/${Ke.id}`,children:"Ha n"}),R.jsx("a",{className:"btn small primary",href:`#/track/${Ke.id}`,children:"Theo di"})]})]},Ke.id))})})]})}function ao({status:Oe}){const we=[{key:"to_rest",label:"iu drone ti nh hng",icon:""},{key:"pickup",label:"Bt u ly  n",icon:""},{key:"ready",label:"Chun b giao hng",icon:""},{key:"shipping",label:"ang giao  n bng drone",icon:""},{key:"done",label:" giao  n ti nh",icon:""}],He={"iu drone ti nh hng":0,"Bt u ly  n":1,"Chun b giao hng":2,"ang giao  n bng drone":3," giao  n ti nh":4},Ke=typeof Oe=="string"&&Oe in He?He[Oe]:0,yt=Math.max(0,Math.min(100,Ke/(we.length-1)*100));return R.jsxs("div",{className:"steps",children:[R.jsx("div",{className:"rail",children:R.jsx("div",{className:"fill",style:{width:`${yt}%`}})}),we.map((lt,ht)=>R.jsxs("div",{className:`step${ht<Ke?" completed":ht===Ke?" active":""}`,children:[R.jsx("div",{className:"circle","aria-hidden":!0,children:lt.icon}),R.jsx("div",{className:"label",children:lt.label})]},lt.key))]})}function Bs({id:Oe}){const[we,He]=Re.useState(null),Ke=Re.useRef(null),yt=Re.useRef(null),lt=Re.useRef(null),ht=Re.useRef([]),ct=Re.useRef([]),Dt=Re.useRef(new Set);return Re.useEffect(()=>{try{if(window.L&&!Ke.current){const ar=window.L,At=[10.776889,106.700806];Ke.current=ar.map("trackmap").setView(At,13),ar.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19}).addTo(Ke.current)}}catch{}Ct.get(`${cl.replace(/\/$/,"")}/orders/${Oe}`).then(ar=>He(ar.data)).catch(()=>{});let Nt=null;try{Nt=new EventSource(`${cl.replace(/\/$/,"")}/orders/${Oe}/events`),Nt.addEventListener("status",ar=>{try{const At=JSON.parse(ar.data||"{}");He(mt=>({...mt||{},status:At.status}))}catch{}}),Nt.addEventListener("drone",ar=>{try{const At=JSON.parse(ar.data||"{}");if(!window.L)return;const mt=window.L;if(!Ke.current){const Bt=[10.776889,106.700806];Ke.current=mt.map("trackmap").setView(Bt,13),mt.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19}).addTo(Ke.current)}if(At.type==="route"&&Array.isArray(At.path)){const Bt=At.path.map(gt=>[gt.lat,gt.lng]);if(At.append&&lt.current)try{const Ot=(lt.current.getLatLngs()||[]).concat(Bt.map(Rt=>mt.latLng(Rt[0],Rt[1])));lt.current.setLatLngs(Ot)}catch{try{lt.current=mt.polyline(Bt,{color:"#7c3aed"}).addTo(Ke.current)}catch{}}else{if(lt.current)try{Ke.current.removeLayer(lt.current)}catch{}lt.current=mt.polyline(Bt,{color:"#7c3aed"}).addTo(Ke.current),Dt.current=new Set;for(const gt of ht.current)try{Ke.current.removeLayer(gt)}catch{}ht.current=[]}try{Ke.current.fitBounds(lt.current.getBounds(),{padding:[20,20]})}catch{}if(Array.isArray(At.stops)){ct.current=At.stops;for(const gt of ht.current)try{Ke.current.removeLayer(gt)}catch{}ht.current=[],At.stops.forEach(gt=>{try{const Ot=mt.marker([gt.lat,gt.lng]).addTo(Ke.current),Rt=`<div><strong>${gt.name||"Nh hng"}</strong><div>${gt.address||""}</div></div>`;Ot.bindPopup(Rt),ht.current.push(Ot)}catch{}})}const Ht=Bt[0];Ht&&(yt.current?yt.current.setLatLng(Ht):yt.current=mt.marker(Ht).addTo(Ke.current))}else if(At.type==="pos"&&typeof At.lat=="number"&&typeof At.lng=="number"){yt.current?yt.current.setLatLng([At.lat,At.lng]):yt.current=window.L.marker([At.lat,At.lng]).addTo(Ke.current);try{const Bt=mt.latLng(At.lat,At.lng),Ht=ct.current||[];for(let gt=0;gt<Ht.length;gt++){if(Dt.current.has(gt))continue;const Ot=Ht[gt];if(Bt.distanceTo(mt.latLng(Ot.lat,Ot.lng))<200){Dt.current.add(gt);const Et=ht.current[gt];try{Et&&Et.openPopup()}catch{}break}}}catch{}}else At.type}catch{}})}catch{}return()=>{try{Nt&&Nt.close()}catch{}}},[Oe]),R.jsxs("div",{className:"page",children:[R.jsx("h2",{children:"Theo di n hng"}),R.jsxs("div",{className:"card",children:[R.jsx("div",{id:"trackmap",style:{width:"100%",height:360,borderRadius:12}}),R.jsx("div",{style:{marginTop:12},children:R.jsx(ao,{status:we==null?void 0:we.status})}),R.jsx("div",{style:{marginTop:8,display:"flex",gap:8},children:R.jsx("a",{className:"btn ghost",href:`#/bill/${Oe}`,children:"Xem ho n"})})]})]})}function Ta(){const[Oe,we]=Re.useState([]);return Re.useEffect(()=>{Ct.get(`${Ec.replace(/\/$/,"")}/restaurants`).then(He=>we(He.data||[])).catch(()=>we([]))},[]),R.jsxs("div",{className:"page",children:[R.jsx("h2",{children:"Nh hng"}),R.jsx("div",{className:"card",children:Oe.length===0?R.jsx("div",{className:"loading",children:"Cha c nh hng"}):R.jsx("div",{className:"restaurants-grid",children:Oe.map(He=>R.jsx("div",{className:"restaurant-card",children:R.jsxs("div",{className:"restaurant-body",children:[R.jsx("div",{className:"restaurant-name",children:He.name}),He.address&&R.jsx("div",{className:"restaurant-addr",children:He.address}),R.jsx("div",{style:{marginTop:10},children:R.jsx("a",{className:"btn primary",href:`#/restaurant/${He.id}`,children:"Xem menu"})})]})},He.id))})})]})}function ys({id:Oe}){const[we,He]=Re.useState(null),[Ke,yt]=Re.useState([]);Re.useEffect(()=>{Ct.get(`${Ec.replace(/\/$/,"")}/restaurants/${Oe}`).then(ht=>He(ht.data)).catch(()=>He(null)),Ct.get(`${Ec.replace(/\/$/,"")}/products`).then(ht=>yt(ht.data||[])).catch(()=>yt([]))},[Oe]);const lt=Ke.filter(ht=>(ht.restaurantId||"")===Oe);return R.jsxs("div",{className:"page",children:[R.jsx("h2",{children:(we==null?void 0:we.name)||"Nh hng"}),R.jsxs("div",{className:"card",children:[(we==null?void 0:we.address)&&R.jsxs("div",{style:{marginBottom:12,color:"var(--muted)"},children:["a ch: ",we.address]}),lt.length===0?R.jsx("div",{className:"loading",children:"Nh hng cha c mn"}):R.jsx("div",{className:"products-grid",children:lt.map(ht=>R.jsxs("div",{className:"product-card",children:[R.jsxs("div",{className:"product-media",onClick:()=>kt(`/product/${ht.id}`),style:{cursor:"pointer"},children:[R.jsx("div",{className:"badge",children:Tt(ht.category||Lt(ht.name))}),(()=>{const ct=qt(ht);return R.jsx(Eg,{src:ct[0],srcList:ct.slice(1),alt:ht.name},ht.id)})()]}),R.jsxs("div",{className:"product-body",children:[R.jsx("div",{className:"product-name",children:ht.name}),R.jsxs("div",{className:"product-price",children:["$",ht.price.toFixed(2)]}),ht.description&&R.jsx("div",{className:"product-desc",children:ht.description}),R.jsxs("div",{className:"product-actions",children:[R.jsx("button",{className:"btn primary",onClick:()=>Pr(ht.id),children:"Thm"}),R.jsx("button",{className:"btn small",onClick:()=>hn(ht.id,1),children:"+1"})]})]})]},ht.id))})]})]})}function Fi(){return R.jsxs("div",{className:"page",children:[R.jsx("h2",{children:"Gi hng"}),R.jsxs("div",{className:"card",children:[d.length===0?R.jsx("div",{children:"Gi hng trng"}):R.jsx("ul",{style:{listStyle:"none",padding:0},children:d.map(Oe=>{const we=r.find(He=>He.id===Oe.productId);return R.jsxs("li",{style:{marginBottom:10,display:"flex",gap:12,alignItems:"center"},children:[R.jsx("img",{src:or(we,Oe.productId),style:{width:90,height:60,objectFit:"cover",borderRadius:6}}),R.jsxs("div",{style:{flex:1},children:[R.jsx("div",{style:{fontWeight:700},children:(we==null?void 0:we.name)||Oe.productId}),R.jsxs("div",{style:{color:"var(--muted)"},children:["$",((we==null?void 0:we.price)||0).toFixed(2)]})]}),R.jsxs("div",{children:[R.jsx("button",{className:"btn ghost small",onClick:()=>hn(Oe.productId,-1),children:"-"}),R.jsx("span",{style:{margin:"0 8px"},children:Oe.qty}),R.jsx("button",{className:"btn ghost small",onClick:()=>hn(Oe.productId,1),children:"+"}),R.jsx("button",{className:"btn ghost small",onClick:()=>Rr(Oe.productId),style:{marginLeft:8},children:"Xo"})]})]},Oe.productId)})}),R.jsxs("div",{style:{marginTop:12},children:[R.jsxs("div",{style:{fontWeight:700},children:["Tm tnh: $",Ft.toFixed(2)]}),R.jsx("div",{style:{marginTop:8},children:R.jsx("button",{className:"btn primary",onClick:()=>kt("/checkout"),disabled:d.length===0,children:"Thanh ton"})})]})]})]})}function Ml(){const Oe=Re.useRef(null),we=Re.useRef(null),[He,Ke]=Re.useState(!1),[yt,lt]=Re.useState(null),[ht,ct]=Re.useState([]),[Dt,Nt]=Re.useState(0),ar=Re.useRef(null);async function At(mt){var Bt;try{const Ht=((mt??((Bt=xe.current)==null?void 0:Bt.value)??nr)||"").trim();if(!Ht)return;Ke(!0),lt(null);const gt=await Ve(Ht);ct(gt),gt[0]?(Di(gt[0].lat),un(gt[0].lon)):lt("Khng tm thy v tr ph hp")}catch{lt("nh v tht bi")}finally{Ke(!1)}}return Re.useEffect(()=>{try{const mt=pM;if(!mt)return;const Bt=typeof rn=="number"&&typeof ci=="number";if(!Oe.current){const Ht=[Bt?ci:106.700806,Bt?rn:10.776889];Oe.current=new mt.Map({container:"shipmap",style:`https://maps.track-asia.com/styles/v2/streets.json?key=${encodeURIComponent(kg||"a8da2e51d0a720ef81a1762860280f15fa")}`,center:Ht,zoom:Bt?16:13}),Oe.current.on("click",gt=>{try{const{lng:Ot,lat:Rt}=(gt==null?void 0:gt.lngLat)||{};typeof Rt=="number"&&typeof Ot=="number"&&(Di(Rt),un(Ot),we.current&&we.current.setLngLat([Ot,Rt]))}catch{}})}Bt&&(we.current?we.current.setLngLat([ci,rn]):(we.current=new mt.Marker({draggable:!0}).setLngLat([ci,rn]).addTo(Oe.current),we.current.on("dragend",()=>{try{const Ht=we.current.getLngLat();Di(Ht.lat),un(Ht.lng)}catch{}})),Oe.current&&Oe.current.flyTo&&Oe.current.flyTo({center:[ci,rn],zoom:16}))}catch{}return()=>{try{ar.current&&(clearTimeout(ar.current),ar.current=null)}catch{}}},[rn,ci,Dt]),R.jsxs("div",{className:"page",children:[R.jsx("h2",{children:"Thanh ton"}),R.jsxs("div",{className:"card",children:[R.jsxs("div",{children:["Tm tnh: $",Ft.toFixed(2)]}),R.jsxs("div",{className:"form-row",style:{marginTop:12},children:[R.jsx("label",{children:"H tn ngi nhn"}),R.jsx("input",{className:"input",placeholder:"Nguyn Vn A",name:"name",autoComplete:"shipping name",defaultValue:yr,ref:be,onBlur:mt=>qr(mt.target.value)})]}),R.jsxs("div",{className:"form-row",children:[R.jsx("label",{children:"S in thoi"}),R.jsx("input",{className:"input",placeholder:"09xx xxx xxx",type:"tel",inputMode:"tel",name:"tel",autoComplete:"shipping tel",defaultValue:Sr,ref:Ce,onBlur:mt=>mr(mt.target.value)})]}),R.jsxs("div",{className:"form-row",children:[R.jsx("label",{children:"a ch giao hng"}),R.jsx("input",{className:"input",placeholder:"S nh, ng, phng/x, qun/huyn, tnh/thnh",name:"street-address",autoComplete:"shipping street-address",defaultValue:nr,ref:xe,onBlur:mt=>{Qi(mt.target.value),At(mt.target.value)}})]}),R.jsxs("div",{className:"form-row",style:{display:"flex",alignItems:"center",gap:8},children:[R.jsx("button",{className:"btn small",onClick:mt=>{mt.preventDefault(),At()},children:"nh v"}),He&&R.jsx("div",{className:"loading",style:{padding:0},children:"ang nh v..."}),yt&&R.jsx("div",{className:"error",children:yt})]}),R.jsx("div",{style:{marginTop:8},children:R.jsx("div",{id:"shipmap",style:{width:"100%",height:260,borderRadius:12}})}),ht.length>=1&&R.jsxs("div",{className:"form-row",children:[R.jsx("label",{children:"Gi "}),R.jsx("ul",{style:{listStyle:"none",padding:0,margin:0},children:ht.slice(0,5).map((mt,Bt)=>R.jsx("li",{children:R.jsx("a",{href:"#",onClick:Ht=>{Ht.preventDefault(),Di(mt.lat),un(mt.lon);try{we.current&&Oe.current&&Oe.current.flyTo&&(we.current.setLngLat([mt.lon,mt.lat]),Oe.current.flyTo({center:[mt.lon,mt.lat],zoom:16}))}catch{}},children:mt.display_name||`${mt.lat},${mt.lon}`})},Bt))})]}),R.jsxs("div",{className:"form-row",children:[R.jsx("label",{children:"Phng thc thanh ton"}),R.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",flexWrap:"wrap"},children:[R.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6},children:[R.jsx("input",{type:"radio",name:"payment",checked:kn==="COD",onChange:()=>Ji("COD")})," COD (Thanh ton khi nhn hng)"]}),R.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6},children:[R.jsx("input",{type:"radio",name:"payment",checked:kn==="VNPay",onChange:()=>Ji("VNPay")})," VNPay"]})]})]}),kn==="VNPay"&&R.jsx(R.Fragment,{}),R.jsx("div",{style:{marginTop:12},children:R.jsx("button",{className:"btn primary",onClick:ji,disabled:d.length===0,children:"t hng"})})]})]})}function Sa({id:Oe}){const we=r.find(yt=>yt.id===Oe);if(!we)return R.jsx("div",{children:"Khng tm thy sn phm"});const[He,Ke]=Re.useState(null);return Re.useEffect(()=>{const yt=we==null?void 0:we.restaurantId;yt?Ct.get(`${Ec.replace(/\/$/,"")}/restaurants/${yt}`).then(lt=>Ke(lt.data)).catch(()=>Ke(null)):Ke(null)},[Oe]),R.jsxs("div",{children:[R.jsx("button",{className:"btn ghost",onClick:()=>kt("/"),children:"Quay li"}),R.jsx("h2",{children:we.name}),R.jsx("div",{className:"product-hero",children:(()=>{const yt=qt(we);return R.jsx(Eg,{src:yt[0],srcList:yt.slice(1),alt:we.name})})()}),R.jsxs("p",{children:["Gi: $",we.price.toFixed(2)]}),(He==null?void 0:He.name)&&R.jsxs("p",{children:["Nh hng: ",R.jsx("a",{href:`#/restaurant/${He.id}`,children:He.name})]}),we.description&&R.jsx("p",{children:we.description}),R.jsx("button",{className:"btn primary",onClick:()=>Pr(we.id),children:"Thm vo gi"})]})}return R.jsx("div",{children:R.jsxs("div",{className:"app-container",children:[R.jsxs("header",{className:"site-header",children:[R.jsx("div",{className:"site-title",children:R.jsx("span",{className:"logo",children:"FF"})}),R.jsxs("nav",{className:"nav-links",children:[R.jsx("a",{href:"#/",children:"Trang ch"}),R.jsx("a",{href:"#/restaurants",children:"Nh hng"}),R.jsx("a",{href:"#/cart",children:"Gi hng"}),R.jsx("a",{href:"#/history",children:"Lch s"}),b&&b.role==="admin"&&R.jsx("a",{href:"#/admin",children:"Admin"}),b?R.jsxs(R.Fragment,{children:[R.jsx("span",{className:"user-email",children:b.email}),R.jsx("button",{className:"btn ghost small",onClick:oo,children:"ng xut"})]}):R.jsxs(R.Fragment,{children:[R.jsx("a",{href:"#/login",children:"ng nhp"}),R.jsx("a",{href:"#/register",children:"ng k"})]})]})]}),R.jsx("div",{className:"hero",children:R.jsxs("div",{className:"hero-content",children:[R.jsx("h1",{children:"Ngon, nhanh, tn ni"}),R.jsx("p",{children:"t mn n yu thch v giao tn nh trong tch tc"}),ge==="/"&&R.jsx("div",{className:"hero-search",children:R.jsx("input",{ref:br,className:"input",placeholder:"Tm mn n...",value:hr,onChange:Oe=>_r(Oe.target.value)})})]})}),R.jsx("main",{children:ge.startsWith("/product/")?R.jsx(Sa,{id:ge.split("/product/")[1]}):ge.startsWith("/bill/")?R.jsx(Hn,{id:ge.split("/bill/")[1]}):ge.startsWith("/track/")?R.jsx(Bs,{id:ge.split("/track/")[1]}):ge==="/restaurants"?R.jsx(Ta,{}):ge.startsWith("/restaurant/")?R.jsx(ys,{id:ge.split("/restaurant/")[1]}):ge==="/history"?R.jsx(Cr,{}):ge==="/cart"?R.jsx(Fi,{}):ge==="/login"||ge==="/register"?R.jsx(Or,{}):ge==="/checkout"?R.jsx(Ml,{}):ge==="/admin"?R.jsx(yM,{}):ge==="/admin/restaurants/new"?R.jsx(_M,{}):ge==="/admin/products/new"?R.jsx(gM,{}):R.jsx(_s,{})})]})})}const O0=document.getElementById("root");O0&&Qb(O0).render(R.jsx(xM,{}));
